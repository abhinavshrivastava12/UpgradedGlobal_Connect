var pq=Object.defineProperty;var fq=(o,d,m)=>d in o?pq(o,d,{enumerable:!0,configurable:!0,writable:!0,value:m}):o[d]=m;var mq=(o,d)=>()=>(d||o((d={exports:{}}).exports,d),d.exports);var aj=(o,d,m)=>fq(o,typeof d!="symbol"?d+"":d,m);var Lre=mq((tse,AC)=>{(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))_(v);new MutationObserver(v=>{for(const w of v)if(w.type==="childList")for(const D of w.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&_(D)}).observe(document,{childList:!0,subtree:!0});function m(v){const w={};return v.integrity&&(w.integrity=v.integrity),v.referrerPolicy&&(w.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?w.credentials="include":v.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function _(v){if(v.ep)return;v.ep=!0;const w=m(v);fetch(v.href,w)}})();var c1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function aF(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var l1={exports:{}},NS={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oj;function _q(){if(oj)return NS;oj=1;var o=Symbol.for("react.transitional.element"),d=Symbol.for("react.fragment");function m(_,v,w){var D=null;if(w!==void 0&&(D=""+w),v.key!==void 0&&(D=""+v.key),"key"in v){w={};for(var B in v)B!=="key"&&(w[B]=v[B])}else w=v;return v=w.ref,{$$typeof:o,type:_,key:D,ref:v!==void 0?v:null,props:w}}return NS.Fragment=d,NS.jsx=m,NS.jsxs=m,NS}var cj;function Eq(){return cj||(cj=1,l1.exports=_q()),l1.exports}var N=Eq(),d1={exports:{}},vn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lj;function gq(){if(lj)return vn;lj=1;var o=Symbol.for("react.transitional.element"),d=Symbol.for("react.portal"),m=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),v=Symbol.for("react.profiler"),w=Symbol.for("react.consumer"),D=Symbol.for("react.context"),B=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),F=Symbol.for("react.memo"),X=Symbol.for("react.lazy"),Q=Symbol.iterator;function oe(ne){return ne===null||typeof ne!="object"?null:(ne=Q&&ne[Q]||ne["@@iterator"],typeof ne=="function"?ne:null)}var Ae={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ie=Object.assign,fe={};function ae(ne,Ke,gt){this.props=ne,this.context=Ke,this.refs=fe,this.updater=gt||Ae}ae.prototype.isReactComponent={},ae.prototype.setState=function(ne,Ke){if(typeof ne!="object"&&typeof ne!="function"&&ne!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ne,Ke,"setState")},ae.prototype.forceUpdate=function(ne){this.updater.enqueueForceUpdate(this,ne,"forceUpdate")};function ve(){}ve.prototype=ae.prototype;function be(ne,Ke,gt){this.props=ne,this.context=Ke,this.refs=fe,this.updater=gt||Ae}var _e=be.prototype=new ve;_e.constructor=be,ie(_e,ae.prototype),_e.isPureReactComponent=!0;var Qe=Array.isArray,Ye={H:null,A:null,T:null,S:null},Et=Object.prototype.hasOwnProperty;function Ge(ne,Ke,gt,bt,it,en){return gt=en.ref,{$$typeof:o,type:ne,key:Ke,ref:gt!==void 0?gt:null,props:en}}function Je(ne,Ke){return Ge(ne.type,Ke,void 0,void 0,void 0,ne.props)}function we(ne){return typeof ne=="object"&&ne!==null&&ne.$$typeof===o}function We(ne){var Ke={"=":"=0",":":"=2"};return"$"+ne.replace(/[=:]/g,function(gt){return Ke[gt]})}var ct=/\/+/g;function Tt(ne,Ke){return typeof ne=="object"&&ne!==null&&ne.key!=null?We(""+ne.key):Ke.toString(36)}function rn(){}function fn(ne){switch(ne.status){case"fulfilled":return ne.value;case"rejected":throw ne.reason;default:switch(typeof ne.status=="string"?ne.then(rn,rn):(ne.status="pending",ne.then(function(Ke){ne.status==="pending"&&(ne.status="fulfilled",ne.value=Ke)},function(Ke){ne.status==="pending"&&(ne.status="rejected",ne.reason=Ke)})),ne.status){case"fulfilled":return ne.value;case"rejected":throw ne.reason}}throw ne}function bn(ne,Ke,gt,bt,it){var en=typeof ne;(en==="undefined"||en==="boolean")&&(ne=null);var Nt=!1;if(ne===null)Nt=!0;else switch(en){case"bigint":case"string":case"number":Nt=!0;break;case"object":switch(ne.$$typeof){case o:case d:Nt=!0;break;case X:return Nt=ne._init,bn(Nt(ne._payload),Ke,gt,bt,it)}}if(Nt)return it=it(ne),Nt=bt===""?"."+Tt(ne,0):bt,Qe(it)?(gt="",Nt!=null&&(gt=Nt.replace(ct,"$&/")+"/"),bn(it,Ke,gt,"",function(qt){return qt})):it!=null&&(we(it)&&(it=Je(it,gt+(it.key==null||ne&&ne.key===it.key?"":(""+it.key).replace(ct,"$&/")+"/")+Nt)),Ke.push(it)),1;Nt=0;var ke=bt===""?".":bt+":";if(Qe(ne))for(var qe=0;qe<ne.length;qe++)bt=ne[qe],en=ke+Tt(bt,qe),Nt+=bn(bt,Ke,gt,en,it);else if(qe=oe(ne),typeof qe=="function")for(ne=qe.call(ne),qe=0;!(bt=ne.next()).done;)bt=bt.value,en=ke+Tt(bt,qe++),Nt+=bn(bt,Ke,gt,en,it);else if(en==="object"){if(typeof ne.then=="function")return bn(fn(ne),Ke,gt,bt,it);throw Ke=String(ne),Error("Objects are not valid as a React child (found: "+(Ke==="[object Object]"?"object with keys {"+Object.keys(ne).join(", ")+"}":Ke)+"). If you meant to render a collection of children, use an array instead.")}return Nt}function De(ne,Ke,gt){if(ne==null)return ne;var bt=[],it=0;return bn(ne,bt,"","",function(en){return Ke.call(gt,en,it++)}),bt}function Ue(ne){if(ne._status===-1){var Ke=ne._result;Ke=Ke(),Ke.then(function(gt){(ne._status===0||ne._status===-1)&&(ne._status=1,ne._result=gt)},function(gt){(ne._status===0||ne._status===-1)&&(ne._status=2,ne._result=gt)}),ne._status===-1&&(ne._status=0,ne._result=Ke)}if(ne._status===1)return ne._result.default;throw ne._result}var rt=typeof reportError=="function"?reportError:function(ne){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ke=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ne=="object"&&ne!==null&&typeof ne.message=="string"?String(ne.message):String(ne),error:ne});if(!window.dispatchEvent(Ke))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ne);return}console.error(ne)};function sn(){}return vn.Children={map:De,forEach:function(ne,Ke,gt){De(ne,function(){Ke.apply(this,arguments)},gt)},count:function(ne){var Ke=0;return De(ne,function(){Ke++}),Ke},toArray:function(ne){return De(ne,function(Ke){return Ke})||[]},only:function(ne){if(!we(ne))throw Error("React.Children.only expected to receive a single React element child.");return ne}},vn.Component=ae,vn.Fragment=m,vn.Profiler=v,vn.PureComponent=be,vn.StrictMode=_,vn.Suspense=W,vn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ye,vn.act=function(){throw Error("act(...) is not supported in production builds of React.")},vn.cache=function(ne){return function(){return ne.apply(null,arguments)}},vn.cloneElement=function(ne,Ke,gt){if(ne==null)throw Error("The argument must be a React element, but you passed "+ne+".");var bt=ie({},ne.props),it=ne.key,en=void 0;if(Ke!=null)for(Nt in Ke.ref!==void 0&&(en=void 0),Ke.key!==void 0&&(it=""+Ke.key),Ke)!Et.call(Ke,Nt)||Nt==="key"||Nt==="__self"||Nt==="__source"||Nt==="ref"&&Ke.ref===void 0||(bt[Nt]=Ke[Nt]);var Nt=arguments.length-2;if(Nt===1)bt.children=gt;else if(1<Nt){for(var ke=Array(Nt),qe=0;qe<Nt;qe++)ke[qe]=arguments[qe+2];bt.children=ke}return Ge(ne.type,it,void 0,void 0,en,bt)},vn.createContext=function(ne){return ne={$$typeof:D,_currentValue:ne,_currentValue2:ne,_threadCount:0,Provider:null,Consumer:null},ne.Provider=ne,ne.Consumer={$$typeof:w,_context:ne},ne},vn.createElement=function(ne,Ke,gt){var bt,it={},en=null;if(Ke!=null)for(bt in Ke.key!==void 0&&(en=""+Ke.key),Ke)Et.call(Ke,bt)&&bt!=="key"&&bt!=="__self"&&bt!=="__source"&&(it[bt]=Ke[bt]);var Nt=arguments.length-2;if(Nt===1)it.children=gt;else if(1<Nt){for(var ke=Array(Nt),qe=0;qe<Nt;qe++)ke[qe]=arguments[qe+2];it.children=ke}if(ne&&ne.defaultProps)for(bt in Nt=ne.defaultProps,Nt)it[bt]===void 0&&(it[bt]=Nt[bt]);return Ge(ne,en,void 0,void 0,null,it)},vn.createRef=function(){return{current:null}},vn.forwardRef=function(ne){return{$$typeof:B,render:ne}},vn.isValidElement=we,vn.lazy=function(ne){return{$$typeof:X,_payload:{_status:-1,_result:ne},_init:Ue}},vn.memo=function(ne,Ke){return{$$typeof:F,type:ne,compare:Ke===void 0?null:Ke}},vn.startTransition=function(ne){var Ke=Ye.T,gt={};Ye.T=gt;try{var bt=ne(),it=Ye.S;it!==null&&it(gt,bt),typeof bt=="object"&&bt!==null&&typeof bt.then=="function"&&bt.then(sn,rt)}catch(en){rt(en)}finally{Ye.T=Ke}},vn.unstable_useCacheRefresh=function(){return Ye.H.useCacheRefresh()},vn.use=function(ne){return Ye.H.use(ne)},vn.useActionState=function(ne,Ke,gt){return Ye.H.useActionState(ne,Ke,gt)},vn.useCallback=function(ne,Ke){return Ye.H.useCallback(ne,Ke)},vn.useContext=function(ne){return Ye.H.useContext(ne)},vn.useDebugValue=function(){},vn.useDeferredValue=function(ne,Ke){return Ye.H.useDeferredValue(ne,Ke)},vn.useEffect=function(ne,Ke){return Ye.H.useEffect(ne,Ke)},vn.useId=function(){return Ye.H.useId()},vn.useImperativeHandle=function(ne,Ke,gt){return Ye.H.useImperativeHandle(ne,Ke,gt)},vn.useInsertionEffect=function(ne,Ke){return Ye.H.useInsertionEffect(ne,Ke)},vn.useLayoutEffect=function(ne,Ke){return Ye.H.useLayoutEffect(ne,Ke)},vn.useMemo=function(ne,Ke){return Ye.H.useMemo(ne,Ke)},vn.useOptimistic=function(ne,Ke){return Ye.H.useOptimistic(ne,Ke)},vn.useReducer=function(ne,Ke,gt){return Ye.H.useReducer(ne,Ke,gt)},vn.useRef=function(ne){return Ye.H.useRef(ne)},vn.useState=function(ne){return Ye.H.useState(ne)},vn.useSyncExternalStore=function(ne,Ke,gt){return Ye.H.useSyncExternalStore(ne,Ke,gt)},vn.useTransition=function(){return Ye.H.useTransition()},vn.version="19.0.0",vn}var dj;function rD(){return dj||(dj=1,d1.exports=gq()),d1.exports}var J=rD();const Qn=aF(J);var u1={exports:{}},DS={},h1={exports:{}},p1={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uj;function yq(){return uj||(uj=1,function(o){function d(De,Ue){var rt=De.length;De.push(Ue);e:for(;0<rt;){var sn=rt-1>>>1,ne=De[sn];if(0<v(ne,Ue))De[sn]=Ue,De[rt]=ne,rt=sn;else break e}}function m(De){return De.length===0?null:De[0]}function _(De){if(De.length===0)return null;var Ue=De[0],rt=De.pop();if(rt!==Ue){De[0]=rt;e:for(var sn=0,ne=De.length,Ke=ne>>>1;sn<Ke;){var gt=2*(sn+1)-1,bt=De[gt],it=gt+1,en=De[it];if(0>v(bt,rt))it<ne&&0>v(en,bt)?(De[sn]=en,De[it]=rt,sn=it):(De[sn]=bt,De[gt]=rt,sn=gt);else if(it<ne&&0>v(en,rt))De[sn]=en,De[it]=rt,sn=it;else break e}}return Ue}function v(De,Ue){var rt=De.sortIndex-Ue.sortIndex;return rt!==0?rt:De.id-Ue.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var w=performance;o.unstable_now=function(){return w.now()}}else{var D=Date,B=D.now();o.unstable_now=function(){return D.now()-B}}var W=[],F=[],X=1,Q=null,oe=3,Ae=!1,ie=!1,fe=!1,ae=typeof setTimeout=="function"?setTimeout:null,ve=typeof clearTimeout=="function"?clearTimeout:null,be=typeof setImmediate<"u"?setImmediate:null;function _e(De){for(var Ue=m(F);Ue!==null;){if(Ue.callback===null)_(F);else if(Ue.startTime<=De)_(F),Ue.sortIndex=Ue.expirationTime,d(W,Ue);else break;Ue=m(F)}}function Qe(De){if(fe=!1,_e(De),!ie)if(m(W)!==null)ie=!0,fn();else{var Ue=m(F);Ue!==null&&bn(Qe,Ue.startTime-De)}}var Ye=!1,Et=-1,Ge=5,Je=-1;function we(){return!(o.unstable_now()-Je<Ge)}function We(){if(Ye){var De=o.unstable_now();Je=De;var Ue=!0;try{e:{ie=!1,fe&&(fe=!1,ve(Et),Et=-1),Ae=!0;var rt=oe;try{t:{for(_e(De),Q=m(W);Q!==null&&!(Q.expirationTime>De&&we());){var sn=Q.callback;if(typeof sn=="function"){Q.callback=null,oe=Q.priorityLevel;var ne=sn(Q.expirationTime<=De);if(De=o.unstable_now(),typeof ne=="function"){Q.callback=ne,_e(De),Ue=!0;break t}Q===m(W)&&_(W),_e(De)}else _(W);Q=m(W)}if(Q!==null)Ue=!0;else{var Ke=m(F);Ke!==null&&bn(Qe,Ke.startTime-De),Ue=!1}}break e}finally{Q=null,oe=rt,Ae=!1}Ue=void 0}}finally{Ue?ct():Ye=!1}}}var ct;if(typeof be=="function")ct=function(){be(We)};else if(typeof MessageChannel<"u"){var Tt=new MessageChannel,rn=Tt.port2;Tt.port1.onmessage=We,ct=function(){rn.postMessage(null)}}else ct=function(){ae(We,0)};function fn(){Ye||(Ye=!0,ct())}function bn(De,Ue){Et=ae(function(){De(o.unstable_now())},Ue)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(De){De.callback=null},o.unstable_continueExecution=function(){ie||Ae||(ie=!0,fn())},o.unstable_forceFrameRate=function(De){0>De||125<De?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ge=0<De?Math.floor(1e3/De):5},o.unstable_getCurrentPriorityLevel=function(){return oe},o.unstable_getFirstCallbackNode=function(){return m(W)},o.unstable_next=function(De){switch(oe){case 1:case 2:case 3:var Ue=3;break;default:Ue=oe}var rt=oe;oe=Ue;try{return De()}finally{oe=rt}},o.unstable_pauseExecution=function(){},o.unstable_requestPaint=function(){},o.unstable_runWithPriority=function(De,Ue){switch(De){case 1:case 2:case 3:case 4:case 5:break;default:De=3}var rt=oe;oe=De;try{return Ue()}finally{oe=rt}},o.unstable_scheduleCallback=function(De,Ue,rt){var sn=o.unstable_now();switch(typeof rt=="object"&&rt!==null?(rt=rt.delay,rt=typeof rt=="number"&&0<rt?sn+rt:sn):rt=sn,De){case 1:var ne=-1;break;case 2:ne=250;break;case 5:ne=1073741823;break;case 4:ne=1e4;break;default:ne=5e3}return ne=rt+ne,De={id:X++,callback:Ue,priorityLevel:De,startTime:rt,expirationTime:ne,sortIndex:-1},rt>sn?(De.sortIndex=rt,d(F,De),m(W)===null&&De===m(F)&&(fe?(ve(Et),Et=-1):fe=!0,bn(Qe,rt-sn))):(De.sortIndex=ne,d(W,De),ie||Ae||(ie=!0,fn())),De},o.unstable_shouldYield=we,o.unstable_wrapCallback=function(De){var Ue=oe;return function(){var rt=oe;oe=Ue;try{return De.apply(this,arguments)}finally{oe=rt}}}}(p1)),p1}var hj;function Sq(){return hj||(hj=1,h1.exports=yq()),h1.exports}var f1={exports:{}},ps={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pj;function vq(){if(pj)return ps;pj=1;var o=rD();function d(W){var F="https://react.dev/errors/"+W;if(1<arguments.length){F+="?args[]="+encodeURIComponent(arguments[1]);for(var X=2;X<arguments.length;X++)F+="&args[]="+encodeURIComponent(arguments[X])}return"Minified React error #"+W+"; visit "+F+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function m(){}var _={d:{f:m,r:function(){throw Error(d(522))},D:m,C:m,L:m,m,X:m,S:m,M:m},p:0,findDOMNode:null},v=Symbol.for("react.portal");function w(W,F,X){var Q=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:v,key:Q==null?null:""+Q,children:W,containerInfo:F,implementation:X}}var D=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function B(W,F){if(W==="font")return"";if(typeof F=="string")return F==="use-credentials"?F:""}return ps.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=_,ps.createPortal=function(W,F){var X=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!F||F.nodeType!==1&&F.nodeType!==9&&F.nodeType!==11)throw Error(d(299));return w(W,F,null,X)},ps.flushSync=function(W){var F=D.T,X=_.p;try{if(D.T=null,_.p=2,W)return W()}finally{D.T=F,_.p=X,_.d.f()}},ps.preconnect=function(W,F){typeof W=="string"&&(F?(F=F.crossOrigin,F=typeof F=="string"?F==="use-credentials"?F:"":void 0):F=null,_.d.C(W,F))},ps.prefetchDNS=function(W){typeof W=="string"&&_.d.D(W)},ps.preinit=function(W,F){if(typeof W=="string"&&F&&typeof F.as=="string"){var X=F.as,Q=B(X,F.crossOrigin),oe=typeof F.integrity=="string"?F.integrity:void 0,Ae=typeof F.fetchPriority=="string"?F.fetchPriority:void 0;X==="style"?_.d.S(W,typeof F.precedence=="string"?F.precedence:void 0,{crossOrigin:Q,integrity:oe,fetchPriority:Ae}):X==="script"&&_.d.X(W,{crossOrigin:Q,integrity:oe,fetchPriority:Ae,nonce:typeof F.nonce=="string"?F.nonce:void 0})}},ps.preinitModule=function(W,F){if(typeof W=="string")if(typeof F=="object"&&F!==null){if(F.as==null||F.as==="script"){var X=B(F.as,F.crossOrigin);_.d.M(W,{crossOrigin:X,integrity:typeof F.integrity=="string"?F.integrity:void 0,nonce:typeof F.nonce=="string"?F.nonce:void 0})}}else F==null&&_.d.M(W)},ps.preload=function(W,F){if(typeof W=="string"&&typeof F=="object"&&F!==null&&typeof F.as=="string"){var X=F.as,Q=B(X,F.crossOrigin);_.d.L(W,X,{crossOrigin:Q,integrity:typeof F.integrity=="string"?F.integrity:void 0,nonce:typeof F.nonce=="string"?F.nonce:void 0,type:typeof F.type=="string"?F.type:void 0,fetchPriority:typeof F.fetchPriority=="string"?F.fetchPriority:void 0,referrerPolicy:typeof F.referrerPolicy=="string"?F.referrerPolicy:void 0,imageSrcSet:typeof F.imageSrcSet=="string"?F.imageSrcSet:void 0,imageSizes:typeof F.imageSizes=="string"?F.imageSizes:void 0,media:typeof F.media=="string"?F.media:void 0})}},ps.preloadModule=function(W,F){if(typeof W=="string")if(F){var X=B(F.as,F.crossOrigin);_.d.m(W,{as:typeof F.as=="string"&&F.as!=="script"?F.as:void 0,crossOrigin:X,integrity:typeof F.integrity=="string"?F.integrity:void 0})}else _.d.m(W)},ps.requestFormReset=function(W){_.d.r(W)},ps.unstable_batchedUpdates=function(W,F){return W(F)},ps.useFormState=function(W,F,X){return D.H.useFormState(W,F,X)},ps.useFormStatus=function(){return D.H.useHostTransitionStatus()},ps.version="19.0.0",ps}var fj;function Tq(){if(fj)return f1.exports;fj=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(d){console.error(d)}}return o(),f1.exports=vq(),f1.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mj;function Rq(){if(mj)return DS;mj=1;var o=Sq(),d=rD(),m=Tq();function _(s){var c="https://react.dev/errors/"+s;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)c+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+s+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function v(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}var w=Symbol.for("react.element"),D=Symbol.for("react.transitional.element"),B=Symbol.for("react.portal"),W=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),X=Symbol.for("react.profiler"),Q=Symbol.for("react.provider"),oe=Symbol.for("react.consumer"),Ae=Symbol.for("react.context"),ie=Symbol.for("react.forward_ref"),fe=Symbol.for("react.suspense"),ae=Symbol.for("react.suspense_list"),ve=Symbol.for("react.memo"),be=Symbol.for("react.lazy"),_e=Symbol.for("react.offscreen"),Qe=Symbol.for("react.memo_cache_sentinel"),Ye=Symbol.iterator;function Et(s){return s===null||typeof s!="object"?null:(s=Ye&&s[Ye]||s["@@iterator"],typeof s=="function"?s:null)}var Ge=Symbol.for("react.client.reference");function Je(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===Ge?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case W:return"Fragment";case B:return"Portal";case X:return"Profiler";case F:return"StrictMode";case fe:return"Suspense";case ae:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case Ae:return(s.displayName||"Context")+".Provider";case oe:return(s._context.displayName||"Context")+".Consumer";case ie:var c=s.render;return s=s.displayName,s||(s=c.displayName||c.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case ve:return c=s.displayName||null,c!==null?c:Je(s.type)||"Memo";case be:c=s._payload,s=s._init;try{return Je(s(c))}catch{}}return null}var we=d.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,We=Object.assign,ct,Tt;function rn(s){if(ct===void 0)try{throw Error()}catch(p){var c=p.stack.trim().match(/\n( *(at )?)/);ct=c&&c[1]||"",Tt=-1<p.stack.indexOf(`
    at`)?" (<anonymous>)":-1<p.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ct+s+Tt}var fn=!1;function bn(s,c){if(!s||fn)return"";fn=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(c){var ze=function(){throw Error()};if(Object.defineProperty(ze.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ze,[])}catch(Pe){var Ce=Pe}Reflect.construct(s,[],ze)}else{try{ze.call()}catch(Pe){Ce=Pe}s.call(ze.prototype)}}else{try{throw Error()}catch(Pe){Ce=Pe}(ze=s())&&typeof ze.catch=="function"&&ze.catch(function(){})}}catch(Pe){if(Pe&&Ce&&typeof Pe.stack=="string")return[Pe.stack,Ce.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var R=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");R&&R.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var C=g.DetermineComponentFrameRoot(),V=C[0],q=C[1];if(V&&q){var ee=V.split(`
`),de=q.split(`
`);for(R=g=0;g<ee.length&&!ee[g].includes("DetermineComponentFrameRoot");)g++;for(;R<de.length&&!de[R].includes("DetermineComponentFrameRoot");)R++;if(g===ee.length||R===de.length)for(g=ee.length-1,R=de.length-1;1<=g&&0<=R&&ee[g]!==de[R];)R--;for(;1<=g&&0<=R;g--,R--)if(ee[g]!==de[R]){if(g!==1||R!==1)do if(g--,R--,0>R||ee[g]!==de[R]){var Me=`
`+ee[g].replace(" at new "," at ");return s.displayName&&Me.includes("<anonymous>")&&(Me=Me.replace("<anonymous>",s.displayName)),Me}while(1<=g&&0<=R);break}}}finally{fn=!1,Error.prepareStackTrace=p}return(p=s?s.displayName||s.name:"")?rn(p):""}function De(s){switch(s.tag){case 26:case 27:case 5:return rn(s.type);case 16:return rn("Lazy");case 13:return rn("Suspense");case 19:return rn("SuspenseList");case 0:case 15:return s=bn(s.type,!1),s;case 11:return s=bn(s.type.render,!1),s;case 1:return s=bn(s.type,!0),s;default:return""}}function Ue(s){try{var c="";do c+=De(s),s=s.return;while(s);return c}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}function rt(s){var c=s,p=s;if(s.alternate)for(;c.return;)c=c.return;else{s=c;do c=s,(c.flags&4098)!==0&&(p=c.return),s=c.return;while(s)}return c.tag===3?p:null}function sn(s){if(s.tag===13){var c=s.memoizedState;if(c===null&&(s=s.alternate,s!==null&&(c=s.memoizedState)),c!==null)return c.dehydrated}return null}function ne(s){if(rt(s)!==s)throw Error(_(188))}function Ke(s){var c=s.alternate;if(!c){if(c=rt(s),c===null)throw Error(_(188));return c!==s?null:s}for(var p=s,g=c;;){var R=p.return;if(R===null)break;var C=R.alternate;if(C===null){if(g=R.return,g!==null){p=g;continue}break}if(R.child===C.child){for(C=R.child;C;){if(C===p)return ne(R),s;if(C===g)return ne(R),c;C=C.sibling}throw Error(_(188))}if(p.return!==g.return)p=R,g=C;else{for(var V=!1,q=R.child;q;){if(q===p){V=!0,p=R,g=C;break}if(q===g){V=!0,g=R,p=C;break}q=q.sibling}if(!V){for(q=C.child;q;){if(q===p){V=!0,p=C,g=R;break}if(q===g){V=!0,g=C,p=R;break}q=q.sibling}if(!V)throw Error(_(189))}}if(p.alternate!==g)throw Error(_(190))}if(p.tag!==3)throw Error(_(188));return p.stateNode.current===p?s:c}function gt(s){var c=s.tag;if(c===5||c===26||c===27||c===6)return s;for(s=s.child;s!==null;){if(c=gt(s),c!==null)return c;s=s.sibling}return null}var bt=Array.isArray,it=m.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,en={pending:!1,data:null,method:null,action:null},Nt=[],ke=-1;function qe(s){return{current:s}}function qt(s){0>ke||(s.current=Nt[ke],Nt[ke]=null,ke--)}function an(s,c){ke++,Nt[ke]=s.current,s.current=c}var br=qe(null),da=qe(null),at=qe(null),Ze=qe(null);function St(s,c){switch(an(at,c),an(da,s),an(br,null),s=c.nodeType,s){case 9:case 11:c=(c=c.documentElement)&&(c=c.namespaceURI)?ry(c):0;break;default:if(s=s===8?c.parentNode:c,c=s.tagName,s=s.namespaceURI)s=ry(s),c=fT(s,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}qt(br),an(br,c)}function Ht(){qt(br),qt(da),qt(at)}function $n(s){s.memoizedState!==null&&an(Ze,s);var c=br.current,p=fT(c,s.type);c!==p&&(an(da,s),an(br,p))}function Un(s){da.current===s&&(qt(br),qt(da)),Ze.current===s&&(qt(Ze),Cu._currentValue=en)}var Ci=Object.prototype.hasOwnProperty,_s=o.unstable_scheduleCallback,hc=o.unstable_cancelCallback,df=o.unstable_shouldYield,sh=o.unstable_requestPaint,Xt=o.unstable_now,pc=o.unstable_getCurrentPriorityLevel,fc=o.unstable_ImmediatePriority,Ms=o.unstable_UserBlockingPriority,Nd=o.unstable_NormalPriority,eE=o.unstable_LowPriority,tE=o.unstable_IdlePriority,av=o.log,ov=o.unstable_setDisableYieldValue,Dd=null,sr=null;function cv(s){if(sr&&typeof sr.onCommitFiberRoot=="function")try{sr.onCommitFiberRoot(Dd,s,void 0,(s.current.flags&128)===128)}catch{}}function mc(s){if(typeof av=="function"&&ov(s),sr&&typeof sr.setStrictMode=="function")try{sr.setStrictMode(Dd,s)}catch{}}var Es=Math.clz32?Math.clz32:cw,kd=Math.log,lv=Math.LN2;function cw(s){return s>>>=0,s===0?32:31-(kd(s)/lv|0)|0}var uf=128,hf=4194304;function yl(s){var c=s&42;if(c!==0)return c;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function _c(s,c){var p=s.pendingLanes;if(p===0)return 0;var g=0,R=s.suspendedLanes,C=s.pingedLanes,V=s.warmLanes;s=s.finishedLanes!==0;var q=p&134217727;return q!==0?(p=q&~R,p!==0?g=yl(p):(C&=q,C!==0?g=yl(C):s||(V=q&~V,V!==0&&(g=yl(V))))):(q=p&~R,q!==0?g=yl(q):C!==0?g=yl(C):s||(V=p&~V,V!==0&&(g=yl(V)))),g===0?0:c!==0&&c!==g&&(c&R)===0&&(R=g&-g,V=c&-c,R>=V||R===32&&(V&4194176)!==0)?c:g}function ah(s,c){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&c)===0}function Pd(s,c){switch(s){case 1:case 2:case 4:case 8:return c+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dv(){var s=uf;return uf<<=1,(uf&4194176)===0&&(uf=128),s}function uv(){var s=hf;return hf<<=1,(hf&62914560)===0&&(hf=4194304),s}function nE(s){for(var c=[],p=0;31>p;p++)c.push(s);return c}function mr(s,c){s.pendingLanes|=c,c!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function lw(s,c,p,g,R,C){var V=s.pendingLanes;s.pendingLanes=p,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=p,s.entangledLanes&=p,s.errorRecoveryDisabledLanes&=p,s.shellSuspendCounter=0;var q=s.entanglements,ee=s.expirationTimes,de=s.hiddenUpdates;for(p=V&~p;0<p;){var Me=31-Es(p),ze=1<<Me;q[Me]=0,ee[Me]=-1;var Ce=de[Me];if(Ce!==null)for(de[Me]=null,Me=0;Me<Ce.length;Me++){var Pe=Ce[Me];Pe!==null&&(Pe.lane&=-536870913)}p&=~ze}g!==0&&hv(s,g,0),C!==0&&R===0&&s.tag!==0&&(s.suspendedLanes|=C&~(V&~c))}function hv(s,c,p){s.pendingLanes|=c,s.suspendedLanes&=~c;var g=31-Es(c);s.entangledLanes|=c,s.entanglements[g]=s.entanglements[g]|1073741824|p&4194218}function oh(s,c){var p=s.entangledLanes|=c;for(s=s.entanglements;p;){var g=31-Es(p),R=1<<g;R&c|s[g]&c&&(s[g]|=c),p&=~R}}function iE(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function rE(){var s=it.p;return s!==0?s:(s=window.event,s===void 0?32:gy(s.type))}function pv(s,c){var p=it.p;try{return it.p=s,c()}finally{it.p=p}}var Ec=Math.random().toString(36).slice(2),Cr="__reactFiber$"+Ec,Wr="__reactProps$"+Ec,Ld="__reactContainer$"+Ec,sE="__reactEvents$"+Ec,dw="__reactListeners$"+Ec,fv="__reactHandles$"+Ec,aE="__reactResources$"+Ec,Sl="__reactMarker$"+Ec;function pf(s){delete s[Cr],delete s[Wr],delete s[sE],delete s[dw],delete s[fv]}function xs(s){var c=s[Cr];if(c)return c;for(var p=s.parentNode;p;){if(c=p[Ld]||p[Cr]){if(p=c.alternate,c.child!==null||p!==null&&p.child!==null)for(s=_T(s);s!==null;){if(p=s[Cr])return p;s=_T(s)}return c}s=p,p=s.parentNode}return null}function Md(s){if(s=s[Cr]||s[Ld]){var c=s.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return s}return null}function ch(s){var c=s.tag;if(c===5||c===26||c===27||c===6)return s.stateNode;throw Error(_(33))}function Yr(s){var c=s[aE];return c||(c=s[aE]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function _r(s){s[Sl]=!0}var mv=new Set,Hi={};function vl(s,c){xd(s,c),xd(s+"Capture",c)}function xd(s,c){for(Hi[s]=c,s=0;s<c.length;s++)mv.add(c[s])}var vo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),uw=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ff={},_v={};function Ev(s){return Ci.call(_v,s)?!0:Ci.call(ff,s)?!1:uw.test(s)?_v[s]=!0:(ff[s]=!0,!1)}function mf(s,c,p){if(Ev(c))if(p===null)s.removeAttribute(c);else{switch(typeof p){case"undefined":case"function":case"symbol":s.removeAttribute(c);return;case"boolean":var g=c.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){s.removeAttribute(c);return}}s.setAttribute(c,""+p)}}function _f(s,c,p){if(p===null)s.removeAttribute(c);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttribute(c,""+p)}}function To(s,c,p,g){if(g===null)s.removeAttribute(p);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(p);return}s.setAttributeNS(c,p,""+g)}}function wr(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Ef(s){var c=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function hw(s){var c=Ef(s)?"checked":"value",p=Object.getOwnPropertyDescriptor(s.constructor.prototype,c),g=""+s[c];if(!s.hasOwnProperty(c)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var R=p.get,C=p.set;return Object.defineProperty(s,c,{configurable:!0,get:function(){return R.call(this)},set:function(V){g=""+V,C.call(this,V)}}),Object.defineProperty(s,c,{enumerable:p.enumerable}),{getValue:function(){return g},setValue:function(V){g=""+V},stopTracking:function(){s._valueTracker=null,delete s[c]}}}}function ei(s){s._valueTracker||(s._valueTracker=hw(s))}function gv(s){if(!s)return!1;var c=s._valueTracker;if(!c)return!0;var p=c.getValue(),g="";return s&&(g=Ef(s)?s.checked?"true":"false":s.value),s=g,s!==p?(c.setValue(s),!0):!1}function lh(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var yv=/[\n"\\]/g;function Us(s){return s.replace(yv,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function oE(s,c,p,g,R,C,V,q){s.name="",V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"?s.type=V:s.removeAttribute("type"),c!=null?V==="number"?(c===0&&s.value===""||s.value!=c)&&(s.value=""+wr(c)):s.value!==""+wr(c)&&(s.value=""+wr(c)):V!=="submit"&&V!=="reset"||s.removeAttribute("value"),c!=null?cE(s,V,wr(c)):p!=null?cE(s,V,wr(p)):g!=null&&s.removeAttribute("value"),R==null&&C!=null&&(s.defaultChecked=!!C),R!=null&&(s.checked=R&&typeof R!="function"&&typeof R!="symbol"),q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?s.name=""+wr(q):s.removeAttribute("name")}function Sv(s,c,p,g,R,C,V,q){if(C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(s.type=C),c!=null||p!=null){if(!(C!=="submit"&&C!=="reset"||c!=null))return;p=p!=null?""+wr(p):"",c=c!=null?""+wr(c):p,q||c===s.value||(s.value=c),s.defaultValue=c}g=g??R,g=typeof g!="function"&&typeof g!="symbol"&&!!g,s.checked=q?s.checked:!!g,s.defaultChecked=!!g,V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"&&(s.name=V)}function cE(s,c,p){c==="number"&&lh(s.ownerDocument)===s||s.defaultValue===""+p||(s.defaultValue=""+p)}function Ud(s,c,p,g){if(s=s.options,c){c={};for(var R=0;R<p.length;R++)c["$"+p[R]]=!0;for(p=0;p<s.length;p++)R=c.hasOwnProperty("$"+s[p].value),s[p].selected!==R&&(s[p].selected=R),R&&g&&(s[p].defaultSelected=!0)}else{for(p=""+wr(p),c=null,R=0;R<s.length;R++){if(s[R].value===p){s[R].selected=!0,g&&(s[R].defaultSelected=!0);return}c!==null||s[R].disabled||(c=s[R])}c!==null&&(c.selected=!0)}}function vv(s,c,p){if(c!=null&&(c=""+wr(c),c!==s.value&&(s.value=c),p==null)){s.defaultValue!==c&&(s.defaultValue=c);return}s.defaultValue=p!=null?""+wr(p):""}function gf(s,c,p,g){if(c==null){if(g!=null){if(p!=null)throw Error(_(92));if(bt(g)){if(1<g.length)throw Error(_(93));g=g[0]}p=g}p==null&&(p=""),c=p}p=wr(c),s.defaultValue=p,g=s.textContent,g===p&&g!==""&&g!==null&&(s.value=g)}function Tl(s,c){if(c){var p=s.firstChild;if(p&&p===s.lastChild&&p.nodeType===3){p.nodeValue=c;return}}s.textContent=c}var lE=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tv(s,c,p){var g=c.indexOf("--")===0;p==null||typeof p=="boolean"||p===""?g?s.setProperty(c,""):c==="float"?s.cssFloat="":s[c]="":g?s.setProperty(c,p):typeof p!="number"||p===0||lE.has(c)?c==="float"?s.cssFloat=p:s[c]=(""+p).trim():s[c]=p+"px"}function yf(s,c,p){if(c!=null&&typeof c!="object")throw Error(_(62));if(s=s.style,p!=null){for(var g in p)!p.hasOwnProperty(g)||c!=null&&c.hasOwnProperty(g)||(g.indexOf("--")===0?s.setProperty(g,""):g==="float"?s.cssFloat="":s[g]="");for(var R in c)g=c[R],c.hasOwnProperty(R)&&p[R]!==g&&Tv(s,R,g)}else for(var C in c)c.hasOwnProperty(C)&&Tv(s,C,c[C])}function dE(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Rv=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),pw=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Sf(s){return pw.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var uE=null;function hE(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Vd=null,jd=null;function bv(s){var c=Md(s);if(c&&(s=c.stateNode)){var p=s[Wr]||null;e:switch(s=c.stateNode,c.type){case"input":if(oE(s,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name),c=p.name,p.type==="radio"&&c!=null){for(p=s;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll('input[name="'+Us(""+c)+'"][type="radio"]'),c=0;c<p.length;c++){var g=p[c];if(g!==s&&g.form===s.form){var R=g[Wr]||null;if(!R)throw Error(_(90));oE(g,R.value,R.defaultValue,R.defaultValue,R.checked,R.defaultChecked,R.type,R.name)}}for(c=0;c<p.length;c++)g=p[c],g.form===s.form&&gv(g)}break e;case"textarea":vv(s,p.value,p.defaultValue);break e;case"select":c=p.value,c!=null&&Ud(s,!!p.multiple,c,!1)}}}var pE=!1;function fE(s,c,p){if(pE)return s(c,p);pE=!0;try{var g=s(c);return g}finally{if(pE=!1,(Vd!==null||jd!==null)&&(Qh(),Vd&&(c=Vd,s=jd,jd=Vd=null,bv(c),s)))for(c=0;c<s.length;c++)bv(s[c])}}function dh(s,c){var p=s.stateNode;if(p===null)return null;var g=p[Wr]||null;if(g===null)return null;p=g[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(s=s.type,g=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!g;break e;default:s=!1}if(s)return null;if(p&&typeof p!="function")throw Error(_(231,c,typeof p));return p}var mE=!1;if(vo)try{var uh={};Object.defineProperty(uh,"passive",{get:function(){mE=!0}}),window.addEventListener("test",uh,uh),window.removeEventListener("test",uh,uh)}catch{mE=!1}var Vs=null,_E=null,vf=null;function Cv(){if(vf)return vf;var s,c=_E,p=c.length,g,R="value"in Vs?Vs.value:Vs.textContent,C=R.length;for(s=0;s<p&&c[s]===R[s];s++);var V=p-s;for(g=1;g<=V&&c[p-g]===R[C-g];g++);return vf=R.slice(s,1<g?1-g:void 0)}function Tf(s){var c=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&c===13&&(s=13)):s=c,s===10&&(s=13),32<=s||s===13?s:0}function hh(){return!0}function wv(){return!1}function ns(s){function c(p,g,R,C,V){this._reactName=p,this._targetInst=R,this.type=g,this.nativeEvent=C,this.target=V,this.currentTarget=null;for(var q in s)s.hasOwnProperty(q)&&(p=s[q],this[q]=p?p(C):C[q]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?hh:wv,this.isPropagationStopped=wv,this}return We(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=hh)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=hh)},persist:function(){},isPersistent:hh}),c}var Rl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ua=ns(Rl),Mr=We({},Rl,{view:0,detail:0}),Av=ns(Mr),EE,gE,ph,Er=We({},Mr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:TE,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==ph&&(ph&&s.type==="mousemove"?(EE=s.screenX-ph.screenX,gE=s.screenY-ph.screenY):gE=EE=0,ph=s),EE)},movementY:function(s){return"movementY"in s?s.movementY:gE}}),Ov=ns(Er),fw=We({},Er,{dataTransfer:0}),mw=ns(fw),Rf=We({},Mr,{relatedTarget:0}),bf=ns(Rf),_w=We({},Rl,{animationName:0,elapsedTime:0,pseudoElement:0}),yE=ns(_w),Ew=We({},Rl,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),SE=ns(Ew),vE=We({},Rl,{data:0}),Cf=ns(vE),gw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fh(s){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(s):(s=bl[s])?!!c[s]:!1}function TE(){return fh}var Sw=We({},Mr,{key:function(s){if(s.key){var c=gw[s.key]||s.key;if(c!=="Unidentified")return c}return s.type==="keypress"?(s=Tf(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?yw[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:TE,charCode:function(s){return s.type==="keypress"?Tf(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Tf(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),vw=ns(Sw),Tw=We({},Er,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Iv=ns(Tw),Fd=We({},Mr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:TE}),Rw=ns(Fd),Bd=We({},Rl,{propertyName:0,elapsedTime:0,pseudoElement:0}),Nv=ns(Bd),bw=We({},Er,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Jt=ns(bw),Cw=We({},Rl,{newState:0,oldState:0}),ww=ns(Cw),Aw=[9,13,27,32],RE=vo&&"CompositionEvent"in window,Cl=null;vo&&"documentMode"in document&&(Cl=document.documentMode);var Ow=vo&&"TextEvent"in window&&!Cl,Dv=vo&&(!RE||Cl&&8<Cl&&11>=Cl),kv=" ",wf=!1;function Pv(s,c){switch(s){case"keyup":return Aw.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Lv(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var wl=!1;function Iw(s,c){switch(s){case"compositionend":return Lv(c);case"keypress":return c.which!==32?null:(wf=!0,kv);case"textInput":return s=c.data,s===kv&&wf?null:s;default:return null}}function gc(s,c){if(wl)return s==="compositionend"||!RE&&Pv(s,c)?(s=Cv(),vf=_E=Vs=null,wl=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return Dv&&c.locale!=="ko"?null:c.data;default:return null}}var Nw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mv(s){var c=s&&s.nodeName&&s.nodeName.toLowerCase();return c==="input"?!!Nw[s.type]:c==="textarea"}function xv(s,c,p,g){Vd?jd?jd.push(g):jd=[g]:Vd=g,c=gu(c,"onChange"),0<c.length&&(p=new ua("onChange","change",null,p,g),s.push({event:p,listeners:c}))}var Gd=null,Al=null;function Dw(s){mm(s,0)}function Af(s){var c=ch(s);if(gv(c))return s}function Uv(s,c){if(s==="change")return c}var gs=!1;if(vo){var bE;if(vo){var CE="oninput"in document;if(!CE){var Vv=document.createElement("div");Vv.setAttribute("oninput","return;"),CE=typeof Vv.oninput=="function"}bE=CE}else bE=!1;gs=bE&&(!document.documentMode||9<document.documentMode)}function jv(){Gd&&(Gd.detachEvent("onpropertychange",wE),Al=Gd=null)}function wE(s){if(s.propertyName==="value"&&Af(Al)){var c=[];xv(c,Al,s,hE(s)),fE(Dw,c)}}function kw(s,c,p){s==="focusin"?(jv(),Gd=c,Al=p,Gd.attachEvent("onpropertychange",wE)):s==="focusout"&&jv()}function Pw(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Af(Al)}function Fv(s,c){if(s==="click")return Af(c)}function AE(s,c){if(s==="input"||s==="change")return Af(c)}function Lw(s,c){return s===c&&(s!==0||1/s===1/c)||s!==s&&c!==c}var ys=typeof Object.is=="function"?Object.is:Lw;function yc(s,c){if(ys(s,c))return!0;if(typeof s!="object"||s===null||typeof c!="object"||c===null)return!1;var p=Object.keys(s),g=Object.keys(c);if(p.length!==g.length)return!1;for(g=0;g<p.length;g++){var R=p[g];if(!Ci.call(c,R)||!ys(s[R],c[R]))return!1}return!0}function Bv(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Gv(s,c){var p=Bv(s);s=0;for(var g;p;){if(p.nodeType===3){if(g=s+p.textContent.length,s<=c&&g>=c)return{node:p,offset:c-s};s=g}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=Bv(p)}}function Hv(s,c){return s&&c?s===c?!0:s&&s.nodeType===3?!1:c&&c.nodeType===3?Hv(s,c.parentNode):"contains"in s?s.contains(c):s.compareDocumentPosition?!!(s.compareDocumentPosition(c)&16):!1:!1}function Ro(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var c=lh(s.document);c instanceof s.HTMLIFrameElement;){try{var p=typeof c.contentWindow.location.href=="string"}catch{p=!1}if(p)s=c.contentWindow;else break;c=lh(s.document)}return c}function OE(s){var c=s&&s.nodeName&&s.nodeName.toLowerCase();return c&&(c==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||c==="textarea"||s.contentEditable==="true")}function Mw(s,c){var p=Ro(c);c=s.focusedElem;var g=s.selectionRange;if(p!==c&&c&&c.ownerDocument&&Hv(c.ownerDocument.documentElement,c)){if(g!==null&&OE(c)){if(s=g.start,p=g.end,p===void 0&&(p=s),"selectionStart"in c)c.selectionStart=s,c.selectionEnd=Math.min(p,c.value.length);else if(p=(s=c.ownerDocument||document)&&s.defaultView||window,p.getSelection){p=p.getSelection();var R=c.textContent.length,C=Math.min(g.start,R);g=g.end===void 0?C:Math.min(g.end,R),!p.extend&&C>g&&(R=g,g=C,C=R),R=Gv(c,C);var V=Gv(c,g);R&&V&&(p.rangeCount!==1||p.anchorNode!==R.node||p.anchorOffset!==R.offset||p.focusNode!==V.node||p.focusOffset!==V.offset)&&(s=s.createRange(),s.setStart(R.node,R.offset),p.removeAllRanges(),C>g?(p.addRange(s),p.extend(V.node,V.offset)):(s.setEnd(V.node,V.offset),p.addRange(s)))}}for(s=[],p=c;p=p.parentNode;)p.nodeType===1&&s.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<s.length;c++)p=s[c],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var is=vo&&"documentMode"in document&&11>=document.documentMode,Hd=null,IE=null,mh=null,NE=!1;function DE(s,c,p){var g=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;NE||Hd==null||Hd!==lh(g)||(g=Hd,"selectionStart"in g&&OE(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),mh&&yc(mh,g)||(mh=g,g=gu(IE,"onSelect"),0<g.length&&(c=new ua("onSelect","select",null,c,p),s.push({event:c,listeners:g}),c.target=Hd)))}function Ol(s,c){var p={};return p[s.toLowerCase()]=c.toLowerCase(),p["Webkit"+s]="webkit"+c,p["Moz"+s]="moz"+c,p}var Wd={animationend:Ol("Animation","AnimationEnd"),animationiteration:Ol("Animation","AnimationIteration"),animationstart:Ol("Animation","AnimationStart"),transitionrun:Ol("Transition","TransitionRun"),transitionstart:Ol("Transition","TransitionStart"),transitioncancel:Ol("Transition","TransitionCancel"),transitionend:Ol("Transition","TransitionEnd")},kE={},PE={};vo&&(PE=document.createElement("div").style,"AnimationEvent"in window||(delete Wd.animationend.animation,delete Wd.animationiteration.animation,delete Wd.animationstart.animation),"TransitionEvent"in window||delete Wd.transitionend.transition);function Il(s){if(kE[s])return kE[s];if(!Wd[s])return s;var c=Wd[s],p;for(p in c)if(c.hasOwnProperty(p)&&p in PE)return kE[s]=c[p];return s}var Wv=Il("animationend"),Of=Il("animationiteration"),If=Il("animationstart"),xw=Il("transitionrun"),Re=Il("transitionstart"),Uw=Il("transitioncancel"),Yv=Il("transitionend"),zv=new Map,Kv="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function js(s,c){zv.set(s,c),vl(c,[s])}var Ss=[],Yd=0,LE=0;function Nf(){for(var s=Yd,c=LE=Yd=0;c<s;){var p=Ss[c];Ss[c++]=null;var g=Ss[c];Ss[c++]=null;var R=Ss[c];Ss[c++]=null;var C=Ss[c];if(Ss[c++]=null,g!==null&&R!==null){var V=g.pending;V===null?R.next=R:(R.next=V.next,V.next=R),g.pending=R}C!==0&&qv(p,R,C)}}function Nl(s,c,p,g){Ss[Yd++]=s,Ss[Yd++]=c,Ss[Yd++]=p,Ss[Yd++]=g,LE|=g,s.lanes|=g,s=s.alternate,s!==null&&(s.lanes|=g)}function Dl(s,c,p,g){return Nl(s,c,p,g),kl(s)}function Sc(s,c){return Nl(s,null,null,c),kl(s)}function qv(s,c,p){s.lanes|=p;var g=s.alternate;g!==null&&(g.lanes|=p);for(var R=!1,C=s.return;C!==null;)C.childLanes|=p,g=C.alternate,g!==null&&(g.childLanes|=p),C.tag===22&&(s=C.stateNode,s===null||s._visibility&1||(R=!0)),s=C,C=C.return;R&&c!==null&&s.tag===3&&(C=s.stateNode,R=31-Es(p),C=C.hiddenUpdates,s=C[R],s===null?C[R]=[c]:s.push(c),c.lane=p|536870912)}function kl(s){if(50<Zh)throw Zh=0,cm=null,Error(_(185));for(var c=s.return;c!==null;)s=c,c=s.return;return s.tag===3?s.stateNode:null}var vc={},_h=new WeakMap;function Fs(s,c){if(typeof s=="object"&&s!==null){var p=_h.get(s);return p!==void 0?p:(c={value:s,source:c,stack:Ue(c)},_h.set(s,c),c)}return{value:s,source:c,stack:Ue(c)}}var zd=[],Kd=0,Df=null,qd=0,Bs=[],vs=0,gr=null,bo=1,Ts="";function Pl(s,c){zd[Kd++]=qd,zd[Kd++]=Df,Df=s,qd=c}function Xv(s,c,p){Bs[vs++]=bo,Bs[vs++]=Ts,Bs[vs++]=gr,gr=s;var g=bo;s=Ts;var R=32-Es(g)-1;g&=~(1<<R),p+=1;var C=32-Es(c)+R;if(30<C){var V=R-R%5;C=(g&(1<<V)-1).toString(32),g>>=V,R-=V,bo=1<<32-Es(c)+R|p<<R|g,Ts=C+s}else bo=1<<C|p<<R|g,Ts=s}function ME(s){s.return!==null&&(Pl(s,1),Xv(s,1,0))}function kf(s){for(;s===Df;)Df=zd[--Kd],zd[Kd]=null,qd=zd[--Kd],zd[Kd]=null;for(;s===gr;)gr=Bs[--vs],Bs[vs]=null,Ts=Bs[--vs],Bs[vs]=null,bo=Bs[--vs],Bs[vs]=null}var zr=null,Ar=null,Gn=!1,Rs=null,ka=!1,Pf=Error(_(519));function Tc(s){var c=Error(_(418,""));throw gh(Fs(c,s)),Pf}function Jv(s){var c=s.stateNode,p=s.type,g=s.memoizedProps;switch(c[Cr]=s,c[Wr]=g,p){case"dialog":kn("cancel",c),kn("close",c);break;case"iframe":case"object":case"embed":kn("load",c);break;case"video":case"audio":for(p=0;p<Eu.length;p++)kn(Eu[p],c);break;case"source":kn("error",c);break;case"img":case"image":case"link":kn("error",c),kn("load",c);break;case"details":kn("toggle",c);break;case"input":kn("invalid",c),Sv(c,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0),ei(c);break;case"select":kn("invalid",c);break;case"textarea":kn("invalid",c),gf(c,g.value,g.defaultValue,g.children),ei(c)}p=g.children,typeof p!="string"&&typeof p!="number"&&typeof p!="bigint"||c.textContent===""+p||g.suppressHydrationWarning===!0||iy(c.textContent,p)?(g.popover!=null&&(kn("beforetoggle",c),kn("toggle",c)),g.onScroll!=null&&kn("scroll",c),g.onScrollEnd!=null&&kn("scrollend",c),g.onClick!=null&&(c.onclick=ap),c=!0):c=!1,c||Tc(s)}function xE(s){for(zr=s.return;zr;)switch(zr.tag){case 3:case 27:ka=!0;return;case 5:case 13:ka=!1;return;default:zr=zr.return}}function Rc(s){if(s!==zr)return!1;if(!Gn)return xE(s),Gn=!0,!1;var c=!1,p;if((p=s.tag!==3&&s.tag!==27)&&((p=s.tag===5)&&(p=s.type,p=!(p!=="form"&&p!=="button")||Em(s.type,s.memoizedProps)),p=!p),p&&(c=!0),c&&Ar&&Tc(s),xE(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(_(317));e:{for(s=s.nextSibling,c=0;s;){if(s.nodeType===8)if(p=s.data,p==="/$"){if(c===0){Ar=ga(s.nextSibling);break e}c--}else p!=="$"&&p!=="$!"&&p!=="$?"||c++;s=s.nextSibling}Ar=null}}else Ar=zr?ga(s.stateNode.nextSibling):null;return!0}function Eh(){Ar=zr=null,Gn=!1}function gh(s){Rs===null?Rs=[s]:Rs.push(s)}var yh=Error(_(460)),Zv=Error(_(474)),UE={then:function(){}};function VE(s){return s=s.status,s==="fulfilled"||s==="rejected"}function Xd(){}function Qv(s,c,p){switch(p=s[p],p===void 0?s.push(c):p!==c&&(c.then(Xd,Xd),c=p),c.status){case"fulfilled":return c.value;case"rejected":throw s=c.reason,s===yh?Error(_(483)):s;default:if(typeof c.status=="string")c.then(Xd,Xd);else{if(s=mi,s!==null&&100<s.shellSuspendCounter)throw Error(_(482));s=c,s.status="pending",s.then(function(g){if(c.status==="pending"){var R=c;R.status="fulfilled",R.value=g}},function(g){if(c.status==="pending"){var R=c;R.status="rejected",R.reason=g}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw s=c.reason,s===yh?Error(_(483)):s}throw Ll=c,yh}}var Ll=null;function $v(){if(Ll===null)throw Error(_(459));var s=Ll;return Ll=null,s}var Jd=null,Sh=0;function Lf(s){var c=Sh;return Sh+=1,Jd===null&&(Jd=[]),Qv(Jd,s,c)}function vh(s,c){c=c.props.ref,s.ref=c!==void 0?c:null}function Mf(s,c){throw c.$$typeof===w?Error(_(525)):(s=Object.prototype.toString.call(c),Error(_(31,s==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":s)))}function e0(s){var c=s._init;return c(s._payload)}function t0(s){function c(pe,ce){if(s){var ye=pe.deletions;ye===null?(pe.deletions=[ce],pe.flags|=16):ye.push(ce)}}function p(pe,ce){if(!s)return null;for(;ce!==null;)c(pe,ce),ce=ce.sibling;return null}function g(pe){for(var ce=new Map;pe!==null;)pe.key!==null?ce.set(pe.key,pe):ce.set(pe.index,pe),pe=pe.sibling;return ce}function R(pe,ce){return pe=qr(pe,ce),pe.index=0,pe.sibling=null,pe}function C(pe,ce,ye){return pe.index=ye,s?(ye=pe.alternate,ye!==null?(ye=ye.index,ye<ce?(pe.flags|=33554434,ce):ye):(pe.flags|=33554434,ce)):(pe.flags|=1048576,ce)}function V(pe){return s&&pe.alternate===null&&(pe.flags|=33554434),pe}function q(pe,ce,ye,Fe){return ce===null||ce.tag!==6?(ce=Bg(ye,pe.mode,Fe),ce.return=pe,ce):(ce=R(ce,ye),ce.return=pe,ce)}function ee(pe,ce,ye,Fe){var pt=ye.type;return pt===W?Me(pe,ce,ye.props.children,Fe,ye.key):ce!==null&&(ce.elementType===pt||typeof pt=="object"&&pt!==null&&pt.$$typeof===be&&e0(pt)===ce.type)?(ce=R(ce,ye.props),vh(ce,ye),ce.return=pe,ce):(ce=Ga(ye.type,ye.key,ye.props,null,pe.mode,Fe),vh(ce,ye),ce.return=pe,ce)}function de(pe,ce,ye,Fe){return ce===null||ce.tag!==4||ce.stateNode.containerInfo!==ye.containerInfo||ce.stateNode.implementation!==ye.implementation?(ce=Gg(ye,pe.mode,Fe),ce.return=pe,ce):(ce=R(ce,ye.children||[]),ce.return=pe,ce)}function Me(pe,ce,ye,Fe,pt){return ce===null||ce.tag!==7?(ce=Lc(ye,pe.mode,Fe,pt),ce.return=pe,ce):(ce=R(ce,ye),ce.return=pe,ce)}function ze(pe,ce,ye){if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return ce=Bg(""+ce,pe.mode,ye),ce.return=pe,ce;if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case D:return ye=Ga(ce.type,ce.key,ce.props,null,pe.mode,ye),vh(ye,ce),ye.return=pe,ye;case B:return ce=Gg(ce,pe.mode,ye),ce.return=pe,ce;case be:var Fe=ce._init;return ce=Fe(ce._payload),ze(pe,ce,ye)}if(bt(ce)||Et(ce))return ce=Lc(ce,pe.mode,ye,null),ce.return=pe,ce;if(typeof ce.then=="function")return ze(pe,Lf(ce),ye);if(ce.$$typeof===Ae)return ze(pe,tm(pe,ce),ye);Mf(pe,ce)}return null}function Ce(pe,ce,ye,Fe){var pt=ce!==null?ce.key:null;if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return pt!==null?null:q(pe,ce,""+ye,Fe);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case D:return ye.key===pt?ee(pe,ce,ye,Fe):null;case B:return ye.key===pt?de(pe,ce,ye,Fe):null;case be:return pt=ye._init,ye=pt(ye._payload),Ce(pe,ce,ye,Fe)}if(bt(ye)||Et(ye))return pt!==null?null:Me(pe,ce,ye,Fe,null);if(typeof ye.then=="function")return Ce(pe,ce,Lf(ye),Fe);if(ye.$$typeof===Ae)return Ce(pe,ce,tm(pe,ye),Fe);Mf(pe,ye)}return null}function Pe(pe,ce,ye,Fe,pt){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number"||typeof Fe=="bigint")return pe=pe.get(ye)||null,q(ce,pe,""+Fe,pt);if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case D:return pe=pe.get(Fe.key===null?ye:Fe.key)||null,ee(ce,pe,Fe,pt);case B:return pe=pe.get(Fe.key===null?ye:Fe.key)||null,de(ce,pe,Fe,pt);case be:var En=Fe._init;return Fe=En(Fe._payload),Pe(pe,ce,ye,Fe,pt)}if(bt(Fe)||Et(Fe))return pe=pe.get(ye)||null,Me(ce,pe,Fe,pt,null);if(typeof Fe.then=="function")return Pe(pe,ce,ye,Lf(Fe),pt);if(Fe.$$typeof===Ae)return Pe(pe,ce,ye,tm(ce,Fe),pt);Mf(ce,Fe)}return null}function Ct(pe,ce,ye,Fe){for(var pt=null,En=null,Dt=ce,jt=ce=0,yr=null;Dt!==null&&jt<ye.length;jt++){Dt.index>jt?(yr=Dt,Dt=null):yr=Dt.sibling;var Hn=Ce(pe,Dt,ye[jt],Fe);if(Hn===null){Dt===null&&(Dt=yr);break}s&&Dt&&Hn.alternate===null&&c(pe,Dt),ce=C(Hn,ce,jt),En===null?pt=Hn:En.sibling=Hn,En=Hn,Dt=yr}if(jt===ye.length)return p(pe,Dt),Gn&&Pl(pe,jt),pt;if(Dt===null){for(;jt<ye.length;jt++)Dt=ze(pe,ye[jt],Fe),Dt!==null&&(ce=C(Dt,ce,jt),En===null?pt=Dt:En.sibling=Dt,En=Dt);return Gn&&Pl(pe,jt),pt}for(Dt=g(Dt);jt<ye.length;jt++)yr=Pe(Dt,pe,jt,ye[jt],Fe),yr!==null&&(s&&yr.alternate!==null&&Dt.delete(yr.key===null?jt:yr.key),ce=C(yr,ce,jt),En===null?pt=yr:En.sibling=yr,En=yr);return s&&Dt.forEach(function(xo){return c(pe,xo)}),Gn&&Pl(pe,jt),pt}function Zt(pe,ce,ye,Fe){if(ye==null)throw Error(_(151));for(var pt=null,En=null,Dt=ce,jt=ce=0,yr=null,Hn=ye.next();Dt!==null&&!Hn.done;jt++,Hn=ye.next()){Dt.index>jt?(yr=Dt,Dt=null):yr=Dt.sibling;var xo=Ce(pe,Dt,Hn.value,Fe);if(xo===null){Dt===null&&(Dt=yr);break}s&&Dt&&xo.alternate===null&&c(pe,Dt),ce=C(xo,ce,jt),En===null?pt=xo:En.sibling=xo,En=xo,Dt=yr}if(Hn.done)return p(pe,Dt),Gn&&Pl(pe,jt),pt;if(Dt===null){for(;!Hn.done;jt++,Hn=ye.next())Hn=ze(pe,Hn.value,Fe),Hn!==null&&(ce=C(Hn,ce,jt),En===null?pt=Hn:En.sibling=Hn,En=Hn);return Gn&&Pl(pe,jt),pt}for(Dt=g(Dt);!Hn.done;jt++,Hn=ye.next())Hn=Pe(Dt,pe,jt,Hn.value,Fe),Hn!==null&&(s&&Hn.alternate!==null&&Dt.delete(Hn.key===null?jt:Hn.key),ce=C(Hn,ce,jt),En===null?pt=Hn:En.sibling=Hn,En=Hn);return s&&Dt.forEach(function(TA){return c(pe,TA)}),Gn&&Pl(pe,jt),pt}function Ui(pe,ce,ye,Fe){if(typeof ye=="object"&&ye!==null&&ye.type===W&&ye.key===null&&(ye=ye.props.children),typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case D:e:{for(var pt=ye.key;ce!==null;){if(ce.key===pt){if(pt=ye.type,pt===W){if(ce.tag===7){p(pe,ce.sibling),Fe=R(ce,ye.props.children),Fe.return=pe,pe=Fe;break e}}else if(ce.elementType===pt||typeof pt=="object"&&pt!==null&&pt.$$typeof===be&&e0(pt)===ce.type){p(pe,ce.sibling),Fe=R(ce,ye.props),vh(Fe,ye),Fe.return=pe,pe=Fe;break e}p(pe,ce);break}else c(pe,ce);ce=ce.sibling}ye.type===W?(Fe=Lc(ye.props.children,pe.mode,Fe,ye.key),Fe.return=pe,pe=Fe):(Fe=Ga(ye.type,ye.key,ye.props,null,pe.mode,Fe),vh(Fe,ye),Fe.return=pe,pe=Fe)}return V(pe);case B:e:{for(pt=ye.key;ce!==null;){if(ce.key===pt)if(ce.tag===4&&ce.stateNode.containerInfo===ye.containerInfo&&ce.stateNode.implementation===ye.implementation){p(pe,ce.sibling),Fe=R(ce,ye.children||[]),Fe.return=pe,pe=Fe;break e}else{p(pe,ce);break}else c(pe,ce);ce=ce.sibling}Fe=Gg(ye,pe.mode,Fe),Fe.return=pe,pe=Fe}return V(pe);case be:return pt=ye._init,ye=pt(ye._payload),Ui(pe,ce,ye,Fe)}if(bt(ye))return Ct(pe,ce,ye,Fe);if(Et(ye)){if(pt=Et(ye),typeof pt!="function")throw Error(_(150));return ye=pt.call(ye),Zt(pe,ce,ye,Fe)}if(typeof ye.then=="function")return Ui(pe,ce,Lf(ye),Fe);if(ye.$$typeof===Ae)return Ui(pe,ce,tm(pe,ye),Fe);Mf(pe,ye)}return typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint"?(ye=""+ye,ce!==null&&ce.tag===6?(p(pe,ce.sibling),Fe=R(ce,ye),Fe.return=pe,pe=Fe):(p(pe,ce),Fe=Bg(ye,pe.mode,Fe),Fe.return=pe,pe=Fe),V(pe)):p(pe,ce)}return function(pe,ce,ye,Fe){try{Sh=0;var pt=Ui(pe,ce,ye,Fe);return Jd=null,pt}catch(Dt){if(Dt===yh)throw Dt;var En=zs(29,Dt,null,pe.mode);return En.lanes=Fe,En.return=pe,En}finally{}}}var Ml=t0(!0),n0=t0(!1),Zd=qe(null),xl=qe(0);function Th(s,c){s=_a,an(xl,s),an(Zd,c),_a=s|c.baseLanes}function Rh(){an(xl,_a),an(Zd,Zd.current)}function jE(){_a=xl.current,qt(Zd),qt(xl)}var Gs=qe(null),Pa=null;function Co(s){var c=s.alternate;an(ar,ar.current&1),an(Gs,s),Pa===null&&(c===null||Zd.current!==null||c.memoizedState!==null)&&(Pa=s)}function FE(s){if(s.tag===22){if(an(ar,ar.current),an(Gs,s),Pa===null){var c=s.alternate;c!==null&&c.memoizedState!==null&&(Pa=s)}}else La()}function La(){an(ar,ar.current),an(Gs,Gs.current)}function wo(s){qt(Gs),Pa===s&&(Pa=null),qt(ar)}var ar=qe(0);function bc(s){for(var c=s;c!==null;){if(c.tag===13){var p=c.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||p.data==="$?"||p.data==="$!"))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===s)break;for(;c.sibling===null;){if(c.return===null||c.return===s)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var Vw=typeof AbortController<"u"?AbortController:function(){var s=[],c=this.signal={aborted:!1,addEventListener:function(p,g){s.push(g)}};this.abort=function(){c.aborted=!0,s.forEach(function(p){return p()})}},jw=o.unstable_scheduleCallback,Fw=o.unstable_NormalPriority,or={$$typeof:Ae,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function BE(){return{controller:new Vw,data:new Map,refCount:0}}function bh(s){s.refCount--,s.refCount===0&&jw(Fw,function(){s.controller.abort()})}var Qd=null,GE=0,$d=0,eu=null;function HE(s,c){if(Qd===null){var p=Qd=[];GE=0,$d=$g(),eu={status:"pending",value:void 0,then:function(g){p.push(g)}}}return GE++,c.then(i0,i0),c}function i0(){if(--GE===0&&Qd!==null){eu!==null&&(eu.status="fulfilled");var s=Qd;Qd=null,$d=0,eu=null;for(var c=0;c<s.length;c++)(0,s[c])()}}function Bw(s,c){var p=[],g={status:"pending",value:null,reason:null,then:function(R){p.push(R)}};return s.then(function(){g.status="fulfilled",g.value=c;for(var R=0;R<p.length;R++)(0,p[R])(c)},function(R){for(g.status="rejected",g.reason=R,R=0;R<p.length;R++)(0,p[R])(void 0)}),g}var Ch=we.S;we.S=function(s,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&HE(s,c),Ch!==null&&Ch(s,c)};var Ul=qe(null);function WE(){var s=Ul.current;return s!==null?s:mi.pooledCache}function xf(s,c){c===null?an(Ul,Ul.current):an(Ul,c.pool)}function r0(){var s=WE();return s===null?null:{parent:or._currentValue,pool:s}}var Cc=0,mn=null,Kn=null,Wi=null,Uf=!1,tu=!1,wc=!1,Vf=0,wh=0,nu=null,YE=0;function Ii(){throw Error(_(321))}function jf(s,c){if(c===null)return!1;for(var p=0;p<c.length&&p<s.length;p++)if(!ys(s[p],c[p]))return!1;return!0}function Ah(s,c,p,g,R,C){return Cc=C,mn=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,we.H=s===null||s.memoizedState===null?Bl:Cs,wc=!1,C=p(g,R),wc=!1,tu&&(C=KE(c,p,g,R)),zE(s),C}function zE(s){we.H=bs;var c=Kn!==null&&Kn.next!==null;if(Cc=0,Wi=Kn=mn=null,Uf=!1,wh=0,nu=null,c)throw Error(_(300));s===null||di||(s=s.dependencies,s!==null&&em(s)&&(di=!0))}function KE(s,c,p,g){mn=s;var R=0;do{if(tu&&(nu=null),wh=0,tu=!1,25<=R)throw Error(_(301));if(R+=1,Wi=Kn=null,s.updateQueue!=null){var C=s.updateQueue;C.lastEffect=null,C.events=null,C.stores=null,C.memoCache!=null&&(C.memoCache.index=0)}we.H=Oo,C=c(p,g)}while(tu);return C}function Ff(){var s=we.H,c=s.useState()[0];return c=typeof c.then=="function"?iu(c):c,s=s.useState()[0],(Kn!==null?Kn.memoizedState:null)!==s&&(mn.flags|=1024),c}function Vl(){var s=Vf!==0;return Vf=0,s}function qE(s,c,p){c.updateQueue=s.updateQueue,c.flags&=-2053,s.lanes&=~p}function XE(s){if(Uf){for(s=s.memoizedState;s!==null;){var c=s.queue;c!==null&&(c.pending=null),s=s.next}Uf=!1}Cc=0,Wi=Kn=mn=null,tu=!1,wh=Vf=0,nu=null}function Kr(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wi===null?mn.memoizedState=Wi=s:Wi=Wi.next=s,Wi}function Qi(){if(Kn===null){var s=mn.alternate;s=s!==null?s.memoizedState:null}else s=Kn.next;var c=Wi===null?mn.memoizedState:Wi.next;if(c!==null)Wi=c,Kn=s;else{if(s===null)throw mn.alternate===null?Error(_(467)):Error(_(310));Kn=s,s={memoizedState:Kn.memoizedState,baseState:Kn.baseState,baseQueue:Kn.baseQueue,queue:Kn.queue,next:null},Wi===null?mn.memoizedState=Wi=s:Wi=Wi.next=s}return Wi}var Bf;Bf=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function iu(s){var c=wh;return wh+=1,nu===null&&(nu=[]),s=Qv(nu,s,c),c=mn,(Wi===null?c.memoizedState:Wi.next)===null&&(c=c.alternate,we.H=c===null||c.memoizedState===null?Bl:Cs),s}function Gf(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return iu(s);if(s.$$typeof===Ae)return xr(s)}throw Error(_(438,String(s)))}function JE(s){var c=null,p=mn.updateQueue;if(p!==null&&(c=p.memoCache),c==null){var g=mn.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(c={data:g.data.map(function(R){return R.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),p===null&&(p=Bf(),mn.updateQueue=p),p.memoCache=c,p=c.data[c.index],p===void 0)for(p=c.data[c.index]=Array(s),g=0;g<s;g++)p[g]=Qe;return c.index++,p}function Ao(s,c){return typeof c=="function"?c(s):c}function Hf(s){var c=Qi();return ZE(c,Kn,s)}function ZE(s,c,p){var g=s.queue;if(g===null)throw Error(_(311));g.lastRenderedReducer=p;var R=s.baseQueue,C=g.pending;if(C!==null){if(R!==null){var V=R.next;R.next=C.next,C.next=V}c.baseQueue=R=C,g.pending=null}if(C=s.baseState,R===null)s.memoizedState=C;else{c=R.next;var q=V=null,ee=null,de=c,Me=!1;do{var ze=de.lane&-536870913;if(ze!==de.lane?(Pn&ze)===ze:(Cc&ze)===ze){var Ce=de.revertLane;if(Ce===0)ee!==null&&(ee=ee.next={lane:0,revertLane:0,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null}),ze===$d&&(Me=!0);else if((Cc&Ce)===Ce){de=de.next,Ce===$d&&(Me=!0);continue}else ze={lane:0,revertLane:de.revertLane,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null},ee===null?(q=ee=ze,V=C):ee=ee.next=ze,mn.lanes|=Ce,Po|=Ce;ze=de.action,wc&&p(C,ze),C=de.hasEagerState?de.eagerState:p(C,ze)}else Ce={lane:ze,revertLane:de.revertLane,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null},ee===null?(q=ee=Ce,V=C):ee=ee.next=Ce,mn.lanes|=ze,Po|=ze;de=de.next}while(de!==null&&de!==c);if(ee===null?V=C:ee.next=q,!ys(C,s.memoizedState)&&(di=!0,Me&&(p=eu,p!==null)))throw p;s.memoizedState=C,s.baseState=V,s.baseQueue=ee,g.lastRenderedState=C}return R===null&&(g.lanes=0),[s.memoizedState,g.dispatch]}function QE(s){var c=Qi(),p=c.queue;if(p===null)throw Error(_(311));p.lastRenderedReducer=s;var g=p.dispatch,R=p.pending,C=c.memoizedState;if(R!==null){p.pending=null;var V=R=R.next;do C=s(C,V.action),V=V.next;while(V!==R);ys(C,c.memoizedState)||(di=!0),c.memoizedState=C,c.baseQueue===null&&(c.baseState=C),p.lastRenderedState=C}return[C,g]}function $E(s,c,p){var g=mn,R=Qi(),C=Gn;if(C){if(p===void 0)throw Error(_(407));p=p()}else p=c();var V=!ys((Kn||R).memoizedState,p);if(V&&(R.memoizedState=p,di=!0),R=R.queue,sg(a0.bind(null,g,R,s),[s]),R.getSnapshot!==c||V||Wi!==null&&Wi.memoizedState.tag&1){if(g.flags|=2048,Fl(9,s0.bind(null,g,R,p,c),{destroy:void 0},null),mi===null)throw Error(_(349));C||(Cc&60)!==0||jl(g,c,p)}return p}function jl(s,c,p){s.flags|=16384,s={getSnapshot:c,value:p},c=mn.updateQueue,c===null?(c=Bf(),mn.updateQueue=c,c.stores=[s]):(p=c.stores,p===null?c.stores=[s]:p.push(s))}function s0(s,c,p,g){c.value=p,c.getSnapshot=g,o0(c)&&eg(s)}function a0(s,c,p){return p(function(){o0(c)&&eg(s)})}function o0(s){var c=s.getSnapshot;s=s.value;try{var p=c();return!ys(s,p)}catch{return!0}}function eg(s){var c=Sc(s,2);c!==null&&Jr(c,s,2)}function tg(s){var c=Kr();if(typeof s=="function"){var p=s;if(s=p(),wc){mc(!0);try{p()}finally{mc(!1)}}}return c.memoizedState=c.baseState=s,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ao,lastRenderedState:s},c}function ng(s,c,p,g){return s.baseState=p,ZE(s,Kn,typeof g=="function"?g:Ao)}function Gw(s,c,p,g,R){if(zf(s))throw Error(_(485));if(s=c.action,s!==null){var C={payload:R,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(V){C.listeners.push(V)}};we.T!==null?p(!0):C.isTransition=!1,g(C),p=c.pending,p===null?(C.next=c.pending=C,c0(c,C)):(C.next=p.next,c.pending=p.next=C)}}function c0(s,c){var p=c.action,g=c.payload,R=s.state;if(c.isTransition){var C=we.T,V={};we.T=V;try{var q=p(R,g),ee=we.S;ee!==null&&ee(V,q),l0(s,c,q)}catch(de){ig(s,c,de)}finally{we.T=C}}else try{C=p(R,g),l0(s,c,C)}catch(de){ig(s,c,de)}}function l0(s,c,p){p!==null&&typeof p=="object"&&typeof p.then=="function"?p.then(function(g){Oh(s,c,g)},function(g){return ig(s,c,g)}):Oh(s,c,p)}function Oh(s,c,p){c.status="fulfilled",c.value=p,d0(c),s.state=p,c=s.pending,c!==null&&(p=c.next,p===c?s.pending=null:(p=p.next,c.next=p,c0(s,p)))}function ig(s,c,p){var g=s.pending;if(s.pending=null,g!==null){g=g.next;do c.status="rejected",c.reason=p,d0(c),c=c.next;while(c!==g)}s.action=null}function d0(s){s=s.listeners;for(var c=0;c<s.length;c++)(0,s[c])()}function u0(s,c){return c}function h0(s,c){if(Gn){var p=mi.formState;if(p!==null){e:{var g=mn;if(Gn){if(Ar){t:{for(var R=Ar,C=ka;R.nodeType!==8;){if(!C){R=null;break t}if(R=ga(R.nextSibling),R===null){R=null;break t}}C=R.data,R=C==="F!"||C==="F"?R:null}if(R){Ar=ga(R.nextSibling),g=R.data==="F!";break e}}Tc(g)}g=!1}g&&(c=p[0])}}return p=Kr(),p.memoizedState=p.baseState=c,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u0,lastRenderedState:c},p.queue=g,p=Yf.bind(null,mn,g),g.dispatch=p,g=tg(!1),C=fg.bind(null,mn,!1,g.queue),g=Kr(),R={state:c,dispatch:null,action:s,pending:null},g.queue=R,p=Gw.bind(null,mn,R,C,p),R.dispatch=p,g.memoizedState=s,[c,p,!1]}function p0(s){var c=Qi();return f0(c,Kn,s)}function f0(s,c,p){c=ZE(s,c,u0)[0],s=Hf(Ao)[0],c=typeof c=="object"&&c!==null&&typeof c.then=="function"?iu(c):c;var g=Qi(),R=g.queue,C=R.dispatch;return p!==g.memoizedState&&(mn.flags|=2048,Fl(9,rg.bind(null,R,p),{destroy:void 0},null)),[c,C,s]}function rg(s,c){s.action=c}function m0(s){var c=Qi(),p=Kn;if(p!==null)return f0(c,p,s);Qi(),c=c.memoizedState,p=Qi();var g=p.queue.dispatch;return p.memoizedState=s,[c,g,!1]}function Fl(s,c,p,g){return s={tag:s,create:c,inst:p,deps:g,next:null},c=mn.updateQueue,c===null&&(c=Bf(),mn.updateQueue=c),p=c.lastEffect,p===null?c.lastEffect=s.next=s:(g=p.next,p.next=s,s.next=g,c.lastEffect=s),s}function _0(){return Qi().memoizedState}function Ih(s,c,p,g){var R=Kr();mn.flags|=s,R.memoizedState=Fl(1|c,p,{destroy:void 0},g===void 0?null:g)}function Wf(s,c,p,g){var R=Qi();g=g===void 0?null:g;var C=R.memoizedState.inst;Kn!==null&&g!==null&&jf(g,Kn.memoizedState.deps)?R.memoizedState=Fl(c,p,C,g):(mn.flags|=s,R.memoizedState=Fl(1|c,p,C,g))}function E0(s,c){Ih(8390656,8,s,c)}function sg(s,c){Wf(2048,8,s,c)}function g0(s,c){return Wf(4,2,s,c)}function y0(s,c){return Wf(4,4,s,c)}function S0(s,c){if(typeof c=="function"){s=s();var p=c(s);return function(){typeof p=="function"?p():c(null)}}if(c!=null)return s=s(),c.current=s,function(){c.current=null}}function ag(s,c,p){p=p!=null?p.concat([s]):null,Wf(4,4,S0.bind(null,c,s),p)}function og(){}function v0(s,c){var p=Qi();c=c===void 0?null:c;var g=p.memoizedState;return c!==null&&jf(c,g[1])?g[0]:(p.memoizedState=[s,c],s)}function cg(s,c){var p=Qi();c=c===void 0?null:c;var g=p.memoizedState;if(c!==null&&jf(c,g[1]))return g[0];if(g=s(),wc){mc(!0);try{s()}finally{mc(!1)}}return p.memoizedState=[g,c],g}function lg(s,c,p){return p===void 0||(Cc&1073741824)!==0?s.memoizedState=c:(s.memoizedState=p,s=Q0(),mn.lanes|=s,Po|=s,p)}function Nh(s,c,p,g){return ys(p,c)?p:Zd.current!==null?(s=lg(s,p,g),ys(s,c)||(di=!0),s):(Cc&42)===0?(di=!0,s.memoizedState=p):(s=Q0(),mn.lanes|=s,Po|=s,c)}function dg(s,c,p,g,R){var C=it.p;it.p=C!==0&&8>C?C:8;var V=we.T,q={};we.T=q,fg(s,!1,c,p);try{var ee=R(),de=we.S;if(de!==null&&de(q,ee),ee!==null&&typeof ee=="object"&&typeof ee.then=="function"){var Me=Bw(ee,g);Ph(s,c,Me,Xr(s))}else Ph(s,c,g,Xr(s))}catch(ze){Ph(s,c,{then:function(){},status:"rejected",reason:ze},Xr())}finally{it.p=C,we.T=V}}function Dh(){}function ug(s,c,p,g){if(s.tag!==5)throw Error(_(476));var R=T0(s).queue;dg(s,R,c,en,p===null?Dh:function(){return R0(s),p(g)})}function T0(s){var c=s.memoizedState;if(c!==null)return c;c={memoizedState:en,baseState:en,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ao,lastRenderedState:en},next:null};var p={};return c.next={memoizedState:p,baseState:p,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ao,lastRenderedState:p},next:null},s.memoizedState=c,s=s.alternate,s!==null&&(s.memoizedState=c),c}function R0(s){var c=T0(s).next.queue;Ph(s,c,{},Xr())}function hg(){return xr(Cu)}function kh(){return Qi().memoizedState}function b0(){return Qi().memoizedState}function C0(s){for(var c=s.return;c!==null;){switch(c.tag){case 24:case 3:var p=Xr();s=Dc(p);var g=kc(c,s,p);g!==null&&(Jr(g,c,p),Vh(g,c,p)),c={cache:BE()},s.payload=c;return}c=c.return}}function pg(s,c,p){var g=Xr();p={lane:g,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null},zf(s)?w0(c,p):(p=Dl(s,c,p,g),p!==null&&(Jr(p,s,g),A0(p,c,g)))}function Yf(s,c,p){var g=Xr();Ph(s,c,p,g)}function Ph(s,c,p,g){var R={lane:g,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null};if(zf(s))w0(c,R);else{var C=s.alternate;if(s.lanes===0&&(C===null||C.lanes===0)&&(C=c.lastRenderedReducer,C!==null))try{var V=c.lastRenderedState,q=C(V,p);if(R.hasEagerState=!0,R.eagerState=q,ys(q,V))return Nl(s,c,R,0),mi===null&&Nf(),!1}catch{}finally{}if(p=Dl(s,c,R,g),p!==null)return Jr(p,s,g),A0(p,c,g),!0}return!1}function fg(s,c,p,g){if(g={lane:2,revertLane:$g(),action:g,hasEagerState:!1,eagerState:null,next:null},zf(s)){if(c)throw Error(_(479))}else c=Dl(s,p,g,2),c!==null&&Jr(c,s,2)}function zf(s){var c=s.alternate;return s===mn||c!==null&&c===mn}function w0(s,c){tu=Uf=!0;var p=s.pending;p===null?c.next=c:(c.next=p.next,p.next=c),s.pending=c}function A0(s,c,p){if((p&4194176)!==0){var g=c.lanes;g&=s.pendingLanes,p|=g,c.lanes=p,oh(s,p)}}var bs={readContext:xr,use:Gf,useCallback:Ii,useContext:Ii,useEffect:Ii,useImperativeHandle:Ii,useLayoutEffect:Ii,useInsertionEffect:Ii,useMemo:Ii,useReducer:Ii,useRef:Ii,useState:Ii,useDebugValue:Ii,useDeferredValue:Ii,useTransition:Ii,useSyncExternalStore:Ii,useId:Ii};bs.useCacheRefresh=Ii,bs.useMemoCache=Ii,bs.useHostTransitionStatus=Ii,bs.useFormState=Ii,bs.useActionState=Ii,bs.useOptimistic=Ii;var Bl={readContext:xr,use:Gf,useCallback:function(s,c){return Kr().memoizedState=[s,c===void 0?null:c],s},useContext:xr,useEffect:E0,useImperativeHandle:function(s,c,p){p=p!=null?p.concat([s]):null,Ih(4194308,4,S0.bind(null,c,s),p)},useLayoutEffect:function(s,c){return Ih(4194308,4,s,c)},useInsertionEffect:function(s,c){Ih(4,2,s,c)},useMemo:function(s,c){var p=Kr();c=c===void 0?null:c;var g=s();if(wc){mc(!0);try{s()}finally{mc(!1)}}return p.memoizedState=[g,c],g},useReducer:function(s,c,p){var g=Kr();if(p!==void 0){var R=p(c);if(wc){mc(!0);try{p(c)}finally{mc(!1)}}}else R=c;return g.memoizedState=g.baseState=R,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:R},g.queue=s,s=s.dispatch=pg.bind(null,mn,s),[g.memoizedState,s]},useRef:function(s){var c=Kr();return s={current:s},c.memoizedState=s},useState:function(s){s=tg(s);var c=s.queue,p=Yf.bind(null,mn,c);return c.dispatch=p,[s.memoizedState,p]},useDebugValue:og,useDeferredValue:function(s,c){var p=Kr();return lg(p,s,c)},useTransition:function(){var s=tg(!1);return s=dg.bind(null,mn,s.queue,!0,!1),Kr().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,c,p){var g=mn,R=Kr();if(Gn){if(p===void 0)throw Error(_(407));p=p()}else{if(p=c(),mi===null)throw Error(_(349));(Pn&60)!==0||jl(g,c,p)}R.memoizedState=p;var C={value:p,getSnapshot:c};return R.queue=C,E0(a0.bind(null,g,C,s),[s]),g.flags|=2048,Fl(9,s0.bind(null,g,C,p,c),{destroy:void 0},null),p},useId:function(){var s=Kr(),c=mi.identifierPrefix;if(Gn){var p=Ts,g=bo;p=(g&~(1<<32-Es(g)-1)).toString(32)+p,c=":"+c+"R"+p,p=Vf++,0<p&&(c+="H"+p.toString(32)),c+=":"}else p=YE++,c=":"+c+"r"+p.toString(32)+":";return s.memoizedState=c},useCacheRefresh:function(){return Kr().memoizedState=C0.bind(null,mn)}};Bl.useMemoCache=JE,Bl.useHostTransitionStatus=hg,Bl.useFormState=h0,Bl.useActionState=h0,Bl.useOptimistic=function(s){var c=Kr();c.memoizedState=c.baseState=s;var p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=p,c=fg.bind(null,mn,!0,p),p.dispatch=c,[s,c]};var Cs={readContext:xr,use:Gf,useCallback:v0,useContext:xr,useEffect:sg,useImperativeHandle:ag,useInsertionEffect:g0,useLayoutEffect:y0,useMemo:cg,useReducer:Hf,useRef:_0,useState:function(){return Hf(Ao)},useDebugValue:og,useDeferredValue:function(s,c){var p=Qi();return Nh(p,Kn.memoizedState,s,c)},useTransition:function(){var s=Hf(Ao)[0],c=Qi().memoizedState;return[typeof s=="boolean"?s:iu(s),c]},useSyncExternalStore:$E,useId:kh};Cs.useCacheRefresh=b0,Cs.useMemoCache=JE,Cs.useHostTransitionStatus=hg,Cs.useFormState=p0,Cs.useActionState=p0,Cs.useOptimistic=function(s,c){var p=Qi();return ng(p,Kn,s,c)};var Oo={readContext:xr,use:Gf,useCallback:v0,useContext:xr,useEffect:sg,useImperativeHandle:ag,useInsertionEffect:g0,useLayoutEffect:y0,useMemo:cg,useReducer:QE,useRef:_0,useState:function(){return QE(Ao)},useDebugValue:og,useDeferredValue:function(s,c){var p=Qi();return Kn===null?lg(p,s,c):Nh(p,Kn.memoizedState,s,c)},useTransition:function(){var s=QE(Ao)[0],c=Qi().memoizedState;return[typeof s=="boolean"?s:iu(s),c]},useSyncExternalStore:$E,useId:kh};Oo.useCacheRefresh=b0,Oo.useMemoCache=JE,Oo.useHostTransitionStatus=hg,Oo.useFormState=m0,Oo.useActionState=m0,Oo.useOptimistic=function(s,c){var p=Qi();return Kn!==null?ng(p,Kn,s,c):(p.baseState=s,[s,p.queue.dispatch])};function ru(s,c,p,g){c=s.memoizedState,p=p(g,c),p=p==null?c:We({},c,p),s.memoizedState=p,s.lanes===0&&(s.updateQueue.baseState=p)}var Gl={isMounted:function(s){return(s=s._reactInternals)?rt(s)===s:!1},enqueueSetState:function(s,c,p){s=s._reactInternals;var g=Xr(),R=Dc(g);R.payload=c,p!=null&&(R.callback=p),c=kc(s,R,g),c!==null&&(Jr(c,s,g),Vh(c,s,g))},enqueueReplaceState:function(s,c,p){s=s._reactInternals;var g=Xr(),R=Dc(g);R.tag=1,R.payload=c,p!=null&&(R.callback=p),c=kc(s,R,g),c!==null&&(Jr(c,s,g),Vh(c,s,g))},enqueueForceUpdate:function(s,c){s=s._reactInternals;var p=Xr(),g=Dc(p);g.tag=2,c!=null&&(g.callback=c),c=kc(s,g,p),c!==null&&(Jr(c,s,p),Vh(c,s,p))}};function Lh(s,c,p,g,R,C,V){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(g,C,V):c.prototype&&c.prototype.isPureReactComponent?!yc(p,g)||!yc(R,C):!0}function O0(s,c,p,g){s=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(p,g),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(p,g),c.state!==s&&Gl.enqueueReplaceState(c,c.state,null)}function Ac(s,c){var p=c;if("ref"in c){p={};for(var g in c)g!=="ref"&&(p[g]=c[g])}if(s=s.defaultProps){p===c&&(p=We({},p));for(var R in s)p[R]===void 0&&(p[R]=s[R])}return p}var Kf=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function mg(s){Kf(s)}function I0(s){console.error(s)}function N0(s){Kf(s)}function su(s,c){try{var p=s.onUncaughtError;p(c.value,{componentStack:c.stack})}catch(g){setTimeout(function(){throw g})}}function qf(s,c,p){try{var g=s.onCaughtError;g(p.value,{componentStack:p.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(R){setTimeout(function(){throw R})}}function _g(s,c,p){return p=Dc(p),p.tag=3,p.payload={element:null},p.callback=function(){su(s,c)},p}function D0(s){return s=Dc(s),s.tag=3,s}function Eg(s,c,p,g){var R=p.type.getDerivedStateFromError;if(typeof R=="function"){var C=g.value;s.payload=function(){return R(C)},s.callback=function(){qf(c,p,g)}}var V=p.stateNode;V!==null&&typeof V.componentDidCatch=="function"&&(s.callback=function(){qf(c,p,g),typeof R!="function"&&(Ya===null?Ya=new Set([this]):Ya.add(this));var q=g.stack;this.componentDidCatch(g.value,{componentStack:q!==null?q:""})})}function gg(s,c,p,g,R){if(p.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(c=p.alternate,c!==null&&Uh(c,p,R,!0),p=Gs.current,p!==null){switch(p.tag){case 13:return Pa===null?Fc():p.alternate===null&&wi===0&&(wi=3),p.flags&=-257,p.flags|=65536,p.lanes=R,g===UE?p.flags|=16384:(c=p.updateQueue,c===null?p.updateQueue=new Set([g]):c.add(g),um(s,g,R)),!1;case 22:return p.flags|=65536,g===UE?p.flags|=16384:(c=p.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([g])},p.updateQueue=c):(p=c.retryQueue,p===null?c.retryQueue=new Set([g]):p.add(g)),um(s,g,R)),!1}throw Error(_(435,p.tag))}return um(s,g,R),Fc(),!1}if(Gn)return c=Gs.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=R,g!==Pf&&(s=Error(_(422),{cause:g}),gh(Fs(s,p)))):(g!==Pf&&(c=Error(_(423),{cause:g}),gh(Fs(c,p))),s=s.current.alternate,s.flags|=65536,R&=-R,s.lanes|=R,g=Fs(g,p),R=_g(s.stateNode,g,R),Dg(s,R),wi!==4&&(wi=2)),!1;var C=Error(_(520),{cause:g});if(C=Fs(C,p),qh===null?qh=[C]:qh.push(C),wi!==4&&(wi=2),c===null)return!0;g=Fs(g,p),p=c;do{switch(p.tag){case 3:return p.flags|=65536,s=R&-R,p.lanes|=s,s=_g(p.stateNode,g,s),Dg(p,s),!1;case 1:if(c=p.type,C=p.stateNode,(p.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(Ya===null||!Ya.has(C))))return p.flags|=65536,R&=-R,p.lanes|=R,R=D0(R),Eg(R,s,p,g),Dg(p,R),!1}p=p.return}while(p!==null);return!1}var k0=Error(_(461)),di=!1;function Mi(s,c,p,g){c.child=s===null?n0(c,null,p,g):Ml(c,s.child,p,g)}function Oc(s,c,p,g,R){p=p.render;var C=c.ref;if("ref"in g){var V={};for(var q in g)q!=="ref"&&(V[q]=g[q])}else V=g;return Wl(c),g=Ah(s,c,p,V,C,R),q=Vl(),s!==null&&!di?(qE(s,c,R),Io(s,c,R)):(Gn&&q&&ME(c),c.flags|=1,Mi(s,c,g,R),c.child)}function yg(s,c,p,g,R){if(s===null){var C=p.type;return typeof C=="function"&&!zh(C)&&C.defaultProps===void 0&&p.compare===null?(c.tag=15,c.type=C,Sg(s,c,C,g,R)):(s=Ga(p.type,null,g,c,c.mode,R),s.ref=c.ref,s.return=c,c.child=s)}if(C=s.child,!Qf(s,R)){var V=C.memoizedProps;if(p=p.compare,p=p!==null?p:yc,p(V,g)&&s.ref===c.ref)return Io(s,c,R)}return c.flags|=1,s=qr(C,g),s.ref=c.ref,s.return=c,c.child=s}function Sg(s,c,p,g,R){if(s!==null){var C=s.memoizedProps;if(yc(C,g)&&s.ref===c.ref)if(di=!1,c.pendingProps=g=C,Qf(s,R))(s.flags&131072)!==0&&(di=!0);else return c.lanes=s.lanes,Io(s,c,R)}return Jf(s,c,p,g,R)}function Ic(s,c,p){var g=c.pendingProps,R=g.children,C=(c.stateNode._pendingVisibility&2)!==0,V=s!==null?s.memoizedState:null;if(Mh(s,c),g.mode==="hidden"||C){if((c.flags&128)!==0){if(g=V!==null?V.baseLanes|p:p,s!==null){for(R=c.child=s.child,C=0;R!==null;)C=C|R.lanes|R.childLanes,R=R.sibling;c.childLanes=C&~g}else c.childLanes=0,c.child=null;return Xf(s,c,g,p)}if((p&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},s!==null&&xf(c,V!==null?V.cachePool:null),V!==null?Th(c,V):Rh(),FE(c);else return c.lanes=c.childLanes=536870912,Xf(s,c,V!==null?V.baseLanes|p:p,p)}else V!==null?(xf(c,V.cachePool),Th(c,V),La(),c.memoizedState=null):(s!==null&&xf(c,null),Rh(),La());return Mi(s,c,R,p),c.child}function Xf(s,c,p,g){var R=WE();return R=R===null?null:{parent:or._currentValue,pool:R},c.memoizedState={baseLanes:p,cachePool:R},s!==null&&xf(c,null),Rh(),FE(c),s!==null&&Uh(s,c,g,!0),null}function Mh(s,c){var p=c.ref;if(p===null)s!==null&&s.ref!==null&&(c.flags|=2097664);else{if(typeof p!="function"&&typeof p!="object")throw Error(_(284));(s===null||s.ref!==p)&&(c.flags|=2097664)}}function Jf(s,c,p,g,R){return Wl(c),p=Ah(s,c,p,g,void 0,R),g=Vl(),s!==null&&!di?(qE(s,c,R),Io(s,c,R)):(Gn&&g&&ME(c),c.flags|=1,Mi(s,c,p,R),c.child)}function P0(s,c,p,g,R,C){return Wl(c),c.updateQueue=null,p=KE(c,g,p,R),zE(s),g=Vl(),s!==null&&!di?(qE(s,c,C),Io(s,c,C)):(Gn&&g&&ME(c),c.flags|=1,Mi(s,c,p,C),c.child)}function vg(s,c,p,g,R){if(Wl(c),c.stateNode===null){var C=vc,V=p.contextType;typeof V=="object"&&V!==null&&(C=xr(V)),C=new p(g,C),c.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,C.updater=Gl,c.stateNode=C,C._reactInternals=c,C=c.stateNode,C.props=g,C.state=c.memoizedState,C.refs={},Ig(c),V=p.contextType,C.context=typeof V=="object"&&V!==null?xr(V):vc,C.state=c.memoizedState,V=p.getDerivedStateFromProps,typeof V=="function"&&(ru(c,p,V,g),C.state=c.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(V=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),V!==C.state&&Gl.enqueueReplaceState(C,C.state,null),jh(c,g,C,R),au(),C.state=c.memoizedState),typeof C.componentDidMount=="function"&&(c.flags|=4194308),g=!0}else if(s===null){C=c.stateNode;var q=c.memoizedProps,ee=Ac(p,q);C.props=ee;var de=C.context,Me=p.contextType;V=vc,typeof Me=="object"&&Me!==null&&(V=xr(Me));var ze=p.getDerivedStateFromProps;Me=typeof ze=="function"||typeof C.getSnapshotBeforeUpdate=="function",q=c.pendingProps!==q,Me||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(q||de!==V)&&O0(c,C,g,V),xa=!1;var Ce=c.memoizedState;C.state=Ce,jh(c,g,C,R),au(),de=c.memoizedState,q||Ce!==de||xa?(typeof ze=="function"&&(ru(c,p,ze,g),de=c.memoizedState),(ee=xa||Lh(c,p,ee,g,Ce,de,V))?(Me||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(c.flags|=4194308)):(typeof C.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=g,c.memoizedState=de),C.props=g,C.state=de,C.context=V,g=ee):(typeof C.componentDidMount=="function"&&(c.flags|=4194308),g=!1)}else{C=c.stateNode,Ng(s,c),V=c.memoizedProps,Me=Ac(p,V),C.props=Me,ze=c.pendingProps,Ce=C.context,de=p.contextType,ee=vc,typeof de=="object"&&de!==null&&(ee=xr(de)),q=p.getDerivedStateFromProps,(de=typeof q=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(V!==ze||Ce!==ee)&&O0(c,C,g,ee),xa=!1,Ce=c.memoizedState,C.state=Ce,jh(c,g,C,R),au();var Pe=c.memoizedState;V!==ze||Ce!==Pe||xa||s!==null&&s.dependencies!==null&&em(s.dependencies)?(typeof q=="function"&&(ru(c,p,q,g),Pe=c.memoizedState),(Me=xa||Lh(c,p,Me,g,Ce,Pe,ee)||s!==null&&s.dependencies!==null&&em(s.dependencies))?(de||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(g,Pe,ee),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(g,Pe,ee)),typeof C.componentDidUpdate=="function"&&(c.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof C.componentDidUpdate!="function"||V===s.memoizedProps&&Ce===s.memoizedState||(c.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||V===s.memoizedProps&&Ce===s.memoizedState||(c.flags|=1024),c.memoizedProps=g,c.memoizedState=Pe),C.props=g,C.state=Pe,C.context=ee,g=Me):(typeof C.componentDidUpdate!="function"||V===s.memoizedProps&&Ce===s.memoizedState||(c.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||V===s.memoizedProps&&Ce===s.memoizedState||(c.flags|=1024),g=!1)}return C=g,Mh(s,c),g=(c.flags&128)!==0,C||g?(C=c.stateNode,p=g&&typeof p.getDerivedStateFromError!="function"?null:C.render(),c.flags|=1,s!==null&&g?(c.child=Ml(c,s.child,null,R),c.child=Ml(c,null,p,R)):Mi(s,c,p,R),c.memoizedState=C.state,s=c.child):s=Io(s,c,R),s}function Tg(s,c,p,g){return Eh(),c.flags|=256,Mi(s,c,p,g),c.child}var Rg={dehydrated:null,treeContext:null,retryLane:0};function Ma(s){return{baseLanes:s,cachePool:r0()}}function bg(s,c,p){return s=s!==null?s.childLanes&~p:0,c&&(s|=Os),s}function L0(s,c,p){var g=c.pendingProps,R=!1,C=(c.flags&128)!==0,V;if((V=C)||(V=s!==null&&s.memoizedState===null?!1:(ar.current&2)!==0),V&&(R=!0,c.flags&=-129),V=(c.flags&32)!==0,c.flags&=-33,s===null){if(Gn){if(R?Co(c):La(),Gn){var q=Ar,ee;if(ee=q){e:{for(ee=q,q=ka;ee.nodeType!==8;){if(!q){q=null;break e}if(ee=ga(ee.nextSibling),ee===null){q=null;break e}}q=ee}q!==null?(c.memoizedState={dehydrated:q,treeContext:gr!==null?{id:bo,overflow:Ts}:null,retryLane:536870912},ee=zs(18,null,null,0),ee.stateNode=q,ee.return=c,c.child=ee,zr=c,Ar=null,ee=!0):ee=!1}ee||Tc(c)}if(q=c.memoizedState,q!==null&&(q=q.dehydrated,q!==null))return q.data==="$!"?c.lanes=16:c.lanes=536870912,null;wo(c)}return q=g.children,g=g.fallback,R?(La(),R=c.mode,q=wg({mode:"hidden",children:q},R),g=Lc(g,R,p,null),q.return=c,g.return=c,q.sibling=g,c.child=q,R=c.child,R.memoizedState=Ma(p),R.childLanes=bg(s,V,p),c.memoizedState=Rg,g):(Co(c),Cg(c,q))}if(ee=s.memoizedState,ee!==null&&(q=ee.dehydrated,q!==null)){if(C)c.flags&256?(Co(c),c.flags&=-257,c=Zf(s,c,p)):c.memoizedState!==null?(La(),c.child=s.child,c.flags|=128,c=null):(La(),R=g.fallback,q=c.mode,g=wg({mode:"visible",children:g.children},q),R=Lc(R,q,p,null),R.flags|=2,g.return=c,R.return=c,g.sibling=R,c.child=g,Ml(c,s.child,null,p),g=c.child,g.memoizedState=Ma(p),g.childLanes=bg(s,V,p),c.memoizedState=Rg,c=R);else if(Co(c),q.data==="$!"){if(V=q.nextSibling&&q.nextSibling.dataset,V)var de=V.dgst;V=de,g=Error(_(419)),g.stack="",g.digest=V,gh({value:g,source:null,stack:null}),c=Zf(s,c,p)}else if(di||Uh(s,c,p,!1),V=(p&s.childLanes)!==0,di||V){if(V=mi,V!==null){if(g=p&-p,(g&42)!==0)g=1;else switch(g){case 2:g=1;break;case 8:g=4;break;case 32:g=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:g=64;break;case 268435456:g=134217728;break;default:g=0}if(g=(g&(V.suspendedLanes|p))!==0?0:g,g!==0&&g!==ee.retryLane)throw ee.retryLane=g,Sc(s,g),Jr(V,s,g),k0}q.data==="$?"||Fc(),c=Zf(s,c,p)}else q.data==="$?"?(c.flags|=128,c.child=s.child,c=Xg.bind(null,s),q._reactRetry=c,c=null):(s=ee.treeContext,Ar=ga(q.nextSibling),zr=c,Gn=!0,Rs=null,ka=!1,s!==null&&(Bs[vs++]=bo,Bs[vs++]=Ts,Bs[vs++]=gr,bo=s.id,Ts=s.overflow,gr=c),c=Cg(c,g.children),c.flags|=4096);return c}return R?(La(),R=g.fallback,q=c.mode,ee=s.child,de=ee.sibling,g=qr(ee,{mode:"hidden",children:g.children}),g.subtreeFlags=ee.subtreeFlags&31457280,de!==null?R=qr(de,R):(R=Lc(R,q,p,null),R.flags|=2),R.return=c,g.return=c,g.sibling=R,c.child=g,g=R,R=c.child,q=s.child.memoizedState,q===null?q=Ma(p):(ee=q.cachePool,ee!==null?(de=or._currentValue,ee=ee.parent!==de?{parent:de,pool:de}:ee):ee=r0(),q={baseLanes:q.baseLanes|p,cachePool:ee}),R.memoizedState=q,R.childLanes=bg(s,V,p),c.memoizedState=Rg,g):(Co(c),p=s.child,s=p.sibling,p=qr(p,{mode:"visible",children:g.children}),p.return=c,p.sibling=null,s!==null&&(V=c.deletions,V===null?(c.deletions=[s],c.flags|=16):V.push(s)),c.child=p,c.memoizedState=null,p)}function Cg(s,c){return c=wg({mode:"visible",children:c},s.mode),c.return=s,s.child=c}function wg(s,c){return ss(s,c,0,null)}function Zf(s,c,p){return Ml(c,s.child,null,p),s=Cg(c,c.pendingProps.children),s.flags|=2,c.memoizedState=null,s}function M0(s,c,p){s.lanes|=c;var g=s.alternate;g!==null&&(g.lanes|=c),$f(s.return,c,p)}function xh(s,c,p,g,R){var C=s.memoizedState;C===null?s.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:g,tail:p,tailMode:R}:(C.isBackwards=c,C.rendering=null,C.renderingStartTime=0,C.last=g,C.tail=p,C.tailMode=R)}function Ag(s,c,p){var g=c.pendingProps,R=g.revealOrder,C=g.tail;if(Mi(s,c,g.children,p),g=ar.current,(g&2)!==0)g=g&1|2,c.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=c.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&M0(s,p,c);else if(s.tag===19)M0(s,p,c);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===c)break e;for(;s.sibling===null;){if(s.return===null||s.return===c)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}g&=1}switch(an(ar,g),R){case"forwards":for(p=c.child,R=null;p!==null;)s=p.alternate,s!==null&&bc(s)===null&&(R=p),p=p.sibling;p=R,p===null?(R=c.child,c.child=null):(R=p.sibling,p.sibling=null),xh(c,!1,R,p,C);break;case"backwards":for(p=null,R=c.child,c.child=null;R!==null;){if(s=R.alternate,s!==null&&bc(s)===null){c.child=R;break}s=R.sibling,R.sibling=p,p=R,R=s}xh(c,!0,p,null,C);break;case"together":xh(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function Io(s,c,p){if(s!==null&&(c.dependencies=s.dependencies),Po|=c.lanes,(p&c.childLanes)===0)if(s!==null){if(Uh(s,c,p,!1),(p&c.childLanes)===0)return null}else return null;if(s!==null&&c.child!==s.child)throw Error(_(153));if(c.child!==null){for(s=c.child,p=qr(s,s.pendingProps),c.child=p,p.return=c;s.sibling!==null;)s=s.sibling,p=p.sibling=qr(s,s.pendingProps),p.return=c;p.sibling=null}return c.child}function Qf(s,c){return(s.lanes&c)!==0?!0:(s=s.dependencies,!!(s!==null&&em(s)))}function Hw(s,c,p){switch(c.tag){case 3:St(c,c.stateNode.containerInfo),Nc(c,or,s.memoizedState.cache),Eh();break;case 27:case 5:$n(c);break;case 4:St(c,c.stateNode.containerInfo);break;case 10:Nc(c,c.type,c.memoizedProps.value);break;case 13:var g=c.memoizedState;if(g!==null)return g.dehydrated!==null?(Co(c),c.flags|=128,null):(p&c.child.childLanes)!==0?L0(s,c,p):(Co(c),s=Io(s,c,p),s!==null?s.sibling:null);Co(c);break;case 19:var R=(s.flags&128)!==0;if(g=(p&c.childLanes)!==0,g||(Uh(s,c,p,!1),g=(p&c.childLanes)!==0),R){if(g)return Ag(s,c,p);c.flags|=128}if(R=c.memoizedState,R!==null&&(R.rendering=null,R.tail=null,R.lastEffect=null),an(ar,ar.current),g)break;return null;case 22:case 23:return c.lanes=0,Ic(s,c,p);case 24:Nc(c,or,s.memoizedState.cache)}return Io(s,c,p)}function x0(s,c,p){if(s!==null)if(s.memoizedProps!==c.pendingProps)di=!0;else{if(!Qf(s,p)&&(c.flags&128)===0)return di=!1,Hw(s,c,p);di=(s.flags&131072)!==0}else di=!1,Gn&&(c.flags&1048576)!==0&&Xv(c,qd,c.index);switch(c.lanes=0,c.tag){case 16:e:{s=c.pendingProps;var g=c.elementType,R=g._init;if(g=R(g._payload),c.type=g,typeof g=="function")zh(g)?(s=Ac(g,s),c.tag=1,c=vg(null,c,g,s,p)):(c.tag=0,c=Jf(null,c,g,s,p));else{if(g!=null){if(R=g.$$typeof,R===ie){c.tag=11,c=Oc(null,c,g,s,p);break e}else if(R===ve){c.tag=14,c=yg(null,c,g,s,p);break e}}throw c=Je(g)||g,Error(_(306,c,""))}}return c;case 0:return Jf(s,c,c.type,c.pendingProps,p);case 1:return g=c.type,R=Ac(g,c.pendingProps),vg(s,c,g,R,p);case 3:e:{if(St(c,c.stateNode.containerInfo),s===null)throw Error(_(387));var C=c.pendingProps;R=c.memoizedState,g=R.element,Ng(s,c),jh(c,C,null,p);var V=c.memoizedState;if(C=V.cache,Nc(c,or,C),C!==R.cache&&ha(c,[or],p,!0),au(),C=V.element,R.isDehydrated)if(R={element:C,isDehydrated:!1,cache:V.cache},c.updateQueue.baseState=R,c.memoizedState=R,c.flags&256){c=Tg(s,c,C,p);break e}else if(C!==g){g=Fs(Error(_(424)),c),gh(g),c=Tg(s,c,C,p);break e}else for(Ar=ga(c.stateNode.containerInfo.firstChild),zr=c,Gn=!0,Rs=null,ka=!0,p=n0(c,null,C,p),c.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling;else{if(Eh(),C===g){c=Io(s,c,p);break e}Mi(s,c,C,p)}c=c.child}return c;case 26:return Mh(s,c),s===null?(p=vT(c.type,null,c.pendingProps,null))?c.memoizedState=p:Gn||(p=c.type,s=c.pendingProps,g=cp(at.current).createElement(p),g[Cr]=c,g[Wr]=s,Or(g,p,s),_r(g),c.stateNode=g):c.memoizedState=vT(c.type,s.memoizedProps,c.pendingProps,s.memoizedState),null;case 27:return $n(c),s===null&&Gn&&(g=c.stateNode=ET(c.type,c.pendingProps,at.current),zr=c,ka=!0,Ar=ga(g.firstChild)),g=c.pendingProps.children,s!==null||Gn?Mi(s,c,g,p):c.child=Ml(c,null,g,p),Mh(s,c),c.child;case 5:return s===null&&Gn&&((R=g=Ar)&&(g=aA(g,c.type,c.pendingProps,ka),g!==null?(c.stateNode=g,zr=c,Ar=ga(g.firstChild),ka=!1,R=!0):R=!1),R||Tc(c)),$n(c),R=c.type,C=c.pendingProps,V=s!==null?s.memoizedProps:null,g=C.children,Em(R,C)?g=null:V!==null&&Em(R,V)&&(c.flags|=32),c.memoizedState!==null&&(R=Ah(s,c,Ff,null,null,p),Cu._currentValue=R),Mh(s,c),Mi(s,c,g,p),c.child;case 6:return s===null&&Gn&&((s=p=Ar)&&(p=oA(p,c.pendingProps,ka),p!==null?(c.stateNode=p,zr=c,Ar=null,s=!0):s=!1),s||Tc(c)),null;case 13:return L0(s,c,p);case 4:return St(c,c.stateNode.containerInfo),g=c.pendingProps,s===null?c.child=Ml(c,null,g,p):Mi(s,c,g,p),c.child;case 11:return Oc(s,c,c.type,c.pendingProps,p);case 7:return Mi(s,c,c.pendingProps,p),c.child;case 8:return Mi(s,c,c.pendingProps.children,p),c.child;case 12:return Mi(s,c,c.pendingProps.children,p),c.child;case 10:return g=c.pendingProps,Nc(c,c.type,g.value),Mi(s,c,g.children,p),c.child;case 9:return R=c.type._context,g=c.pendingProps.children,Wl(c),R=xr(R),g=g(R),c.flags|=1,Mi(s,c,g,p),c.child;case 14:return yg(s,c,c.type,c.pendingProps,p);case 15:return Sg(s,c,c.type,c.pendingProps,p);case 19:return Ag(s,c,p);case 22:return Ic(s,c,p);case 24:return Wl(c),g=xr(or),s===null?(R=WE(),R===null&&(R=mi,C=BE(),R.pooledCache=C,C.refCount++,C!==null&&(R.pooledCacheLanes|=p),R=C),c.memoizedState={parent:g,cache:R},Ig(c),Nc(c,or,R)):((s.lanes&p)!==0&&(Ng(s,c),jh(c,null,null,p),au()),R=s.memoizedState,C=c.memoizedState,R.parent!==g?(R={parent:g,cache:g},c.memoizedState=R,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=R),Nc(c,or,g)):(g=C.cache,Nc(c,or,g),g!==R.cache&&ha(c,[or],p,!0))),Mi(s,c,c.pendingProps.children,p),c.child;case 29:throw c.pendingProps}throw Error(_(156,c.tag))}var Og=qe(null),Hl=null,No=null;function Nc(s,c,p){an(Og,c._currentValue),c._currentValue=p}function Do(s){s._currentValue=Og.current,qt(Og)}function $f(s,c,p){for(;s!==null;){var g=s.alternate;if((s.childLanes&c)!==c?(s.childLanes|=c,g!==null&&(g.childLanes|=c)):g!==null&&(g.childLanes&c)!==c&&(g.childLanes|=c),s===p)break;s=s.return}}function ha(s,c,p,g){var R=s.child;for(R!==null&&(R.return=s);R!==null;){var C=R.dependencies;if(C!==null){var V=R.child;C=C.firstContext;e:for(;C!==null;){var q=C;C=R;for(var ee=0;ee<c.length;ee++)if(q.context===c[ee]){C.lanes|=p,q=C.alternate,q!==null&&(q.lanes|=p),$f(C.return,p,s),g||(V=null);break e}C=q.next}}else if(R.tag===18){if(V=R.return,V===null)throw Error(_(341));V.lanes|=p,C=V.alternate,C!==null&&(C.lanes|=p),$f(V,p,s),V=null}else V=R.child;if(V!==null)V.return=R;else for(V=R;V!==null;){if(V===s){V=null;break}if(R=V.sibling,R!==null){R.return=V.return,V=R;break}V=V.return}R=V}}function Uh(s,c,p,g){s=null;for(var R=c,C=!1;R!==null;){if(!C){if((R.flags&524288)!==0)C=!0;else if((R.flags&262144)!==0)break}if(R.tag===10){var V=R.alternate;if(V===null)throw Error(_(387));if(V=V.memoizedProps,V!==null){var q=R.type;ys(R.pendingProps.value,V.value)||(s!==null?s.push(q):s=[q])}}else if(R===Ze.current){if(V=R.alternate,V===null)throw Error(_(387));V.memoizedState.memoizedState!==R.memoizedState.memoizedState&&(s!==null?s.push(Cu):s=[Cu])}R=R.return}s!==null&&ha(c,s,p,g),c.flags|=262144}function em(s){for(s=s.firstContext;s!==null;){if(!ys(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Wl(s){Hl=s,No=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function xr(s){return U0(Hl,s)}function tm(s,c){return Hl===null&&Wl(s),U0(s,c)}function U0(s,c){var p=c._currentValue;if(c={context:c,memoizedValue:p,next:null},No===null){if(s===null)throw Error(_(308));No=c,s.dependencies={lanes:0,firstContext:c},s.flags|=524288}else No=No.next=c;return p}var xa=!1;function Ig(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ng(s,c){s=s.updateQueue,c.updateQueue===s&&(c.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Dc(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function kc(s,c,p){var g=s.updateQueue;if(g===null)return null;if(g=g.shared,(Si&2)!==0){var R=g.pending;return R===null?c.next=c:(c.next=R.next,R.next=c),g.pending=c,c=kl(s),qv(s,null,p),c}return Nl(s,g,c,p),kl(s)}function Vh(s,c,p){if(c=c.updateQueue,c!==null&&(c=c.shared,(p&4194176)!==0)){var g=c.lanes;g&=s.pendingLanes,p|=g,c.lanes=p,oh(s,p)}}function Dg(s,c){var p=s.updateQueue,g=s.alternate;if(g!==null&&(g=g.updateQueue,p===g)){var R=null,C=null;if(p=p.firstBaseUpdate,p!==null){do{var V={lane:p.lane,tag:p.tag,payload:p.payload,callback:null,next:null};C===null?R=C=V:C=C.next=V,p=p.next}while(p!==null);C===null?R=C=c:C=C.next=c}else R=C=c;p={baseState:g.baseState,firstBaseUpdate:R,lastBaseUpdate:C,shared:g.shared,callbacks:g.callbacks},s.updateQueue=p;return}s=p.lastBaseUpdate,s===null?p.firstBaseUpdate=c:s.next=c,p.lastBaseUpdate=c}var nm=!1;function au(){if(nm){var s=eu;if(s!==null)throw s}}function jh(s,c,p,g){nm=!1;var R=s.updateQueue;xa=!1;var C=R.firstBaseUpdate,V=R.lastBaseUpdate,q=R.shared.pending;if(q!==null){R.shared.pending=null;var ee=q,de=ee.next;ee.next=null,V===null?C=de:V.next=de,V=ee;var Me=s.alternate;Me!==null&&(Me=Me.updateQueue,q=Me.lastBaseUpdate,q!==V&&(q===null?Me.firstBaseUpdate=de:q.next=de,Me.lastBaseUpdate=ee))}if(C!==null){var ze=R.baseState;V=0,Me=de=ee=null,q=C;do{var Ce=q.lane&-536870913,Pe=Ce!==q.lane;if(Pe?(Pn&Ce)===Ce:(g&Ce)===Ce){Ce!==0&&Ce===$d&&(nm=!0),Me!==null&&(Me=Me.next={lane:0,tag:q.tag,payload:q.payload,callback:null,next:null});e:{var Ct=s,Zt=q;Ce=c;var Ui=p;switch(Zt.tag){case 1:if(Ct=Zt.payload,typeof Ct=="function"){ze=Ct.call(Ui,ze,Ce);break e}ze=Ct;break e;case 3:Ct.flags=Ct.flags&-65537|128;case 0:if(Ct=Zt.payload,Ce=typeof Ct=="function"?Ct.call(Ui,ze,Ce):Ct,Ce==null)break e;ze=We({},ze,Ce);break e;case 2:xa=!0}}Ce=q.callback,Ce!==null&&(s.flags|=64,Pe&&(s.flags|=8192),Pe=R.callbacks,Pe===null?R.callbacks=[Ce]:Pe.push(Ce))}else Pe={lane:Ce,tag:q.tag,payload:q.payload,callback:q.callback,next:null},Me===null?(de=Me=Pe,ee=ze):Me=Me.next=Pe,V|=Ce;if(q=q.next,q===null){if(q=R.shared.pending,q===null)break;Pe=q,q=Pe.next,Pe.next=null,R.lastBaseUpdate=Pe,R.shared.pending=null}}while(!0);Me===null&&(ee=ze),R.baseState=ee,R.firstBaseUpdate=de,R.lastBaseUpdate=Me,C===null&&(R.shared.lanes=0),Po|=V,s.lanes=V,s.memoizedState=ze}}function V0(s,c){if(typeof s!="function")throw Error(_(191,s));s.call(c)}function Fh(s,c){var p=s.callbacks;if(p!==null)for(s.callbacks=null,s=0;s<p.length;s++)V0(p[s],c)}function Yl(s,c){try{var p=c.updateQueue,g=p!==null?p.lastEffect:null;if(g!==null){var R=g.next;p=R;do{if((p.tag&s)===s){g=void 0;var C=p.create,V=p.inst;g=C(),V.destroy=g}p=p.next}while(p!==R)}}catch(q){On(c,c.return,q)}}function ko(s,c,p){try{var g=c.updateQueue,R=g!==null?g.lastEffect:null;if(R!==null){var C=R.next;g=C;do{if((g.tag&s)===s){var V=g.inst,q=V.destroy;if(q!==void 0){V.destroy=void 0,R=c;var ee=p;try{q()}catch(de){On(R,ee,de)}}}g=g.next}while(g!==C)}}catch(de){On(c,c.return,de)}}function Bh(s){var c=s.updateQueue;if(c!==null){var p=s.stateNode;try{Fh(c,p)}catch(g){On(s,s.return,g)}}}function kg(s,c,p){p.props=Ac(s.type,s.memoizedProps),p.state=s.memoizedState;try{p.componentWillUnmount()}catch(g){On(s,c,g)}}function zl(s,c){try{var p=s.ref;if(p!==null){var g=s.stateNode;switch(s.tag){case 26:case 27:case 5:var R=g;break;default:R=g}typeof p=="function"?s.refCleanup=p(R):p.current=R}}catch(C){On(s,c,C)}}function rs(s,c){var p=s.ref,g=s.refCleanup;if(p!==null)if(typeof g=="function")try{g()}catch(R){On(s,c,R)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof p=="function")try{p(null)}catch(R){On(s,c,R)}else p.current=null}function Gh(s){var c=s.type,p=s.memoizedProps,g=s.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":p.autoFocus&&g.focus();break e;case"img":p.src?g.src=p.src:p.srcSet&&(g.srcset=p.srcSet)}}catch(R){On(s,s.return,R)}}function j0(s,c,p){try{var g=s.stateNode;Su(g,s.type,p,c),g[Wr]=c}catch(R){On(s,s.return,R)}}function Pg(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27||s.tag===4}function im(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Pg(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==27&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Lg(s,c,p){var g=s.tag;if(g===5||g===6)s=s.stateNode,c?p.nodeType===8?p.parentNode.insertBefore(s,c):p.insertBefore(s,c):(p.nodeType===8?(c=p.parentNode,c.insertBefore(s,p)):(c=p,c.appendChild(s)),p=p._reactRootContainer,p!=null||c.onclick!==null||(c.onclick=ap));else if(g!==4&&g!==27&&(s=s.child,s!==null))for(Lg(s,c,p),s=s.sibling;s!==null;)Lg(s,c,p),s=s.sibling}function Kl(s,c,p){var g=s.tag;if(g===5||g===6)s=s.stateNode,c?p.insertBefore(s,c):p.appendChild(s);else if(g!==4&&g!==27&&(s=s.child,s!==null))for(Kl(s,c,p),s=s.sibling;s!==null;)Kl(s,c,p),s=s.sibling}var Ua=!1,xi=!1,Mg=!1,F0=typeof WeakSet=="function"?WeakSet:Set,Yi=null,B0=!1;function Ww(s,c){if(s=s.containerInfo,Gc=bm,s=Ro(s),OE(s)){if("selectionStart"in s)var p={start:s.selectionStart,end:s.selectionEnd};else e:{p=(p=s.ownerDocument)&&p.defaultView||window;var g=p.getSelection&&p.getSelection();if(g&&g.rangeCount!==0){p=g.anchorNode;var R=g.anchorOffset,C=g.focusNode;g=g.focusOffset;try{p.nodeType,C.nodeType}catch{p=null;break e}var V=0,q=-1,ee=-1,de=0,Me=0,ze=s,Ce=null;t:for(;;){for(var Pe;ze!==p||R!==0&&ze.nodeType!==3||(q=V+R),ze!==C||g!==0&&ze.nodeType!==3||(ee=V+g),ze.nodeType===3&&(V+=ze.nodeValue.length),(Pe=ze.firstChild)!==null;)Ce=ze,ze=Pe;for(;;){if(ze===s)break t;if(Ce===p&&++de===R&&(q=V),Ce===C&&++Me===g&&(ee=V),(Pe=ze.nextSibling)!==null)break;ze=Ce,Ce=ze.parentNode}ze=Pe}p=q===-1||ee===-1?null:{start:q,end:ee}}else p=null}p=p||{start:0,end:0}}else p=null;for(op={focusedElem:s,selectionRange:p},bm=!1,Yi=c;Yi!==null;)if(c=Yi,s=c.child,(c.subtreeFlags&1028)!==0&&s!==null)s.return=c,Yi=s;else for(;Yi!==null;){switch(c=Yi,C=c.alternate,s=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&C!==null){s=void 0,p=c,R=C.memoizedProps,C=C.memoizedState,g=p.stateNode;try{var Ct=Ac(p.type,R,p.elementType===p.type);s=g.getSnapshotBeforeUpdate(Ct,C),g.__reactInternalSnapshotBeforeUpdate=s}catch(Zt){On(p,p.return,Zt)}}break;case 3:if((s&1024)!==0){if(s=c.stateNode.containerInfo,p=s.nodeType,p===9)oy(s);else if(p===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":oy(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(_(163))}if(s=c.sibling,s!==null){s.return=c.return,Yi=s;break}Yi=c.return}return Ct=B0,B0=!1,Ct}function G0(s,c,p){var g=p.flags;switch(p.tag){case 0:case 11:case 15:Va(s,p),g&4&&Yl(5,p);break;case 1:if(Va(s,p),g&4)if(s=p.stateNode,c===null)try{s.componentDidMount()}catch(q){On(p,p.return,q)}else{var R=Ac(p.type,c.memoizedProps);c=c.memoizedState;try{s.componentDidUpdate(R,c,s.__reactInternalSnapshotBeforeUpdate)}catch(q){On(p,p.return,q)}}g&64&&Bh(p),g&512&&zl(p,p.return);break;case 3:if(Va(s,p),g&64&&(g=p.updateQueue,g!==null)){if(s=null,p.child!==null)switch(p.child.tag){case 27:case 5:s=p.child.stateNode;break;case 1:s=p.child.stateNode}try{Fh(g,s)}catch(q){On(p,p.return,q)}}break;case 26:Va(s,p),g&512&&zl(p,p.return);break;case 27:case 5:Va(s,p),c===null&&g&4&&Gh(p),g&512&&zl(p,p.return);break;case 12:Va(s,p);break;case 13:Va(s,p),g&4&&rm(s,p);break;case 22:if(R=p.memoizedState!==null||Ua,!R){c=c!==null&&c.memoizedState!==null||xi;var C=Ua,V=xi;Ua=R,(xi=c)&&!V?ja(s,p,(p.subtreeFlags&8772)!==0):Va(s,p),Ua=C,xi=V}g&512&&(p.memoizedProps.mode==="manual"?zl(p,p.return):rs(p,p.return));break;default:Va(s,p)}}function xg(s){var c=s.alternate;c!==null&&(s.alternate=null,xg(c)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(c=s.stateNode,c!==null&&pf(c)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var $i=null,ws=!1;function pa(s,c,p){for(p=p.child;p!==null;)H0(s,c,p),p=p.sibling}function H0(s,c,p){if(sr&&typeof sr.onCommitFiberUnmount=="function")try{sr.onCommitFiberUnmount(Dd,p)}catch{}switch(p.tag){case 26:xi||rs(p,c),pa(s,c,p),p.memoizedState?p.memoizedState.count--:p.stateNode&&(p=p.stateNode,p.parentNode.removeChild(p));break;case 27:xi||rs(p,c);var g=$i,R=ws;for($i=p.stateNode,pa(s,c,p),p=p.stateNode,c=p.attributes;c.length;)p.removeAttributeNode(c[0]);pf(p),$i=g,ws=R;break;case 5:xi||rs(p,c);case 6:R=$i;var C=ws;if($i=null,pa(s,c,p),$i=R,ws=C,$i!==null)if(ws)try{s=$i,g=p.stateNode,s.nodeType===8?s.parentNode.removeChild(g):s.removeChild(g)}catch(V){On(p,c,V)}else try{$i.removeChild(p.stateNode)}catch(V){On(p,c,V)}break;case 18:$i!==null&&(ws?(c=$i,p=p.stateNode,c.nodeType===8?ay(c.parentNode,p):c.nodeType===1&&ay(c,p),_p(c)):ay($i,p.stateNode));break;case 4:g=$i,R=ws,$i=p.stateNode.containerInfo,ws=!0,pa(s,c,p),$i=g,ws=R;break;case 0:case 11:case 14:case 15:xi||ko(2,p,c),xi||ko(4,p,c),pa(s,c,p);break;case 1:xi||(rs(p,c),g=p.stateNode,typeof g.componentWillUnmount=="function"&&kg(p,c,g)),pa(s,c,p);break;case 21:pa(s,c,p);break;case 22:xi||rs(p,c),xi=(g=xi)||p.memoizedState!==null,pa(s,c,p),xi=g;break;default:pa(s,c,p)}}function rm(s,c){if(c.memoizedState===null&&(s=c.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{_p(s)}catch(p){On(c,c.return,p)}}function Yw(s){switch(s.tag){case 13:case 19:var c=s.stateNode;return c===null&&(c=s.stateNode=new F0),c;case 22:return s=s.stateNode,c=s._retryCache,c===null&&(c=s._retryCache=new F0),c;default:throw Error(_(435,s.tag))}}function sm(s,c){var p=Yw(s);c.forEach(function(g){var R=rT.bind(null,s,g);p.has(g)||(p.add(g),g.then(R,R))})}function Hs(s,c){var p=c.deletions;if(p!==null)for(var g=0;g<p.length;g++){var R=p[g],C=s,V=c,q=V;e:for(;q!==null;){switch(q.tag){case 27:case 5:$i=q.stateNode,ws=!1;break e;case 3:$i=q.stateNode.containerInfo,ws=!0;break e;case 4:$i=q.stateNode.containerInfo,ws=!0;break e}q=q.return}if($i===null)throw Error(_(160));H0(C,V,R),$i=null,ws=!1,C=R.alternate,C!==null&&(C.return=null),R.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)Ug(c,s),c=c.sibling}var fa=null;function Ug(s,c){var p=s.alternate,g=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Hs(c,s),Ws(s),g&4&&(ko(3,s,s.return),Yl(3,s),ko(5,s,s.return));break;case 1:Hs(c,s),Ws(s),g&512&&(xi||p===null||rs(p,p.return)),g&64&&Ua&&(s=s.updateQueue,s!==null&&(g=s.callbacks,g!==null&&(p=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=p===null?g:p.concat(g))));break;case 26:var R=fa;if(Hs(c,s),Ws(s),g&512&&(xi||p===null||rs(p,p.return)),g&4){var C=p!==null?p.memoizedState:null;if(g=s.memoizedState,p===null)if(g===null)if(s.stateNode===null){e:{g=s.type,p=s.memoizedProps,R=R.ownerDocument||R;t:switch(g){case"title":C=R.getElementsByTagName("title")[0],(!C||C[Sl]||C[Cr]||C.namespaceURI==="http://www.w3.org/2000/svg"||C.hasAttribute("itemprop"))&&(C=R.createElement(g),R.head.insertBefore(C,R.querySelector("head > title"))),Or(C,g,p),C[Cr]=s,_r(C),g=C;break e;case"link":var V=bT("link","href",R).get(g+(p.href||""));if(V){for(var q=0;q<V.length;q++)if(C=V[q],C.getAttribute("href")===(p.href==null?null:p.href)&&C.getAttribute("rel")===(p.rel==null?null:p.rel)&&C.getAttribute("title")===(p.title==null?null:p.title)&&C.getAttribute("crossorigin")===(p.crossOrigin==null?null:p.crossOrigin)){V.splice(q,1);break t}}C=R.createElement(g),Or(C,g,p),R.head.appendChild(C);break;case"meta":if(V=bT("meta","content",R).get(g+(p.content||""))){for(q=0;q<V.length;q++)if(C=V[q],C.getAttribute("content")===(p.content==null?null:""+p.content)&&C.getAttribute("name")===(p.name==null?null:p.name)&&C.getAttribute("property")===(p.property==null?null:p.property)&&C.getAttribute("http-equiv")===(p.httpEquiv==null?null:p.httpEquiv)&&C.getAttribute("charset")===(p.charSet==null?null:p.charSet)){V.splice(q,1);break t}}C=R.createElement(g),Or(C,g,p),R.head.appendChild(C);break;default:throw Error(_(468,g))}C[Cr]=s,_r(C),g=C}s.stateNode=g}else CT(R,s.type,s.stateNode);else s.stateNode=RT(R,g,s.memoizedProps);else C!==g?(C===null?p.stateNode!==null&&(p=p.stateNode,p.parentNode.removeChild(p)):C.count--,g===null?CT(R,s.type,s.stateNode):RT(R,g,s.memoizedProps)):g===null&&s.stateNode!==null&&j0(s,s.memoizedProps,p.memoizedProps)}break;case 27:if(g&4&&s.alternate===null){R=s.stateNode,C=s.memoizedProps;try{for(var ee=R.firstChild;ee;){var de=ee.nextSibling,Me=ee.nodeName;ee[Sl]||Me==="HEAD"||Me==="BODY"||Me==="SCRIPT"||Me==="STYLE"||Me==="LINK"&&ee.rel.toLowerCase()==="stylesheet"||R.removeChild(ee),ee=de}for(var ze=s.type,Ce=R.attributes;Ce.length;)R.removeAttributeNode(Ce[0]);Or(R,ze,C),R[Cr]=s,R[Wr]=C}catch(Ct){On(s,s.return,Ct)}}case 5:if(Hs(c,s),Ws(s),g&512&&(xi||p===null||rs(p,p.return)),s.flags&32){R=s.stateNode;try{Tl(R,"")}catch(Ct){On(s,s.return,Ct)}}g&4&&s.stateNode!=null&&(R=s.memoizedProps,j0(s,R,p!==null?p.memoizedProps:R)),g&1024&&(Mg=!0);break;case 6:if(Hs(c,s),Ws(s),g&4){if(s.stateNode===null)throw Error(_(162));g=s.memoizedProps,p=s.stateNode;try{p.nodeValue=g}catch(Ct){On(s,s.return,Ct)}}break;case 3:if(ym=null,R=fa,fa=gm(c.containerInfo),Hs(c,s),fa=R,Ws(s),g&4&&p!==null&&p.memoizedState.isDehydrated)try{_p(c.containerInfo)}catch(Ct){On(s,s.return,Ct)}Mg&&(Mg=!1,W0(s));break;case 4:g=fa,fa=gm(s.stateNode.containerInfo),Hs(c,s),Ws(s),fa=g;break;case 12:Hs(c,s),Ws(s);break;case 13:Hs(c,s),Ws(s),s.child.flags&8192&&s.memoizedState!==null!=(p!==null&&p.memoizedState!==null)&&(xc=Xt()),g&4&&(g=s.updateQueue,g!==null&&(s.updateQueue=null,sm(s,g)));break;case 22:if(g&512&&(xi||p===null||rs(p,p.return)),ee=s.memoizedState!==null,de=p!==null&&p.memoizedState!==null,Me=Ua,ze=xi,Ua=Me||ee,xi=ze||de,Hs(c,s),xi=ze,Ua=Me,Ws(s),c=s.stateNode,c._current=s,c._visibility&=-3,c._visibility|=c._pendingVisibility&2,g&8192&&(c._visibility=ee?c._visibility&-2:c._visibility|1,ee&&(c=Ua||xi,p===null||de||c||ql(s)),s.memoizedProps===null||s.memoizedProps.mode!=="manual"))e:for(p=null,c=s;;){if(c.tag===5||c.tag===26||c.tag===27){if(p===null){de=p=c;try{if(R=de.stateNode,ee)C=R.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none";else{V=de.stateNode,q=de.memoizedProps.style;var Pe=q!=null&&q.hasOwnProperty("display")?q.display:null;V.style.display=Pe==null||typeof Pe=="boolean"?"":(""+Pe).trim()}}catch(Ct){On(de,de.return,Ct)}}}else if(c.tag===6){if(p===null){de=c;try{de.stateNode.nodeValue=ee?"":de.memoizedProps}catch(Ct){On(de,de.return,Ct)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===s)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===s)break e;for(;c.sibling===null;){if(c.return===null||c.return===s)break e;p===c&&(p=null),c=c.return}p===c&&(p=null),c.sibling.return=c.return,c=c.sibling}g&4&&(g=s.updateQueue,g!==null&&(p=g.retryQueue,p!==null&&(g.retryQueue=null,sm(s,p))));break;case 19:Hs(c,s),Ws(s),g&4&&(g=s.updateQueue,g!==null&&(s.updateQueue=null,sm(s,g)));break;case 21:break;default:Hs(c,s),Ws(s)}}function Ws(s){var c=s.flags;if(c&2){try{if(s.tag!==27){e:{for(var p=s.return;p!==null;){if(Pg(p)){var g=p;break e}p=p.return}throw Error(_(160))}switch(g.tag){case 27:var R=g.stateNode,C=im(s);Kl(s,C,R);break;case 5:var V=g.stateNode;g.flags&32&&(Tl(V,""),g.flags&=-33);var q=im(s);Kl(s,q,V);break;case 3:case 4:var ee=g.stateNode.containerInfo,de=im(s);Lg(s,de,ee);break;default:throw Error(_(161))}}}catch(Me){On(s,s.return,Me)}s.flags&=-3}c&4096&&(s.flags&=-4097)}function W0(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var c=s;W0(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),s=s.sibling}}function Va(s,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)G0(s,c.alternate,c),c=c.sibling}function ql(s){for(s=s.child;s!==null;){var c=s;switch(c.tag){case 0:case 11:case 14:case 15:ko(4,c,c.return),ql(c);break;case 1:rs(c,c.return);var p=c.stateNode;typeof p.componentWillUnmount=="function"&&kg(c,c.return,p),ql(c);break;case 26:case 27:case 5:rs(c,c.return),ql(c);break;case 22:rs(c,c.return),c.memoizedState===null&&ql(c);break;default:ql(c)}s=s.sibling}}function ja(s,c,p){for(p=p&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var g=c.alternate,R=s,C=c,V=C.flags;switch(C.tag){case 0:case 11:case 15:ja(R,C,p),Yl(4,C);break;case 1:if(ja(R,C,p),g=C,R=g.stateNode,typeof R.componentDidMount=="function")try{R.componentDidMount()}catch(de){On(g,g.return,de)}if(g=C,R=g.updateQueue,R!==null){var q=g.stateNode;try{var ee=R.shared.hiddenCallbacks;if(ee!==null)for(R.shared.hiddenCallbacks=null,R=0;R<ee.length;R++)V0(ee[R],q)}catch(de){On(g,g.return,de)}}p&&V&64&&Bh(C),zl(C,C.return);break;case 26:case 27:case 5:ja(R,C,p),p&&g===null&&V&4&&Gh(C),zl(C,C.return);break;case 12:ja(R,C,p);break;case 13:ja(R,C,p),p&&V&4&&rm(R,C);break;case 22:C.memoizedState===null&&ja(R,C,p),zl(C,C.return);break;default:ja(R,C,p)}c=c.sibling}}function Vg(s,c){var p=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(p=s.memoizedState.cachePool.pool),s=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(s=c.memoizedState.cachePool.pool),s!==p&&(s!=null&&s.refCount++,p!=null&&bh(p))}function jg(s,c){s=null,c.alternate!==null&&(s=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==s&&(c.refCount++,s!=null&&bh(s))}function Ys(s,c,p,g){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)Fg(s,c,p,g),c=c.sibling}function Fg(s,c,p,g){var R=c.flags;switch(c.tag){case 0:case 11:case 15:Ys(s,c,p,g),R&2048&&Yl(9,c);break;case 3:Ys(s,c,p,g),R&2048&&(s=null,c.alternate!==null&&(s=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==s&&(c.refCount++,s!=null&&bh(s)));break;case 12:if(R&2048){Ys(s,c,p,g),s=c.stateNode;try{var C=c.memoizedProps,V=C.id,q=C.onPostCommit;typeof q=="function"&&q(V,c.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(ee){On(c,c.return,ee)}}else Ys(s,c,p,g);break;case 23:break;case 22:C=c.stateNode,c.memoizedState!==null?C._visibility&4?Ys(s,c,p,g):Ba(s,c):C._visibility&4?Ys(s,c,p,g):(C._visibility|=4,Fa(s,c,p,g,(c.subtreeFlags&10256)!==0)),R&2048&&Vg(c.alternate,c);break;case 24:Ys(s,c,p,g),R&2048&&jg(c.alternate,c);break;default:Ys(s,c,p,g)}}function Fa(s,c,p,g,R){for(R=R&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var C=s,V=c,q=p,ee=g,de=V.flags;switch(V.tag){case 0:case 11:case 15:Fa(C,V,q,ee,R),Yl(8,V);break;case 23:break;case 22:var Me=V.stateNode;V.memoizedState!==null?Me._visibility&4?Fa(C,V,q,ee,R):Ba(C,V):(Me._visibility|=4,Fa(C,V,q,ee,R)),R&&de&2048&&Vg(V.alternate,V);break;case 24:Fa(C,V,q,ee,R),R&&de&2048&&jg(V.alternate,V);break;default:Fa(C,V,q,ee,R)}c=c.sibling}}function Ba(s,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var p=s,g=c,R=g.flags;switch(g.tag){case 22:Ba(p,g),R&2048&&Vg(g.alternate,g);break;case 24:Ba(p,g),R&2048&&jg(g.alternate,g);break;default:Ba(p,g)}c=c.sibling}}var ou=8192;function Pc(s){if(s.subtreeFlags&ou)for(s=s.child;s!==null;)Hh(s),s=s.sibling}function Hh(s){switch(s.tag){case 26:Pc(s),s.flags&ou&&s.memoizedState!==null&&gA(fa,s.memoizedState,s.memoizedProps);break;case 5:Pc(s);break;case 3:case 4:var c=fa;fa=gm(s.stateNode.containerInfo),Pc(s),fa=c;break;case 22:s.memoizedState===null&&(c=s.alternate,c!==null&&c.memoizedState!==null?(c=ou,ou=16777216,Pc(s),ou=c):Pc(s));break;default:Pc(s)}}function Y0(s){var c=s.alternate;if(c!==null&&(s=c.child,s!==null)){c.child=null;do c=s.sibling,s.sibling=null,s=c;while(s!==null)}}function Wh(s){var c=s.deletions;if((s.flags&16)!==0){if(c!==null)for(var p=0;p<c.length;p++){var g=c[p];Yi=g,K0(g,s)}Y0(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)z0(s),s=s.sibling}function z0(s){switch(s.tag){case 0:case 11:case 15:Wh(s),s.flags&2048&&ko(9,s,s.return);break;case 3:Wh(s);break;case 12:Wh(s);break;case 22:var c=s.stateNode;s.memoizedState!==null&&c._visibility&4&&(s.return===null||s.return.tag!==13)?(c._visibility&=-5,Yh(s)):Wh(s);break;default:Wh(s)}}function Yh(s){var c=s.deletions;if((s.flags&16)!==0){if(c!==null)for(var p=0;p<c.length;p++){var g=c[p];Yi=g,K0(g,s)}Y0(s)}for(s=s.child;s!==null;){switch(c=s,c.tag){case 0:case 11:case 15:ko(8,c,c.return),Yh(c);break;case 22:p=c.stateNode,p._visibility&4&&(p._visibility&=-5,Yh(c));break;default:Yh(c)}s=s.sibling}}function K0(s,c){for(;Yi!==null;){var p=Yi;switch(p.tag){case 0:case 11:case 15:ko(8,p,c);break;case 23:case 22:if(p.memoizedState!==null&&p.memoizedState.cachePool!==null){var g=p.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:bh(p.memoizedState.cache)}if(g=p.child,g!==null)g.return=p,Yi=g;else e:for(p=s;Yi!==null;){g=Yi;var R=g.sibling,C=g.return;if(xg(g),g===p){Yi=null;break e}if(R!==null){R.return=C,Yi=R;break e}Yi=C}}}function zw(s,c,p,g){this.tag=s,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zs(s,c,p,g){return new zw(s,c,p,g)}function zh(s){return s=s.prototype,!(!s||!s.isReactComponent)}function qr(s,c){var p=s.alternate;return p===null?(p=zs(s.tag,c,s.key,s.mode),p.elementType=s.elementType,p.type=s.type,p.stateNode=s.stateNode,p.alternate=s,s.alternate=p):(p.pendingProps=c,p.type=s.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=s.flags&31457280,p.childLanes=s.childLanes,p.lanes=s.lanes,p.child=s.child,p.memoizedProps=s.memoizedProps,p.memoizedState=s.memoizedState,p.updateQueue=s.updateQueue,c=s.dependencies,p.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},p.sibling=s.sibling,p.index=s.index,p.ref=s.ref,p.refCleanup=s.refCleanup,p}function q0(s,c){s.flags&=31457282;var p=s.alternate;return p===null?(s.childLanes=0,s.lanes=c,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=p.childLanes,s.lanes=p.lanes,s.child=p.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=p.memoizedProps,s.memoizedState=p.memoizedState,s.updateQueue=p.updateQueue,s.type=p.type,c=p.dependencies,s.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),s}function Ga(s,c,p,g,R,C){var V=0;if(g=s,typeof s=="function")zh(s)&&(V=1);else if(typeof s=="string")V=wT(s,p,br.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case W:return Lc(p.children,R,C,c);case F:V=8,R|=24;break;case X:return s=zs(12,p,c,R|2),s.elementType=X,s.lanes=C,s;case fe:return s=zs(13,p,c,R),s.elementType=fe,s.lanes=C,s;case ae:return s=zs(19,p,c,R),s.elementType=ae,s.lanes=C,s;case _e:return ss(p,R,C,c);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case Q:case Ae:V=10;break e;case oe:V=9;break e;case ie:V=11;break e;case ve:V=14;break e;case be:V=16,g=null;break e}V=29,p=Error(_(130,s===null?"null":typeof s,"")),g=null}return c=zs(V,p,c,R),c.elementType=s,c.type=g,c.lanes=C,c}function Lc(s,c,p,g){return s=zs(7,s,g,c),s.lanes=p,s}function ss(s,c,p,g){s=zs(22,s,g,c),s.elementType=_e,s.lanes=p;var R={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var C=R._current;if(C===null)throw Error(_(456));if((R._pendingVisibility&2)===0){var V=Sc(C,2);V!==null&&(R._pendingVisibility|=2,Jr(V,C,2))}},attach:function(){var C=R._current;if(C===null)throw Error(_(456));if((R._pendingVisibility&2)!==0){var V=Sc(C,2);V!==null&&(R._pendingVisibility&=-3,Jr(V,C,2))}}};return s.stateNode=R,s}function Bg(s,c,p){return s=zs(6,s,null,c),s.lanes=p,s}function Gg(s,c,p){return c=zs(4,s.children!==null?s.children:[],s.key,c),c.lanes=p,c.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},c}function Ha(s){s.flags|=4}function X0(s,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!Sm(c)){if(c=Gs.current,c!==null&&((Pn&4194176)===Pn?Pa!==null:(Pn&62914560)!==Pn&&(Pn&536870912)===0||c!==Pa))throw Ll=UE,Zv;s.flags|=8192}}function Kh(s,c){c!==null&&(s.flags|=4),s.flags&16384&&(c=s.tag!==22?uv():536870912,s.lanes|=c,du|=c)}function cu(s,c){if(!Gn)switch(s.tailMode){case"hidden":c=s.tail;for(var p=null;c!==null;)c.alternate!==null&&(p=c),c=c.sibling;p===null?s.tail=null:p.sibling=null;break;case"collapsed":p=s.tail;for(var g=null;p!==null;)p.alternate!==null&&(g=p),p=p.sibling;g===null?c||s.tail===null?s.tail=null:s.tail.sibling=null:g.sibling=null}}function Ni(s){var c=s.alternate!==null&&s.alternate.child===s.child,p=0,g=0;if(c)for(var R=s.child;R!==null;)p|=R.lanes|R.childLanes,g|=R.subtreeFlags&31457280,g|=R.flags&31457280,R.return=s,R=R.sibling;else for(R=s.child;R!==null;)p|=R.lanes|R.childLanes,g|=R.subtreeFlags,g|=R.flags,R.return=s,R=R.sibling;return s.subtreeFlags|=g,s.childLanes=p,c}function J0(s,c,p){var g=c.pendingProps;switch(kf(c),c.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ni(c),null;case 1:return Ni(c),null;case 3:return p=c.stateNode,g=null,s!==null&&(g=s.memoizedState.cache),c.memoizedState.cache!==g&&(c.flags|=2048),Do(or),Ht(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(s===null||s.child===null)&&(Rc(c)?Ha(c):s===null||s.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,Rs!==null&&(Yg(Rs),Rs=null))),Ni(c),null;case 26:return p=c.memoizedState,s===null?(Ha(c),p!==null?(Ni(c),X0(c,p)):(Ni(c),c.flags&=-16777217)):p?p!==s.memoizedState?(Ha(c),Ni(c),X0(c,p)):(Ni(c),c.flags&=-16777217):(s.memoizedProps!==g&&Ha(c),Ni(c),c.flags&=-16777217),null;case 27:Un(c),p=at.current;var R=c.type;if(s!==null&&c.stateNode!=null)s.memoizedProps!==g&&Ha(c);else{if(!g){if(c.stateNode===null)throw Error(_(166));return Ni(c),null}s=br.current,Rc(c)?Jv(c):(s=ET(R,g,p),c.stateNode=s,Ha(c))}return Ni(c),null;case 5:if(Un(c),p=c.type,s!==null&&c.stateNode!=null)s.memoizedProps!==g&&Ha(c);else{if(!g){if(c.stateNode===null)throw Error(_(166));return Ni(c),null}if(s=br.current,Rc(c))Jv(c);else{switch(R=cp(at.current),s){case 1:s=R.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:s=R.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":s=R.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":s=R.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":s=R.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof g.is=="string"?R.createElement("select",{is:g.is}):R.createElement("select"),g.multiple?s.multiple=!0:g.size&&(s.size=g.size);break;default:s=typeof g.is=="string"?R.createElement(p,{is:g.is}):R.createElement(p)}}s[Cr]=c,s[Wr]=g;e:for(R=c.child;R!==null;){if(R.tag===5||R.tag===6)s.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===c)break e;for(;R.sibling===null;){if(R.return===null||R.return===c)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}c.stateNode=s;e:switch(Or(s,p,g),p){case"button":case"input":case"select":case"textarea":s=!!g.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&Ha(c)}}return Ni(c),c.flags&=-16777217,null;case 6:if(s&&c.stateNode!=null)s.memoizedProps!==g&&Ha(c);else{if(typeof g!="string"&&c.stateNode===null)throw Error(_(166));if(s=at.current,Rc(c)){if(s=c.stateNode,p=c.memoizedProps,g=null,R=zr,R!==null)switch(R.tag){case 27:case 5:g=R.memoizedProps}s[Cr]=c,s=!!(s.nodeValue===p||g!==null&&g.suppressHydrationWarning===!0||iy(s.nodeValue,p)),s||Tc(c)}else s=cp(s).createTextNode(g),s[Cr]=c,c.stateNode=s}return Ni(c),null;case 13:if(g=c.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(R=Rc(c),g!==null&&g.dehydrated!==null){if(s===null){if(!R)throw Error(_(318));if(R=c.memoizedState,R=R!==null?R.dehydrated:null,!R)throw Error(_(317));R[Cr]=c}else Eh(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Ni(c),R=!1}else Rs!==null&&(Yg(Rs),Rs=null),R=!0;if(!R)return c.flags&256?(wo(c),c):(wo(c),null)}if(wo(c),(c.flags&128)!==0)return c.lanes=p,c;if(p=g!==null,s=s!==null&&s.memoizedState!==null,p){g=c.child,R=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(R=g.alternate.memoizedState.cachePool.pool);var C=null;g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(C=g.memoizedState.cachePool.pool),C!==R&&(g.flags|=2048)}return p!==s&&p&&(c.child.flags|=8192),Kh(c,c.updateQueue),Ni(c),null;case 4:return Ht(),s===null&&rp(c.stateNode.containerInfo),Ni(c),null;case 10:return Do(c.type),Ni(c),null;case 19:if(qt(ar),R=c.memoizedState,R===null)return Ni(c),null;if(g=(c.flags&128)!==0,C=R.rendering,C===null)if(g)cu(R,!1);else{if(wi!==0||s!==null&&(s.flags&128)!==0)for(s=c.child;s!==null;){if(C=bc(s),C!==null){for(c.flags|=128,cu(R,!1),s=C.updateQueue,c.updateQueue=s,Kh(c,s),c.subtreeFlags=0,s=p,p=c.child;p!==null;)q0(p,s),p=p.sibling;return an(ar,ar.current&1|2),c.child}s=s.sibling}R.tail!==null&&Xt()>uu&&(c.flags|=128,g=!0,cu(R,!1),c.lanes=4194304)}else{if(!g)if(s=bc(C),s!==null){if(c.flags|=128,g=!0,s=s.updateQueue,c.updateQueue=s,Kh(c,s),cu(R,!0),R.tail===null&&R.tailMode==="hidden"&&!C.alternate&&!Gn)return Ni(c),null}else 2*Xt()-R.renderingStartTime>uu&&p!==536870912&&(c.flags|=128,g=!0,cu(R,!1),c.lanes=4194304);R.isBackwards?(C.sibling=c.child,c.child=C):(s=R.last,s!==null?s.sibling=C:c.child=C,R.last=C)}return R.tail!==null?(c=R.tail,R.rendering=c,R.tail=c.sibling,R.renderingStartTime=Xt(),c.sibling=null,s=ar.current,an(ar,g?s&1|2:s&1),c):(Ni(c),null);case 22:case 23:return wo(c),jE(),g=c.memoizedState!==null,s!==null?s.memoizedState!==null!==g&&(c.flags|=8192):g&&(c.flags|=8192),g?(p&536870912)!==0&&(c.flags&128)===0&&(Ni(c),c.subtreeFlags&6&&(c.flags|=8192)):Ni(c),p=c.updateQueue,p!==null&&Kh(c,p.retryQueue),p=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(p=s.memoizedState.cachePool.pool),g=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),g!==p&&(c.flags|=2048),s!==null&&qt(Ul),null;case 24:return p=null,s!==null&&(p=s.memoizedState.cache),c.memoizedState.cache!==p&&(c.flags|=2048),Do(or),Ni(c),null;case 25:return null}throw Error(_(156,c.tag))}function Kw(s,c){switch(kf(c),c.tag){case 1:return s=c.flags,s&65536?(c.flags=s&-65537|128,c):null;case 3:return Do(or),Ht(),s=c.flags,(s&65536)!==0&&(s&128)===0?(c.flags=s&-65537|128,c):null;case 26:case 27:case 5:return Un(c),null;case 13:if(wo(c),s=c.memoizedState,s!==null&&s.dehydrated!==null){if(c.alternate===null)throw Error(_(340));Eh()}return s=c.flags,s&65536?(c.flags=s&-65537|128,c):null;case 19:return qt(ar),null;case 4:return Ht(),null;case 10:return Do(c.type),null;case 22:case 23:return wo(c),jE(),s!==null&&qt(Ul),s=c.flags,s&65536?(c.flags=s&-65537|128,c):null;case 24:return Do(or),null;case 25:return null;default:return null}}function Z0(s,c){switch(kf(c),c.tag){case 3:Do(or),Ht();break;case 26:case 27:case 5:Un(c);break;case 4:Ht();break;case 13:wo(c);break;case 19:qt(ar);break;case 10:Do(c.type);break;case 22:case 23:wo(c),jE(),s!==null&&qt(Ul);break;case 24:Do(or)}}var qw={getCacheForType:function(s){var c=xr(or),p=c.data.get(s);return p===void 0&&(p=s(),c.data.set(s,p)),p}},Hg=typeof WeakMap=="function"?WeakMap:Map,Si=0,mi=null,_n=null,Pn=0,ui=0,As=null,ma=!1,Wa=!1,am=!1,_a=0,wi=0,Po=0,Mc=0,lu=0,Os=0,du=0,qh=null,Ea=null,om=!1,xc=0,uu=1/0,hu=null,Ya=null,Xh=!1,Uc=null,Jh=0,Wg=0,Vc=null,Zh=0,cm=null;function Xr(){if((Si&2)!==0&&Pn!==0)return Pn&-Pn;if(we.T!==null){var s=$d;return s!==0?s:$g()}return rE()}function Q0(){Os===0&&(Os=(Pn&536870912)===0||Gn?dv():536870912);var s=Gs.current;return s!==null&&(s.flags|=32),Os}function Jr(s,c,p){(s===mi&&ui===2||s.cancelPendingCommit!==null)&&(jc(s,0),za(s,Pn,Os,!1)),mr(s,p),((Si&2)===0||s!==mi)&&(s===mi&&((Si&2)===0&&(Mc|=p),wi===4&&za(s,Pn,Os,!1)),Ka(s))}function $0(s,c,p){if((Si&6)!==0)throw Error(_(327));var g=!p&&(c&60)===0&&(c&s.expiredLanes)===0||ah(s,c),R=g?tp(s,c):Lo(s,c,!0),C=g;do{if(R===0){Wa&&!g&&za(s,c,0,!1);break}else if(R===6)za(s,c,0,!ma);else{if(p=s.current.alternate,C&&!eT(p)){R=Lo(s,c,!1),C=!1;continue}if(R===2){if(C=c,s.errorRecoveryDisabledLanes&C)var V=0;else V=s.pendingLanes&-536870913,V=V!==0?V:V&536870912?536870912:0;if(V!==0){c=V;e:{var q=s;R=qh;var ee=q.current.memoizedState.isDehydrated;if(ee&&(jc(q,V).flags|=256),V=Lo(q,V,!1),V!==2){if(am&&!ee){q.errorRecoveryDisabledLanes|=C,Mc|=C,R=4;break e}C=Ea,Ea=R,C!==null&&Yg(C)}R=V}if(C=!1,R!==2)continue}}if(R===1){jc(s,0),za(s,c,0,!0);break}e:{switch(g=s,R){case 0:case 1:throw Error(_(345));case 4:if((c&4194176)===c){za(g,c,Os,!ma);break e}break;case 2:Ea=null;break;case 3:case 5:break;default:throw Error(_(329))}if(g.finishedWork=p,g.finishedLanes=c,(c&62914560)===c&&(C=xc+300-Xt(),10<C)){if(za(g,c,Os,!ma),_c(g,0)!==0)break e;g.timeoutHandle=lp(lm.bind(null,g,p,Ea,hu,om,c,Os,Mc,du,ma,2,-0,0),C);break e}lm(g,p,Ea,hu,om,c,Os,Mc,du,ma,0,-0,0)}}break}while(!0);Ka(s)}function Yg(s){Ea===null?Ea=s:Ea.push.apply(Ea,s)}function lm(s,c,p,g,R,C,V,q,ee,de,Me,ze,Ce){var Pe=c.subtreeFlags;if((Pe&8192||(Pe&16785408)===16785408)&&(bu={stylesheets:null,count:0,unsuspend:EA},Hh(c),c=dy(),c!==null)){s.cancelPendingCommit=c(Kg.bind(null,s,p,g,R,V,q,ee,1,ze,Ce)),za(s,C,V,!de);return}Kg(s,p,g,R,V,q,ee,Me,ze,Ce)}function eT(s){for(var c=s;;){var p=c.tag;if((p===0||p===11||p===15)&&c.flags&16384&&(p=c.updateQueue,p!==null&&(p=p.stores,p!==null)))for(var g=0;g<p.length;g++){var R=p[g],C=R.getSnapshot;R=R.value;try{if(!ys(C(),R))return!1}catch{return!1}}if(p=c.child,c.subtreeFlags&16384&&p!==null)p.return=c,c=p;else{if(c===s)break;for(;c.sibling===null;){if(c.return===null||c.return===s)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function za(s,c,p,g){c&=~lu,c&=~Mc,s.suspendedLanes|=c,s.pingedLanes&=~c,g&&(s.warmLanes|=c),g=s.expirationTimes;for(var R=c;0<R;){var C=31-Es(R),V=1<<C;g[C]=-1,R&=~V}p!==0&&hv(s,p,c)}function Qh(){return(Si&6)===0?(Ql(0),!1):!0}function pu(){if(_n!==null){if(ui===0)var s=_n.return;else s=_n,No=Hl=null,XE(s),Jd=null,Sh=0,s=_n;for(;s!==null;)Z0(s.alternate,s),s=s.return;_n=null}}function jc(s,c){s.finishedWork=null,s.finishedLanes=0;var p=s.timeoutHandle;p!==-1&&(s.timeoutHandle=-1,iA(p)),p=s.cancelPendingCommit,p!==null&&(s.cancelPendingCommit=null,p()),pu(),mi=s,_n=p=qr(s.current,null),Pn=c,ui=0,As=null,ma=!1,Wa=ah(s,c),am=!1,du=Os=lu=Mc=Po=wi=0,Ea=qh=null,om=!1,(c&8)!==0&&(c|=c&32);var g=s.entangledLanes;if(g!==0)for(s=s.entanglements,g&=c;0<g;){var R=31-Es(g),C=1<<R;c|=s[R],g&=~C}return _a=c,Nf(),p}function $h(s,c){mn=null,we.H=bs,c===yh?(c=$v(),ui=3):c===Zv?(c=$v(),ui=4):ui=c===k0?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,As=c,_n===null&&(wi=1,su(s,Fs(c,s.current)))}function ep(){var s=we.H;return we.H=bs,s===null?bs:s}function zg(){var s=we.A;return we.A=qw,s}function Fc(){wi=4,ma||(Pn&4194176)!==Pn&&Gs.current!==null||(Wa=!0),(Po&134217727)===0&&(Mc&134217727)===0||mi===null||za(mi,Pn,Os,!1)}function Lo(s,c,p){var g=Si;Si|=2;var R=ep(),C=zg();(mi!==s||Pn!==c)&&(hu=null,jc(s,c)),c=!1;var V=wi;e:do try{if(ui!==0&&_n!==null){var q=_n,ee=As;switch(ui){case 8:pu(),V=6;break e;case 3:case 2:case 6:Gs.current===null&&(c=!0);var de=ui;if(ui=0,As=null,fu(s,q,ee,de),p&&Wa){V=0;break e}break;default:de=ui,ui=0,As=null,fu(s,q,ee,de)}}Xw(),V=wi;break}catch(Me){$h(s,Me)}while(!0);return c&&s.shellSuspendCounter++,No=Hl=null,Si=g,we.H=R,we.A=C,_n===null&&(mi=null,Pn=0,Nf()),V}function Xw(){for(;_n!==null;)tT(_n)}function tp(s,c){var p=Si;Si|=2;var g=ep(),R=zg();mi!==s||Pn!==c?(hu=null,uu=Xt()+500,jc(s,c)):Wa=ah(s,c);e:do try{if(ui!==0&&_n!==null){c=_n;var C=As;t:switch(ui){case 1:ui=0,As=null,fu(s,c,C,1);break;case 2:if(VE(C)){ui=0,As=null,nT(c);break}c=function(){ui===2&&mi===s&&(ui=7),Ka(s)},C.then(c,c);break e;case 3:ui=7;break e;case 4:ui=5;break e;case 7:VE(C)?(ui=0,As=null,nT(c)):(ui=0,As=null,fu(s,c,C,7));break;case 5:var V=null;switch(_n.tag){case 26:V=_n.memoizedState;case 5:case 27:var q=_n;if(!V||Sm(V)){ui=0,As=null;var ee=q.sibling;if(ee!==null)_n=ee;else{var de=q.return;de!==null?(_n=de,np(de)):_n=null}break t}}ui=0,As=null,fu(s,c,C,5);break;case 6:ui=0,As=null,fu(s,c,C,6);break;case 8:pu(),wi=6;break e;default:throw Error(_(462))}}Jw();break}catch(Me){$h(s,Me)}while(!0);return No=Hl=null,we.H=g,we.A=R,Si=p,_n!==null?0:(mi=null,Pn=0,Nf(),wi)}function Jw(){for(;_n!==null&&!df();)tT(_n)}function tT(s){var c=x0(s.alternate,s,_a);s.memoizedProps=s.pendingProps,c===null?np(s):_n=c}function nT(s){var c=s,p=c.alternate;switch(c.tag){case 15:case 0:c=P0(p,c,c.pendingProps,c.type,void 0,Pn);break;case 11:c=P0(p,c,c.pendingProps,c.type.render,c.ref,Pn);break;case 5:XE(c);default:Z0(p,c),c=_n=q0(c,_a),c=x0(p,c,_a)}s.memoizedProps=s.pendingProps,c===null?np(s):_n=c}function fu(s,c,p,g){No=Hl=null,XE(c),Jd=null,Sh=0;var R=c.return;try{if(gg(s,R,c,p,Pn)){wi=1,su(s,Fs(p,s.current)),_n=null;return}}catch(C){if(R!==null)throw _n=R,C;wi=1,su(s,Fs(p,s.current)),_n=null;return}c.flags&32768?(Gn||g===1?s=!0:Wa||(Pn&536870912)!==0?s=!1:(ma=s=!0,(g===2||g===3||g===6)&&(g=Gs.current,g!==null&&g.tag===13&&(g.flags|=16384))),dm(c,s)):np(c)}function np(s){var c=s;do{if((c.flags&32768)!==0){dm(c,ma);return}s=c.return;var p=J0(c.alternate,c,_a);if(p!==null){_n=p;return}if(c=c.sibling,c!==null){_n=c;return}_n=c=s}while(c!==null);wi===0&&(wi=5)}function dm(s,c){do{var p=Kw(s.alternate,s);if(p!==null){p.flags&=32767,_n=p;return}if(p=s.return,p!==null&&(p.flags|=32768,p.subtreeFlags=0,p.deletions=null),!c&&(s=s.sibling,s!==null)){_n=s;return}_n=s=p}while(s!==null);wi=6,_n=null}function Kg(s,c,p,g,R,C,V,q,ee,de){var Me=we.T,ze=it.p;try{it.p=2,we.T=null,Zw(s,c,p,g,ze,R,C,V,q,ee,de)}finally{we.T=Me,it.p=ze}}function Zw(s,c,p,g,R,C,V,q){do mu();while(Uc!==null);if((Si&6)!==0)throw Error(_(327));var ee=s.finishedWork;if(g=s.finishedLanes,ee===null)return null;if(s.finishedWork=null,s.finishedLanes=0,ee===s.current)throw Error(_(177));s.callbackNode=null,s.callbackPriority=0,s.cancelPendingCommit=null;var de=ee.lanes|ee.childLanes;if(de|=LE,lw(s,g,de,C,V,q),s===mi&&(_n=mi=null,Pn=0),(ee.subtreeFlags&10256)===0&&(ee.flags&10256)===0||Xh||(Xh=!0,Wg=de,Vc=p,$w(Nd,function(){return mu(),null})),p=(ee.flags&15990)!==0,(ee.subtreeFlags&15990)!==0||p?(p=we.T,we.T=null,C=it.p,it.p=2,V=Si,Si|=4,Ww(s,ee),Ug(ee,s),Mw(op,s.containerInfo),bm=!!Gc,op=Gc=null,s.current=ee,G0(s,ee.alternate,ee),sh(),Si=V,it.p=C,we.T=p):s.current=ee,Xh?(Xh=!1,Uc=s,Jh=g):qg(s,de),de=s.pendingLanes,de===0&&(Ya=null),cv(ee.stateNode),Ka(s),c!==null)for(R=s.onRecoverableError,ee=0;ee<c.length;ee++)de=c[ee],R(de.value,{componentStack:de.stack});return(Jh&3)!==0&&mu(),de=s.pendingLanes,(g&4194218)!==0&&(de&42)!==0?s===cm?Zh++:(Zh=0,cm=s):Zh=0,Ql(0),null}function qg(s,c){(s.pooledCacheLanes&=c)===0&&(c=s.pooledCache,c!=null&&(s.pooledCache=null,bh(c)))}function mu(){if(Uc!==null){var s=Uc,c=Wg;Wg=0;var p=iE(Jh),g=we.T,R=it.p;try{if(it.p=32>p?32:p,we.T=null,Uc===null)var C=!1;else{p=Vc,Vc=null;var V=Uc,q=Jh;if(Uc=null,Jh=0,(Si&6)!==0)throw Error(_(331));var ee=Si;if(Si|=4,z0(V.current),Fg(V,V.current,q,p),Si=ee,Ql(0,!1),sr&&typeof sr.onPostCommitFiberRoot=="function")try{sr.onPostCommitFiberRoot(Dd,V)}catch{}C=!0}return C}finally{it.p=R,we.T=g,qg(s,c)}}return!1}function _u(s,c,p){c=Fs(p,c),c=_g(s.stateNode,c,2),s=kc(s,c,2),s!==null&&(mr(s,2),Ka(s))}function On(s,c,p){if(s.tag===3)_u(s,s,p);else for(;c!==null;){if(c.tag===3){_u(c,s,p);break}else if(c.tag===1){var g=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(Ya===null||!Ya.has(g))){s=Fs(p,s),p=D0(2),g=kc(c,p,2),g!==null&&(Eg(p,g,c,s),mr(g,2),Ka(g));break}}c=c.return}}function um(s,c,p){var g=s.pingCache;if(g===null){g=s.pingCache=new Hg;var R=new Set;g.set(c,R)}else R=g.get(c),R===void 0&&(R=new Set,g.set(c,R));R.has(p)||(am=!0,R.add(p),s=Qw.bind(null,s,c,p),c.then(s,s))}function Qw(s,c,p){var g=s.pingCache;g!==null&&g.delete(c),s.pingedLanes|=s.suspendedLanes&p,s.warmLanes&=~p,mi===s&&(Pn&p)===p&&(wi===4||wi===3&&(Pn&62914560)===Pn&&300>Xt()-xc?(Si&2)===0&&jc(s,0):lu|=p,du===Pn&&(du=0)),Ka(s)}function iT(s,c){c===0&&(c=uv()),s=Sc(s,c),s!==null&&(mr(s,c),Ka(s))}function Xg(s){var c=s.memoizedState,p=0;c!==null&&(p=c.retryLane),iT(s,p)}function rT(s,c){var p=0;switch(s.tag){case 13:var g=s.stateNode,R=s.memoizedState;R!==null&&(p=R.retryLane);break;case 19:g=s.stateNode;break;case 22:g=s.stateNode._retryCache;break;default:throw Error(_(314))}g!==null&&g.delete(c),iT(s,p)}function $w(s,c){return _s(s,c)}var Xl=null,Is=null,Jl=!1,hm=!1,Jg=!1,Zl=0;function Ka(s){s!==Is&&s.next===null&&(Is===null?Xl=Is=s:Is=Is.next=s),hm=!0,Jl||(Jl=!0,Qg(eA))}function Ql(s,c){if(!Jg&&hm){Jg=!0;do for(var p=!1,g=Xl;g!==null;){if(s!==0){var R=g.pendingLanes;if(R===0)var C=0;else{var V=g.suspendedLanes,q=g.pingedLanes;C=(1<<31-Es(42|s)+1)-1,C&=R&~(V&~q),C=C&201326677?C&201326677|1:C?C|2:0}C!==0&&(p=!0,Zg(g,C))}else C=Pn,C=_c(g,g===mi?C:0),(C&3)===0||ah(g,C)||(p=!0,Zg(g,C));g=g.next}while(p);Jg=!1}}function eA(){hm=Jl=!1;var s=0;Zl!==0&&(nA()&&(s=Zl),Zl=0);for(var c=Xt(),p=null,g=Xl;g!==null;){var R=g.next,C=sT(g,c);C===0?(g.next=null,p===null?Xl=R:p.next=R,R===null&&(Is=p)):(p=g,(s!==0||(C&3)!==0)&&(hm=!0)),g=R}Ql(s)}function sT(s,c){for(var p=s.suspendedLanes,g=s.pingedLanes,R=s.expirationTimes,C=s.pendingLanes&-62914561;0<C;){var V=31-Es(C),q=1<<V,ee=R[V];ee===-1?((q&p)===0||(q&g)!==0)&&(R[V]=Pd(q,c)):ee<=c&&(s.expiredLanes|=q),C&=~q}if(c=mi,p=Pn,p=_c(s,s===c?p:0),g=s.callbackNode,p===0||s===c&&ui===2||s.cancelPendingCommit!==null)return g!==null&&g!==null&&hc(g),s.callbackNode=null,s.callbackPriority=0;if((p&3)===0||ah(s,p)){if(c=p&-p,c===s.callbackPriority)return c;switch(g!==null&&hc(g),iE(p)){case 2:case 8:p=Ms;break;case 32:p=Nd;break;case 268435456:p=tE;break;default:p=Nd}return g=aT.bind(null,s),p=_s(p,g),s.callbackPriority=c,s.callbackNode=p,c}return g!==null&&g!==null&&hc(g),s.callbackPriority=2,s.callbackNode=null,2}function aT(s,c){var p=s.callbackNode;if(mu()&&s.callbackNode!==p)return null;var g=Pn;return g=_c(s,s===mi?g:0),g===0?null:($0(s,g,c),sT(s,Xt()),s.callbackNode!=null&&s.callbackNode===p?aT.bind(null,s):null)}function Zg(s,c){if(mu())return null;$0(s,c,!0)}function Qg(s){rA(function(){(Si&6)!==0?_s(fc,s):s()})}function $g(){return Zl===0&&(Zl=dv()),Zl}function oT(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Sf(""+s)}function cT(s,c){var p=c.ownerDocument.createElement("input");return p.name=c.name,p.value=c.value,s.id&&p.setAttribute("form",s.id),c.parentNode.insertBefore(p,c),s=new FormData(s),p.parentNode.removeChild(p),s}function lT(s,c,p,g,R){if(c==="submit"&&p&&p.stateNode===R){var C=oT((R[Wr]||null).action),V=g.submitter;V&&(c=(c=V[Wr]||null)?oT(c.formAction):V.getAttribute("formAction"),c!==null&&(C=c,V=null));var q=new ua("action","action",null,g,R);s.push({event:q,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(Zl!==0){var ee=V?cT(R,V):new FormData(R);ug(p,{pending:!0,data:ee,method:R.method,action:C},null,ee)}}else typeof C=="function"&&(q.preventDefault(),ee=V?cT(R,V):new FormData(R),ug(p,{pending:!0,data:ee,method:R.method,action:C},C,ee))},currentTarget:R}]})}}for(var ip=0;ip<Kv.length;ip++){var pm=Kv[ip],dT=pm.toLowerCase(),fm=pm[0].toUpperCase()+pm.slice(1);js(dT,"on"+fm)}js(Wv,"onAnimationEnd"),js(Of,"onAnimationIteration"),js(If,"onAnimationStart"),js("dblclick","onDoubleClick"),js("focusin","onFocus"),js("focusout","onBlur"),js(xw,"onTransitionRun"),js(Re,"onTransitionStart"),js(Uw,"onTransitionCancel"),js(Yv,"onTransitionEnd"),xd("onMouseEnter",["mouseout","mouseover"]),xd("onMouseLeave",["mouseout","mouseover"]),xd("onPointerEnter",["pointerout","pointerover"]),xd("onPointerLeave",["pointerout","pointerover"]),vl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),vl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),vl("onBeforeInput",["compositionend","keypress","textInput","paste"]),vl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),vl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),vl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Eu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),tA=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Eu));function mm(s,c){c=(c&4)!==0;for(var p=0;p<s.length;p++){var g=s[p],R=g.event;g=g.listeners;e:{var C=void 0;if(c)for(var V=g.length-1;0<=V;V--){var q=g[V],ee=q.instance,de=q.currentTarget;if(q=q.listener,ee!==C&&R.isPropagationStopped())break e;C=q,R.currentTarget=de;try{C(R)}catch(Me){Kf(Me)}R.currentTarget=null,C=ee}else for(V=0;V<g.length;V++){if(q=g[V],ee=q.instance,de=q.currentTarget,q=q.listener,ee!==C&&R.isPropagationStopped())break e;C=q,R.currentTarget=de;try{C(R)}catch(Me){Kf(Me)}R.currentTarget=null,C=ee}}}}function kn(s,c){var p=c[sE];p===void 0&&(p=c[sE]=new Set);var g=s+"__bubble";p.has(g)||(ty(c,s,2,!1),p.add(g))}function ey(s,c,p){var g=0;c&&(g|=4),ty(p,s,g,c)}var Bc="_reactListening"+Math.random().toString(36).slice(2);function rp(s){if(!s[Bc]){s[Bc]=!0,mv.forEach(function(p){p!=="selectionchange"&&(tA.has(p)||ey(p,!1,s),ey(p,!0,s))});var c=s.nodeType===9?s:s.ownerDocument;c===null||c[Bc]||(c[Bc]=!0,ey("selectionchange",!1,c))}}function ty(s,c,p,g){switch(gy(c)){case 2:var R=NT;break;case 8:R=fy;break;default:R=my}p=R.bind(null,c,p,s),R=void 0,!mE||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(R=!0),g?R!==void 0?s.addEventListener(c,p,{capture:!0,passive:R}):s.addEventListener(c,p,!0):R!==void 0?s.addEventListener(c,p,{passive:R}):s.addEventListener(c,p,!1)}function sp(s,c,p,g,R){var C=g;if((c&1)===0&&(c&2)===0&&g!==null)e:for(;;){if(g===null)return;var V=g.tag;if(V===3||V===4){var q=g.stateNode.containerInfo;if(q===R||q.nodeType===8&&q.parentNode===R)break;if(V===4)for(V=g.return;V!==null;){var ee=V.tag;if((ee===3||ee===4)&&(ee=V.stateNode.containerInfo,ee===R||ee.nodeType===8&&ee.parentNode===R))return;V=V.return}for(;q!==null;){if(V=xs(q),V===null)return;if(ee=V.tag,ee===5||ee===6||ee===26||ee===27){g=C=V;continue e}q=q.parentNode}}g=g.return}fE(function(){var de=C,Me=hE(p),ze=[];e:{var Ce=zv.get(s);if(Ce!==void 0){var Pe=ua,Ct=s;switch(s){case"keypress":if(Tf(p)===0)break e;case"keydown":case"keyup":Pe=vw;break;case"focusin":Ct="focus",Pe=bf;break;case"focusout":Ct="blur",Pe=bf;break;case"beforeblur":case"afterblur":Pe=bf;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Pe=Ov;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Pe=mw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Pe=Rw;break;case Wv:case Of:case If:Pe=yE;break;case Yv:Pe=Nv;break;case"scroll":case"scrollend":Pe=Av;break;case"wheel":Pe=Jt;break;case"copy":case"cut":case"paste":Pe=SE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Pe=Iv;break;case"toggle":case"beforetoggle":Pe=ww}var Zt=(c&4)!==0,Ui=!Zt&&(s==="scroll"||s==="scrollend"),pe=Zt?Ce!==null?Ce+"Capture":null:Ce;Zt=[];for(var ce=de,ye;ce!==null;){var Fe=ce;if(ye=Fe.stateNode,Fe=Fe.tag,Fe!==5&&Fe!==26&&Fe!==27||ye===null||pe===null||(Fe=dh(ce,pe),Fe!=null&&Zt.push($l(ce,Fe,ye))),Ui)break;ce=ce.return}0<Zt.length&&(Ce=new Pe(Ce,Ct,null,p,Me),ze.push({event:Ce,listeners:Zt}))}}if((c&7)===0){e:{if(Ce=s==="mouseover"||s==="pointerover",Pe=s==="mouseout"||s==="pointerout",Ce&&p!==uE&&(Ct=p.relatedTarget||p.fromElement)&&(xs(Ct)||Ct[Ld]))break e;if((Pe||Ce)&&(Ce=Me.window===Me?Me:(Ce=Me.ownerDocument)?Ce.defaultView||Ce.parentWindow:window,Pe?(Ct=p.relatedTarget||p.toElement,Pe=de,Ct=Ct?xs(Ct):null,Ct!==null&&(Ui=rt(Ct),Zt=Ct.tag,Ct!==Ui||Zt!==5&&Zt!==27&&Zt!==6)&&(Ct=null)):(Pe=null,Ct=de),Pe!==Ct)){if(Zt=Ov,Fe="onMouseLeave",pe="onMouseEnter",ce="mouse",(s==="pointerout"||s==="pointerover")&&(Zt=Iv,Fe="onPointerLeave",pe="onPointerEnter",ce="pointer"),Ui=Pe==null?Ce:ch(Pe),ye=Ct==null?Ce:ch(Ct),Ce=new Zt(Fe,ce+"leave",Pe,p,Me),Ce.target=Ui,Ce.relatedTarget=ye,Fe=null,xs(Me)===de&&(Zt=new Zt(pe,ce+"enter",Ct,p,Me),Zt.target=ye,Zt.relatedTarget=Ui,Fe=Zt),Ui=Fe,Pe&&Ct)t:{for(Zt=Pe,pe=Ct,ce=0,ye=Zt;ye;ye=yu(ye))ce++;for(ye=0,Fe=pe;Fe;Fe=yu(Fe))ye++;for(;0<ce-ye;)Zt=yu(Zt),ce--;for(;0<ye-ce;)pe=yu(pe),ye--;for(;ce--;){if(Zt===pe||pe!==null&&Zt===pe.alternate)break t;Zt=yu(Zt),pe=yu(pe)}Zt=null}else Zt=null;Pe!==null&&uT(ze,Ce,Pe,Zt,!1),Ct!==null&&Ui!==null&&uT(ze,Ui,Ct,Zt,!0)}}e:{if(Ce=de?ch(de):window,Pe=Ce.nodeName&&Ce.nodeName.toLowerCase(),Pe==="select"||Pe==="input"&&Ce.type==="file")var pt=Uv;else if(Mv(Ce))if(gs)pt=AE;else{pt=Pw;var En=kw}else Pe=Ce.nodeName,!Pe||Pe.toLowerCase()!=="input"||Ce.type!=="checkbox"&&Ce.type!=="radio"?de&&dE(de.elementType)&&(pt=Uv):pt=Fv;if(pt&&(pt=pt(s,de))){xv(ze,pt,p,Me);break e}En&&En(s,Ce,de),s==="focusout"&&de&&Ce.type==="number"&&de.memoizedProps.value!=null&&cE(Ce,"number",Ce.value)}switch(En=de?ch(de):window,s){case"focusin":(Mv(En)||En.contentEditable==="true")&&(Hd=En,IE=de,mh=null);break;case"focusout":mh=IE=Hd=null;break;case"mousedown":NE=!0;break;case"contextmenu":case"mouseup":case"dragend":NE=!1,DE(ze,p,Me);break;case"selectionchange":if(is)break;case"keydown":case"keyup":DE(ze,p,Me)}var Dt;if(RE)e:{switch(s){case"compositionstart":var jt="onCompositionStart";break e;case"compositionend":jt="onCompositionEnd";break e;case"compositionupdate":jt="onCompositionUpdate";break e}jt=void 0}else wl?Pv(s,p)&&(jt="onCompositionEnd"):s==="keydown"&&p.keyCode===229&&(jt="onCompositionStart");jt&&(Dv&&p.locale!=="ko"&&(wl||jt!=="onCompositionStart"?jt==="onCompositionEnd"&&wl&&(Dt=Cv()):(Vs=Me,_E="value"in Vs?Vs.value:Vs.textContent,wl=!0)),En=gu(de,jt),0<En.length&&(jt=new Cf(jt,s,null,p,Me),ze.push({event:jt,listeners:En}),Dt?jt.data=Dt:(Dt=Lv(p),Dt!==null&&(jt.data=Dt)))),(Dt=Ow?Iw(s,p):gc(s,p))&&(jt=gu(de,"onBeforeInput"),0<jt.length&&(En=new Cf("onBeforeInput","beforeinput",null,p,Me),ze.push({event:En,listeners:jt}),En.data=Dt)),lT(ze,s,de,p,Me)}mm(ze,c)})}function $l(s,c,p){return{instance:s,listener:c,currentTarget:p}}function gu(s,c){for(var p=c+"Capture",g=[];s!==null;){var R=s,C=R.stateNode;R=R.tag,R!==5&&R!==26&&R!==27||C===null||(R=dh(s,p),R!=null&&g.unshift($l(s,R,C)),R=dh(s,c),R!=null&&g.push($l(s,R,C))),s=s.return}return g}function yu(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function uT(s,c,p,g,R){for(var C=c._reactName,V=[];p!==null&&p!==g;){var q=p,ee=q.alternate,de=q.stateNode;if(q=q.tag,ee!==null&&ee===g)break;q!==5&&q!==26&&q!==27||de===null||(ee=de,R?(de=dh(p,C),de!=null&&V.unshift($l(p,de,ee))):R||(de=dh(p,C),de!=null&&V.push($l(p,de,ee)))),p=p.return}V.length!==0&&s.push({event:c,listeners:V})}var hT=/\r\n?/g,pT=/\u0000|\uFFFD/g;function ny(s){return(typeof s=="string"?s:""+s).replace(hT,`
`).replace(pT,"")}function iy(s,c){return c=ny(c),ny(s)===c}function ap(){}function oi(s,c,p,g,R,C){switch(p){case"children":typeof g=="string"?c==="body"||c==="textarea"&&g===""||Tl(s,g):(typeof g=="number"||typeof g=="bigint")&&c!=="body"&&Tl(s,""+g);break;case"className":_f(s,"class",g);break;case"tabIndex":_f(s,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":_f(s,p,g);break;case"style":yf(s,g,C);break;case"data":if(c!=="object"){_f(s,"data",g);break}case"src":case"href":if(g===""&&(c!=="a"||p!=="href")){s.removeAttribute(p);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){s.removeAttribute(p);break}g=Sf(""+g),s.setAttribute(p,g);break;case"action":case"formAction":if(typeof g=="function"){s.setAttribute(p,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof C=="function"&&(p==="formAction"?(c!=="input"&&oi(s,c,"name",R.name,R,null),oi(s,c,"formEncType",R.formEncType,R,null),oi(s,c,"formMethod",R.formMethod,R,null),oi(s,c,"formTarget",R.formTarget,R,null)):(oi(s,c,"encType",R.encType,R,null),oi(s,c,"method",R.method,R,null),oi(s,c,"target",R.target,R,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){s.removeAttribute(p);break}g=Sf(""+g),s.setAttribute(p,g);break;case"onClick":g!=null&&(s.onclick=ap);break;case"onScroll":g!=null&&kn("scroll",s);break;case"onScrollEnd":g!=null&&kn("scrollend",s);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(_(61));if(p=g.__html,p!=null){if(R.children!=null)throw Error(_(60));s.innerHTML=p}}break;case"multiple":s.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":s.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){s.removeAttribute("xlink:href");break}p=Sf(""+g),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",p);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?s.setAttribute(p,""+g):s.removeAttribute(p);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?s.setAttribute(p,""):s.removeAttribute(p);break;case"capture":case"download":g===!0?s.setAttribute(p,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?s.setAttribute(p,g):s.removeAttribute(p);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?s.setAttribute(p,g):s.removeAttribute(p);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?s.removeAttribute(p):s.setAttribute(p,g);break;case"popover":kn("beforetoggle",s),kn("toggle",s),mf(s,"popover",g);break;case"xlinkActuate":To(s,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":To(s,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":To(s,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":To(s,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":To(s,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":To(s,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":To(s,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":To(s,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":To(s,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":mf(s,"is",g);break;case"innerText":case"textContent":break;default:(!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(p=Rv.get(p)||p,mf(s,p,g))}}function _m(s,c,p,g,R,C){switch(p){case"style":yf(s,g,C);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(_(61));if(p=g.__html,p!=null){if(R.children!=null)throw Error(_(60));s.innerHTML=p}}break;case"children":typeof g=="string"?Tl(s,g):(typeof g=="number"||typeof g=="bigint")&&Tl(s,""+g);break;case"onScroll":g!=null&&kn("scroll",s);break;case"onScrollEnd":g!=null&&kn("scrollend",s);break;case"onClick":g!=null&&(s.onclick=ap);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Hi.hasOwnProperty(p))e:{if(p[0]==="o"&&p[1]==="n"&&(R=p.endsWith("Capture"),c=p.slice(2,R?p.length-7:void 0),C=s[Wr]||null,C=C!=null?C[p]:null,typeof C=="function"&&s.removeEventListener(c,C,R),typeof g=="function")){typeof C!="function"&&C!==null&&(p in s?s[p]=null:s.hasAttribute(p)&&s.removeAttribute(p)),s.addEventListener(c,g,R);break e}p in s?s[p]=g:g===!0?s.setAttribute(p,""):mf(s,p,g)}}}function Or(s,c,p){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":kn("error",s),kn("load",s);var g=!1,R=!1,C;for(C in p)if(p.hasOwnProperty(C)){var V=p[C];if(V!=null)switch(C){case"src":g=!0;break;case"srcSet":R=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(_(137,c));default:oi(s,c,C,V,p,null)}}R&&oi(s,c,"srcSet",p.srcSet,p,null),g&&oi(s,c,"src",p.src,p,null);return;case"input":kn("invalid",s);var q=C=V=R=null,ee=null,de=null;for(g in p)if(p.hasOwnProperty(g)){var Me=p[g];if(Me!=null)switch(g){case"name":R=Me;break;case"type":V=Me;break;case"checked":ee=Me;break;case"defaultChecked":de=Me;break;case"value":C=Me;break;case"defaultValue":q=Me;break;case"children":case"dangerouslySetInnerHTML":if(Me!=null)throw Error(_(137,c));break;default:oi(s,c,g,Me,p,null)}}Sv(s,C,q,ee,de,V,R,!1),ei(s);return;case"select":kn("invalid",s),g=V=C=null;for(R in p)if(p.hasOwnProperty(R)&&(q=p[R],q!=null))switch(R){case"value":C=q;break;case"defaultValue":V=q;break;case"multiple":g=q;default:oi(s,c,R,q,p,null)}c=C,p=V,s.multiple=!!g,c!=null?Ud(s,!!g,c,!1):p!=null&&Ud(s,!!g,p,!0);return;case"textarea":kn("invalid",s),C=R=g=null;for(V in p)if(p.hasOwnProperty(V)&&(q=p[V],q!=null))switch(V){case"value":g=q;break;case"defaultValue":R=q;break;case"children":C=q;break;case"dangerouslySetInnerHTML":if(q!=null)throw Error(_(91));break;default:oi(s,c,V,q,p,null)}gf(s,g,R,C),ei(s);return;case"option":for(ee in p)if(p.hasOwnProperty(ee)&&(g=p[ee],g!=null))switch(ee){case"selected":s.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:oi(s,c,ee,g,p,null)}return;case"dialog":kn("cancel",s),kn("close",s);break;case"iframe":case"object":kn("load",s);break;case"video":case"audio":for(g=0;g<Eu.length;g++)kn(Eu[g],s);break;case"image":kn("error",s),kn("load",s);break;case"details":kn("toggle",s);break;case"embed":case"source":case"link":kn("error",s),kn("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(de in p)if(p.hasOwnProperty(de)&&(g=p[de],g!=null))switch(de){case"children":case"dangerouslySetInnerHTML":throw Error(_(137,c));default:oi(s,c,de,g,p,null)}return;default:if(dE(c)){for(Me in p)p.hasOwnProperty(Me)&&(g=p[Me],g!==void 0&&_m(s,c,Me,g,p,void 0));return}}for(q in p)p.hasOwnProperty(q)&&(g=p[q],g!=null&&oi(s,c,q,g,p,null))}function Su(s,c,p,g){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var R=null,C=null,V=null,q=null,ee=null,de=null,Me=null;for(Pe in p){var ze=p[Pe];if(p.hasOwnProperty(Pe)&&ze!=null)switch(Pe){case"checked":break;case"value":break;case"defaultValue":ee=ze;default:g.hasOwnProperty(Pe)||oi(s,c,Pe,null,g,ze)}}for(var Ce in g){var Pe=g[Ce];if(ze=p[Ce],g.hasOwnProperty(Ce)&&(Pe!=null||ze!=null))switch(Ce){case"type":C=Pe;break;case"name":R=Pe;break;case"checked":de=Pe;break;case"defaultChecked":Me=Pe;break;case"value":V=Pe;break;case"defaultValue":q=Pe;break;case"children":case"dangerouslySetInnerHTML":if(Pe!=null)throw Error(_(137,c));break;default:Pe!==ze&&oi(s,c,Ce,Pe,g,ze)}}oE(s,V,q,ee,de,Me,C,R);return;case"select":Pe=V=q=Ce=null;for(C in p)if(ee=p[C],p.hasOwnProperty(C)&&ee!=null)switch(C){case"value":break;case"multiple":Pe=ee;default:g.hasOwnProperty(C)||oi(s,c,C,null,g,ee)}for(R in g)if(C=g[R],ee=p[R],g.hasOwnProperty(R)&&(C!=null||ee!=null))switch(R){case"value":Ce=C;break;case"defaultValue":q=C;break;case"multiple":V=C;default:C!==ee&&oi(s,c,R,C,g,ee)}c=q,p=V,g=Pe,Ce!=null?Ud(s,!!p,Ce,!1):!!g!=!!p&&(c!=null?Ud(s,!!p,c,!0):Ud(s,!!p,p?[]:"",!1));return;case"textarea":Pe=Ce=null;for(q in p)if(R=p[q],p.hasOwnProperty(q)&&R!=null&&!g.hasOwnProperty(q))switch(q){case"value":break;case"children":break;default:oi(s,c,q,null,g,R)}for(V in g)if(R=g[V],C=p[V],g.hasOwnProperty(V)&&(R!=null||C!=null))switch(V){case"value":Ce=R;break;case"defaultValue":Pe=R;break;case"children":break;case"dangerouslySetInnerHTML":if(R!=null)throw Error(_(91));break;default:R!==C&&oi(s,c,V,R,g,C)}vv(s,Ce,Pe);return;case"option":for(var Ct in p)if(Ce=p[Ct],p.hasOwnProperty(Ct)&&Ce!=null&&!g.hasOwnProperty(Ct))switch(Ct){case"selected":s.selected=!1;break;default:oi(s,c,Ct,null,g,Ce)}for(ee in g)if(Ce=g[ee],Pe=p[ee],g.hasOwnProperty(ee)&&Ce!==Pe&&(Ce!=null||Pe!=null))switch(ee){case"selected":s.selected=Ce&&typeof Ce!="function"&&typeof Ce!="symbol";break;default:oi(s,c,ee,Ce,g,Pe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Zt in p)Ce=p[Zt],p.hasOwnProperty(Zt)&&Ce!=null&&!g.hasOwnProperty(Zt)&&oi(s,c,Zt,null,g,Ce);for(de in g)if(Ce=g[de],Pe=p[de],g.hasOwnProperty(de)&&Ce!==Pe&&(Ce!=null||Pe!=null))switch(de){case"children":case"dangerouslySetInnerHTML":if(Ce!=null)throw Error(_(137,c));break;default:oi(s,c,de,Ce,g,Pe)}return;default:if(dE(c)){for(var Ui in p)Ce=p[Ui],p.hasOwnProperty(Ui)&&Ce!==void 0&&!g.hasOwnProperty(Ui)&&_m(s,c,Ui,void 0,g,Ce);for(Me in g)Ce=g[Me],Pe=p[Me],!g.hasOwnProperty(Me)||Ce===Pe||Ce===void 0&&Pe===void 0||_m(s,c,Me,Ce,g,Pe);return}}for(var pe in p)Ce=p[pe],p.hasOwnProperty(pe)&&Ce!=null&&!g.hasOwnProperty(pe)&&oi(s,c,pe,null,g,Ce);for(ze in g)Ce=g[ze],Pe=p[ze],!g.hasOwnProperty(ze)||Ce===Pe||Ce==null&&Pe==null||oi(s,c,ze,Ce,g,Pe)}var Gc=null,op=null;function cp(s){return s.nodeType===9?s:s.ownerDocument}function ry(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function fT(s,c){if(s===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&c==="foreignObject"?0:s}function Em(s,c){return s==="textarea"||s==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var sy=null;function nA(){var s=window.event;return s&&s.type==="popstate"?s===sy?!1:(sy=s,!0):(sy=null,!1)}var lp=typeof setTimeout=="function"?setTimeout:void 0,iA=typeof clearTimeout=="function"?clearTimeout:void 0,mT=typeof Promise=="function"?Promise:void 0,rA=typeof queueMicrotask=="function"?queueMicrotask:typeof mT<"u"?function(s){return mT.resolve(null).then(s).catch(sA)}:lp;function sA(s){setTimeout(function(){throw s})}function ay(s,c){var p=c,g=0;do{var R=p.nextSibling;if(s.removeChild(p),R&&R.nodeType===8)if(p=R.data,p==="/$"){if(g===0){s.removeChild(R),_p(c);return}g--}else p!=="$"&&p!=="$?"&&p!=="$!"||g++;p=R}while(p);_p(c)}function oy(s){var c=s.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var p=c;switch(c=c.nextSibling,p.nodeName){case"HTML":case"HEAD":case"BODY":oy(p),pf(p);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(p.rel.toLowerCase()==="stylesheet")continue}s.removeChild(p)}}function aA(s,c,p,g){for(;s.nodeType===1;){var R=p;if(s.nodeName.toLowerCase()!==c.toLowerCase()){if(!g&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(g){if(!s[Sl])switch(c){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(C=s.getAttribute("rel"),C==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(C!==R.rel||s.getAttribute("href")!==(R.href==null?null:R.href)||s.getAttribute("crossorigin")!==(R.crossOrigin==null?null:R.crossOrigin)||s.getAttribute("title")!==(R.title==null?null:R.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(C=s.getAttribute("src"),(C!==(R.src==null?null:R.src)||s.getAttribute("type")!==(R.type==null?null:R.type)||s.getAttribute("crossorigin")!==(R.crossOrigin==null?null:R.crossOrigin))&&C&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(c==="input"&&s.type==="hidden"){var C=R.name==null?null:""+R.name;if(R.type==="hidden"&&s.getAttribute("name")===C)return s}else return s;if(s=ga(s.nextSibling),s===null)break}return null}function oA(s,c,p){if(c==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!p||(s=ga(s.nextSibling),s===null))return null;return s}function ga(s){for(;s!=null;s=s.nextSibling){var c=s.nodeType;if(c===1||c===3)break;if(c===8){if(c=s.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return s}function _T(s){s=s.previousSibling;for(var c=0;s;){if(s.nodeType===8){var p=s.data;if(p==="$"||p==="$!"||p==="$?"){if(c===0)return s;c--}else p==="/$"&&c++}s=s.previousSibling}return null}function ET(s,c,p){switch(c=cp(p),s){case"html":if(s=c.documentElement,!s)throw Error(_(452));return s;case"head":if(s=c.head,!s)throw Error(_(453));return s;case"body":if(s=c.body,!s)throw Error(_(454));return s;default:throw Error(_(451))}}var Ks=new Map,gT=new Set;function gm(s){return typeof s.getRootNode=="function"?s.getRootNode():s.ownerDocument}var Mo=it.d;it.d={f:cA,r:yT,D:lA,C:dA,L:uA,m:hA,X:fA,S:pA,M:mA};function cA(){var s=Mo.f(),c=Qh();return s||c}function yT(s){var c=Md(s);c!==null&&c.tag===5&&c.type==="form"?R0(c):Mo.r(s)}var vu=typeof document>"u"?null:document;function ST(s,c,p){var g=vu;if(g&&typeof c=="string"&&c){var R=Us(c);R='link[rel="'+s+'"][href="'+R+'"]',typeof p=="string"&&(R+='[crossorigin="'+p+'"]'),gT.has(R)||(gT.add(R),s={rel:s,crossOrigin:p,href:c},g.querySelector(R)===null&&(c=g.createElement("link"),Or(c,"link",s),_r(c),g.head.appendChild(c)))}}function lA(s){Mo.D(s),ST("dns-prefetch",s,null)}function dA(s,c){Mo.C(s,c),ST("preconnect",s,c)}function uA(s,c,p){Mo.L(s,c,p);var g=vu;if(g&&s&&c){var R='link[rel="preload"][as="'+Us(c)+'"]';c==="image"&&p&&p.imageSrcSet?(R+='[imagesrcset="'+Us(p.imageSrcSet)+'"]',typeof p.imageSizes=="string"&&(R+='[imagesizes="'+Us(p.imageSizes)+'"]')):R+='[href="'+Us(s)+'"]';var C=R;switch(c){case"style":C=Tu(s);break;case"script":C=Ru(s)}Ks.has(C)||(s=We({rel:"preload",href:c==="image"&&p&&p.imageSrcSet?void 0:s,as:c},p),Ks.set(C,s),g.querySelector(R)!==null||c==="style"&&g.querySelector(dp(C))||c==="script"&&g.querySelector(up(C))||(c=g.createElement("link"),Or(c,"link",s),_r(c),g.head.appendChild(c)))}}function hA(s,c){Mo.m(s,c);var p=vu;if(p&&s){var g=c&&typeof c.as=="string"?c.as:"script",R='link[rel="modulepreload"][as="'+Us(g)+'"][href="'+Us(s)+'"]',C=R;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":C=Ru(s)}if(!Ks.has(C)&&(s=We({rel:"modulepreload",href:s},c),Ks.set(C,s),p.querySelector(R)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(p.querySelector(up(C)))return}g=p.createElement("link"),Or(g,"link",s),_r(g),p.head.appendChild(g)}}}function pA(s,c,p){Mo.S(s,c,p);var g=vu;if(g&&s){var R=Yr(g).hoistableStyles,C=Tu(s);c=c||"default";var V=R.get(C);if(!V){var q={loading:0,preload:null};if(V=g.querySelector(dp(C)))q.loading=5;else{s=We({rel:"stylesheet",href:s,"data-precedence":c},p),(p=Ks.get(C))&&cy(s,p);var ee=V=g.createElement("link");_r(ee),Or(ee,"link",s),ee._p=new Promise(function(de,Me){ee.onload=de,ee.onerror=Me}),ee.addEventListener("load",function(){q.loading|=1}),ee.addEventListener("error",function(){q.loading|=2}),q.loading|=4,hp(V,c,g)}V={type:"stylesheet",instance:V,count:1,state:q},R.set(C,V)}}}function fA(s,c){Mo.X(s,c);var p=vu;if(p&&s){var g=Yr(p).hoistableScripts,R=Ru(s),C=g.get(R);C||(C=p.querySelector(up(R)),C||(s=We({src:s,async:!0},c),(c=Ks.get(R))&&ly(s,c),C=p.createElement("script"),_r(C),Or(C,"link",s),p.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},g.set(R,C))}}function mA(s,c){Mo.M(s,c);var p=vu;if(p&&s){var g=Yr(p).hoistableScripts,R=Ru(s),C=g.get(R);C||(C=p.querySelector(up(R)),C||(s=We({src:s,async:!0,type:"module"},c),(c=Ks.get(R))&&ly(s,c),C=p.createElement("script"),_r(C),Or(C,"link",s),p.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},g.set(R,C))}}function vT(s,c,p,g){var R=(R=at.current)?gm(R):null;if(!R)throw Error(_(446));switch(s){case"meta":case"title":return null;case"style":return typeof p.precedence=="string"&&typeof p.href=="string"?(c=Tu(p.href),p=Yr(R).hoistableStyles,g=p.get(c),g||(g={type:"style",instance:null,count:0,state:null},p.set(c,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(p.rel==="stylesheet"&&typeof p.href=="string"&&typeof p.precedence=="string"){s=Tu(p.href);var C=Yr(R).hoistableStyles,V=C.get(s);if(V||(R=R.ownerDocument||R,V={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},C.set(s,V),(C=R.querySelector(dp(s)))&&!C._p&&(V.instance=C,V.state.loading=5),Ks.has(s)||(p={rel:"preload",as:"style",href:p.href,crossOrigin:p.crossOrigin,integrity:p.integrity,media:p.media,hrefLang:p.hrefLang,referrerPolicy:p.referrerPolicy},Ks.set(s,p),C||_A(R,s,p,V.state))),c&&g===null)throw Error(_(528,""));return V}if(c&&g!==null)throw Error(_(529,""));return null;case"script":return c=p.async,p=p.src,typeof p=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=Ru(p),p=Yr(R).hoistableScripts,g=p.get(c),g||(g={type:"script",instance:null,count:0,state:null},p.set(c,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(_(444,s))}}function Tu(s){return'href="'+Us(s)+'"'}function dp(s){return'link[rel="stylesheet"]['+s+"]"}function TT(s){return We({},s,{"data-precedence":s.precedence,precedence:null})}function _A(s,c,p,g){s.querySelector('link[rel="preload"][as="style"]['+c+"]")?g.loading=1:(c=s.createElement("link"),g.preload=c,c.addEventListener("load",function(){return g.loading|=1}),c.addEventListener("error",function(){return g.loading|=2}),Or(c,"link",p),_r(c),s.head.appendChild(c))}function Ru(s){return'[src="'+Us(s)+'"]'}function up(s){return"script[async]"+s}function RT(s,c,p){if(c.count++,c.instance===null)switch(c.type){case"style":var g=s.querySelector('style[data-href~="'+Us(p.href)+'"]');if(g)return c.instance=g,_r(g),g;var R=We({},p,{"data-href":p.href,"data-precedence":p.precedence,href:null,precedence:null});return g=(s.ownerDocument||s).createElement("style"),_r(g),Or(g,"style",R),hp(g,p.precedence,s),c.instance=g;case"stylesheet":R=Tu(p.href);var C=s.querySelector(dp(R));if(C)return c.state.loading|=4,c.instance=C,_r(C),C;g=TT(p),(R=Ks.get(R))&&cy(g,R),C=(s.ownerDocument||s).createElement("link"),_r(C);var V=C;return V._p=new Promise(function(q,ee){V.onload=q,V.onerror=ee}),Or(C,"link",g),c.state.loading|=4,hp(C,p.precedence,s),c.instance=C;case"script":return C=Ru(p.src),(R=s.querySelector(up(C)))?(c.instance=R,_r(R),R):(g=p,(R=Ks.get(C))&&(g=We({},p),ly(g,R)),s=s.ownerDocument||s,R=s.createElement("script"),_r(R),Or(R,"link",g),s.head.appendChild(R),c.instance=R);case"void":return null;default:throw Error(_(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(g=c.instance,c.state.loading|=4,hp(g,p.precedence,s));return c.instance}function hp(s,c,p){for(var g=p.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),R=g.length?g[g.length-1]:null,C=R,V=0;V<g.length;V++){var q=g[V];if(q.dataset.precedence===c)C=q;else if(C!==R)break}C?C.parentNode.insertBefore(s,C.nextSibling):(c=p.nodeType===9?p.head:p,c.insertBefore(s,c.firstChild))}function cy(s,c){s.crossOrigin==null&&(s.crossOrigin=c.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=c.referrerPolicy),s.title==null&&(s.title=c.title)}function ly(s,c){s.crossOrigin==null&&(s.crossOrigin=c.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=c.referrerPolicy),s.integrity==null&&(s.integrity=c.integrity)}var ym=null;function bT(s,c,p){if(ym===null){var g=new Map,R=ym=new Map;R.set(p,g)}else R=ym,g=R.get(p),g||(g=new Map,R.set(p,g));if(g.has(s))return g;for(g.set(s,null),p=p.getElementsByTagName(s),R=0;R<p.length;R++){var C=p[R];if(!(C[Sl]||C[Cr]||s==="link"&&C.getAttribute("rel")==="stylesheet")&&C.namespaceURI!=="http://www.w3.org/2000/svg"){var V=C.getAttribute(c)||"";V=s+V;var q=g.get(V);q?q.push(C):g.set(V,[C])}}return g}function CT(s,c,p){s=s.ownerDocument||s,s.head.insertBefore(p,c==="title"?s.querySelector("head > title"):null)}function wT(s,c,p){if(p===1||c.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return s=c.disabled,typeof c.precedence=="string"&&s==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function Sm(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var bu=null;function EA(){}function gA(s,c,p){if(bu===null)throw Error(_(475));var g=bu;if(c.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var R=Tu(p.href),C=s.querySelector(dp(R));if(C){s=C._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(g.count++,g=vm.bind(g),s.then(g,g)),c.state.loading|=4,c.instance=C,_r(C);return}C=s.ownerDocument||s,p=TT(p),(R=Ks.get(R))&&cy(p,R),C=C.createElement("link"),_r(C);var V=C;V._p=new Promise(function(q,ee){V.onload=q,V.onerror=ee}),Or(C,"link",p),c.instance=C}g.stylesheets===null&&(g.stylesheets=new Map),g.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(g.count++,c=vm.bind(g),s.addEventListener("load",c),s.addEventListener("error",c))}}function dy(){if(bu===null)throw Error(_(475));var s=bu;return s.stylesheets&&s.count===0&&uy(s,s.stylesheets),0<s.count?function(c){var p=setTimeout(function(){if(s.stylesheets&&uy(s,s.stylesheets),s.unsuspend){var g=s.unsuspend;s.unsuspend=null,g()}},6e4);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(p)}}:null}function vm(){if(this.count--,this.count===0){if(this.stylesheets)uy(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Tm=null;function uy(s,c){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Tm=new Map,c.forEach(yA,s),Tm=null,vm.call(s))}function yA(s,c){if(!(c.state.loading&4)){var p=Tm.get(s);if(p)var g=p.get(null);else{p=new Map,Tm.set(s,p);for(var R=s.querySelectorAll("link[data-precedence],style[data-precedence]"),C=0;C<R.length;C++){var V=R[C];(V.nodeName==="LINK"||V.getAttribute("media")!=="not all")&&(p.set(V.dataset.precedence,V),g=V)}g&&p.set(null,g)}R=c.instance,V=R.getAttribute("data-precedence"),C=p.get(V)||g,C===g&&p.set(null,R),p.set(V,R),this.count++,g=vm.bind(this),R.addEventListener("load",g),R.addEventListener("error",g),C?C.parentNode.insertBefore(R,C.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(R,s.firstChild)),c.state.loading|=4}}var Cu={$$typeof:Ae,Provider:null,Consumer:null,_currentValue:en,_currentValue2:en,_threadCount:0};function SA(s,c,p,g,R,C,V,q){this.tag=1,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=nE(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nE(0),this.hiddenUpdates=nE(null),this.identifierPrefix=g,this.onUncaughtError=R,this.onCaughtError=C,this.onRecoverableError=V,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=q,this.incompleteTransitions=new Map}function Rm(s,c,p,g,R,C,V,q,ee,de,Me,ze){return s=new SA(s,c,p,V,q,ee,de,ze),c=1,C===!0&&(c|=24),C=zs(3,null,null,c),s.current=C,C.stateNode=s,c=BE(),c.refCount++,s.pooledCache=c,c.refCount++,C.memoizedState={element:g,isDehydrated:p,cache:c},Ig(C),s}function AT(s){return s?(s=vc,s):vc}function OT(s,c,p,g,R,C){R=AT(R),g.context===null?g.context=R:g.pendingContext=R,g=Dc(c),g.payload={element:p},C=C===void 0?null:C,C!==null&&(g.callback=C),p=kc(s,g,c),p!==null&&(Jr(p,s,c),Vh(p,s,c))}function IT(s,c){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var p=s.retryLane;s.retryLane=p!==0&&p<c?p:c}}function hy(s,c){IT(s,c),(s=s.alternate)&&IT(s,c)}function py(s){if(s.tag===13){var c=Sc(s,67108864);c!==null&&Jr(c,s,67108864),hy(s,67108864)}}var bm=!0;function NT(s,c,p,g){var R=we.T;we.T=null;var C=it.p;try{it.p=2,my(s,c,p,g)}finally{it.p=C,we.T=R}}function fy(s,c,p,g){var R=we.T;we.T=null;var C=it.p;try{it.p=8,my(s,c,p,g)}finally{it.p=C,we.T=R}}function my(s,c,p,g){if(bm){var R=_y(g);if(R===null)sp(s,c,g,pp,p),wm(s,g);else if(Ne(R,s,c,p,g))g.stopPropagation();else if(wm(s,g),c&4&&-1<DT.indexOf(s)){for(;R!==null;){var C=Md(R);if(C!==null)switch(C.tag){case 3:if(C=C.stateNode,C.current.memoizedState.isDehydrated){var V=yl(C.pendingLanes);if(V!==0){var q=C;for(q.pendingLanes|=2,q.entangledLanes|=2;V;){var ee=1<<31-Es(V);q.entanglements[1]|=ee,V&=~ee}Ka(C),(Si&6)===0&&(uu=Xt()+500,Ql(0))}}break;case 13:q=Sc(C,2),q!==null&&Jr(q,C,2),Qh(),hy(C,2)}if(C=_y(g),C===null&&sp(s,c,g,pp,p),C===R)break;R=C}R!==null&&g.stopPropagation()}else sp(s,c,g,null,p)}}function _y(s){return s=hE(s),Ey(s)}var pp=null;function Ey(s){if(pp=null,s=xs(s),s!==null){var c=rt(s);if(c===null)s=null;else{var p=c.tag;if(p===13){if(s=sn(c),s!==null)return s;s=null}else if(p===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;s=null}else c!==s&&(s=null)}}return pp=s,null}function gy(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(pc()){case fc:return 2;case Ms:return 8;case Nd:case eE:return 32;case tE:return 268435456;default:return 32}default:return 32}}var Cm=!1,Hc=null,Wc=null,Yc=null,fp=new Map,mp=new Map,zc=[],DT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function wm(s,c){switch(s){case"focusin":case"focusout":Hc=null;break;case"dragenter":case"dragleave":Wc=null;break;case"mouseover":case"mouseout":Yc=null;break;case"pointerover":case"pointerout":fp.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":mp.delete(c.pointerId)}}function wu(s,c,p,g,R,C){return s===null||s.nativeEvent!==C?(s={blockedOn:c,domEventName:p,eventSystemFlags:g,nativeEvent:C,targetContainers:[R]},c!==null&&(c=Md(c),c!==null&&py(c)),s):(s.eventSystemFlags|=g,c=s.targetContainers,R!==null&&c.indexOf(R)===-1&&c.push(R),s)}function Ne(s,c,p,g,R){switch(c){case"focusin":return Hc=wu(Hc,s,c,p,g,R),!0;case"dragenter":return Wc=wu(Wc,s,c,p,g,R),!0;case"mouseover":return Yc=wu(Yc,s,c,p,g,R),!0;case"pointerover":var C=R.pointerId;return fp.set(C,wu(fp.get(C)||null,s,c,p,g,R)),!0;case"gotpointercapture":return C=R.pointerId,mp.set(C,wu(mp.get(C)||null,s,c,p,g,R)),!0}return!1}function kT(s){var c=xs(s.target);if(c!==null){var p=rt(c);if(p!==null){if(c=p.tag,c===13){if(c=sn(p),c!==null){s.blockedOn=c,pv(s.priority,function(){if(p.tag===13){var g=Xr(),R=Sc(p,g);R!==null&&Jr(R,p,g),hy(p,g)}});return}}else if(c===3&&p.stateNode.current.memoizedState.isDehydrated){s.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Am(s){if(s.blockedOn!==null)return!1;for(var c=s.targetContainers;0<c.length;){var p=_y(s.nativeEvent);if(p===null){p=s.nativeEvent;var g=new p.constructor(p.type,p);uE=g,p.target.dispatchEvent(g),uE=null}else return c=Md(p),c!==null&&py(c),s.blockedOn=p,!1;c.shift()}return!0}function PT(s,c,p){Am(s)&&p.delete(c)}function vA(){Cm=!1,Hc!==null&&Am(Hc)&&(Hc=null),Wc!==null&&Am(Wc)&&(Wc=null),Yc!==null&&Am(Yc)&&(Yc=null),fp.forEach(PT),mp.forEach(PT)}function Om(s,c){s.blockedOn===c&&(s.blockedOn=null,Cm||(Cm=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,vA)))}var Au=null;function LT(s){Au!==s&&(Au=s,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){Au===s&&(Au=null);for(var c=0;c<s.length;c+=3){var p=s[c],g=s[c+1],R=s[c+2];if(typeof g!="function"){if(Ey(g||p)===null)continue;break}var C=Md(p);C!==null&&(s.splice(c,3),c-=3,ug(C,{pending:!0,data:R,method:p.method,action:g},g,R))}}))}function _p(s){function c(ee){return Om(ee,s)}Hc!==null&&Om(Hc,s),Wc!==null&&Om(Wc,s),Yc!==null&&Om(Yc,s),fp.forEach(c),mp.forEach(c);for(var p=0;p<zc.length;p++){var g=zc[p];g.blockedOn===s&&(g.blockedOn=null)}for(;0<zc.length&&(p=zc[0],p.blockedOn===null);)kT(p),p.blockedOn===null&&zc.shift();if(p=(s.ownerDocument||s).$$reactFormReplay,p!=null)for(g=0;g<p.length;g+=3){var R=p[g],C=p[g+1],V=R[Wr]||null;if(typeof C=="function")V||LT(p);else if(V){var q=null;if(C&&C.hasAttribute("formAction")){if(R=C,V=C[Wr]||null)q=V.formAction;else if(Ey(R)!==null)continue}else q=V.action;typeof q=="function"?p[g+1]=q:(p.splice(g,3),g-=3),LT(p)}}}function Ir(s){this._internalRoot=s}Ep.prototype.render=Ir.prototype.render=function(s){var c=this._internalRoot;if(c===null)throw Error(_(409));var p=c.current,g=Xr();OT(p,g,s,c,null,null)},Ep.prototype.unmount=Ir.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var c=s.containerInfo;s.tag===0&&mu(),OT(s.current,2,null,s,null,null),Qh(),c[Ld]=null}};function Ep(s){this._internalRoot=s}Ep.prototype.unstable_scheduleHydration=function(s){if(s){var c=rE();s={blockedOn:null,target:s,priority:c};for(var p=0;p<zc.length&&c!==0&&c<zc[p].priority;p++);zc.splice(p,0,s),p===0&&kT(s)}};var MT=d.version;if(MT!=="19.0.0")throw Error(_(527,MT,"19.0.0"));it.findDOMNode=function(s){var c=s._reactInternals;if(c===void 0)throw typeof s.render=="function"?Error(_(188)):(s=Object.keys(s).join(","),Error(_(268,s)));return s=Ke(c),s=s!==null?gt(s):null,s=s===null?null:s.stateNode,s};var xT={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:we,findFiberByHostInstance:xs,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Im=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Im.isDisabled&&Im.supportsFiber)try{Dd=Im.inject(xT),sr=Im}catch{}}return DS.createRoot=function(s,c){if(!v(s))throw Error(_(299));var p=!1,g="",R=mg,C=I0,V=N0,q=null;return c!=null&&(c.unstable_strictMode===!0&&(p=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(R=c.onUncaughtError),c.onCaughtError!==void 0&&(C=c.onCaughtError),c.onRecoverableError!==void 0&&(V=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(q=c.unstable_transitionCallbacks)),c=Rm(s,1,!1,null,null,p,g,R,C,V,q,null),s[Ld]=c.current,rp(s.nodeType===8?s.parentNode:s),new Ir(c)},DS.hydrateRoot=function(s,c,p){if(!v(s))throw Error(_(299));var g=!1,R="",C=mg,V=I0,q=N0,ee=null,de=null;return p!=null&&(p.unstable_strictMode===!0&&(g=!0),p.identifierPrefix!==void 0&&(R=p.identifierPrefix),p.onUncaughtError!==void 0&&(C=p.onUncaughtError),p.onCaughtError!==void 0&&(V=p.onCaughtError),p.onRecoverableError!==void 0&&(q=p.onRecoverableError),p.unstable_transitionCallbacks!==void 0&&(ee=p.unstable_transitionCallbacks),p.formState!==void 0&&(de=p.formState)),c=Rm(s,1,!0,c,p??null,g,R,C,V,q,ee,de),c.context=AT(null),p=c.current,g=Xr(),R=Dc(g),R.callback=null,kc(p,R,g),c.current.lanes=g,mr(c,g),Ka(c),s[Ld]=c.current,rp(s),new Ep(c)},DS.version="19.0.0",DS}var _j;function bq(){if(_j)return u1.exports;_j=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(d){console.error(d)}}return o(),u1.exports=Rq(),u1.exports}var Cq=bq();/**
 * react-router v7.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Ej="popstate";function wq(o={}){function d(_,v){let{pathname:w,search:D,hash:B}=_.location;return P1("",{pathname:w,search:D,hash:B},v.state&&v.state.usr||null,v.state&&v.state.key||"default")}function m(_,v){return typeof v=="string"?v:BS(v)}return Oq(d,m,null,o)}function Gi(o,d){if(o===!1||o===null||typeof o>"u")throw new Error(d)}function sc(o,d){if(!o){typeof console<"u"&&console.warn(d);try{throw new Error(d)}catch{}}}function Aq(){return Math.random().toString(36).substring(2,10)}function gj(o,d){return{usr:o.state,key:o.key,idx:d}}function P1(o,d,m=null,_){return{pathname:typeof o=="string"?o:o.pathname,search:"",hash:"",...typeof d=="string"?W_(d):d,state:m,key:d&&d.key||_||Aq()}}function BS({pathname:o="/",search:d="",hash:m=""}){return d&&d!=="?"&&(o+=d.charAt(0)==="?"?d:"?"+d),m&&m!=="#"&&(o+=m.charAt(0)==="#"?m:"#"+m),o}function W_(o){let d={};if(o){let m=o.indexOf("#");m>=0&&(d.hash=o.substring(m),o=o.substring(0,m));let _=o.indexOf("?");_>=0&&(d.search=o.substring(_),o=o.substring(0,_)),o&&(d.pathname=o)}return d}function Oq(o,d,m,_={}){let{window:v=document.defaultView,v5Compat:w=!1}=_,D=v.history,B="POP",W=null,F=X();F==null&&(F=0,D.replaceState({...D.state,idx:F},""));function X(){return(D.state||{idx:null}).idx}function Q(){B="POP";let ae=X(),ve=ae==null?null:ae-F;F=ae,W&&W({action:B,location:fe.location,delta:ve})}function oe(ae,ve){B="PUSH";let be=P1(fe.location,ae,ve);F=X()+1;let _e=gj(be,F),Qe=fe.createHref(be);try{D.pushState(_e,"",Qe)}catch(Ye){if(Ye instanceof DOMException&&Ye.name==="DataCloneError")throw Ye;v.location.assign(Qe)}w&&W&&W({action:B,location:fe.location,delta:1})}function Ae(ae,ve){B="REPLACE";let be=P1(fe.location,ae,ve);F=X();let _e=gj(be,F),Qe=fe.createHref(be);D.replaceState(_e,"",Qe),w&&W&&W({action:B,location:fe.location,delta:0})}function ie(ae){return Iq(ae)}let fe={get action(){return B},get location(){return o(v,D)},listen(ae){if(W)throw new Error("A history only accepts one active listener");return v.addEventListener(Ej,Q),W=ae,()=>{v.removeEventListener(Ej,Q),W=null}},createHref(ae){return d(v,ae)},createURL:ie,encodeLocation(ae){let ve=ie(ae);return{pathname:ve.pathname,search:ve.search,hash:ve.hash}},push:oe,replace:Ae,go(ae){return D.go(ae)}};return fe}function Iq(o,d=!1){let m="http://localhost";typeof window<"u"&&(m=window.location.origin!=="null"?window.location.origin:window.location.href),Gi(m,"No window.location.(origin|href) available to create URL");let _=typeof o=="string"?o:BS(o);return _=_.replace(/ $/,"%20"),!d&&_.startsWith("//")&&(_=m+_),new URL(_,m)}function oF(o,d,m="/"){return Nq(o,d,m,!1)}function Nq(o,d,m,_){let v=typeof d=="string"?W_(d):d,w=Rd(v.pathname||"/",m);if(w==null)return null;let D=cF(o);Dq(D);let B=null;for(let W=0;B==null&&W<D.length;++W){let F=Gq(w);B=Fq(D[W],F,_)}return B}function cF(o,d=[],m=[],_="",v=!1){let w=(D,B,W=v,F)=>{let X={relativePath:F===void 0?D.path||"":F,caseSensitive:D.caseSensitive===!0,childrenIndex:B,route:D};if(X.relativePath.startsWith("/")){if(!X.relativePath.startsWith(_)&&W)return;Gi(X.relativePath.startsWith(_),`Absolute route path "${X.relativePath}" nested under path "${_}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),X.relativePath=X.relativePath.slice(_.length)}let Q=Sd([_,X.relativePath]),oe=m.concat(X);D.children&&D.children.length>0&&(Gi(D.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${Q}".`),cF(D.children,d,oe,Q,W)),!(D.path==null&&!D.index)&&d.push({path:Q,score:Vq(Q,D.index),routesMeta:oe})};return o.forEach((D,B)=>{var W;if(D.path===""||!((W=D.path)!=null&&W.includes("?")))w(D,B);else for(let F of lF(D.path))w(D,B,!0,F)}),d}function lF(o){let d=o.split("/");if(d.length===0)return[];let[m,..._]=d,v=m.endsWith("?"),w=m.replace(/\?$/,"");if(_.length===0)return v?[w,""]:[w];let D=lF(_.join("/")),B=[];return B.push(...D.map(W=>W===""?w:[w,W].join("/"))),v&&B.push(...D),B.map(W=>o.startsWith("/")&&W===""?"/":W)}function Dq(o){o.sort((d,m)=>d.score!==m.score?m.score-d.score:jq(d.routesMeta.map(_=>_.childrenIndex),m.routesMeta.map(_=>_.childrenIndex)))}var kq=/^:[\w-]+$/,Pq=3,Lq=2,Mq=1,xq=10,Uq=-2,yj=o=>o==="*";function Vq(o,d){let m=o.split("/"),_=m.length;return m.some(yj)&&(_+=Uq),d&&(_+=Lq),m.filter(v=>!yj(v)).reduce((v,w)=>v+(kq.test(w)?Pq:w===""?Mq:xq),_)}function jq(o,d){return o.length===d.length&&o.slice(0,-1).every((_,v)=>_===d[v])?o[o.length-1]-d[d.length-1]:0}function Fq(o,d,m=!1){let{routesMeta:_}=o,v={},w="/",D=[];for(let B=0;B<_.length;++B){let W=_[B],F=B===_.length-1,X=w==="/"?d:d.slice(w.length)||"/",Q=OC({path:W.relativePath,caseSensitive:W.caseSensitive,end:F},X),oe=W.route;if(!Q&&F&&m&&!_[_.length-1].route.index&&(Q=OC({path:W.relativePath,caseSensitive:W.caseSensitive,end:!1},X)),!Q)return null;Object.assign(v,Q.params),D.push({params:v,pathname:Sd([w,Q.pathname]),pathnameBase:zq(Sd([w,Q.pathnameBase])),route:oe}),Q.pathnameBase!=="/"&&(w=Sd([w,Q.pathnameBase]))}return D}function OC(o,d){typeof o=="string"&&(o={path:o,caseSensitive:!1,end:!0});let[m,_]=Bq(o.path,o.caseSensitive,o.end),v=d.match(m);if(!v)return null;let w=v[0],D=w.replace(/(.)\/+$/,"$1"),B=v.slice(1);return{params:_.reduce((F,{paramName:X,isOptional:Q},oe)=>{if(X==="*"){let ie=B[oe]||"";D=w.slice(0,w.length-ie.length).replace(/(.)\/+$/,"$1")}const Ae=B[oe];return Q&&!Ae?F[X]=void 0:F[X]=(Ae||"").replace(/%2F/g,"/"),F},{}),pathname:w,pathnameBase:D,pattern:o}}function Bq(o,d=!1,m=!0){sc(o==="*"||!o.endsWith("*")||o.endsWith("/*"),`Route path "${o}" will be treated as if it were "${o.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${o.replace(/\*$/,"/*")}".`);let _=[],v="^"+o.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(D,B,W)=>(_.push({paramName:B,isOptional:W!=null}),W?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return o.endsWith("*")?(_.push({paramName:"*"}),v+=o==="*"||o==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):m?v+="\\/*$":o!==""&&o!=="/"&&(v+="(?:(?=\\/|$))"),[new RegExp(v,d?void 0:"i"),_]}function Gq(o){try{return o.split("/").map(d=>decodeURIComponent(d).replace(/\//g,"%2F")).join("/")}catch(d){return sc(!1,`The URL path "${o}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${d}).`),o}}function Rd(o,d){if(d==="/")return o;if(!o.toLowerCase().startsWith(d.toLowerCase()))return null;let m=d.endsWith("/")?d.length-1:d.length,_=o.charAt(m);return _&&_!=="/"?null:o.slice(m)||"/"}function Hq(o,d="/"){let{pathname:m,search:_="",hash:v=""}=typeof o=="string"?W_(o):o;return{pathname:m?m.startsWith("/")?m:Wq(m,d):d,search:Kq(_),hash:qq(v)}}function Wq(o,d){let m=d.replace(/\/+$/,"").split("/");return o.split("/").forEach(v=>{v===".."?m.length>1&&m.pop():v!=="."&&m.push(v)}),m.length>1?m.join("/"):"/"}function m1(o,d,m,_){return`Cannot include a '${o}' character in a manually specified \`to.${d}\` field [${JSON.stringify(_)}].  Please separate it out to the \`to.${m}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Yq(o){return o.filter((d,m)=>m===0||d.route.path&&d.route.path.length>0)}function sD(o){let d=Yq(o);return d.map((m,_)=>_===d.length-1?m.pathname:m.pathnameBase)}function aD(o,d,m,_=!1){let v;typeof o=="string"?v=W_(o):(v={...o},Gi(!v.pathname||!v.pathname.includes("?"),m1("?","pathname","search",v)),Gi(!v.pathname||!v.pathname.includes("#"),m1("#","pathname","hash",v)),Gi(!v.search||!v.search.includes("#"),m1("#","search","hash",v)));let w=o===""||v.pathname==="",D=w?"/":v.pathname,B;if(D==null)B=m;else{let Q=d.length-1;if(!_&&D.startsWith("..")){let oe=D.split("/");for(;oe[0]==="..";)oe.shift(),Q-=1;v.pathname=oe.join("/")}B=Q>=0?d[Q]:"/"}let W=Hq(v,B),F=D&&D!=="/"&&D.endsWith("/"),X=(w||D===".")&&m.endsWith("/");return!W.pathname.endsWith("/")&&(F||X)&&(W.pathname+="/"),W}var Sd=o=>o.join("/").replace(/\/\/+/g,"/"),zq=o=>o.replace(/\/+$/,"").replace(/^\/*/,"/"),Kq=o=>!o||o==="?"?"":o.startsWith("?")?o:"?"+o,qq=o=>!o||o==="#"?"":o.startsWith("#")?o:"#"+o;function Xq(o){return o!=null&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.internal=="boolean"&&"data"in o}var dF=["POST","PUT","PATCH","DELETE"];new Set(dF);var Jq=["GET",...dF];new Set(Jq);var Y_=J.createContext(null);Y_.displayName="DataRouter";var VC=J.createContext(null);VC.displayName="DataRouterState";J.createContext(!1);var uF=J.createContext({isTransitioning:!1});uF.displayName="ViewTransition";var Zq=J.createContext(new Map);Zq.displayName="Fetchers";var Qq=J.createContext(null);Qq.displayName="Await";var cc=J.createContext(null);cc.displayName="Navigation";var qS=J.createContext(null);qS.displayName="Location";var _l=J.createContext({outlet:null,matches:[],isDataRoute:!1});_l.displayName="Route";var oD=J.createContext(null);oD.displayName="RouteError";function $q(o,{relative:d}={}){Gi(z_(),"useHref() may be used only in the context of a <Router> component.");let{basename:m,navigator:_}=J.useContext(cc),{hash:v,pathname:w,search:D}=XS(o,{relative:d}),B=w;return m!=="/"&&(B=w==="/"?m:Sd([m,w])),_.createHref({pathname:B,search:D,hash:v})}function z_(){return J.useContext(qS)!=null}function wd(){return Gi(z_(),"useLocation() may be used only in the context of a <Router> component."),J.useContext(qS).location}var hF="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function pF(o){J.useContext(cc).static||J.useLayoutEffect(o)}function Ad(){let{isDataRoute:o}=J.useContext(_l);return o?hX():eX()}function eX(){Gi(z_(),"useNavigate() may be used only in the context of a <Router> component.");let o=J.useContext(Y_),{basename:d,navigator:m}=J.useContext(cc),{matches:_}=J.useContext(_l),{pathname:v}=wd(),w=JSON.stringify(sD(_)),D=J.useRef(!1);return pF(()=>{D.current=!0}),J.useCallback((W,F={})=>{if(sc(D.current,hF),!D.current)return;if(typeof W=="number"){m.go(W);return}let X=aD(W,JSON.parse(w),v,F.relative==="path");o==null&&d!=="/"&&(X.pathname=X.pathname==="/"?d:Sd([d,X.pathname])),(F.replace?m.replace:m.push)(X,F.state,F)},[d,m,w,v,o])}J.createContext(null);function XS(o,{relative:d}={}){let{matches:m}=J.useContext(_l),{pathname:_}=wd(),v=JSON.stringify(sD(m));return J.useMemo(()=>aD(o,JSON.parse(v),_,d==="path"),[o,v,_,d])}function tX(o,d){return fF(o,d)}function fF(o,d,m,_,v){var be;Gi(z_(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:w}=J.useContext(cc),{matches:D}=J.useContext(_l),B=D[D.length-1],W=B?B.params:{},F=B?B.pathname:"/",X=B?B.pathnameBase:"/",Q=B&&B.route;{let _e=Q&&Q.path||"";mF(F,!Q||_e.endsWith("*")||_e.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${F}" (under <Route path="${_e}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${_e}"> to <Route path="${_e==="/"?"*":`${_e}/*`}">.`)}let oe=wd(),Ae;if(d){let _e=typeof d=="string"?W_(d):d;Gi(X==="/"||((be=_e.pathname)==null?void 0:be.startsWith(X)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${X}" but pathname "${_e.pathname}" was given in the \`location\` prop.`),Ae=_e}else Ae=oe;let ie=Ae.pathname||"/",fe=ie;if(X!=="/"){let _e=X.replace(/^\//,"").split("/");fe="/"+ie.replace(/^\//,"").split("/").slice(_e.length).join("/")}let ae=oF(o,{pathname:fe});sc(Q||ae!=null,`No routes matched location "${Ae.pathname}${Ae.search}${Ae.hash}" `),sc(ae==null||ae[ae.length-1].route.element!==void 0||ae[ae.length-1].route.Component!==void 0||ae[ae.length-1].route.lazy!==void 0,`Matched leaf route at location "${Ae.pathname}${Ae.search}${Ae.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let ve=aX(ae&&ae.map(_e=>Object.assign({},_e,{params:Object.assign({},W,_e.params),pathname:Sd([X,w.encodeLocation?w.encodeLocation(_e.pathname).pathname:_e.pathname]),pathnameBase:_e.pathnameBase==="/"?X:Sd([X,w.encodeLocation?w.encodeLocation(_e.pathnameBase).pathname:_e.pathnameBase])})),D,m,_,v);return d&&ve?J.createElement(qS.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Ae},navigationType:"POP"}},ve):ve}function nX(){let o=uX(),d=Xq(o)?`${o.status} ${o.statusText}`:o instanceof Error?o.message:JSON.stringify(o),m=o instanceof Error?o.stack:null,_="rgba(200,200,200, 0.5)",v={padding:"0.5rem",backgroundColor:_},w={padding:"2px 4px",backgroundColor:_},D=null;return console.error("Error handled by React Router default ErrorBoundary:",o),D=J.createElement(J.Fragment,null,J.createElement("p",null," Hey developer "),J.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",J.createElement("code",{style:w},"ErrorBoundary")," or"," ",J.createElement("code",{style:w},"errorElement")," prop on your route.")),J.createElement(J.Fragment,null,J.createElement("h2",null,"Unexpected Application Error!"),J.createElement("h3",{style:{fontStyle:"italic"}},d),m?J.createElement("pre",{style:v},m):null,D)}var iX=J.createElement(nX,null),rX=class extends J.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,d){return d.location!==o.location||d.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:d.error,location:d.location,revalidation:o.revalidation||d.revalidation}}componentDidCatch(o,d){this.props.unstable_onError?this.props.unstable_onError(o,d):console.error("React Router caught the following error during render",o)}render(){return this.state.error!==void 0?J.createElement(_l.Provider,{value:this.props.routeContext},J.createElement(oD.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function sX({routeContext:o,match:d,children:m}){let _=J.useContext(Y_);return _&&_.static&&_.staticContext&&(d.route.errorElement||d.route.ErrorBoundary)&&(_.staticContext._deepestRenderedBoundaryId=d.route.id),J.createElement(_l.Provider,{value:o},m)}function aX(o,d=[],m=null,_=null,v=null){if(o==null){if(!m)return null;if(m.errors)o=m.matches;else if(d.length===0&&!m.initialized&&m.matches.length>0)o=m.matches;else return null}let w=o,D=m==null?void 0:m.errors;if(D!=null){let F=w.findIndex(X=>X.route.id&&(D==null?void 0:D[X.route.id])!==void 0);Gi(F>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(D).join(",")}`),w=w.slice(0,Math.min(w.length,F+1))}let B=!1,W=-1;if(m)for(let F=0;F<w.length;F++){let X=w[F];if((X.route.HydrateFallback||X.route.hydrateFallbackElement)&&(W=F),X.route.id){let{loaderData:Q,errors:oe}=m,Ae=X.route.loader&&!Q.hasOwnProperty(X.route.id)&&(!oe||oe[X.route.id]===void 0);if(X.route.lazy||Ae){B=!0,W>=0?w=w.slice(0,W+1):w=[w[0]];break}}}return w.reduceRight((F,X,Q)=>{let oe,Ae=!1,ie=null,fe=null;m&&(oe=D&&X.route.id?D[X.route.id]:void 0,ie=X.route.errorElement||iX,B&&(W<0&&Q===0?(mF("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),Ae=!0,fe=null):W===Q&&(Ae=!0,fe=X.route.hydrateFallbackElement||null)));let ae=d.concat(w.slice(0,Q+1)),ve=()=>{let be;return oe?be=ie:Ae?be=fe:X.route.Component?be=J.createElement(X.route.Component,null):X.route.element?be=X.route.element:be=F,J.createElement(sX,{match:X,routeContext:{outlet:F,matches:ae,isDataRoute:m!=null},children:be})};return m&&(X.route.ErrorBoundary||X.route.errorElement||Q===0)?J.createElement(rX,{location:m.location,revalidation:m.revalidation,component:ie,error:oe,children:ve(),routeContext:{outlet:null,matches:ae,isDataRoute:!0},unstable_onError:_}):ve()},null)}function cD(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function oX(o){let d=J.useContext(Y_);return Gi(d,cD(o)),d}function cX(o){let d=J.useContext(VC);return Gi(d,cD(o)),d}function lX(o){let d=J.useContext(_l);return Gi(d,cD(o)),d}function lD(o){let d=lX(o),m=d.matches[d.matches.length-1];return Gi(m.route.id,`${o} can only be used on routes that contain a unique "id"`),m.route.id}function dX(){return lD("useRouteId")}function uX(){var _;let o=J.useContext(oD),d=cX("useRouteError"),m=lD("useRouteError");return o!==void 0?o:(_=d.errors)==null?void 0:_[m]}function hX(){let{router:o}=oX("useNavigate"),d=lD("useNavigate"),m=J.useRef(!1);return pF(()=>{m.current=!0}),J.useCallback(async(v,w={})=>{sc(m.current,hF),m.current&&(typeof v=="number"?o.navigate(v):await o.navigate(v,{fromRouteId:d,...w}))},[o,d])}var Sj={};function mF(o,d,m){!d&&!Sj[o]&&(Sj[o]=!0,sc(!1,m))}J.memo(pX);function pX({routes:o,future:d,state:m,unstable_onError:_}){return fF(o,void 0,m,_,d)}function P_({to:o,replace:d,state:m,relative:_}){Gi(z_(),"<Navigate> may be used only in the context of a <Router> component.");let{static:v}=J.useContext(cc);sc(!v,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:w}=J.useContext(_l),{pathname:D}=wd(),B=Ad(),W=aD(o,sD(w),D,_==="path"),F=JSON.stringify(W);return J.useEffect(()=>{B(JSON.parse(F),{replace:d,state:m,relative:_})},[B,F,_,d,m]),null}function hl(o){Gi(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function fX({basename:o="/",children:d=null,location:m,navigationType:_="POP",navigator:v,static:w=!1}){Gi(!z_(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let D=o.replace(/^\/*/,"/"),B=J.useMemo(()=>({basename:D,navigator:v,static:w,future:{}}),[D,v,w]);typeof m=="string"&&(m=W_(m));let{pathname:W="/",search:F="",hash:X="",state:Q=null,key:oe="default"}=m,Ae=J.useMemo(()=>{let ie=Rd(W,D);return ie==null?null:{location:{pathname:ie,search:F,hash:X,state:Q,key:oe},navigationType:_}},[D,W,F,X,Q,oe,_]);return sc(Ae!=null,`<Router basename="${D}"> is not able to match the URL "${W}${F}${X}" because it does not start with the basename, so the <Router> won't render anything.`),Ae==null?null:J.createElement(cc.Provider,{value:B},J.createElement(qS.Provider,{children:d,value:Ae}))}function mX({children:o,location:d}){return tX(L1(o),d)}function L1(o,d=[]){let m=[];return J.Children.forEach(o,(_,v)=>{if(!J.isValidElement(_))return;let w=[...d,v];if(_.type===J.Fragment){m.push.apply(m,L1(_.props.children,w));return}Gi(_.type===hl,`[${typeof _.type=="string"?_.type:_.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Gi(!_.props.index||!_.props.children,"An index route cannot have child routes.");let D={id:_.props.id||w.join("-"),caseSensitive:_.props.caseSensitive,element:_.props.element,Component:_.props.Component,index:_.props.index,path:_.props.path,loader:_.props.loader,action:_.props.action,hydrateFallbackElement:_.props.hydrateFallbackElement,HydrateFallback:_.props.HydrateFallback,errorElement:_.props.errorElement,ErrorBoundary:_.props.ErrorBoundary,hasErrorBoundary:_.props.hasErrorBoundary===!0||_.props.ErrorBoundary!=null||_.props.errorElement!=null,shouldRevalidate:_.props.shouldRevalidate,handle:_.props.handle,lazy:_.props.lazy};_.props.children&&(D.children=L1(_.props.children,w)),m.push(D)}),m}var pC="get",fC="application/x-www-form-urlencoded";function jC(o){return o!=null&&typeof o.tagName=="string"}function _X(o){return jC(o)&&o.tagName.toLowerCase()==="button"}function EX(o){return jC(o)&&o.tagName.toLowerCase()==="form"}function gX(o){return jC(o)&&o.tagName.toLowerCase()==="input"}function yX(o){return!!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)}function SX(o,d){return o.button===0&&(!d||d==="_self")&&!yX(o)}var aC=null;function vX(){if(aC===null)try{new FormData(document.createElement("form"),0),aC=!1}catch{aC=!0}return aC}var TX=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function _1(o){return o!=null&&!TX.has(o)?(sc(!1,`"${o}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${fC}"`),null):o}function RX(o,d){let m,_,v,w,D;if(EX(o)){let B=o.getAttribute("action");_=B?Rd(B,d):null,m=o.getAttribute("method")||pC,v=_1(o.getAttribute("enctype"))||fC,w=new FormData(o)}else if(_X(o)||gX(o)&&(o.type==="submit"||o.type==="image")){let B=o.form;if(B==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let W=o.getAttribute("formaction")||B.getAttribute("action");if(_=W?Rd(W,d):null,m=o.getAttribute("formmethod")||B.getAttribute("method")||pC,v=_1(o.getAttribute("formenctype"))||_1(B.getAttribute("enctype"))||fC,w=new FormData(B,o),!vX()){let{name:F,type:X,value:Q}=o;if(X==="image"){let oe=F?`${F}.`:"";w.append(`${oe}x`,"0"),w.append(`${oe}y`,"0")}else F&&w.append(F,Q)}}else{if(jC(o))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');m=pC,_=null,v=fC,D=o}return w&&v==="text/plain"&&(D=w,w=void 0),{action:_,method:m.toLowerCase(),encType:v,formData:w,body:D}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function dD(o,d){if(o===!1||o===null||typeof o>"u")throw new Error(d)}function bX(o,d,m){let _=typeof o=="string"?new URL(o,typeof window>"u"?"server://singlefetch/":window.location.origin):o;return _.pathname==="/"?_.pathname=`_root.${m}`:d&&Rd(_.pathname,d)==="/"?_.pathname=`${d.replace(/\/$/,"")}/_root.${m}`:_.pathname=`${_.pathname.replace(/\/$/,"")}.${m}`,_}async function CX(o,d){if(o.id in d)return d[o.id];try{let m=await import(o.module);return d[o.id]=m,m}catch(m){return console.error(`Error loading route module \`${o.module}\`, reloading page...`),console.error(m),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function wX(o){return o==null?!1:o.href==null?o.rel==="preload"&&typeof o.imageSrcSet=="string"&&typeof o.imageSizes=="string":typeof o.rel=="string"&&typeof o.href=="string"}async function AX(o,d,m){let _=await Promise.all(o.map(async v=>{let w=d.routes[v.route.id];if(w){let D=await CX(w,m);return D.links?D.links():[]}return[]}));return DX(_.flat(1).filter(wX).filter(v=>v.rel==="stylesheet"||v.rel==="preload").map(v=>v.rel==="stylesheet"?{...v,rel:"prefetch",as:"style"}:{...v,rel:"prefetch"}))}function vj(o,d,m,_,v,w){let D=(W,F)=>m[F]?W.route.id!==m[F].route.id:!0,B=(W,F)=>{var X;return m[F].pathname!==W.pathname||((X=m[F].route.path)==null?void 0:X.endsWith("*"))&&m[F].params["*"]!==W.params["*"]};return w==="assets"?d.filter((W,F)=>D(W,F)||B(W,F)):w==="data"?d.filter((W,F)=>{var Q;let X=_.routes[W.route.id];if(!X||!X.hasLoader)return!1;if(D(W,F)||B(W,F))return!0;if(W.route.shouldRevalidate){let oe=W.route.shouldRevalidate({currentUrl:new URL(v.pathname+v.search+v.hash,window.origin),currentParams:((Q=m[0])==null?void 0:Q.params)||{},nextUrl:new URL(o,window.origin),nextParams:W.params,defaultShouldRevalidate:!0});if(typeof oe=="boolean")return oe}return!0}):[]}function OX(o,d,{includeHydrateFallback:m}={}){return IX(o.map(_=>{let v=d.routes[_.route.id];if(!v)return[];let w=[v.module];return v.clientActionModule&&(w=w.concat(v.clientActionModule)),v.clientLoaderModule&&(w=w.concat(v.clientLoaderModule)),m&&v.hydrateFallbackModule&&(w=w.concat(v.hydrateFallbackModule)),v.imports&&(w=w.concat(v.imports)),w}).flat(1))}function IX(o){return[...new Set(o)]}function NX(o){let d={},m=Object.keys(o).sort();for(let _ of m)d[_]=o[_];return d}function DX(o,d){let m=new Set;return new Set(d),o.reduce((_,v)=>{let w=JSON.stringify(NX(v));return m.has(w)||(m.add(w),_.push({key:w,link:v})),_},[])}function _F(){let o=J.useContext(Y_);return dD(o,"You must render this element inside a <DataRouterContext.Provider> element"),o}function kX(){let o=J.useContext(VC);return dD(o,"You must render this element inside a <DataRouterStateContext.Provider> element"),o}var uD=J.createContext(void 0);uD.displayName="FrameworkContext";function EF(){let o=J.useContext(uD);return dD(o,"You must render this element inside a <HydratedRouter> element"),o}function PX(o,d){let m=J.useContext(uD),[_,v]=J.useState(!1),[w,D]=J.useState(!1),{onFocus:B,onBlur:W,onMouseEnter:F,onMouseLeave:X,onTouchStart:Q}=d,oe=J.useRef(null);J.useEffect(()=>{if(o==="render"&&D(!0),o==="viewport"){let fe=ve=>{ve.forEach(be=>{D(be.isIntersecting)})},ae=new IntersectionObserver(fe,{threshold:.5});return oe.current&&ae.observe(oe.current),()=>{ae.disconnect()}}},[o]),J.useEffect(()=>{if(_){let fe=setTimeout(()=>{D(!0)},100);return()=>{clearTimeout(fe)}}},[_]);let Ae=()=>{v(!0)},ie=()=>{v(!1),D(!1)};return m?o!=="intent"?[w,oe,{}]:[w,oe,{onFocus:kS(B,Ae),onBlur:kS(W,ie),onMouseEnter:kS(F,Ae),onMouseLeave:kS(X,ie),onTouchStart:kS(Q,Ae)}]:[!1,oe,{}]}function kS(o,d){return m=>{o&&o(m),m.defaultPrevented||d(m)}}function LX({page:o,...d}){let{router:m}=_F(),_=J.useMemo(()=>oF(m.routes,o,m.basename),[m.routes,o,m.basename]);return _?J.createElement(xX,{page:o,matches:_,...d}):null}function MX(o){let{manifest:d,routeModules:m}=EF(),[_,v]=J.useState([]);return J.useEffect(()=>{let w=!1;return AX(o,d,m).then(D=>{w||v(D)}),()=>{w=!0}},[o,d,m]),_}function xX({page:o,matches:d,...m}){let _=wd(),{manifest:v,routeModules:w}=EF(),{basename:D}=_F(),{loaderData:B,matches:W}=kX(),F=J.useMemo(()=>vj(o,d,W,v,_,"data"),[o,d,W,v,_]),X=J.useMemo(()=>vj(o,d,W,v,_,"assets"),[o,d,W,v,_]),Q=J.useMemo(()=>{if(o===_.pathname+_.search+_.hash)return[];let ie=new Set,fe=!1;if(d.forEach(ve=>{var _e;let be=v.routes[ve.route.id];!be||!be.hasLoader||(!F.some(Qe=>Qe.route.id===ve.route.id)&&ve.route.id in B&&((_e=w[ve.route.id])!=null&&_e.shouldRevalidate)||be.hasClientLoader?fe=!0:ie.add(ve.route.id))}),ie.size===0)return[];let ae=bX(o,D,"data");return fe&&ie.size>0&&ae.searchParams.set("_routes",d.filter(ve=>ie.has(ve.route.id)).map(ve=>ve.route.id).join(",")),[ae.pathname+ae.search]},[D,B,_,v,F,d,o,w]),oe=J.useMemo(()=>OX(X,v),[X,v]),Ae=MX(X);return J.createElement(J.Fragment,null,Q.map(ie=>J.createElement("link",{key:ie,rel:"prefetch",as:"fetch",href:ie,...m})),oe.map(ie=>J.createElement("link",{key:ie,rel:"modulepreload",href:ie,...m})),Ae.map(({key:ie,link:fe})=>J.createElement("link",{key:ie,nonce:m.nonce,...fe})))}function UX(...o){return d=>{o.forEach(m=>{typeof m=="function"?m(d):m!=null&&(m.current=d)})}}var gF=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{gF&&(window.__reactRouterVersion="7.8.2")}catch{}function VX({basename:o,children:d,window:m}){let _=J.useRef();_.current==null&&(_.current=wq({window:m,v5Compat:!0}));let v=_.current,[w,D]=J.useState({action:v.action,location:v.location}),B=J.useCallback(W=>{J.startTransition(()=>D(W))},[D]);return J.useLayoutEffect(()=>v.listen(B),[v,B]),J.createElement(fX,{basename:o,children:d,location:w.location,navigationType:w.action,navigator:v})}var yF=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,SF=J.forwardRef(function({onClick:d,discover:m="render",prefetch:_="none",relative:v,reloadDocument:w,replace:D,state:B,target:W,to:F,preventScrollReset:X,viewTransition:Q,...oe},Ae){let{basename:ie}=J.useContext(cc),fe=typeof F=="string"&&yF.test(F),ae,ve=!1;if(typeof F=="string"&&fe&&(ae=F,gF))try{let we=new URL(window.location.href),We=F.startsWith("//")?new URL(we.protocol+F):new URL(F),ct=Rd(We.pathname,ie);We.origin===we.origin&&ct!=null?F=ct+We.search+We.hash:ve=!0}catch{sc(!1,`<Link to="${F}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let be=$q(F,{relative:v}),[_e,Qe,Ye]=PX(_,oe),Et=GX(F,{replace:D,state:B,target:W,preventScrollReset:X,relative:v,viewTransition:Q});function Ge(we){d&&d(we),we.defaultPrevented||Et(we)}let Je=J.createElement("a",{...oe,...Ye,href:ae||be,onClick:ve||w?d:Ge,ref:UX(Ae,Qe),target:W,"data-discover":!fe&&m==="render"?"true":void 0});return _e&&!fe?J.createElement(J.Fragment,null,Je,J.createElement(LX,{page:be})):Je});SF.displayName="Link";var jX=J.forwardRef(function({"aria-current":d="page",caseSensitive:m=!1,className:_="",end:v=!1,style:w,to:D,viewTransition:B,children:W,...F},X){let Q=XS(D,{relative:F.relative}),oe=wd(),Ae=J.useContext(VC),{navigator:ie,basename:fe}=J.useContext(cc),ae=Ae!=null&&KX(Q)&&B===!0,ve=ie.encodeLocation?ie.encodeLocation(Q).pathname:Q.pathname,be=oe.pathname,_e=Ae&&Ae.navigation&&Ae.navigation.location?Ae.navigation.location.pathname:null;m||(be=be.toLowerCase(),_e=_e?_e.toLowerCase():null,ve=ve.toLowerCase()),_e&&fe&&(_e=Rd(_e,fe)||_e);const Qe=ve!=="/"&&ve.endsWith("/")?ve.length-1:ve.length;let Ye=be===ve||!v&&be.startsWith(ve)&&be.charAt(Qe)==="/",Et=_e!=null&&(_e===ve||!v&&_e.startsWith(ve)&&_e.charAt(ve.length)==="/"),Ge={isActive:Ye,isPending:Et,isTransitioning:ae},Je=Ye?d:void 0,we;typeof _=="function"?we=_(Ge):we=[_,Ye?"active":null,Et?"pending":null,ae?"transitioning":null].filter(Boolean).join(" ");let We=typeof w=="function"?w(Ge):w;return J.createElement(SF,{...F,"aria-current":Je,className:we,ref:X,style:We,to:D,viewTransition:B},typeof W=="function"?W(Ge):W)});jX.displayName="NavLink";var FX=J.forwardRef(({discover:o="render",fetcherKey:d,navigate:m,reloadDocument:_,replace:v,state:w,method:D=pC,action:B,onSubmit:W,relative:F,preventScrollReset:X,viewTransition:Q,...oe},Ae)=>{let ie=YX(),fe=zX(B,{relative:F}),ae=D.toLowerCase()==="get"?"get":"post",ve=typeof B=="string"&&yF.test(B),be=_e=>{if(W&&W(_e),_e.defaultPrevented)return;_e.preventDefault();let Qe=_e.nativeEvent.submitter,Ye=(Qe==null?void 0:Qe.getAttribute("formmethod"))||D;ie(Qe||_e.currentTarget,{fetcherKey:d,method:Ye,navigate:m,replace:v,state:w,relative:F,preventScrollReset:X,viewTransition:Q})};return J.createElement("form",{ref:Ae,method:ae,action:fe,onSubmit:_?W:be,...oe,"data-discover":!ve&&o==="render"?"true":void 0})});FX.displayName="Form";function BX(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function vF(o){let d=J.useContext(Y_);return Gi(d,BX(o)),d}function GX(o,{target:d,replace:m,state:_,preventScrollReset:v,relative:w,viewTransition:D}={}){let B=Ad(),W=wd(),F=XS(o,{relative:w});return J.useCallback(X=>{if(SX(X,d)){X.preventDefault();let Q=m!==void 0?m:BS(W)===BS(F);B(o,{replace:Q,state:_,preventScrollReset:v,relative:w,viewTransition:D})}},[W,B,F,m,_,d,o,v,w,D])}var HX=0,WX=()=>`__${String(++HX)}__`;function YX(){let{router:o}=vF("useSubmit"),{basename:d}=J.useContext(cc),m=dX();return J.useCallback(async(_,v={})=>{let{action:w,method:D,encType:B,formData:W,body:F}=RX(_,d);if(v.navigate===!1){let X=v.fetcherKey||WX();await o.fetch(X,m,v.action||w,{preventScrollReset:v.preventScrollReset,formData:W,body:F,formMethod:v.method||D,formEncType:v.encType||B,flushSync:v.flushSync})}else await o.navigate(v.action||w,{preventScrollReset:v.preventScrollReset,formData:W,body:F,formMethod:v.method||D,formEncType:v.encType||B,replace:v.replace,state:v.state,fromRouteId:m,flushSync:v.flushSync,viewTransition:v.viewTransition})},[o,d,m])}function zX(o,{relative:d}={}){let{basename:m}=J.useContext(cc),_=J.useContext(_l);Gi(_,"useFormAction must be used inside a RouteContext");let[v]=_.matches.slice(-1),w={...XS(o||".",{relative:d})},D=wd();if(o==null){w.search=D.search;let B=new URLSearchParams(w.search),W=B.getAll("index");if(W.some(X=>X==="")){B.delete("index"),W.filter(Q=>Q).forEach(Q=>B.append("index",Q));let X=B.toString();w.search=X?`?${X}`:""}}return(!o||o===".")&&v.route.index&&(w.search=w.search?w.search.replace(/^\?/,"?index&"):"?index"),m!=="/"&&(w.pathname=w.pathname==="/"?m:Sd([m,w.pathname])),BS(w)}function KX(o,{relative:d}={}){let m=J.useContext(uF);Gi(m!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:_}=vF("useViewTransitionState"),v=XS(o,{relative:d});if(!m.isTransitioning)return!1;let w=Rd(m.currentLocation.pathname,_)||m.currentLocation.pathname,D=Rd(m.nextLocation.pathname,_)||m.nextLocation.pathname;return OC(v.pathname,D)!=null||OC(v.pathname,w)!=null}const Eo="/assets/dp-CQFvQvjp.webp";var TF={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Tj=Qn.createContext&&Qn.createContext(TF),qX=["attr","size","title"];function XX(o,d){if(o==null)return{};var m=JX(o,d),_,v;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(o);for(v=0;v<w.length;v++)_=w[v],!(d.indexOf(_)>=0)&&Object.prototype.propertyIsEnumerable.call(o,_)&&(m[_]=o[_])}return m}function JX(o,d){if(o==null)return{};var m={};for(var _ in o)if(Object.prototype.hasOwnProperty.call(o,_)){if(d.indexOf(_)>=0)continue;m[_]=o[_]}return m}function IC(){return IC=Object.assign?Object.assign.bind():function(o){for(var d=1;d<arguments.length;d++){var m=arguments[d];for(var _ in m)Object.prototype.hasOwnProperty.call(m,_)&&(o[_]=m[_])}return o},IC.apply(this,arguments)}function Rj(o,d){var m=Object.keys(o);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(o);d&&(_=_.filter(function(v){return Object.getOwnPropertyDescriptor(o,v).enumerable})),m.push.apply(m,_)}return m}function NC(o){for(var d=1;d<arguments.length;d++){var m=arguments[d]!=null?arguments[d]:{};d%2?Rj(Object(m),!0).forEach(function(_){ZX(o,_,m[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(m)):Rj(Object(m)).forEach(function(_){Object.defineProperty(o,_,Object.getOwnPropertyDescriptor(m,_))})}return o}function ZX(o,d,m){return d=QX(d),d in o?Object.defineProperty(o,d,{value:m,enumerable:!0,configurable:!0,writable:!0}):o[d]=m,o}function QX(o){var d=$X(o,"string");return typeof d=="symbol"?d:d+""}function $X(o,d){if(typeof o!="object"||!o)return o;var m=o[Symbol.toPrimitive];if(m!==void 0){var _=m.call(o,d);if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return(d==="string"?String:Number)(o)}function RF(o){return o&&o.map((d,m)=>Qn.createElement(d.tag,NC({key:m},d.attr),RF(d.child)))}function An(o){return d=>Qn.createElement(eJ,IC({attr:NC({},o.attr)},d),RF(o.child))}function eJ(o){var d=m=>{var{attr:_,size:v,title:w}=o,D=XX(o,qX),B=v||m.size||"1em",W;return m.className&&(W=m.className),o.className&&(W=(W?W+" ":"")+o.className),Qn.createElement("svg",IC({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},m.attr,_,D,{className:W,style:NC(NC({color:o.color||m.color},m.style),o.style),height:B,width:B,xmlns:"http://www.w3.org/2000/svg"}),w&&Qn.createElement("title",null,w),o.children)};return Tj!==void 0?Qn.createElement(Tj.Consumer,null,m=>d(m)):d(TF)}function bF(o){return An({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"},child:[]},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"},child:[]}]})(o)}function tJ(o){return An({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"},child:[]},{tag:"line",attr:{x1:"4",y1:"22",x2:"4",y2:"15"},child:[]}]})(o)}function nJ(o){return An({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"},child:[]}]})(o)}function iJ(o){return An({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"},child:[]},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"},child:[]}]})(o)}function rJ(o){return An({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"},child:[]}]})(o)}function sJ(o){return An({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"},child:[]}]})(o)}function CF(o){return An({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"},child:[]},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]}]})(o)}function aJ(o){return An({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"18",cy:"5",r:"3"},child:[]},{tag:"circle",attr:{cx:"6",cy:"12",r:"3"},child:[]},{tag:"circle",attr:{cx:"18",cy:"19",r:"3"},child:[]},{tag:"line",attr:{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"},child:[]},{tag:"line",attr:{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"},child:[]}]})(o)}function oJ(o){return An({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"5"},child:[]},{tag:"line",attr:{x1:"12",y1:"1",x2:"12",y2:"3"},child:[]},{tag:"line",attr:{x1:"12",y1:"21",x2:"12",y2:"23"},child:[]},{tag:"line",attr:{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"},child:[]},{tag:"line",attr:{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"},child:[]},{tag:"line",attr:{x1:"1",y1:"12",x2:"3",y2:"12"},child:[]},{tag:"line",attr:{x1:"21",y1:"12",x2:"23",y2:"12"},child:[]},{tag:"line",attr:{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"},child:[]},{tag:"line",attr:{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"},child:[]}]})(o)}function cJ(o){return An({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"},child:[]},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"},child:[]},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"},child:[]},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"},child:[]}]})(o)}function lJ(o){return An({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"23 6 13.5 15.5 8.5 10.5 1 18"},child:[]},{tag:"polyline",attr:{points:"17 6 23 6 23 12"},child:[]}]})(o)}const go=J.createContext();function dJ({children:o}){let m={serverUrl:"http://localhost:8000"};return N.jsx("div",{children:N.jsx(go.Provider,{value:m,children:o})})}function wF(o,d){return function(){return o.apply(d,arguments)}}const{toString:uJ}=Object.prototype,{getPrototypeOf:hD}=Object,{iterator:FC,toStringTag:AF}=Symbol,BC=(o=>d=>{const m=uJ.call(d);return o[m]||(o[m]=m.slice(8,-1).toLowerCase())})(Object.create(null)),lc=o=>(o=o.toLowerCase(),d=>BC(d)===o),GC=o=>d=>typeof d===o,{isArray:K_}=Array,GS=GC("undefined");function JS(o){return o!==null&&!GS(o)&&o.constructor!==null&&!GS(o.constructor)&&ca(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const OF=lc("ArrayBuffer");function hJ(o){let d;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?d=ArrayBuffer.isView(o):d=o&&o.buffer&&OF(o.buffer),d}const pJ=GC("string"),ca=GC("function"),IF=GC("number"),ZS=o=>o!==null&&typeof o=="object",fJ=o=>o===!0||o===!1,mC=o=>{if(BC(o)!=="object")return!1;const d=hD(o);return(d===null||d===Object.prototype||Object.getPrototypeOf(d)===null)&&!(AF in o)&&!(FC in o)},mJ=o=>{if(!ZS(o)||JS(o))return!1;try{return Object.keys(o).length===0&&Object.getPrototypeOf(o)===Object.prototype}catch{return!1}},_J=lc("Date"),EJ=lc("File"),gJ=lc("Blob"),yJ=lc("FileList"),SJ=o=>ZS(o)&&ca(o.pipe),vJ=o=>{let d;return o&&(typeof FormData=="function"&&o instanceof FormData||ca(o.append)&&((d=BC(o))==="formdata"||d==="object"&&ca(o.toString)&&o.toString()==="[object FormData]"))},TJ=lc("URLSearchParams"),[RJ,bJ,CJ,wJ]=["ReadableStream","Request","Response","Headers"].map(lc),AJ=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function QS(o,d,{allOwnKeys:m=!1}={}){if(o===null||typeof o>"u")return;let _,v;if(typeof o!="object"&&(o=[o]),K_(o))for(_=0,v=o.length;_<v;_++)d.call(null,o[_],_,o);else{if(JS(o))return;const w=m?Object.getOwnPropertyNames(o):Object.keys(o),D=w.length;let B;for(_=0;_<D;_++)B=w[_],d.call(null,o[B],B,o)}}function NF(o,d){if(JS(o))return null;d=d.toLowerCase();const m=Object.keys(o);let _=m.length,v;for(;_-- >0;)if(v=m[_],d===v.toLowerCase())return v;return null}const ef=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,DF=o=>!GS(o)&&o!==ef;function M1(){const{caseless:o}=DF(this)&&this||{},d={},m=(_,v)=>{const w=o&&NF(d,v)||v;mC(d[w])&&mC(_)?d[w]=M1(d[w],_):mC(_)?d[w]=M1({},_):K_(_)?d[w]=_.slice():d[w]=_};for(let _=0,v=arguments.length;_<v;_++)arguments[_]&&QS(arguments[_],m);return d}const OJ=(o,d,m,{allOwnKeys:_}={})=>(QS(d,(v,w)=>{m&&ca(v)?o[w]=wF(v,m):o[w]=v},{allOwnKeys:_}),o),IJ=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),NJ=(o,d,m,_)=>{o.prototype=Object.create(d.prototype,_),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:d.prototype}),m&&Object.assign(o.prototype,m)},DJ=(o,d,m,_)=>{let v,w,D;const B={};if(d=d||{},o==null)return d;do{for(v=Object.getOwnPropertyNames(o),w=v.length;w-- >0;)D=v[w],(!_||_(D,o,d))&&!B[D]&&(d[D]=o[D],B[D]=!0);o=m!==!1&&hD(o)}while(o&&(!m||m(o,d))&&o!==Object.prototype);return d},kJ=(o,d,m)=>{o=String(o),(m===void 0||m>o.length)&&(m=o.length),m-=d.length;const _=o.indexOf(d,m);return _!==-1&&_===m},PJ=o=>{if(!o)return null;if(K_(o))return o;let d=o.length;if(!IF(d))return null;const m=new Array(d);for(;d-- >0;)m[d]=o[d];return m},LJ=(o=>d=>o&&d instanceof o)(typeof Uint8Array<"u"&&hD(Uint8Array)),MJ=(o,d)=>{const _=(o&&o[FC]).call(o);let v;for(;(v=_.next())&&!v.done;){const w=v.value;d.call(o,w[0],w[1])}},xJ=(o,d)=>{let m;const _=[];for(;(m=o.exec(d))!==null;)_.push(m);return _},UJ=lc("HTMLFormElement"),VJ=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(m,_,v){return _.toUpperCase()+v}),bj=(({hasOwnProperty:o})=>(d,m)=>o.call(d,m))(Object.prototype),jJ=lc("RegExp"),kF=(o,d)=>{const m=Object.getOwnPropertyDescriptors(o),_={};QS(m,(v,w)=>{let D;(D=d(v,w,o))!==!1&&(_[w]=D||v)}),Object.defineProperties(o,_)},FJ=o=>{kF(o,(d,m)=>{if(ca(o)&&["arguments","caller","callee"].indexOf(m)!==-1)return!1;const _=o[m];if(ca(_)){if(d.enumerable=!1,"writable"in d){d.writable=!1;return}d.set||(d.set=()=>{throw Error("Can not rewrite read-only method '"+m+"'")})}})},BJ=(o,d)=>{const m={},_=v=>{v.forEach(w=>{m[w]=!0})};return K_(o)?_(o):_(String(o).split(d)),m},GJ=()=>{},HJ=(o,d)=>o!=null&&Number.isFinite(o=+o)?o:d;function WJ(o){return!!(o&&ca(o.append)&&o[AF]==="FormData"&&o[FC])}const YJ=o=>{const d=new Array(10),m=(_,v)=>{if(ZS(_)){if(d.indexOf(_)>=0)return;if(JS(_))return _;if(!("toJSON"in _)){d[v]=_;const w=K_(_)?[]:{};return QS(_,(D,B)=>{const W=m(D,v+1);!GS(W)&&(w[B]=W)}),d[v]=void 0,w}}return _};return m(o,0)},zJ=lc("AsyncFunction"),KJ=o=>o&&(ZS(o)||ca(o))&&ca(o.then)&&ca(o.catch),PF=((o,d)=>o?setImmediate:d?((m,_)=>(ef.addEventListener("message",({source:v,data:w})=>{v===ef&&w===m&&_.length&&_.shift()()},!1),v=>{_.push(v),ef.postMessage(m,"*")}))(`axios@${Math.random()}`,[]):m=>setTimeout(m))(typeof setImmediate=="function",ca(ef.postMessage)),qJ=typeof queueMicrotask<"u"?queueMicrotask.bind(ef):typeof process<"u"&&process.nextTick||PF,XJ=o=>o!=null&&ca(o[FC]),Ie={isArray:K_,isArrayBuffer:OF,isBuffer:JS,isFormData:vJ,isArrayBufferView:hJ,isString:pJ,isNumber:IF,isBoolean:fJ,isObject:ZS,isPlainObject:mC,isEmptyObject:mJ,isReadableStream:RJ,isRequest:bJ,isResponse:CJ,isHeaders:wJ,isUndefined:GS,isDate:_J,isFile:EJ,isBlob:gJ,isRegExp:jJ,isFunction:ca,isStream:SJ,isURLSearchParams:TJ,isTypedArray:LJ,isFileList:yJ,forEach:QS,merge:M1,extend:OJ,trim:AJ,stripBOM:IJ,inherits:NJ,toFlatObject:DJ,kindOf:BC,kindOfTest:lc,endsWith:kJ,toArray:PJ,forEachEntry:MJ,matchAll:xJ,isHTMLForm:UJ,hasOwnProperty:bj,hasOwnProp:bj,reduceDescriptors:kF,freezeMethods:FJ,toObjectSet:BJ,toCamelCase:VJ,noop:GJ,toFiniteNumber:HJ,findKey:NF,global:ef,isContextDefined:DF,isSpecCompliantForm:WJ,toJSONObject:YJ,isAsyncFn:zJ,isThenable:KJ,setImmediate:PF,asap:qJ,isIterable:XJ};function pn(o,d,m,_,v){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",d&&(this.code=d),m&&(this.config=m),_&&(this.request=_),v&&(this.response=v,this.status=v.status?v.status:null)}Ie.inherits(pn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ie.toJSONObject(this.config),code:this.code,status:this.status}}});const LF=pn.prototype,MF={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{MF[o]={value:o}});Object.defineProperties(pn,MF);Object.defineProperty(LF,"isAxiosError",{value:!0});pn.from=(o,d,m,_,v,w)=>{const D=Object.create(LF);return Ie.toFlatObject(o,D,function(W){return W!==Error.prototype},B=>B!=="isAxiosError"),pn.call(D,o.message,d,m,_,v),D.cause=o,D.name=o.name,w&&Object.assign(D,w),D};const JJ=null;function x1(o){return Ie.isPlainObject(o)||Ie.isArray(o)}function xF(o){return Ie.endsWith(o,"[]")?o.slice(0,-2):o}function Cj(o,d,m){return o?o.concat(d).map(function(v,w){return v=xF(v),!m&&w?"["+v+"]":v}).join(m?".":""):d}function ZJ(o){return Ie.isArray(o)&&!o.some(x1)}const QJ=Ie.toFlatObject(Ie,{},null,function(d){return/^is[A-Z]/.test(d)});function HC(o,d,m){if(!Ie.isObject(o))throw new TypeError("target must be an object");d=d||new FormData,m=Ie.toFlatObject(m,{metaTokens:!0,dots:!1,indexes:!1},!1,function(fe,ae){return!Ie.isUndefined(ae[fe])});const _=m.metaTokens,v=m.visitor||X,w=m.dots,D=m.indexes,W=(m.Blob||typeof Blob<"u"&&Blob)&&Ie.isSpecCompliantForm(d);if(!Ie.isFunction(v))throw new TypeError("visitor must be a function");function F(ie){if(ie===null)return"";if(Ie.isDate(ie))return ie.toISOString();if(Ie.isBoolean(ie))return ie.toString();if(!W&&Ie.isBlob(ie))throw new pn("Blob is not supported. Use a Buffer instead.");return Ie.isArrayBuffer(ie)||Ie.isTypedArray(ie)?W&&typeof Blob=="function"?new Blob([ie]):Buffer.from(ie):ie}function X(ie,fe,ae){let ve=ie;if(ie&&!ae&&typeof ie=="object"){if(Ie.endsWith(fe,"{}"))fe=_?fe:fe.slice(0,-2),ie=JSON.stringify(ie);else if(Ie.isArray(ie)&&ZJ(ie)||(Ie.isFileList(ie)||Ie.endsWith(fe,"[]"))&&(ve=Ie.toArray(ie)))return fe=xF(fe),ve.forEach(function(_e,Qe){!(Ie.isUndefined(_e)||_e===null)&&d.append(D===!0?Cj([fe],Qe,w):D===null?fe:fe+"[]",F(_e))}),!1}return x1(ie)?!0:(d.append(Cj(ae,fe,w),F(ie)),!1)}const Q=[],oe=Object.assign(QJ,{defaultVisitor:X,convertValue:F,isVisitable:x1});function Ae(ie,fe){if(!Ie.isUndefined(ie)){if(Q.indexOf(ie)!==-1)throw Error("Circular reference detected in "+fe.join("."));Q.push(ie),Ie.forEach(ie,function(ve,be){(!(Ie.isUndefined(ve)||ve===null)&&v.call(d,ve,Ie.isString(be)?be.trim():be,fe,oe))===!0&&Ae(ve,fe?fe.concat(be):[be])}),Q.pop()}}if(!Ie.isObject(o))throw new TypeError("data must be an object");return Ae(o),d}function wj(o){const d={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(_){return d[_]})}function pD(o,d){this._pairs=[],o&&HC(o,this,d)}const UF=pD.prototype;UF.append=function(d,m){this._pairs.push([d,m])};UF.toString=function(d){const m=d?function(_){return d.call(this,_,wj)}:wj;return this._pairs.map(function(v){return m(v[0])+"="+m(v[1])},"").join("&")};function $J(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function VF(o,d,m){if(!d)return o;const _=m&&m.encode||$J;Ie.isFunction(m)&&(m={serialize:m});const v=m&&m.serialize;let w;if(v?w=v(d,m):w=Ie.isURLSearchParams(d)?d.toString():new pD(d,m).toString(_),w){const D=o.indexOf("#");D!==-1&&(o=o.slice(0,D)),o+=(o.indexOf("?")===-1?"?":"&")+w}return o}class Aj{constructor(){this.handlers=[]}use(d,m,_){return this.handlers.push({fulfilled:d,rejected:m,synchronous:_?_.synchronous:!1,runWhen:_?_.runWhen:null}),this.handlers.length-1}eject(d){this.handlers[d]&&(this.handlers[d]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(d){Ie.forEach(this.handlers,function(_){_!==null&&d(_)})}}const jF={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},eZ=typeof URLSearchParams<"u"?URLSearchParams:pD,tZ=typeof FormData<"u"?FormData:null,nZ=typeof Blob<"u"?Blob:null,iZ={isBrowser:!0,classes:{URLSearchParams:eZ,FormData:tZ,Blob:nZ},protocols:["http","https","file","blob","url","data"]},fD=typeof window<"u"&&typeof document<"u",U1=typeof navigator=="object"&&navigator||void 0,rZ=fD&&(!U1||["ReactNative","NativeScript","NS"].indexOf(U1.product)<0),sZ=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",aZ=fD&&window.location.href||"http://localhost",oZ=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:fD,hasStandardBrowserEnv:rZ,hasStandardBrowserWebWorkerEnv:sZ,navigator:U1,origin:aZ},Symbol.toStringTag,{value:"Module"})),fs={...oZ,...iZ};function cZ(o,d){return HC(o,new fs.classes.URLSearchParams,{visitor:function(m,_,v,w){return fs.isNode&&Ie.isBuffer(m)?(this.append(_,m.toString("base64")),!1):w.defaultVisitor.apply(this,arguments)},...d})}function lZ(o){return Ie.matchAll(/\w+|\[(\w*)]/g,o).map(d=>d[0]==="[]"?"":d[1]||d[0])}function dZ(o){const d={},m=Object.keys(o);let _;const v=m.length;let w;for(_=0;_<v;_++)w=m[_],d[w]=o[w];return d}function FF(o){function d(m,_,v,w){let D=m[w++];if(D==="__proto__")return!0;const B=Number.isFinite(+D),W=w>=m.length;return D=!D&&Ie.isArray(v)?v.length:D,W?(Ie.hasOwnProp(v,D)?v[D]=[v[D],_]:v[D]=_,!B):((!v[D]||!Ie.isObject(v[D]))&&(v[D]=[]),d(m,_,v[D],w)&&Ie.isArray(v[D])&&(v[D]=dZ(v[D])),!B)}if(Ie.isFormData(o)&&Ie.isFunction(o.entries)){const m={};return Ie.forEachEntry(o,(_,v)=>{d(lZ(_),v,m,0)}),m}return null}function uZ(o,d,m){if(Ie.isString(o))try{return(d||JSON.parse)(o),Ie.trim(o)}catch(_){if(_.name!=="SyntaxError")throw _}return(m||JSON.stringify)(o)}const $S={transitional:jF,adapter:["xhr","http","fetch"],transformRequest:[function(d,m){const _=m.getContentType()||"",v=_.indexOf("application/json")>-1,w=Ie.isObject(d);if(w&&Ie.isHTMLForm(d)&&(d=new FormData(d)),Ie.isFormData(d))return v?JSON.stringify(FF(d)):d;if(Ie.isArrayBuffer(d)||Ie.isBuffer(d)||Ie.isStream(d)||Ie.isFile(d)||Ie.isBlob(d)||Ie.isReadableStream(d))return d;if(Ie.isArrayBufferView(d))return d.buffer;if(Ie.isURLSearchParams(d))return m.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),d.toString();let B;if(w){if(_.indexOf("application/x-www-form-urlencoded")>-1)return cZ(d,this.formSerializer).toString();if((B=Ie.isFileList(d))||_.indexOf("multipart/form-data")>-1){const W=this.env&&this.env.FormData;return HC(B?{"files[]":d}:d,W&&new W,this.formSerializer)}}return w||v?(m.setContentType("application/json",!1),uZ(d)):d}],transformResponse:[function(d){const m=this.transitional||$S.transitional,_=m&&m.forcedJSONParsing,v=this.responseType==="json";if(Ie.isResponse(d)||Ie.isReadableStream(d))return d;if(d&&Ie.isString(d)&&(_&&!this.responseType||v)){const D=!(m&&m.silentJSONParsing)&&v;try{return JSON.parse(d)}catch(B){if(D)throw B.name==="SyntaxError"?pn.from(B,pn.ERR_BAD_RESPONSE,this,null,this.response):B}}return d}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:fs.classes.FormData,Blob:fs.classes.Blob},validateStatus:function(d){return d>=200&&d<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ie.forEach(["delete","get","head","post","put","patch"],o=>{$S.headers[o]={}});const hZ=Ie.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),pZ=o=>{const d={};let m,_,v;return o&&o.split(`
`).forEach(function(D){v=D.indexOf(":"),m=D.substring(0,v).trim().toLowerCase(),_=D.substring(v+1).trim(),!(!m||d[m]&&hZ[m])&&(m==="set-cookie"?d[m]?d[m].push(_):d[m]=[_]:d[m]=d[m]?d[m]+", "+_:_)}),d},Oj=Symbol("internals");function PS(o){return o&&String(o).trim().toLowerCase()}function _C(o){return o===!1||o==null?o:Ie.isArray(o)?o.map(_C):String(o)}function fZ(o){const d=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=m.exec(o);)d[_[1]]=_[2];return d}const mZ=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function E1(o,d,m,_,v){if(Ie.isFunction(_))return _.call(this,d,m);if(v&&(d=m),!!Ie.isString(d)){if(Ie.isString(_))return d.indexOf(_)!==-1;if(Ie.isRegExp(_))return _.test(d)}}function _Z(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(d,m,_)=>m.toUpperCase()+_)}function EZ(o,d){const m=Ie.toCamelCase(" "+d);["get","set","has"].forEach(_=>{Object.defineProperty(o,_+m,{value:function(v,w,D){return this[_].call(this,d,v,w,D)},configurable:!0})})}let la=class{constructor(d){d&&this.set(d)}set(d,m,_){const v=this;function w(B,W,F){const X=PS(W);if(!X)throw new Error("header name must be a non-empty string");const Q=Ie.findKey(v,X);(!Q||v[Q]===void 0||F===!0||F===void 0&&v[Q]!==!1)&&(v[Q||W]=_C(B))}const D=(B,W)=>Ie.forEach(B,(F,X)=>w(F,X,W));if(Ie.isPlainObject(d)||d instanceof this.constructor)D(d,m);else if(Ie.isString(d)&&(d=d.trim())&&!mZ(d))D(pZ(d),m);else if(Ie.isObject(d)&&Ie.isIterable(d)){let B={},W,F;for(const X of d){if(!Ie.isArray(X))throw TypeError("Object iterator must return a key-value pair");B[F=X[0]]=(W=B[F])?Ie.isArray(W)?[...W,X[1]]:[W,X[1]]:X[1]}D(B,m)}else d!=null&&w(m,d,_);return this}get(d,m){if(d=PS(d),d){const _=Ie.findKey(this,d);if(_){const v=this[_];if(!m)return v;if(m===!0)return fZ(v);if(Ie.isFunction(m))return m.call(this,v,_);if(Ie.isRegExp(m))return m.exec(v);throw new TypeError("parser must be boolean|regexp|function")}}}has(d,m){if(d=PS(d),d){const _=Ie.findKey(this,d);return!!(_&&this[_]!==void 0&&(!m||E1(this,this[_],_,m)))}return!1}delete(d,m){const _=this;let v=!1;function w(D){if(D=PS(D),D){const B=Ie.findKey(_,D);B&&(!m||E1(_,_[B],B,m))&&(delete _[B],v=!0)}}return Ie.isArray(d)?d.forEach(w):w(d),v}clear(d){const m=Object.keys(this);let _=m.length,v=!1;for(;_--;){const w=m[_];(!d||E1(this,this[w],w,d,!0))&&(delete this[w],v=!0)}return v}normalize(d){const m=this,_={};return Ie.forEach(this,(v,w)=>{const D=Ie.findKey(_,w);if(D){m[D]=_C(v),delete m[w];return}const B=d?_Z(w):String(w).trim();B!==w&&delete m[w],m[B]=_C(v),_[B]=!0}),this}concat(...d){return this.constructor.concat(this,...d)}toJSON(d){const m=Object.create(null);return Ie.forEach(this,(_,v)=>{_!=null&&_!==!1&&(m[v]=d&&Ie.isArray(_)?_.join(", "):_)}),m}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([d,m])=>d+": "+m).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(d){return d instanceof this?d:new this(d)}static concat(d,...m){const _=new this(d);return m.forEach(v=>_.set(v)),_}static accessor(d){const _=(this[Oj]=this[Oj]={accessors:{}}).accessors,v=this.prototype;function w(D){const B=PS(D);_[B]||(EZ(v,D),_[B]=!0)}return Ie.isArray(d)?d.forEach(w):w(d),this}};la.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ie.reduceDescriptors(la.prototype,({value:o},d)=>{let m=d[0].toUpperCase()+d.slice(1);return{get:()=>o,set(_){this[m]=_}}});Ie.freezeMethods(la);function g1(o,d){const m=this||$S,_=d||m,v=la.from(_.headers);let w=_.data;return Ie.forEach(o,function(B){w=B.call(m,w,v.normalize(),d?d.status:void 0)}),v.normalize(),w}function BF(o){return!!(o&&o.__CANCEL__)}function q_(o,d,m){pn.call(this,o??"canceled",pn.ERR_CANCELED,d,m),this.name="CanceledError"}Ie.inherits(q_,pn,{__CANCEL__:!0});function GF(o,d,m){const _=m.config.validateStatus;!m.status||!_||_(m.status)?o(m):d(new pn("Request failed with status code "+m.status,[pn.ERR_BAD_REQUEST,pn.ERR_BAD_RESPONSE][Math.floor(m.status/100)-4],m.config,m.request,m))}function gZ(o){const d=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return d&&d[1]||""}function yZ(o,d){o=o||10;const m=new Array(o),_=new Array(o);let v=0,w=0,D;return d=d!==void 0?d:1e3,function(W){const F=Date.now(),X=_[w];D||(D=F),m[v]=W,_[v]=F;let Q=w,oe=0;for(;Q!==v;)oe+=m[Q++],Q=Q%o;if(v=(v+1)%o,v===w&&(w=(w+1)%o),F-D<d)return;const Ae=X&&F-X;return Ae?Math.round(oe*1e3/Ae):void 0}}function SZ(o,d){let m=0,_=1e3/d,v,w;const D=(F,X=Date.now())=>{m=X,v=null,w&&(clearTimeout(w),w=null),o(...F)};return[(...F)=>{const X=Date.now(),Q=X-m;Q>=_?D(F,X):(v=F,w||(w=setTimeout(()=>{w=null,D(v)},_-Q)))},()=>v&&D(v)]}const DC=(o,d,m=3)=>{let _=0;const v=yZ(50,250);return SZ(w=>{const D=w.loaded,B=w.lengthComputable?w.total:void 0,W=D-_,F=v(W),X=D<=B;_=D;const Q={loaded:D,total:B,progress:B?D/B:void 0,bytes:W,rate:F||void 0,estimated:F&&B&&X?(B-D)/F:void 0,event:w,lengthComputable:B!=null,[d?"download":"upload"]:!0};o(Q)},m)},Ij=(o,d)=>{const m=o!=null;return[_=>d[0]({lengthComputable:m,total:o,loaded:_}),d[1]]},Nj=o=>(...d)=>Ie.asap(()=>o(...d)),vZ=fs.hasStandardBrowserEnv?((o,d)=>m=>(m=new URL(m,fs.origin),o.protocol===m.protocol&&o.host===m.host&&(d||o.port===m.port)))(new URL(fs.origin),fs.navigator&&/(msie|trident)/i.test(fs.navigator.userAgent)):()=>!0,TZ=fs.hasStandardBrowserEnv?{write(o,d,m,_,v,w){const D=[o+"="+encodeURIComponent(d)];Ie.isNumber(m)&&D.push("expires="+new Date(m).toGMTString()),Ie.isString(_)&&D.push("path="+_),Ie.isString(v)&&D.push("domain="+v),w===!0&&D.push("secure"),document.cookie=D.join("; ")},read(o){const d=document.cookie.match(new RegExp("(^|;\\s*)("+o+")=([^;]*)"));return d?decodeURIComponent(d[3]):null},remove(o){this.write(o,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function RZ(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function bZ(o,d){return d?o.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):o}function HF(o,d,m){let _=!RZ(d);return o&&(_||m==!1)?bZ(o,d):d}const Dj=o=>o instanceof la?{...o}:o;function of(o,d){d=d||{};const m={};function _(F,X,Q,oe){return Ie.isPlainObject(F)&&Ie.isPlainObject(X)?Ie.merge.call({caseless:oe},F,X):Ie.isPlainObject(X)?Ie.merge({},X):Ie.isArray(X)?X.slice():X}function v(F,X,Q,oe){if(Ie.isUndefined(X)){if(!Ie.isUndefined(F))return _(void 0,F,Q,oe)}else return _(F,X,Q,oe)}function w(F,X){if(!Ie.isUndefined(X))return _(void 0,X)}function D(F,X){if(Ie.isUndefined(X)){if(!Ie.isUndefined(F))return _(void 0,F)}else return _(void 0,X)}function B(F,X,Q){if(Q in d)return _(F,X);if(Q in o)return _(void 0,F)}const W={url:w,method:w,data:w,baseURL:D,transformRequest:D,transformResponse:D,paramsSerializer:D,timeout:D,timeoutMessage:D,withCredentials:D,withXSRFToken:D,adapter:D,responseType:D,xsrfCookieName:D,xsrfHeaderName:D,onUploadProgress:D,onDownloadProgress:D,decompress:D,maxContentLength:D,maxBodyLength:D,beforeRedirect:D,transport:D,httpAgent:D,httpsAgent:D,cancelToken:D,socketPath:D,responseEncoding:D,validateStatus:B,headers:(F,X,Q)=>v(Dj(F),Dj(X),Q,!0)};return Ie.forEach(Object.keys({...o,...d}),function(X){const Q=W[X]||v,oe=Q(o[X],d[X],X);Ie.isUndefined(oe)&&Q!==B||(m[X]=oe)}),m}const WF=o=>{const d=of({},o);let{data:m,withXSRFToken:_,xsrfHeaderName:v,xsrfCookieName:w,headers:D,auth:B}=d;d.headers=D=la.from(D),d.url=VF(HF(d.baseURL,d.url,d.allowAbsoluteUrls),o.params,o.paramsSerializer),B&&D.set("Authorization","Basic "+btoa((B.username||"")+":"+(B.password?unescape(encodeURIComponent(B.password)):"")));let W;if(Ie.isFormData(m)){if(fs.hasStandardBrowserEnv||fs.hasStandardBrowserWebWorkerEnv)D.setContentType(void 0);else if((W=D.getContentType())!==!1){const[F,...X]=W?W.split(";").map(Q=>Q.trim()).filter(Boolean):[];D.setContentType([F||"multipart/form-data",...X].join("; "))}}if(fs.hasStandardBrowserEnv&&(_&&Ie.isFunction(_)&&(_=_(d)),_||_!==!1&&vZ(d.url))){const F=v&&w&&TZ.read(w);F&&D.set(v,F)}return d},CZ=typeof XMLHttpRequest<"u",wZ=CZ&&function(o){return new Promise(function(m,_){const v=WF(o);let w=v.data;const D=la.from(v.headers).normalize();let{responseType:B,onUploadProgress:W,onDownloadProgress:F}=v,X,Q,oe,Ae,ie;function fe(){Ae&&Ae(),ie&&ie(),v.cancelToken&&v.cancelToken.unsubscribe(X),v.signal&&v.signal.removeEventListener("abort",X)}let ae=new XMLHttpRequest;ae.open(v.method.toUpperCase(),v.url,!0),ae.timeout=v.timeout;function ve(){if(!ae)return;const _e=la.from("getAllResponseHeaders"in ae&&ae.getAllResponseHeaders()),Ye={data:!B||B==="text"||B==="json"?ae.responseText:ae.response,status:ae.status,statusText:ae.statusText,headers:_e,config:o,request:ae};GF(function(Ge){m(Ge),fe()},function(Ge){_(Ge),fe()},Ye),ae=null}"onloadend"in ae?ae.onloadend=ve:ae.onreadystatechange=function(){!ae||ae.readyState!==4||ae.status===0&&!(ae.responseURL&&ae.responseURL.indexOf("file:")===0)||setTimeout(ve)},ae.onabort=function(){ae&&(_(new pn("Request aborted",pn.ECONNABORTED,o,ae)),ae=null)},ae.onerror=function(){_(new pn("Network Error",pn.ERR_NETWORK,o,ae)),ae=null},ae.ontimeout=function(){let Qe=v.timeout?"timeout of "+v.timeout+"ms exceeded":"timeout exceeded";const Ye=v.transitional||jF;v.timeoutErrorMessage&&(Qe=v.timeoutErrorMessage),_(new pn(Qe,Ye.clarifyTimeoutError?pn.ETIMEDOUT:pn.ECONNABORTED,o,ae)),ae=null},w===void 0&&D.setContentType(null),"setRequestHeader"in ae&&Ie.forEach(D.toJSON(),function(Qe,Ye){ae.setRequestHeader(Ye,Qe)}),Ie.isUndefined(v.withCredentials)||(ae.withCredentials=!!v.withCredentials),B&&B!=="json"&&(ae.responseType=v.responseType),F&&([oe,ie]=DC(F,!0),ae.addEventListener("progress",oe)),W&&ae.upload&&([Q,Ae]=DC(W),ae.upload.addEventListener("progress",Q),ae.upload.addEventListener("loadend",Ae)),(v.cancelToken||v.signal)&&(X=_e=>{ae&&(_(!_e||_e.type?new q_(null,o,ae):_e),ae.abort(),ae=null)},v.cancelToken&&v.cancelToken.subscribe(X),v.signal&&(v.signal.aborted?X():v.signal.addEventListener("abort",X)));const be=gZ(v.url);if(be&&fs.protocols.indexOf(be)===-1){_(new pn("Unsupported protocol "+be+":",pn.ERR_BAD_REQUEST,o));return}ae.send(w||null)})},AZ=(o,d)=>{const{length:m}=o=o?o.filter(Boolean):[];if(d||m){let _=new AbortController,v;const w=function(F){if(!v){v=!0,B();const X=F instanceof Error?F:this.reason;_.abort(X instanceof pn?X:new q_(X instanceof Error?X.message:X))}};let D=d&&setTimeout(()=>{D=null,w(new pn(`timeout ${d} of ms exceeded`,pn.ETIMEDOUT))},d);const B=()=>{o&&(D&&clearTimeout(D),D=null,o.forEach(F=>{F.unsubscribe?F.unsubscribe(w):F.removeEventListener("abort",w)}),o=null)};o.forEach(F=>F.addEventListener("abort",w));const{signal:W}=_;return W.unsubscribe=()=>Ie.asap(B),W}},OZ=function*(o,d){let m=o.byteLength;if(m<d){yield o;return}let _=0,v;for(;_<m;)v=_+d,yield o.slice(_,v),_=v},IZ=async function*(o,d){for await(const m of NZ(o))yield*OZ(m,d)},NZ=async function*(o){if(o[Symbol.asyncIterator]){yield*o;return}const d=o.getReader();try{for(;;){const{done:m,value:_}=await d.read();if(m)break;yield _}}finally{await d.cancel()}},kj=(o,d,m,_)=>{const v=IZ(o,d);let w=0,D,B=W=>{D||(D=!0,_&&_(W))};return new ReadableStream({async pull(W){try{const{done:F,value:X}=await v.next();if(F){B(),W.close();return}let Q=X.byteLength;if(m){let oe=w+=Q;m(oe)}W.enqueue(new Uint8Array(X))}catch(F){throw B(F),F}},cancel(W){return B(W),v.return()}},{highWaterMark:2})},WC=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",YF=WC&&typeof ReadableStream=="function",DZ=WC&&(typeof TextEncoder=="function"?(o=>d=>o.encode(d))(new TextEncoder):async o=>new Uint8Array(await new Response(o).arrayBuffer())),zF=(o,...d)=>{try{return!!o(...d)}catch{return!1}},kZ=YF&&zF(()=>{let o=!1;const d=new Request(fs.origin,{body:new ReadableStream,method:"POST",get duplex(){return o=!0,"half"}}).headers.has("Content-Type");return o&&!d}),Pj=64*1024,V1=YF&&zF(()=>Ie.isReadableStream(new Response("").body)),kC={stream:V1&&(o=>o.body)};WC&&(o=>{["text","arrayBuffer","blob","formData","stream"].forEach(d=>{!kC[d]&&(kC[d]=Ie.isFunction(o[d])?m=>m[d]():(m,_)=>{throw new pn(`Response type '${d}' is not supported`,pn.ERR_NOT_SUPPORT,_)})})})(new Response);const PZ=async o=>{if(o==null)return 0;if(Ie.isBlob(o))return o.size;if(Ie.isSpecCompliantForm(o))return(await new Request(fs.origin,{method:"POST",body:o}).arrayBuffer()).byteLength;if(Ie.isArrayBufferView(o)||Ie.isArrayBuffer(o))return o.byteLength;if(Ie.isURLSearchParams(o)&&(o=o+""),Ie.isString(o))return(await DZ(o)).byteLength},LZ=async(o,d)=>{const m=Ie.toFiniteNumber(o.getContentLength());return m??PZ(d)},MZ=WC&&(async o=>{let{url:d,method:m,data:_,signal:v,cancelToken:w,timeout:D,onDownloadProgress:B,onUploadProgress:W,responseType:F,headers:X,withCredentials:Q="same-origin",fetchOptions:oe}=WF(o);F=F?(F+"").toLowerCase():"text";let Ae=AZ([v,w&&w.toAbortSignal()],D),ie;const fe=Ae&&Ae.unsubscribe&&(()=>{Ae.unsubscribe()});let ae;try{if(W&&kZ&&m!=="get"&&m!=="head"&&(ae=await LZ(X,_))!==0){let Ye=new Request(d,{method:"POST",body:_,duplex:"half"}),Et;if(Ie.isFormData(_)&&(Et=Ye.headers.get("content-type"))&&X.setContentType(Et),Ye.body){const[Ge,Je]=Ij(ae,DC(Nj(W)));_=kj(Ye.body,Pj,Ge,Je)}}Ie.isString(Q)||(Q=Q?"include":"omit");const ve="credentials"in Request.prototype;ie=new Request(d,{...oe,signal:Ae,method:m.toUpperCase(),headers:X.normalize().toJSON(),body:_,duplex:"half",credentials:ve?Q:void 0});let be=await fetch(ie,oe);const _e=V1&&(F==="stream"||F==="response");if(V1&&(B||_e&&fe)){const Ye={};["status","statusText","headers"].forEach(we=>{Ye[we]=be[we]});const Et=Ie.toFiniteNumber(be.headers.get("content-length")),[Ge,Je]=B&&Ij(Et,DC(Nj(B),!0))||[];be=new Response(kj(be.body,Pj,Ge,()=>{Je&&Je(),fe&&fe()}),Ye)}F=F||"text";let Qe=await kC[Ie.findKey(kC,F)||"text"](be,o);return!_e&&fe&&fe(),await new Promise((Ye,Et)=>{GF(Ye,Et,{data:Qe,headers:la.from(be.headers),status:be.status,statusText:be.statusText,config:o,request:ie})})}catch(ve){throw fe&&fe(),ve&&ve.name==="TypeError"&&/Load failed|fetch/i.test(ve.message)?Object.assign(new pn("Network Error",pn.ERR_NETWORK,o,ie),{cause:ve.cause||ve}):pn.from(ve,ve&&ve.code,o,ie)}}),j1={http:JJ,xhr:wZ,fetch:MZ};Ie.forEach(j1,(o,d)=>{if(o){try{Object.defineProperty(o,"name",{value:d})}catch{}Object.defineProperty(o,"adapterName",{value:d})}});const Lj=o=>`- ${o}`,xZ=o=>Ie.isFunction(o)||o===null||o===!1,KF={getAdapter:o=>{o=Ie.isArray(o)?o:[o];const{length:d}=o;let m,_;const v={};for(let w=0;w<d;w++){m=o[w];let D;if(_=m,!xZ(m)&&(_=j1[(D=String(m)).toLowerCase()],_===void 0))throw new pn(`Unknown adapter '${D}'`);if(_)break;v[D||"#"+w]=_}if(!_){const w=Object.entries(v).map(([B,W])=>`adapter ${B} `+(W===!1?"is not supported by the environment":"is not available in the build"));let D=d?w.length>1?`since :
`+w.map(Lj).join(`
`):" "+Lj(w[0]):"as no adapter specified";throw new pn("There is no suitable adapter to dispatch the request "+D,"ERR_NOT_SUPPORT")}return _},adapters:j1};function y1(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new q_(null,o)}function Mj(o){return y1(o),o.headers=la.from(o.headers),o.data=g1.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),KF.getAdapter(o.adapter||$S.adapter)(o).then(function(_){return y1(o),_.data=g1.call(o,o.transformResponse,_),_.headers=la.from(_.headers),_},function(_){return BF(_)||(y1(o),_&&_.response&&(_.response.data=g1.call(o,o.transformResponse,_.response),_.response.headers=la.from(_.response.headers))),Promise.reject(_)})}const qF="1.11.0",YC={};["object","boolean","number","function","string","symbol"].forEach((o,d)=>{YC[o]=function(_){return typeof _===o||"a"+(d<1?"n ":" ")+o}});const xj={};YC.transitional=function(d,m,_){function v(w,D){return"[Axios v"+qF+"] Transitional option '"+w+"'"+D+(_?". "+_:"")}return(w,D,B)=>{if(d===!1)throw new pn(v(D," has been removed"+(m?" in "+m:"")),pn.ERR_DEPRECATED);return m&&!xj[D]&&(xj[D]=!0,console.warn(v(D," has been deprecated since v"+m+" and will be removed in the near future"))),d?d(w,D,B):!0}};YC.spelling=function(d){return(m,_)=>(console.warn(`${_} is likely a misspelling of ${d}`),!0)};function UZ(o,d,m){if(typeof o!="object")throw new pn("options must be an object",pn.ERR_BAD_OPTION_VALUE);const _=Object.keys(o);let v=_.length;for(;v-- >0;){const w=_[v],D=d[w];if(D){const B=o[w],W=B===void 0||D(B,w,o);if(W!==!0)throw new pn("option "+w+" must be "+W,pn.ERR_BAD_OPTION_VALUE);continue}if(m!==!0)throw new pn("Unknown option "+w,pn.ERR_BAD_OPTION)}}const EC={assertOptions:UZ,validators:YC},ul=EC.validators;let nf=class{constructor(d){this.defaults=d||{},this.interceptors={request:new Aj,response:new Aj}}async request(d,m){try{return await this._request(d,m)}catch(_){if(_ instanceof Error){let v={};Error.captureStackTrace?Error.captureStackTrace(v):v=new Error;const w=v.stack?v.stack.replace(/^.+\n/,""):"";try{_.stack?w&&!String(_.stack).endsWith(w.replace(/^.+\n.+\n/,""))&&(_.stack+=`
`+w):_.stack=w}catch{}}throw _}}_request(d,m){typeof d=="string"?(m=m||{},m.url=d):m=d||{},m=of(this.defaults,m);const{transitional:_,paramsSerializer:v,headers:w}=m;_!==void 0&&EC.assertOptions(_,{silentJSONParsing:ul.transitional(ul.boolean),forcedJSONParsing:ul.transitional(ul.boolean),clarifyTimeoutError:ul.transitional(ul.boolean)},!1),v!=null&&(Ie.isFunction(v)?m.paramsSerializer={serialize:v}:EC.assertOptions(v,{encode:ul.function,serialize:ul.function},!0)),m.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?m.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:m.allowAbsoluteUrls=!0),EC.assertOptions(m,{baseUrl:ul.spelling("baseURL"),withXsrfToken:ul.spelling("withXSRFToken")},!0),m.method=(m.method||this.defaults.method||"get").toLowerCase();let D=w&&Ie.merge(w.common,w[m.method]);w&&Ie.forEach(["delete","get","head","post","put","patch","common"],ie=>{delete w[ie]}),m.headers=la.concat(D,w);const B=[];let W=!0;this.interceptors.request.forEach(function(fe){typeof fe.runWhen=="function"&&fe.runWhen(m)===!1||(W=W&&fe.synchronous,B.unshift(fe.fulfilled,fe.rejected))});const F=[];this.interceptors.response.forEach(function(fe){F.push(fe.fulfilled,fe.rejected)});let X,Q=0,oe;if(!W){const ie=[Mj.bind(this),void 0];for(ie.unshift(...B),ie.push(...F),oe=ie.length,X=Promise.resolve(m);Q<oe;)X=X.then(ie[Q++],ie[Q++]);return X}oe=B.length;let Ae=m;for(Q=0;Q<oe;){const ie=B[Q++],fe=B[Q++];try{Ae=ie(Ae)}catch(ae){fe.call(this,ae);break}}try{X=Mj.call(this,Ae)}catch(ie){return Promise.reject(ie)}for(Q=0,oe=F.length;Q<oe;)X=X.then(F[Q++],F[Q++]);return X}getUri(d){d=of(this.defaults,d);const m=HF(d.baseURL,d.url,d.allowAbsoluteUrls);return VF(m,d.params,d.paramsSerializer)}};Ie.forEach(["delete","get","head","options"],function(d){nf.prototype[d]=function(m,_){return this.request(of(_||{},{method:d,url:m,data:(_||{}).data}))}});Ie.forEach(["post","put","patch"],function(d){function m(_){return function(w,D,B){return this.request(of(B||{},{method:d,headers:_?{"Content-Type":"multipart/form-data"}:{},url:w,data:D}))}}nf.prototype[d]=m(),nf.prototype[d+"Form"]=m(!0)});let VZ=class XF{constructor(d){if(typeof d!="function")throw new TypeError("executor must be a function.");let m;this.promise=new Promise(function(w){m=w});const _=this;this.promise.then(v=>{if(!_._listeners)return;let w=_._listeners.length;for(;w-- >0;)_._listeners[w](v);_._listeners=null}),this.promise.then=v=>{let w;const D=new Promise(B=>{_.subscribe(B),w=B}).then(v);return D.cancel=function(){_.unsubscribe(w)},D},d(function(w,D,B){_.reason||(_.reason=new q_(w,D,B),m(_.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(d){if(this.reason){d(this.reason);return}this._listeners?this._listeners.push(d):this._listeners=[d]}unsubscribe(d){if(!this._listeners)return;const m=this._listeners.indexOf(d);m!==-1&&this._listeners.splice(m,1)}toAbortSignal(){const d=new AbortController,m=_=>{d.abort(_)};return this.subscribe(m),d.signal.unsubscribe=()=>this.unsubscribe(m),d.signal}static source(){let d;return{token:new XF(function(v){d=v}),cancel:d}}};function jZ(o){return function(m){return o.apply(null,m)}}function FZ(o){return Ie.isObject(o)&&o.isAxiosError===!0}const F1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(F1).forEach(([o,d])=>{F1[d]=o});function JF(o){const d=new nf(o),m=wF(nf.prototype.request,d);return Ie.extend(m,nf.prototype,d,{allOwnKeys:!0}),Ie.extend(m,d,null,{allOwnKeys:!0}),m.create=function(v){return JF(of(o,v))},m}const wt=JF($S);wt.Axios=nf;wt.CanceledError=q_;wt.CancelToken=VZ;wt.isCancel=BF;wt.VERSION=qF;wt.toFormData=HC;wt.AxiosError=pn;wt.Cancel=wt.CanceledError;wt.all=function(d){return Promise.all(d)};wt.spread=jZ;wt.isAxiosError=FZ;wt.mergeConfig=of;wt.AxiosHeaders=la;wt.formToJSON=o=>FF(Ie.isHTMLForm(o)?new FormData(o):o);wt.getAdapter=KF.getAdapter;wt.HttpStatusCode=F1;wt.default=wt;const{Axios:Vre,AxiosError:jre,CanceledError:Fre,isCancel:Bre,CancelToken:Gre,VERSION:Hre,all:Wre,Cancel:Yre,isAxiosError:zre,spread:Kre,toFormData:qre,AxiosHeaders:Xre,HttpStatusCode:Jre,formToJSON:Zre,getAdapter:Qre,mergeConfig:$re}=wt,dc=J.createContext();function BZ({children:o}){const[d,m]=J.useState(null),[_,v]=J.useState(!1),[w,D]=J.useState([]),[B,W]=J.useState(null),{serverUrl:F}=J.useContext(go),X=Ad(),Q=async()=>{try{const ie=await wt.get(`${F}/api/user/currentuser`,{withCredentials:!0});m(ie.data)}catch(ie){console.error(ie),m(null)}},oe=async()=>{try{const ie=await wt.get(`${F}/api/post/getpost`,{withCredentials:!0});D(ie.data)}catch(ie){console.error(ie)}},Ae=async ie=>{try{const fe=await wt.get(`${F}/api/user/profile/${ie}`,{withCredentials:!0});W(fe.data),X("/profile")}catch(fe){console.error(fe)}};return J.useEffect(()=>{Q(),oe()},[]),N.jsx(dc.Provider,{value:{userData:d,setUserData:m,edit:_,setEdit:v,postData:w,setPostData:D,getPost:oe,handleGetProfile:Ae,profileData:B,setProfileData:W},children:o})}function rf(o){return An({attr:{viewBox:"0 0 15 15",fill:"none"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M12.8536 2.85355C13.0488 2.65829 13.0488 2.34171 12.8536 2.14645C12.6583 1.95118 12.3417 1.95118 12.1464 2.14645L7.5 6.79289L2.85355 2.14645C2.65829 1.95118 2.34171 1.95118 2.14645 2.14645C1.95118 2.34171 1.95118 2.65829 2.14645 2.85355L6.79289 7.5L2.14645 12.1464C1.95118 12.3417 1.95118 12.6583 2.14645 12.8536C2.34171 13.0488 2.65829 13.0488 2.85355 12.8536L7.5 8.20711L12.1464 12.8536C12.3417 13.0488 12.6583 13.0488 12.8536 12.8536C13.0488 12.6583 13.0488 12.3417 12.8536 12.1464L8.20711 7.5L12.8536 2.85355Z",fill:"currentColor"},child:[]}]})(o)}function GZ(o){return An({attr:{viewBox:"0 0 15 15",fill:"none"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M0.877075 7.49988C0.877075 3.84219 3.84222 0.877045 7.49991 0.877045C11.1576 0.877045 14.1227 3.84219 14.1227 7.49988C14.1227 11.1575 11.1576 14.1227 7.49991 14.1227C3.84222 14.1227 0.877075 11.1575 0.877075 7.49988ZM7.49991 1.82704C4.36689 1.82704 1.82708 4.36686 1.82708 7.49988C1.82708 10.6329 4.36689 13.1727 7.49991 13.1727C10.6329 13.1727 13.1727 10.6329 13.1727 7.49988C13.1727 4.36686 10.6329 1.82704 7.49991 1.82704ZM9.85358 5.14644C10.0488 5.3417 10.0488 5.65829 9.85358 5.85355L8.20713 7.49999L9.85358 9.14644C10.0488 9.3417 10.0488 9.65829 9.85358 9.85355C9.65832 10.0488 9.34173 10.0488 9.14647 9.85355L7.50002 8.2071L5.85358 9.85355C5.65832 10.0488 5.34173 10.0488 5.14647 9.85355C4.95121 9.65829 4.95121 9.3417 5.14647 9.14644L6.79292 7.49999L5.14647 5.85355C4.95121 5.65829 4.95121 5.3417 5.14647 5.14644C5.34173 4.95118 5.65832 4.95118 5.85358 5.14644L7.50002 6.79289L9.14647 5.14644C9.34173 4.95118 9.65832 4.95118 9.85358 5.14644Z",fill:"currentColor"},child:[]}]})(o)}function ZF(){const{edit:o,setEdit:d,userData:m,setUserData:_}=J.useContext(dc),{serverUrl:v}=J.useContext(go),[w,D]=J.useState(m.firstName||""),[B,W]=J.useState(m.lastName||""),[F,X]=J.useState(m.userName||""),[Q,oe]=J.useState(m.headline||""),[Ae,ie]=J.useState(m.location||""),[fe,ae]=J.useState(m.gender||""),[ve,be]=J.useState(m.skills||[]),[_e,Qe]=J.useState(""),[Ye,Et]=J.useState(m.education||[]),[Ge,Je]=J.useState({college:"",degree:"",fieldOfStudy:""}),[we,We]=J.useState(m.experience||[]),[ct,Tt]=J.useState({title:"",company:"",description:""}),[rn,fn]=J.useState(m.profileImage||Eo),[bn,De]=J.useState(null),[Ue,rt]=J.useState(m.coverImage||null),[sn,ne]=J.useState(null),[Ke,gt]=J.useState(!1),bt=J.useRef(),it=J.useRef(),en=Ze=>{Ze.preventDefault(),_e&&!ve.includes(_e)&&be([...ve,_e]),Qe("")},Nt=Ze=>{be(ve.filter(St=>St!==Ze))},ke=Ze=>{Ze.preventDefault(),Ge.college&&Ge.degree&&Ge.fieldOfStudy&&Et([...Ye,Ge]),Je({college:"",degree:"",fieldOfStudy:""})},qe=Ze=>{Et(Ye.filter(St=>St!==Ze))},qt=Ze=>{Ze.preventDefault(),ct.title&&ct.company&&ct.description&&We([...we,ct]),Tt({title:"",company:"",description:""})},an=Ze=>{We(we.filter(St=>St!==Ze))},br=Ze=>{let St=Ze.target.files[0];De(St),fn(URL.createObjectURL(St))},da=Ze=>{let St=Ze.target.files[0];ne(St),rt(URL.createObjectURL(St))},at=async()=>{gt(!0);try{let Ze=new FormData;Ze.append("firstName",w),Ze.append("lastName",B),Ze.append("userName",F),Ze.append("headline",Q),Ze.append("location",Ae),Ze.append("skills",JSON.stringify(ve)),Ze.append("education",JSON.stringify(Ye)),Ze.append("experience",JSON.stringify(we)),bn&&Ze.append("profileImage",bn),sn&&Ze.append("coverImage",sn);let St=await wt.put(v+"/api/user/updateprofile",Ze,{withCredentials:!0});_(St.data),gt(!1),d(!1)}catch(Ze){console.log(Ze),gt(!1)}};return N.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[N.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:()=>d(!1)}),N.jsx("input",{type:"file",accept:"image/*",hidden:!0,ref:bt,onChange:br}),N.jsx("input",{type:"file",accept:"image/*",hidden:!0,ref:it,onChange:da}),N.jsxs("div",{className:"relative z-50 w-[90%] max-w-[600px] h-[90vh] bg-[#1A1F71] shadow-2xl rounded-2xl overflow-y-auto p-5 text-white",children:[N.jsx("button",{className:"absolute top-4 right-4 p-1 rounded-full hover:bg-gray-700 transition",onClick:()=>d(!1),children:N.jsx(rf,{className:"w-6 h-6 text-white"})}),N.jsxs("div",{className:"relative w-full h-40 rounded-lg overflow-hidden cursor-pointer group",onClick:()=>it.current.click(),children:[Ue&&N.jsx("img",{src:Ue,alt:"cover",className:"w-full h-full object-cover"}),N.jsx(bF,{className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-yellow-400 text-2xl opacity-80 group-hover:opacity-100"})]}),N.jsxs("div",{className:"relative w-20 h-20 rounded-full overflow-hidden border-4 border-yellow-400 shadow-lg -mt-10 ml-5 cursor-pointer",onClick:()=>bt.current.click(),children:[N.jsx("img",{src:rn,alt:"profile",className:"w-full h-full object-cover"}),N.jsx("div",{className:"absolute bottom-0 right-0 bg-yellow-400 p-1 rounded-full",children:N.jsx(CF,{className:"text-white"})})]}),N.jsxs("div",{className:"mt-6 space-y-4",children:[[{placeholder:"First Name",value:w,setter:D},{placeholder:"Last Name",value:B,setter:W},{placeholder:"Username",value:F,setter:X},{placeholder:"Headline",value:Q,setter:oe},{placeholder:"Location",value:Ae,setter:ie},{placeholder:"Gender",value:fe,setter:ae}].map((Ze,St)=>N.jsx("input",{type:"text",placeholder:Ze.placeholder,value:Ze.value,onChange:Ht=>Ze.setter(Ht.target.value),className:"w-full p-3 rounded-lg bg-[#2C2C2C] text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-400"},St)),N.jsxs(S1,{title:"Skills",color:"yellow",children:[ve.map((Ze,St)=>N.jsx(HZ,{skill:Ze,onRemove:Nt,color:"yellow"},St)),N.jsx(WZ,{placeholder:"Add new skill",value:_e,onChange:Qe,onAdd:en,color:"yellow"})]}),N.jsxs(S1,{title:"Education",color:"yellow",children:[Ye.map((Ze,St)=>N.jsx(Uj,{data:Ze,onRemove:()=>qe(Ze),color:"yellow"},St)),N.jsx(Vj,{fields:[{placeholder:"College",value:Ge.college,setter:Ze=>Je({...Ge,college:Ze})},{placeholder:"Degree",value:Ge.degree,setter:Ze=>Je({...Ge,degree:Ze})},{placeholder:"Field of Study",value:Ge.fieldOfStudy,setter:Ze=>Je({...Ge,fieldOfStudy:Ze})}],onAdd:ke,color:"yellow"})]}),N.jsxs(S1,{title:"Experience",color:"yellow",children:[we.map((Ze,St)=>N.jsx(Uj,{data:Ze,onRemove:()=>an(Ze),color:"yellow"},St)),N.jsx(Vj,{fields:[{placeholder:"Title",value:ct.title,setter:Ze=>Tt({...ct,title:Ze})},{placeholder:"Company",value:ct.company,setter:Ze=>Tt({...ct,company:Ze})},{placeholder:"Description",value:ct.description,setter:Ze=>Tt({...ct,description:Ze})}],onAdd:qt,color:"yellow"})]}),N.jsx("button",{onClick:at,disabled:Ke,className:"w-full p-3 bg-yellow-400 text-[#1A1F71] font-bold rounded-full hover:scale-105 transition",children:Ke?"Saving...":"Save Profile"})]})]})]})}function S1({title:o,children:d,color:m}){return N.jsxs("div",{className:"p-4 rounded-lg bg-[#2C2C2C] space-y-3 border border-gray-600",children:[N.jsx("h1",{className:`font-semibold text-lg text-${m}-400`,children:o}),d]})}function HZ({skill:o,onRemove:d,color:m}){return N.jsxs("div",{className:"flex justify-between items-center p-2 bg-[#1F2561] rounded-lg",children:[N.jsx("span",{children:o}),N.jsx(rf,{onClick:()=>d(o),className:`w-4 h-4 cursor-pointer text-${m}-400`})]})}function Uj({data:o,onRemove:d,color:m}){return N.jsxs("div",{className:"flex justify-between items-start p-2 bg-[#1F2561] rounded-lg",children:[N.jsx("div",{className:"text-sm space-y-1",children:Object.entries(o).map(([_,v])=>N.jsxs("div",{className:"capitalize text-white",children:[_,": ",v]},_))}),N.jsx(rf,{onClick:d,className:`w-4 h-4 cursor-pointer text-${m}-400`})]})}function WZ({placeholder:o,value:d,onChange:m,onAdd:_,color:v}){return N.jsxs("div",{className:"space-y-2",children:[N.jsx("input",{type:"text",placeholder:o,value:d,onChange:w=>m(w.target.value),className:"w-full p-2 rounded-lg bg-[#2C2C2C] text-white placeholder-gray-300 focus:ring-2 focus:ring-yellow-400 outline-none"}),N.jsx("button",{onClick:_,className:"w-full p-2 rounded-full border border-yellow-400 text-yellow-400 hover:bg-yellow-50",children:"Add"})]})}function Vj({fields:o,onAdd:d,color:m}){return N.jsxs("div",{className:"space-y-2",children:[o.map((_,v)=>N.jsx("input",{type:"text",placeholder:_.placeholder,value:_.value,onChange:w=>_.setter(w.target.value),className:"w-full p-2 rounded-lg bg-[#2C2C2C] text-white placeholder-gray-300 focus:ring-2 focus:ring-yellow-400 outline-none"},v)),N.jsx("button",{onClick:d,className:"w-full p-2 rounded-full border border-yellow-400 text-yellow-400 hover:bg-yellow-50",children:"Add"})]})}function YZ(o){return An({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1z"},child:[]}]})(o)}function gC(o){return An({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"},child:[]},{tag:"path",attr:{d:"M4.285 9.567a.5.5 0 0 1 .683.183A3.5 3.5 0 0 0 8 11.5a3.5 3.5 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5m4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5"},child:[]}]})(o)}function v1(o){return An({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"},child:[]},{tag:"path",attr:{d:"M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"},child:[]}]})(o)}function zZ(o){return An({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},child:[]}]})(o)}function jj(o){return An({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M20 8h-5.612l1.123-3.367c.202-.608.1-1.282-.275-1.802S14.253 2 13.612 2H12c-.297 0-.578.132-.769.36L6.531 8H4c-1.103 0-2 .897-2 2v9c0 1.103.897 2 2 2h13.307a2.01 2.01 0 0 0 1.873-1.298l2.757-7.351A1 1 0 0 0 22 12v-2c0-1.103-.897-2-2-2zM4 10h2v9H4v-9zm16 1.819L17.307 19H8V9.362L12.468 4h1.146l-1.562 4.683A.998.998 0 0 0 13 10h7v1.819z"},child:[]}]})(o)}function T1(o){return An({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M7 11h7v2H7zm0-4h10.97v2H7zm0 8h13v2H7zM4 4h2v16H4z"},child:[]}]})(o)}function KZ(o){return An({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 21h1V8H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2zM20 8h-7l1.122-3.368A2 2 0 0 0 12.225 2H12L7 7.438V21h11l3.912-8.596L22 12v-2a2 2 0 0 0-2-2z"},child:[]}]})(o)}function Fj(o){return An({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m23 12-2.44-2.79.34-3.69-3.61-.82-1.89-3.2L12 2.96 8.6 1.5 6.71 4.69 3.1 5.5l.34 3.7L1 12l2.44 2.79-.34 3.7 3.61.82L8.6 22.5l3.4-1.47 3.4 1.46 1.89-3.19 3.61-.82-.34-3.69L23 12zm-12.91 4.72-3.8-3.81 1.48-1.48 2.32 2.33 5.85-5.87 1.48 1.48-7.33 7.35z"},child:[]}]})(o)}function qZ(o){return An({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"},child:[]}]})(o)}function XZ(o){return An({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92zM18 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM6 13c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm12 7.02c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"},child:[]}]})(o)}function JZ(o){return An({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M475.22 206.52c-10.34-48.65-37.76-92.93-77.22-124.68A227.4 227.4 0 0 0 255.82 32C194.9 32 138 55.47 95.46 98.09 54.35 139.33 31.82 193.78 32 251.37a215.66 215.66 0 0 0 35.65 118.76l4.35 6.05L48 480l114.8-28.56s2.3.77 4 1.42 16.33 6.26 31.85 10.6c12.9 3.6 39.74 9 60.77 9 59.65 0 115.35-23.1 156.83-65.06C457.36 365.77 480 310.42 480 251.49a213.5 213.5 0 0 0-4.78-44.97zM160 288a32 32 0 1 1 32-32 32 32 0 0 1-32 32zm96 0a32 32 0 1 1 32-32 32 32 0 0 1-32 32zm96 0a32 32 0 1 1 32-32 32 32 0 0 1-32 32z"},child:[]}]})(o)}function ZZ(o){return An({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 480a80.09 80.09 0 0 0 73.3-48H182.7a80.09 80.09 0 0 0 73.3 48zm144-192v-60.53C400 157 372.64 95.61 304 80l-8-48h-80l-8 48c-68.88 15.61-96 76.76-96 147.47V288l-48 64v48h384v-48z"},child:[]}]})(o)}function Bj(o){return An({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 428 339.92 303.9a160.48 160.48 0 0 0 30.72-94.58C370.64 120.37 298.27 48 209.32 48S48 120.37 48 209.32s72.37 161.32 161.32 161.32a160.48 160.48 0 0 0 94.58-30.72L428 464zM209.32 319.69a110.38 110.38 0 1 1 110.37-110.37 110.5 110.5 0 0 1-110.37 110.37z"},child:[]}]})(o)}function R1(o){return An({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"m208 512-52.38-139.62L16 320l139.62-52.38L208 128l52.38 139.62L400 320l-139.62 52.38zM88 176l-23.57-64.43L0 88l64.43-23.57L88 0l23.57 64.43L176 88l-64.43 23.57zm312 80-31.11-80.89L288 144l80.89-31.11L400 32l31.11 80.89L512 144l-80.89 31.11z"},child:[]}]})(o)}//! moment.js
//! version : 2.30.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
var QF;function ft(){return QF.apply(null,arguments)}function QZ(o){QF=o}function ac(o){return o instanceof Array||Object.prototype.toString.call(o)==="[object Array]"}function sf(o){return o!=null&&Object.prototype.toString.call(o)==="[object Object]"}function ii(o,d){return Object.prototype.hasOwnProperty.call(o,d)}function mD(o){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(o).length===0;var d;for(d in o)if(ii(o,d))return!1;return!0}function oa(o){return o===void 0}function bd(o){return typeof o=="number"||Object.prototype.toString.call(o)==="[object Number]"}function ev(o){return o instanceof Date||Object.prototype.toString.call(o)==="[object Date]"}function $F(o,d){var m=[],_,v=o.length;for(_=0;_<v;++_)m.push(d(o[_],_));return m}function eh(o,d){for(var m in d)ii(d,m)&&(o[m]=d[m]);return ii(d,"toString")&&(o.toString=d.toString),ii(d,"valueOf")&&(o.valueOf=d.valueOf),o}function El(o,d,m,_){return TB(o,d,m,_,!0).utc()}function $Z(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function Tn(o){return o._pf==null&&(o._pf=$Z()),o._pf}var B1;Array.prototype.some?B1=Array.prototype.some:B1=function(o){var d=Object(this),m=d.length>>>0,_;for(_=0;_<m;_++)if(_ in d&&o.call(this,d[_],_,d))return!0;return!1};function _D(o){var d=null,m=!1,_=o._d&&!isNaN(o._d.getTime());if(_&&(d=Tn(o),m=B1.call(d.parsedDateParts,function(v){return v!=null}),_=d.overflow<0&&!d.empty&&!d.invalidEra&&!d.invalidMonth&&!d.invalidWeekday&&!d.weekdayMismatch&&!d.nullInput&&!d.invalidFormat&&!d.userInvalidated&&(!d.meridiem||d.meridiem&&m),o._strict&&(_=_&&d.charsLeftOver===0&&d.unusedTokens.length===0&&d.bigHour===void 0)),Object.isFrozen==null||!Object.isFrozen(o))o._isValid=_;else return _;return o._isValid}function zC(o){var d=El(NaN);return o!=null?eh(Tn(d),o):Tn(d).userInvalidated=!0,d}var Gj=ft.momentProperties=[],b1=!1;function ED(o,d){var m,_,v,w=Gj.length;if(oa(d._isAMomentObject)||(o._isAMomentObject=d._isAMomentObject),oa(d._i)||(o._i=d._i),oa(d._f)||(o._f=d._f),oa(d._l)||(o._l=d._l),oa(d._strict)||(o._strict=d._strict),oa(d._tzm)||(o._tzm=d._tzm),oa(d._isUTC)||(o._isUTC=d._isUTC),oa(d._offset)||(o._offset=d._offset),oa(d._pf)||(o._pf=Tn(d)),oa(d._locale)||(o._locale=d._locale),w>0)for(m=0;m<w;m++)_=Gj[m],v=d[_],oa(v)||(o[_]=v);return o}function tv(o){ED(this,o),this._d=new Date(o._d!=null?o._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),b1===!1&&(b1=!0,ft.updateOffset(this),b1=!1)}function oc(o){return o instanceof tv||o!=null&&o._isAMomentObject!=null}function eB(o){ft.suppressDeprecationWarnings===!1&&typeof console<"u"&&console.warn&&console.warn("Deprecation warning: "+o)}function yo(o,d){var m=!0;return eh(function(){if(ft.deprecationHandler!=null&&ft.deprecationHandler(null,o),m){var _=[],v,w,D,B=arguments.length;for(w=0;w<B;w++){if(v="",typeof arguments[w]=="object"){v+=`
[`+w+"] ";for(D in arguments[0])ii(arguments[0],D)&&(v+=D+": "+arguments[0][D]+", ");v=v.slice(0,-2)}else v=arguments[w];_.push(v)}eB(o+`
Arguments: `+Array.prototype.slice.call(_).join("")+`
`+new Error().stack),m=!1}return d.apply(this,arguments)},d)}var Hj={};function tB(o,d){ft.deprecationHandler!=null&&ft.deprecationHandler(o,d),Hj[o]||(eB(d),Hj[o]=!0)}ft.suppressDeprecationWarnings=!1;ft.deprecationHandler=null;function gl(o){return typeof Function<"u"&&o instanceof Function||Object.prototype.toString.call(o)==="[object Function]"}function eQ(o){var d,m;for(m in o)ii(o,m)&&(d=o[m],gl(d)?this[m]=d:this["_"+m]=d);this._config=o,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function G1(o,d){var m=eh({},o),_;for(_ in d)ii(d,_)&&(sf(o[_])&&sf(d[_])?(m[_]={},eh(m[_],o[_]),eh(m[_],d[_])):d[_]!=null?m[_]=d[_]:delete m[_]);for(_ in o)ii(o,_)&&!ii(d,_)&&sf(o[_])&&(m[_]=eh({},m[_]));return m}function gD(o){o!=null&&this.set(o)}var H1;Object.keys?H1=Object.keys:H1=function(o){var d,m=[];for(d in o)ii(o,d)&&m.push(d);return m};var tQ={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function nQ(o,d,m){var _=this._calendar[o]||this._calendar.sameElse;return gl(_)?_.call(d,m):_}function fl(o,d,m){var _=""+Math.abs(o),v=d-_.length,w=o>=0;return(w?m?"+":"":"-")+Math.pow(10,Math.max(0,v)).toString().substr(1)+_}var yD=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,oC=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,C1={},j_={};function Lt(o,d,m,_){var v=_;typeof _=="string"&&(v=function(){return this[_]()}),o&&(j_[o]=v),d&&(j_[d[0]]=function(){return fl(v.apply(this,arguments),d[1],d[2])}),m&&(j_[m]=function(){return this.localeData().ordinal(v.apply(this,arguments),o)})}function iQ(o){return o.match(/\[[\s\S]/)?o.replace(/^\[|\]$/g,""):o.replace(/\\/g,"")}function rQ(o){var d=o.match(yD),m,_;for(m=0,_=d.length;m<_;m++)j_[d[m]]?d[m]=j_[d[m]]:d[m]=iQ(d[m]);return function(v){var w="",D;for(D=0;D<_;D++)w+=gl(d[D])?d[D].call(v,o):d[D];return w}}function yC(o,d){return o.isValid()?(d=nB(d,o.localeData()),C1[d]=C1[d]||rQ(d),C1[d](o)):o.localeData().invalidDate()}function nB(o,d){var m=5;function _(v){return d.longDateFormat(v)||v}for(oC.lastIndex=0;m>=0&&oC.test(o);)o=o.replace(oC,_),oC.lastIndex=0,m-=1;return o}var sQ={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function aQ(o){var d=this._longDateFormat[o],m=this._longDateFormat[o.toUpperCase()];return d||!m?d:(this._longDateFormat[o]=m.match(yD).map(function(_){return _==="MMMM"||_==="MM"||_==="DD"||_==="dddd"?_.slice(1):_}).join(""),this._longDateFormat[o])}var oQ="Invalid date";function cQ(){return this._invalidDate}var lQ="%d",dQ=/\d{1,2}/;function uQ(o){return this._ordinal.replace("%d",o)}var hQ={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function pQ(o,d,m,_){var v=this._relativeTime[m];return gl(v)?v(o,d,m,_):v.replace(/%d/i,o)}function fQ(o,d){var m=this._relativeTime[o>0?"future":"past"];return gl(m)?m(d):m.replace(/%s/i,d)}var Wj={D:"date",dates:"date",date:"date",d:"day",days:"day",day:"day",e:"weekday",weekdays:"weekday",weekday:"weekday",E:"isoWeekday",isoweekdays:"isoWeekday",isoweekday:"isoWeekday",DDD:"dayOfYear",dayofyears:"dayOfYear",dayofyear:"dayOfYear",h:"hour",hours:"hour",hour:"hour",ms:"millisecond",milliseconds:"millisecond",millisecond:"millisecond",m:"minute",minutes:"minute",minute:"minute",M:"month",months:"month",month:"month",Q:"quarter",quarters:"quarter",quarter:"quarter",s:"second",seconds:"second",second:"second",gg:"weekYear",weekyears:"weekYear",weekyear:"weekYear",GG:"isoWeekYear",isoweekyears:"isoWeekYear",isoweekyear:"isoWeekYear",w:"week",weeks:"week",week:"week",W:"isoWeek",isoweeks:"isoWeek",isoweek:"isoWeek",y:"year",years:"year",year:"year"};function So(o){return typeof o=="string"?Wj[o]||Wj[o.toLowerCase()]:void 0}function SD(o){var d={},m,_;for(_ in o)ii(o,_)&&(m=So(_),m&&(d[m]=o[_]));return d}var mQ={date:9,day:11,weekday:11,isoWeekday:11,dayOfYear:4,hour:13,millisecond:16,minute:14,month:8,quarter:7,second:15,weekYear:1,isoWeekYear:1,week:5,isoWeek:5,year:1};function _Q(o){var d=[],m;for(m in o)ii(o,m)&&d.push({unit:m,priority:mQ[m]});return d.sort(function(_,v){return _.priority-v.priority}),d}var iB=/\d/,Da=/\d\d/,rB=/\d{3}/,vD=/\d{4}/,KC=/[+-]?\d{6}/,Li=/\d\d?/,sB=/\d\d\d\d?/,aB=/\d\d\d\d\d\d?/,qC=/\d{1,3}/,TD=/\d{1,4}/,XC=/[+-]?\d{1,6}/,X_=/\d+/,JC=/[+-]?\d+/,EQ=/Z|[+-]\d\d:?\d\d/gi,ZC=/Z|[+-]\d\d(?::?\d\d)?/gi,gQ=/[+-]?\d+(\.\d{1,3})?/,nv=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,J_=/^[1-9]\d?/,RD=/^([1-9]\d|\d)/,PC;PC={};function vt(o,d,m){PC[o]=gl(d)?d:function(_,v){return _&&m?m:d}}function yQ(o,d){return ii(PC,o)?PC[o](d._strict,d._locale):new RegExp(SQ(o))}function SQ(o){return vd(o.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(d,m,_,v,w){return m||_||v||w}))}function vd(o){return o.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function mo(o){return o<0?Math.ceil(o)||0:Math.floor(o)}function xn(o){var d=+o,m=0;return d!==0&&isFinite(d)&&(m=mo(d)),m}var W1={};function yi(o,d){var m,_=d,v;for(typeof o=="string"&&(o=[o]),bd(d)&&(_=function(w,D){D[d]=xn(w)}),v=o.length,m=0;m<v;m++)W1[o[m]]=_}function iv(o,d){yi(o,function(m,_,v,w){v._w=v._w||{},d(m,v._w,v,w)})}function vQ(o,d,m){d!=null&&ii(W1,o)&&W1[o](d,m._a,m,o)}function QC(o){return o%4===0&&o%100!==0||o%400===0}var ms=0,gd=1,pl=2,Lr=3,rc=4,yd=5,tf=6,TQ=7,RQ=8;Lt("Y",0,0,function(){var o=this.year();return o<=9999?fl(o,4):"+"+o});Lt(0,["YY",2],0,function(){return this.year()%100});Lt(0,["YYYY",4],0,"year");Lt(0,["YYYYY",5],0,"year");Lt(0,["YYYYYY",6,!0],0,"year");vt("Y",JC);vt("YY",Li,Da);vt("YYYY",TD,vD);vt("YYYYY",XC,KC);vt("YYYYYY",XC,KC);yi(["YYYYY","YYYYYY"],ms);yi("YYYY",function(o,d){d[ms]=o.length===2?ft.parseTwoDigitYear(o):xn(o)});yi("YY",function(o,d){d[ms]=ft.parseTwoDigitYear(o)});yi("Y",function(o,d){d[ms]=parseInt(o,10)});function FS(o){return QC(o)?366:365}ft.parseTwoDigitYear=function(o){return xn(o)+(xn(o)>68?1900:2e3)};var oB=Z_("FullYear",!0);function bQ(){return QC(this.year())}function Z_(o,d){return function(m){return m!=null?(cB(this,o,m),ft.updateOffset(this,d),this):HS(this,o)}}function HS(o,d){if(!o.isValid())return NaN;var m=o._d,_=o._isUTC;switch(d){case"Milliseconds":return _?m.getUTCMilliseconds():m.getMilliseconds();case"Seconds":return _?m.getUTCSeconds():m.getSeconds();case"Minutes":return _?m.getUTCMinutes():m.getMinutes();case"Hours":return _?m.getUTCHours():m.getHours();case"Date":return _?m.getUTCDate():m.getDate();case"Day":return _?m.getUTCDay():m.getDay();case"Month":return _?m.getUTCMonth():m.getMonth();case"FullYear":return _?m.getUTCFullYear():m.getFullYear();default:return NaN}}function cB(o,d,m){var _,v,w,D,B;if(!(!o.isValid()||isNaN(m))){switch(_=o._d,v=o._isUTC,d){case"Milliseconds":return void(v?_.setUTCMilliseconds(m):_.setMilliseconds(m));case"Seconds":return void(v?_.setUTCSeconds(m):_.setSeconds(m));case"Minutes":return void(v?_.setUTCMinutes(m):_.setMinutes(m));case"Hours":return void(v?_.setUTCHours(m):_.setHours(m));case"Date":return void(v?_.setUTCDate(m):_.setDate(m));case"FullYear":break;default:return}w=m,D=o.month(),B=o.date(),B=B===29&&D===1&&!QC(w)?28:B,v?_.setUTCFullYear(w,D,B):_.setFullYear(w,D,B)}}function CQ(o){return o=So(o),gl(this[o])?this[o]():this}function wQ(o,d){if(typeof o=="object"){o=SD(o);var m=_Q(o),_,v=m.length;for(_=0;_<v;_++)this[m[_].unit](o[m[_].unit])}else if(o=So(o),gl(this[o]))return this[o](d);return this}function AQ(o,d){return(o%d+d)%d}var fr;Array.prototype.indexOf?fr=Array.prototype.indexOf:fr=function(o){var d;for(d=0;d<this.length;++d)if(this[d]===o)return d;return-1};function bD(o,d){if(isNaN(o)||isNaN(d))return NaN;var m=AQ(d,12);return o+=(d-m)/12,m===1?QC(o)?29:28:31-m%7%2}Lt("M",["MM",2],"Mo",function(){return this.month()+1});Lt("MMM",0,0,function(o){return this.localeData().monthsShort(this,o)});Lt("MMMM",0,0,function(o){return this.localeData().months(this,o)});vt("M",Li,J_);vt("MM",Li,Da);vt("MMM",function(o,d){return d.monthsShortRegex(o)});vt("MMMM",function(o,d){return d.monthsRegex(o)});yi(["M","MM"],function(o,d){d[gd]=xn(o)-1});yi(["MMM","MMMM"],function(o,d,m,_){var v=m._locale.monthsParse(o,_,m._strict);v!=null?d[gd]=v:Tn(m).invalidMonth=o});var OQ="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),lB="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),dB=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,IQ=nv,NQ=nv;function DQ(o,d){return o?ac(this._months)?this._months[o.month()]:this._months[(this._months.isFormat||dB).test(d)?"format":"standalone"][o.month()]:ac(this._months)?this._months:this._months.standalone}function kQ(o,d){return o?ac(this._monthsShort)?this._monthsShort[o.month()]:this._monthsShort[dB.test(d)?"format":"standalone"][o.month()]:ac(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function PQ(o,d,m){var _,v,w,D=o.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],_=0;_<12;++_)w=El([2e3,_]),this._shortMonthsParse[_]=this.monthsShort(w,"").toLocaleLowerCase(),this._longMonthsParse[_]=this.months(w,"").toLocaleLowerCase();return m?d==="MMM"?(v=fr.call(this._shortMonthsParse,D),v!==-1?v:null):(v=fr.call(this._longMonthsParse,D),v!==-1?v:null):d==="MMM"?(v=fr.call(this._shortMonthsParse,D),v!==-1?v:(v=fr.call(this._longMonthsParse,D),v!==-1?v:null)):(v=fr.call(this._longMonthsParse,D),v!==-1?v:(v=fr.call(this._shortMonthsParse,D),v!==-1?v:null))}function LQ(o,d,m){var _,v,w;if(this._monthsParseExact)return PQ.call(this,o,d,m);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),_=0;_<12;_++){if(v=El([2e3,_]),m&&!this._longMonthsParse[_]&&(this._longMonthsParse[_]=new RegExp("^"+this.months(v,"").replace(".","")+"$","i"),this._shortMonthsParse[_]=new RegExp("^"+this.monthsShort(v,"").replace(".","")+"$","i")),!m&&!this._monthsParse[_]&&(w="^"+this.months(v,"")+"|^"+this.monthsShort(v,""),this._monthsParse[_]=new RegExp(w.replace(".",""),"i")),m&&d==="MMMM"&&this._longMonthsParse[_].test(o))return _;if(m&&d==="MMM"&&this._shortMonthsParse[_].test(o))return _;if(!m&&this._monthsParse[_].test(o))return _}}function uB(o,d){if(!o.isValid())return o;if(typeof d=="string"){if(/^\d+$/.test(d))d=xn(d);else if(d=o.localeData().monthsParse(d),!bd(d))return o}var m=d,_=o.date();return _=_<29?_:Math.min(_,bD(o.year(),m)),o._isUTC?o._d.setUTCMonth(m,_):o._d.setMonth(m,_),o}function hB(o){return o!=null?(uB(this,o),ft.updateOffset(this,!0),this):HS(this,"Month")}function MQ(){return bD(this.year(),this.month())}function xQ(o){return this._monthsParseExact?(ii(this,"_monthsRegex")||pB.call(this),o?this._monthsShortStrictRegex:this._monthsShortRegex):(ii(this,"_monthsShortRegex")||(this._monthsShortRegex=IQ),this._monthsShortStrictRegex&&o?this._monthsShortStrictRegex:this._monthsShortRegex)}function UQ(o){return this._monthsParseExact?(ii(this,"_monthsRegex")||pB.call(this),o?this._monthsStrictRegex:this._monthsRegex):(ii(this,"_monthsRegex")||(this._monthsRegex=NQ),this._monthsStrictRegex&&o?this._monthsStrictRegex:this._monthsRegex)}function pB(){function o(W,F){return F.length-W.length}var d=[],m=[],_=[],v,w,D,B;for(v=0;v<12;v++)w=El([2e3,v]),D=vd(this.monthsShort(w,"")),B=vd(this.months(w,"")),d.push(D),m.push(B),_.push(B),_.push(D);d.sort(o),m.sort(o),_.sort(o),this._monthsRegex=new RegExp("^("+_.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+m.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+d.join("|")+")","i")}function VQ(o,d,m,_,v,w,D){var B;return o<100&&o>=0?(B=new Date(o+400,d,m,_,v,w,D),isFinite(B.getFullYear())&&B.setFullYear(o)):B=new Date(o,d,m,_,v,w,D),B}function WS(o){var d,m;return o<100&&o>=0?(m=Array.prototype.slice.call(arguments),m[0]=o+400,d=new Date(Date.UTC.apply(null,m)),isFinite(d.getUTCFullYear())&&d.setUTCFullYear(o)):d=new Date(Date.UTC.apply(null,arguments)),d}function LC(o,d,m){var _=7+d-m,v=(7+WS(o,0,_).getUTCDay()-d)%7;return-v+_-1}function fB(o,d,m,_,v){var w=(7+m-_)%7,D=LC(o,_,v),B=1+7*(d-1)+w+D,W,F;return B<=0?(W=o-1,F=FS(W)+B):B>FS(o)?(W=o+1,F=B-FS(o)):(W=o,F=B),{year:W,dayOfYear:F}}function YS(o,d,m){var _=LC(o.year(),d,m),v=Math.floor((o.dayOfYear()-_-1)/7)+1,w,D;return v<1?(D=o.year()-1,w=v+Td(D,d,m)):v>Td(o.year(),d,m)?(w=v-Td(o.year(),d,m),D=o.year()+1):(D=o.year(),w=v),{week:w,year:D}}function Td(o,d,m){var _=LC(o,d,m),v=LC(o+1,d,m);return(FS(o)-_+v)/7}Lt("w",["ww",2],"wo","week");Lt("W",["WW",2],"Wo","isoWeek");vt("w",Li,J_);vt("ww",Li,Da);vt("W",Li,J_);vt("WW",Li,Da);iv(["w","ww","W","WW"],function(o,d,m,_){d[_.substr(0,1)]=xn(o)});function jQ(o){return YS(o,this._week.dow,this._week.doy).week}var FQ={dow:0,doy:6};function BQ(){return this._week.dow}function GQ(){return this._week.doy}function HQ(o){var d=this.localeData().week(this);return o==null?d:this.add((o-d)*7,"d")}function WQ(o){var d=YS(this,1,4).week;return o==null?d:this.add((o-d)*7,"d")}Lt("d",0,"do","day");Lt("dd",0,0,function(o){return this.localeData().weekdaysMin(this,o)});Lt("ddd",0,0,function(o){return this.localeData().weekdaysShort(this,o)});Lt("dddd",0,0,function(o){return this.localeData().weekdays(this,o)});Lt("e",0,0,"weekday");Lt("E",0,0,"isoWeekday");vt("d",Li);vt("e",Li);vt("E",Li);vt("dd",function(o,d){return d.weekdaysMinRegex(o)});vt("ddd",function(o,d){return d.weekdaysShortRegex(o)});vt("dddd",function(o,d){return d.weekdaysRegex(o)});iv(["dd","ddd","dddd"],function(o,d,m,_){var v=m._locale.weekdaysParse(o,_,m._strict);v!=null?d.d=v:Tn(m).invalidWeekday=o});iv(["d","e","E"],function(o,d,m,_){d[_]=xn(o)});function YQ(o,d){return typeof o!="string"?o:isNaN(o)?(o=d.weekdaysParse(o),typeof o=="number"?o:null):parseInt(o,10)}function zQ(o,d){return typeof o=="string"?d.weekdaysParse(o)%7||7:isNaN(o)?null:o}function CD(o,d){return o.slice(d,7).concat(o.slice(0,d))}var KQ="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),mB="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),qQ="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),XQ=nv,JQ=nv,ZQ=nv;function QQ(o,d){var m=ac(this._weekdays)?this._weekdays:this._weekdays[o&&o!==!0&&this._weekdays.isFormat.test(d)?"format":"standalone"];return o===!0?CD(m,this._week.dow):o?m[o.day()]:m}function $Q(o){return o===!0?CD(this._weekdaysShort,this._week.dow):o?this._weekdaysShort[o.day()]:this._weekdaysShort}function e$(o){return o===!0?CD(this._weekdaysMin,this._week.dow):o?this._weekdaysMin[o.day()]:this._weekdaysMin}function t$(o,d,m){var _,v,w,D=o.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],_=0;_<7;++_)w=El([2e3,1]).day(_),this._minWeekdaysParse[_]=this.weekdaysMin(w,"").toLocaleLowerCase(),this._shortWeekdaysParse[_]=this.weekdaysShort(w,"").toLocaleLowerCase(),this._weekdaysParse[_]=this.weekdays(w,"").toLocaleLowerCase();return m?d==="dddd"?(v=fr.call(this._weekdaysParse,D),v!==-1?v:null):d==="ddd"?(v=fr.call(this._shortWeekdaysParse,D),v!==-1?v:null):(v=fr.call(this._minWeekdaysParse,D),v!==-1?v:null):d==="dddd"?(v=fr.call(this._weekdaysParse,D),v!==-1||(v=fr.call(this._shortWeekdaysParse,D),v!==-1)?v:(v=fr.call(this._minWeekdaysParse,D),v!==-1?v:null)):d==="ddd"?(v=fr.call(this._shortWeekdaysParse,D),v!==-1||(v=fr.call(this._weekdaysParse,D),v!==-1)?v:(v=fr.call(this._minWeekdaysParse,D),v!==-1?v:null)):(v=fr.call(this._minWeekdaysParse,D),v!==-1||(v=fr.call(this._weekdaysParse,D),v!==-1)?v:(v=fr.call(this._shortWeekdaysParse,D),v!==-1?v:null))}function n$(o,d,m){var _,v,w;if(this._weekdaysParseExact)return t$.call(this,o,d,m);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),_=0;_<7;_++){if(v=El([2e3,1]).day(_),m&&!this._fullWeekdaysParse[_]&&(this._fullWeekdaysParse[_]=new RegExp("^"+this.weekdays(v,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[_]=new RegExp("^"+this.weekdaysShort(v,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[_]=new RegExp("^"+this.weekdaysMin(v,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[_]||(w="^"+this.weekdays(v,"")+"|^"+this.weekdaysShort(v,"")+"|^"+this.weekdaysMin(v,""),this._weekdaysParse[_]=new RegExp(w.replace(".",""),"i")),m&&d==="dddd"&&this._fullWeekdaysParse[_].test(o))return _;if(m&&d==="ddd"&&this._shortWeekdaysParse[_].test(o))return _;if(m&&d==="dd"&&this._minWeekdaysParse[_].test(o))return _;if(!m&&this._weekdaysParse[_].test(o))return _}}function i$(o){if(!this.isValid())return o!=null?this:NaN;var d=HS(this,"Day");return o!=null?(o=YQ(o,this.localeData()),this.add(o-d,"d")):d}function r$(o){if(!this.isValid())return o!=null?this:NaN;var d=(this.day()+7-this.localeData()._week.dow)%7;return o==null?d:this.add(o-d,"d")}function s$(o){if(!this.isValid())return o!=null?this:NaN;if(o!=null){var d=zQ(o,this.localeData());return this.day(this.day()%7?d:d-7)}else return this.day()||7}function a$(o){return this._weekdaysParseExact?(ii(this,"_weekdaysRegex")||wD.call(this),o?this._weekdaysStrictRegex:this._weekdaysRegex):(ii(this,"_weekdaysRegex")||(this._weekdaysRegex=XQ),this._weekdaysStrictRegex&&o?this._weekdaysStrictRegex:this._weekdaysRegex)}function o$(o){return this._weekdaysParseExact?(ii(this,"_weekdaysRegex")||wD.call(this),o?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(ii(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=JQ),this._weekdaysShortStrictRegex&&o?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function c$(o){return this._weekdaysParseExact?(ii(this,"_weekdaysRegex")||wD.call(this),o?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(ii(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=ZQ),this._weekdaysMinStrictRegex&&o?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function wD(){function o(X,Q){return Q.length-X.length}var d=[],m=[],_=[],v=[],w,D,B,W,F;for(w=0;w<7;w++)D=El([2e3,1]).day(w),B=vd(this.weekdaysMin(D,"")),W=vd(this.weekdaysShort(D,"")),F=vd(this.weekdays(D,"")),d.push(B),m.push(W),_.push(F),v.push(B),v.push(W),v.push(F);d.sort(o),m.sort(o),_.sort(o),v.sort(o),this._weekdaysRegex=new RegExp("^("+v.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+_.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+m.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+d.join("|")+")","i")}function AD(){return this.hours()%12||12}function l$(){return this.hours()||24}Lt("H",["HH",2],0,"hour");Lt("h",["hh",2],0,AD);Lt("k",["kk",2],0,l$);Lt("hmm",0,0,function(){return""+AD.apply(this)+fl(this.minutes(),2)});Lt("hmmss",0,0,function(){return""+AD.apply(this)+fl(this.minutes(),2)+fl(this.seconds(),2)});Lt("Hmm",0,0,function(){return""+this.hours()+fl(this.minutes(),2)});Lt("Hmmss",0,0,function(){return""+this.hours()+fl(this.minutes(),2)+fl(this.seconds(),2)});function _B(o,d){Lt(o,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),d)})}_B("a",!0);_B("A",!1);function EB(o,d){return d._meridiemParse}vt("a",EB);vt("A",EB);vt("H",Li,RD);vt("h",Li,J_);vt("k",Li,J_);vt("HH",Li,Da);vt("hh",Li,Da);vt("kk",Li,Da);vt("hmm",sB);vt("hmmss",aB);vt("Hmm",sB);vt("Hmmss",aB);yi(["H","HH"],Lr);yi(["k","kk"],function(o,d,m){var _=xn(o);d[Lr]=_===24?0:_});yi(["a","A"],function(o,d,m){m._isPm=m._locale.isPM(o),m._meridiem=o});yi(["h","hh"],function(o,d,m){d[Lr]=xn(o),Tn(m).bigHour=!0});yi("hmm",function(o,d,m){var _=o.length-2;d[Lr]=xn(o.substr(0,_)),d[rc]=xn(o.substr(_)),Tn(m).bigHour=!0});yi("hmmss",function(o,d,m){var _=o.length-4,v=o.length-2;d[Lr]=xn(o.substr(0,_)),d[rc]=xn(o.substr(_,2)),d[yd]=xn(o.substr(v)),Tn(m).bigHour=!0});yi("Hmm",function(o,d,m){var _=o.length-2;d[Lr]=xn(o.substr(0,_)),d[rc]=xn(o.substr(_))});yi("Hmmss",function(o,d,m){var _=o.length-4,v=o.length-2;d[Lr]=xn(o.substr(0,_)),d[rc]=xn(o.substr(_,2)),d[yd]=xn(o.substr(v))});function d$(o){return(o+"").toLowerCase().charAt(0)==="p"}var u$=/[ap]\.?m?\.?/i,h$=Z_("Hours",!0);function p$(o,d,m){return o>11?m?"pm":"PM":m?"am":"AM"}var gB={calendar:tQ,longDateFormat:sQ,invalidDate:oQ,ordinal:lQ,dayOfMonthOrdinalParse:dQ,relativeTime:hQ,months:OQ,monthsShort:lB,week:FQ,weekdays:KQ,weekdaysMin:qQ,weekdaysShort:mB,meridiemParse:u$},Bi={},LS={},zS;function f$(o,d){var m,_=Math.min(o.length,d.length);for(m=0;m<_;m+=1)if(o[m]!==d[m])return m;return _}function Yj(o){return o&&o.toLowerCase().replace("_","-")}function m$(o){for(var d=0,m,_,v,w;d<o.length;){for(w=Yj(o[d]).split("-"),m=w.length,_=Yj(o[d+1]),_=_?_.split("-"):null;m>0;){if(v=$C(w.slice(0,m).join("-")),v)return v;if(_&&_.length>=m&&f$(w,_)>=m-1)break;m--}d++}return zS}function _$(o){return!!(o&&o.match("^[^/\\\\]*$"))}function $C(o){var d=null,m;if(Bi[o]===void 0&&typeof AC<"u"&&AC&&AC.exports&&_$(o))try{d=zS._abbr,m=require,m("./locale/"+o),nh(d)}catch{Bi[o]=null}return Bi[o]}function nh(o,d){var m;return o&&(oa(d)?m=Od(o):m=OD(o,d),m?zS=m:typeof console<"u"&&console.warn&&console.warn("Locale "+o+" not found. Did you forget to load it?")),zS._abbr}function OD(o,d){if(d!==null){var m,_=gB;if(d.abbr=o,Bi[o]!=null)tB("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),_=Bi[o]._config;else if(d.parentLocale!=null)if(Bi[d.parentLocale]!=null)_=Bi[d.parentLocale]._config;else if(m=$C(d.parentLocale),m!=null)_=m._config;else return LS[d.parentLocale]||(LS[d.parentLocale]=[]),LS[d.parentLocale].push({name:o,config:d}),null;return Bi[o]=new gD(G1(_,d)),LS[o]&&LS[o].forEach(function(v){OD(v.name,v.config)}),nh(o),Bi[o]}else return delete Bi[o],null}function E$(o,d){if(d!=null){var m,_,v=gB;Bi[o]!=null&&Bi[o].parentLocale!=null?Bi[o].set(G1(Bi[o]._config,d)):(_=$C(o),_!=null&&(v=_._config),d=G1(v,d),_==null&&(d.abbr=o),m=new gD(d),m.parentLocale=Bi[o],Bi[o]=m),nh(o)}else Bi[o]!=null&&(Bi[o].parentLocale!=null?(Bi[o]=Bi[o].parentLocale,o===nh()&&nh(o)):Bi[o]!=null&&delete Bi[o]);return Bi[o]}function Od(o){var d;if(o&&o._locale&&o._locale._abbr&&(o=o._locale._abbr),!o)return zS;if(!ac(o)){if(d=$C(o),d)return d;o=[o]}return m$(o)}function g$(){return H1(Bi)}function ID(o){var d,m=o._a;return m&&Tn(o).overflow===-2&&(d=m[gd]<0||m[gd]>11?gd:m[pl]<1||m[pl]>bD(m[ms],m[gd])?pl:m[Lr]<0||m[Lr]>24||m[Lr]===24&&(m[rc]!==0||m[yd]!==0||m[tf]!==0)?Lr:m[rc]<0||m[rc]>59?rc:m[yd]<0||m[yd]>59?yd:m[tf]<0||m[tf]>999?tf:-1,Tn(o)._overflowDayOfYear&&(d<ms||d>pl)&&(d=pl),Tn(o)._overflowWeeks&&d===-1&&(d=TQ),Tn(o)._overflowWeekday&&d===-1&&(d=RQ),Tn(o).overflow=d),o}var y$=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,S$=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,v$=/Z|[+-]\d\d(?::?\d\d)?/,cC=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],w1=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],T$=/^\/?Date\((-?\d+)/i,R$=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,b$={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function yB(o){var d,m,_=o._i,v=y$.exec(_)||S$.exec(_),w,D,B,W,F=cC.length,X=w1.length;if(v){for(Tn(o).iso=!0,d=0,m=F;d<m;d++)if(cC[d][1].exec(v[1])){D=cC[d][0],w=cC[d][2]!==!1;break}if(D==null){o._isValid=!1;return}if(v[3]){for(d=0,m=X;d<m;d++)if(w1[d][1].exec(v[3])){B=(v[2]||" ")+w1[d][0];break}if(B==null){o._isValid=!1;return}}if(!w&&B!=null){o._isValid=!1;return}if(v[4])if(v$.exec(v[4]))W="Z";else{o._isValid=!1;return}o._f=D+(B||"")+(W||""),DD(o)}else o._isValid=!1}function C$(o,d,m,_,v,w){var D=[w$(o),lB.indexOf(d),parseInt(m,10),parseInt(_,10),parseInt(v,10)];return w&&D.push(parseInt(w,10)),D}function w$(o){var d=parseInt(o,10);return d<=49?2e3+d:d<=999?1900+d:d}function A$(o){return o.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function O$(o,d,m){if(o){var _=mB.indexOf(o),v=new Date(d[0],d[1],d[2]).getDay();if(_!==v)return Tn(m).weekdayMismatch=!0,m._isValid=!1,!1}return!0}function I$(o,d,m){if(o)return b$[o];if(d)return 0;var _=parseInt(m,10),v=_%100,w=(_-v)/100;return w*60+v}function SB(o){var d=R$.exec(A$(o._i)),m;if(d){if(m=C$(d[4],d[3],d[2],d[5],d[6],d[7]),!O$(d[1],m,o))return;o._a=m,o._tzm=I$(d[8],d[9],d[10]),o._d=WS.apply(null,o._a),o._d.setUTCMinutes(o._d.getUTCMinutes()-o._tzm),Tn(o).rfc2822=!0}else o._isValid=!1}function N$(o){var d=T$.exec(o._i);if(d!==null){o._d=new Date(+d[1]);return}if(yB(o),o._isValid===!1)delete o._isValid;else return;if(SB(o),o._isValid===!1)delete o._isValid;else return;o._strict?o._isValid=!1:ft.createFromInputFallback(o)}ft.createFromInputFallback=yo("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(o){o._d=new Date(o._i+(o._useUTC?" UTC":""))});function x_(o,d,m){return o??d??m}function D$(o){var d=new Date(ft.now());return o._useUTC?[d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()]:[d.getFullYear(),d.getMonth(),d.getDate()]}function ND(o){var d,m,_=[],v,w,D;if(!o._d){for(v=D$(o),o._w&&o._a[pl]==null&&o._a[gd]==null&&k$(o),o._dayOfYear!=null&&(D=x_(o._a[ms],v[ms]),(o._dayOfYear>FS(D)||o._dayOfYear===0)&&(Tn(o)._overflowDayOfYear=!0),m=WS(D,0,o._dayOfYear),o._a[gd]=m.getUTCMonth(),o._a[pl]=m.getUTCDate()),d=0;d<3&&o._a[d]==null;++d)o._a[d]=_[d]=v[d];for(;d<7;d++)o._a[d]=_[d]=o._a[d]==null?d===2?1:0:o._a[d];o._a[Lr]===24&&o._a[rc]===0&&o._a[yd]===0&&o._a[tf]===0&&(o._nextDay=!0,o._a[Lr]=0),o._d=(o._useUTC?WS:VQ).apply(null,_),w=o._useUTC?o._d.getUTCDay():o._d.getDay(),o._tzm!=null&&o._d.setUTCMinutes(o._d.getUTCMinutes()-o._tzm),o._nextDay&&(o._a[Lr]=24),o._w&&typeof o._w.d<"u"&&o._w.d!==w&&(Tn(o).weekdayMismatch=!0)}}function k$(o){var d,m,_,v,w,D,B,W,F;d=o._w,d.GG!=null||d.W!=null||d.E!=null?(w=1,D=4,m=x_(d.GG,o._a[ms],YS(Pi(),1,4).year),_=x_(d.W,1),v=x_(d.E,1),(v<1||v>7)&&(W=!0)):(w=o._locale._week.dow,D=o._locale._week.doy,F=YS(Pi(),w,D),m=x_(d.gg,o._a[ms],F.year),_=x_(d.w,F.week),d.d!=null?(v=d.d,(v<0||v>6)&&(W=!0)):d.e!=null?(v=d.e+w,(d.e<0||d.e>6)&&(W=!0)):v=w),_<1||_>Td(m,w,D)?Tn(o)._overflowWeeks=!0:W!=null?Tn(o)._overflowWeekday=!0:(B=fB(m,_,v,w,D),o._a[ms]=B.year,o._dayOfYear=B.dayOfYear)}ft.ISO_8601=function(){};ft.RFC_2822=function(){};function DD(o){if(o._f===ft.ISO_8601){yB(o);return}if(o._f===ft.RFC_2822){SB(o);return}o._a=[],Tn(o).empty=!0;var d=""+o._i,m,_,v,w,D,B=d.length,W=0,F,X;for(v=nB(o._f,o._locale).match(yD)||[],X=v.length,m=0;m<X;m++)w=v[m],_=(d.match(yQ(w,o))||[])[0],_&&(D=d.substr(0,d.indexOf(_)),D.length>0&&Tn(o).unusedInput.push(D),d=d.slice(d.indexOf(_)+_.length),W+=_.length),j_[w]?(_?Tn(o).empty=!1:Tn(o).unusedTokens.push(w),vQ(w,_,o)):o._strict&&!_&&Tn(o).unusedTokens.push(w);Tn(o).charsLeftOver=B-W,d.length>0&&Tn(o).unusedInput.push(d),o._a[Lr]<=12&&Tn(o).bigHour===!0&&o._a[Lr]>0&&(Tn(o).bigHour=void 0),Tn(o).parsedDateParts=o._a.slice(0),Tn(o).meridiem=o._meridiem,o._a[Lr]=P$(o._locale,o._a[Lr],o._meridiem),F=Tn(o).era,F!==null&&(o._a[ms]=o._locale.erasConvertYear(F,o._a[ms])),ND(o),ID(o)}function P$(o,d,m){var _;return m==null?d:o.meridiemHour!=null?o.meridiemHour(d,m):(o.isPM!=null&&(_=o.isPM(m),_&&d<12&&(d+=12),!_&&d===12&&(d=0)),d)}function L$(o){var d,m,_,v,w,D,B=!1,W=o._f.length;if(W===0){Tn(o).invalidFormat=!0,o._d=new Date(NaN);return}for(v=0;v<W;v++)w=0,D=!1,d=ED({},o),o._useUTC!=null&&(d._useUTC=o._useUTC),d._f=o._f[v],DD(d),_D(d)&&(D=!0),w+=Tn(d).charsLeftOver,w+=Tn(d).unusedTokens.length*10,Tn(d).score=w,B?w<_&&(_=w,m=d):(_==null||w<_||D)&&(_=w,m=d,D&&(B=!0));eh(o,m||d)}function M$(o){if(!o._d){var d=SD(o._i),m=d.day===void 0?d.date:d.day;o._a=$F([d.year,d.month,m,d.hour,d.minute,d.second,d.millisecond],function(_){return _&&parseInt(_,10)}),ND(o)}}function x$(o){var d=new tv(ID(vB(o)));return d._nextDay&&(d.add(1,"d"),d._nextDay=void 0),d}function vB(o){var d=o._i,m=o._f;return o._locale=o._locale||Od(o._l),d===null||m===void 0&&d===""?zC({nullInput:!0}):(typeof d=="string"&&(o._i=d=o._locale.preparse(d)),oc(d)?new tv(ID(d)):(ev(d)?o._d=d:ac(m)?L$(o):m?DD(o):U$(o),_D(o)||(o._d=null),o))}function U$(o){var d=o._i;oa(d)?o._d=new Date(ft.now()):ev(d)?o._d=new Date(d.valueOf()):typeof d=="string"?N$(o):ac(d)?(o._a=$F(d.slice(0),function(m){return parseInt(m,10)}),ND(o)):sf(d)?M$(o):bd(d)?o._d=new Date(d):ft.createFromInputFallback(o)}function TB(o,d,m,_,v){var w={};return(d===!0||d===!1)&&(_=d,d=void 0),(m===!0||m===!1)&&(_=m,m=void 0),(sf(o)&&mD(o)||ac(o)&&o.length===0)&&(o=void 0),w._isAMomentObject=!0,w._useUTC=w._isUTC=v,w._l=m,w._i=o,w._f=d,w._strict=_,x$(w)}function Pi(o,d,m,_){return TB(o,d,m,_,!1)}var V$=yo("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var o=Pi.apply(null,arguments);return this.isValid()&&o.isValid()?o<this?this:o:zC()}),j$=yo("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var o=Pi.apply(null,arguments);return this.isValid()&&o.isValid()?o>this?this:o:zC()});function RB(o,d){var m,_;if(d.length===1&&ac(d[0])&&(d=d[0]),!d.length)return Pi();for(m=d[0],_=1;_<d.length;++_)(!d[_].isValid()||d[_][o](m))&&(m=d[_]);return m}function F$(){var o=[].slice.call(arguments,0);return RB("isBefore",o)}function B$(){var o=[].slice.call(arguments,0);return RB("isAfter",o)}var G$=function(){return Date.now?Date.now():+new Date},MS=["year","quarter","month","week","day","hour","minute","second","millisecond"];function H$(o){var d,m=!1,_,v=MS.length;for(d in o)if(ii(o,d)&&!(fr.call(MS,d)!==-1&&(o[d]==null||!isNaN(o[d]))))return!1;for(_=0;_<v;++_)if(o[MS[_]]){if(m)return!1;parseFloat(o[MS[_]])!==xn(o[MS[_]])&&(m=!0)}return!0}function W$(){return this._isValid}function Y$(){return uc(NaN)}function ew(o){var d=SD(o),m=d.year||0,_=d.quarter||0,v=d.month||0,w=d.week||d.isoWeek||0,D=d.day||0,B=d.hour||0,W=d.minute||0,F=d.second||0,X=d.millisecond||0;this._isValid=H$(d),this._milliseconds=+X+F*1e3+W*6e4+B*1e3*60*60,this._days=+D+w*7,this._months=+v+_*3+m*12,this._data={},this._locale=Od(),this._bubble()}function SC(o){return o instanceof ew}function Y1(o){return o<0?Math.round(-1*o)*-1:Math.round(o)}function z$(o,d,m){var _=Math.min(o.length,d.length),v=Math.abs(o.length-d.length),w=0,D;for(D=0;D<_;D++)xn(o[D])!==xn(d[D])&&w++;return w+v}function bB(o,d){Lt(o,0,0,function(){var m=this.utcOffset(),_="+";return m<0&&(m=-m,_="-"),_+fl(~~(m/60),2)+d+fl(~~m%60,2)})}bB("Z",":");bB("ZZ","");vt("Z",ZC);vt("ZZ",ZC);yi(["Z","ZZ"],function(o,d,m){m._useUTC=!0,m._tzm=kD(ZC,o)});var K$=/([\+\-]|\d\d)/gi;function kD(o,d){var m=(d||"").match(o),_,v,w;return m===null?null:(_=m[m.length-1]||[],v=(_+"").match(K$)||["-",0,0],w=+(v[1]*60)+xn(v[2]),w===0?0:v[0]==="+"?w:-w)}function PD(o,d){var m,_;return d._isUTC?(m=d.clone(),_=(oc(o)||ev(o)?o.valueOf():Pi(o).valueOf())-m.valueOf(),m._d.setTime(m._d.valueOf()+_),ft.updateOffset(m,!1),m):Pi(o).local()}function z1(o){return-Math.round(o._d.getTimezoneOffset())}ft.updateOffset=function(){};function q$(o,d,m){var _=this._offset||0,v;if(!this.isValid())return o!=null?this:NaN;if(o!=null){if(typeof o=="string"){if(o=kD(ZC,o),o===null)return this}else Math.abs(o)<16&&!m&&(o=o*60);return!this._isUTC&&d&&(v=z1(this)),this._offset=o,this._isUTC=!0,v!=null&&this.add(v,"m"),_!==o&&(!d||this._changeInProgress?AB(this,uc(o-_,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,ft.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?_:z1(this)}function X$(o,d){return o!=null?(typeof o!="string"&&(o=-o),this.utcOffset(o,d),this):-this.utcOffset()}function J$(o){return this.utcOffset(0,o)}function Z$(o){return this._isUTC&&(this.utcOffset(0,o),this._isUTC=!1,o&&this.subtract(z1(this),"m")),this}function Q$(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var o=kD(EQ,this._i);o!=null?this.utcOffset(o):this.utcOffset(0,!0)}return this}function $$(o){return this.isValid()?(o=o?Pi(o).utcOffset():0,(this.utcOffset()-o)%60===0):!1}function eee(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function tee(){if(!oa(this._isDSTShifted))return this._isDSTShifted;var o={},d;return ED(o,this),o=vB(o),o._a?(d=o._isUTC?El(o._a):Pi(o._a),this._isDSTShifted=this.isValid()&&z$(o._a,d.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function nee(){return this.isValid()?!this._isUTC:!1}function iee(){return this.isValid()?this._isUTC:!1}function CB(){return this.isValid()?this._isUTC&&this._offset===0:!1}var ree=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,see=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function uc(o,d){var m=o,_=null,v,w,D;return SC(o)?m={ms:o._milliseconds,d:o._days,M:o._months}:bd(o)||!isNaN(+o)?(m={},d?m[d]=+o:m.milliseconds=+o):(_=ree.exec(o))?(v=_[1]==="-"?-1:1,m={y:0,d:xn(_[pl])*v,h:xn(_[Lr])*v,m:xn(_[rc])*v,s:xn(_[yd])*v,ms:xn(Y1(_[tf]*1e3))*v}):(_=see.exec(o))?(v=_[1]==="-"?-1:1,m={y:Qp(_[2],v),M:Qp(_[3],v),w:Qp(_[4],v),d:Qp(_[5],v),h:Qp(_[6],v),m:Qp(_[7],v),s:Qp(_[8],v)}):m==null?m={}:typeof m=="object"&&("from"in m||"to"in m)&&(D=aee(Pi(m.from),Pi(m.to)),m={},m.ms=D.milliseconds,m.M=D.months),w=new ew(m),SC(o)&&ii(o,"_locale")&&(w._locale=o._locale),SC(o)&&ii(o,"_isValid")&&(w._isValid=o._isValid),w}uc.fn=ew.prototype;uc.invalid=Y$;function Qp(o,d){var m=o&&parseFloat(o.replace(",","."));return(isNaN(m)?0:m)*d}function zj(o,d){var m={};return m.months=d.month()-o.month()+(d.year()-o.year())*12,o.clone().add(m.months,"M").isAfter(d)&&--m.months,m.milliseconds=+d-+o.clone().add(m.months,"M"),m}function aee(o,d){var m;return o.isValid()&&d.isValid()?(d=PD(d,o),o.isBefore(d)?m=zj(o,d):(m=zj(d,o),m.milliseconds=-m.milliseconds,m.months=-m.months),m):{milliseconds:0,months:0}}function wB(o,d){return function(m,_){var v,w;return _!==null&&!isNaN(+_)&&(tB(d,"moment()."+d+"(period, number) is deprecated. Please use moment()."+d+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),w=m,m=_,_=w),v=uc(m,_),AB(this,v,o),this}}function AB(o,d,m,_){var v=d._milliseconds,w=Y1(d._days),D=Y1(d._months);o.isValid()&&(_=_??!0,D&&uB(o,HS(o,"Month")+D*m),w&&cB(o,"Date",HS(o,"Date")+w*m),v&&o._d.setTime(o._d.valueOf()+v*m),_&&ft.updateOffset(o,w||D))}var oee=wB(1,"add"),cee=wB(-1,"subtract");function OB(o){return typeof o=="string"||o instanceof String}function lee(o){return oc(o)||ev(o)||OB(o)||bd(o)||uee(o)||dee(o)||o===null||o===void 0}function dee(o){var d=sf(o)&&!mD(o),m=!1,_=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],v,w,D=_.length;for(v=0;v<D;v+=1)w=_[v],m=m||ii(o,w);return d&&m}function uee(o){var d=ac(o),m=!1;return d&&(m=o.filter(function(_){return!bd(_)&&OB(o)}).length===0),d&&m}function hee(o){var d=sf(o)&&!mD(o),m=!1,_=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],v,w;for(v=0;v<_.length;v+=1)w=_[v],m=m||ii(o,w);return d&&m}function pee(o,d){var m=o.diff(d,"days",!0);return m<-6?"sameElse":m<-1?"lastWeek":m<0?"lastDay":m<1?"sameDay":m<2?"nextDay":m<7?"nextWeek":"sameElse"}function fee(o,d){arguments.length===1&&(arguments[0]?lee(arguments[0])?(o=arguments[0],d=void 0):hee(arguments[0])&&(d=arguments[0],o=void 0):(o=void 0,d=void 0));var m=o||Pi(),_=PD(m,this).startOf("day"),v=ft.calendarFormat(this,_)||"sameElse",w=d&&(gl(d[v])?d[v].call(this,m):d[v]);return this.format(w||this.localeData().calendar(v,this,Pi(m)))}function mee(){return new tv(this)}function _ee(o,d){var m=oc(o)?o:Pi(o);return this.isValid()&&m.isValid()?(d=So(d)||"millisecond",d==="millisecond"?this.valueOf()>m.valueOf():m.valueOf()<this.clone().startOf(d).valueOf()):!1}function Eee(o,d){var m=oc(o)?o:Pi(o);return this.isValid()&&m.isValid()?(d=So(d)||"millisecond",d==="millisecond"?this.valueOf()<m.valueOf():this.clone().endOf(d).valueOf()<m.valueOf()):!1}function gee(o,d,m,_){var v=oc(o)?o:Pi(o),w=oc(d)?d:Pi(d);return this.isValid()&&v.isValid()&&w.isValid()?(_=_||"()",(_[0]==="("?this.isAfter(v,m):!this.isBefore(v,m))&&(_[1]===")"?this.isBefore(w,m):!this.isAfter(w,m))):!1}function yee(o,d){var m=oc(o)?o:Pi(o),_;return this.isValid()&&m.isValid()?(d=So(d)||"millisecond",d==="millisecond"?this.valueOf()===m.valueOf():(_=m.valueOf(),this.clone().startOf(d).valueOf()<=_&&_<=this.clone().endOf(d).valueOf())):!1}function See(o,d){return this.isSame(o,d)||this.isAfter(o,d)}function vee(o,d){return this.isSame(o,d)||this.isBefore(o,d)}function Tee(o,d,m){var _,v,w;if(!this.isValid())return NaN;if(_=PD(o,this),!_.isValid())return NaN;switch(v=(_.utcOffset()-this.utcOffset())*6e4,d=So(d),d){case"year":w=vC(this,_)/12;break;case"month":w=vC(this,_);break;case"quarter":w=vC(this,_)/3;break;case"second":w=(this-_)/1e3;break;case"minute":w=(this-_)/6e4;break;case"hour":w=(this-_)/36e5;break;case"day":w=(this-_-v)/864e5;break;case"week":w=(this-_-v)/6048e5;break;default:w=this-_}return m?w:mo(w)}function vC(o,d){if(o.date()<d.date())return-vC(d,o);var m=(d.year()-o.year())*12+(d.month()-o.month()),_=o.clone().add(m,"months"),v,w;return d-_<0?(v=o.clone().add(m-1,"months"),w=(d-_)/(_-v)):(v=o.clone().add(m+1,"months"),w=(d-_)/(v-_)),-(m+w)||0}ft.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";ft.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function Ree(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function bee(o){if(!this.isValid())return null;var d=o!==!0,m=d?this.clone().utc():this;return m.year()<0||m.year()>9999?yC(m,d?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):gl(Date.prototype.toISOString)?d?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",yC(m,"Z")):yC(m,d?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function Cee(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var o="moment",d="",m,_,v,w;return this.isLocal()||(o=this.utcOffset()===0?"moment.utc":"moment.parseZone",d="Z"),m="["+o+'("]',_=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",v="-MM-DD[T]HH:mm:ss.SSS",w=d+'[")]',this.format(m+_+v+w)}function wee(o){o||(o=this.isUtc()?ft.defaultFormatUtc:ft.defaultFormat);var d=yC(this,o);return this.localeData().postformat(d)}function Aee(o,d){return this.isValid()&&(oc(o)&&o.isValid()||Pi(o).isValid())?uc({to:this,from:o}).locale(this.locale()).humanize(!d):this.localeData().invalidDate()}function Oee(o){return this.from(Pi(),o)}function Iee(o,d){return this.isValid()&&(oc(o)&&o.isValid()||Pi(o).isValid())?uc({from:this,to:o}).locale(this.locale()).humanize(!d):this.localeData().invalidDate()}function Nee(o){return this.to(Pi(),o)}function IB(o){var d;return o===void 0?this._locale._abbr:(d=Od(o),d!=null&&(this._locale=d),this)}var NB=yo("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(o){return o===void 0?this.localeData():this.locale(o)});function DB(){return this._locale}var MC=1e3,F_=60*MC,xC=60*F_,kB=(365*400+97)*24*xC;function B_(o,d){return(o%d+d)%d}function PB(o,d,m){return o<100&&o>=0?new Date(o+400,d,m)-kB:new Date(o,d,m).valueOf()}function LB(o,d,m){return o<100&&o>=0?Date.UTC(o+400,d,m)-kB:Date.UTC(o,d,m)}function Dee(o){var d,m;if(o=So(o),o===void 0||o==="millisecond"||!this.isValid())return this;switch(m=this._isUTC?LB:PB,o){case"year":d=m(this.year(),0,1);break;case"quarter":d=m(this.year(),this.month()-this.month()%3,1);break;case"month":d=m(this.year(),this.month(),1);break;case"week":d=m(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":d=m(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":d=m(this.year(),this.month(),this.date());break;case"hour":d=this._d.valueOf(),d-=B_(d+(this._isUTC?0:this.utcOffset()*F_),xC);break;case"minute":d=this._d.valueOf(),d-=B_(d,F_);break;case"second":d=this._d.valueOf(),d-=B_(d,MC);break}return this._d.setTime(d),ft.updateOffset(this,!0),this}function kee(o){var d,m;if(o=So(o),o===void 0||o==="millisecond"||!this.isValid())return this;switch(m=this._isUTC?LB:PB,o){case"year":d=m(this.year()+1,0,1)-1;break;case"quarter":d=m(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":d=m(this.year(),this.month()+1,1)-1;break;case"week":d=m(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":d=m(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":d=m(this.year(),this.month(),this.date()+1)-1;break;case"hour":d=this._d.valueOf(),d+=xC-B_(d+(this._isUTC?0:this.utcOffset()*F_),xC)-1;break;case"minute":d=this._d.valueOf(),d+=F_-B_(d,F_)-1;break;case"second":d=this._d.valueOf(),d+=MC-B_(d,MC)-1;break}return this._d.setTime(d),ft.updateOffset(this,!0),this}function Pee(){return this._d.valueOf()-(this._offset||0)*6e4}function Lee(){return Math.floor(this.valueOf()/1e3)}function Mee(){return new Date(this.valueOf())}function xee(){var o=this;return[o.year(),o.month(),o.date(),o.hour(),o.minute(),o.second(),o.millisecond()]}function Uee(){var o=this;return{years:o.year(),months:o.month(),date:o.date(),hours:o.hours(),minutes:o.minutes(),seconds:o.seconds(),milliseconds:o.milliseconds()}}function Vee(){return this.isValid()?this.toISOString():null}function jee(){return _D(this)}function Fee(){return eh({},Tn(this))}function Bee(){return Tn(this).overflow}function Gee(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}Lt("N",0,0,"eraAbbr");Lt("NN",0,0,"eraAbbr");Lt("NNN",0,0,"eraAbbr");Lt("NNNN",0,0,"eraName");Lt("NNNNN",0,0,"eraNarrow");Lt("y",["y",1],"yo","eraYear");Lt("y",["yy",2],0,"eraYear");Lt("y",["yyy",3],0,"eraYear");Lt("y",["yyyy",4],0,"eraYear");vt("N",LD);vt("NN",LD);vt("NNN",LD);vt("NNNN",$ee);vt("NNNNN",ete);yi(["N","NN","NNN","NNNN","NNNNN"],function(o,d,m,_){var v=m._locale.erasParse(o,_,m._strict);v?Tn(m).era=v:Tn(m).invalidEra=o});vt("y",X_);vt("yy",X_);vt("yyy",X_);vt("yyyy",X_);vt("yo",tte);yi(["y","yy","yyy","yyyy"],ms);yi(["yo"],function(o,d,m,_){var v;m._locale._eraYearOrdinalRegex&&(v=o.match(m._locale._eraYearOrdinalRegex)),m._locale.eraYearOrdinalParse?d[ms]=m._locale.eraYearOrdinalParse(o,v):d[ms]=parseInt(o,10)});function Hee(o,d){var m,_,v,w=this._eras||Od("en")._eras;for(m=0,_=w.length;m<_;++m){switch(typeof w[m].since){case"string":v=ft(w[m].since).startOf("day"),w[m].since=v.valueOf();break}switch(typeof w[m].until){case"undefined":w[m].until=1/0;break;case"string":v=ft(w[m].until).startOf("day").valueOf(),w[m].until=v.valueOf();break}}return w}function Wee(o,d,m){var _,v,w=this.eras(),D,B,W;for(o=o.toUpperCase(),_=0,v=w.length;_<v;++_)if(D=w[_].name.toUpperCase(),B=w[_].abbr.toUpperCase(),W=w[_].narrow.toUpperCase(),m)switch(d){case"N":case"NN":case"NNN":if(B===o)return w[_];break;case"NNNN":if(D===o)return w[_];break;case"NNNNN":if(W===o)return w[_];break}else if([D,B,W].indexOf(o)>=0)return w[_]}function Yee(o,d){var m=o.since<=o.until?1:-1;return d===void 0?ft(o.since).year():ft(o.since).year()+(d-o.offset)*m}function zee(){var o,d,m,_=this.localeData().eras();for(o=0,d=_.length;o<d;++o)if(m=this.clone().startOf("day").valueOf(),_[o].since<=m&&m<=_[o].until||_[o].until<=m&&m<=_[o].since)return _[o].name;return""}function Kee(){var o,d,m,_=this.localeData().eras();for(o=0,d=_.length;o<d;++o)if(m=this.clone().startOf("day").valueOf(),_[o].since<=m&&m<=_[o].until||_[o].until<=m&&m<=_[o].since)return _[o].narrow;return""}function qee(){var o,d,m,_=this.localeData().eras();for(o=0,d=_.length;o<d;++o)if(m=this.clone().startOf("day").valueOf(),_[o].since<=m&&m<=_[o].until||_[o].until<=m&&m<=_[o].since)return _[o].abbr;return""}function Xee(){var o,d,m,_,v=this.localeData().eras();for(o=0,d=v.length;o<d;++o)if(m=v[o].since<=v[o].until?1:-1,_=this.clone().startOf("day").valueOf(),v[o].since<=_&&_<=v[o].until||v[o].until<=_&&_<=v[o].since)return(this.year()-ft(v[o].since).year())*m+v[o].offset;return this.year()}function Jee(o){return ii(this,"_erasNameRegex")||MD.call(this),o?this._erasNameRegex:this._erasRegex}function Zee(o){return ii(this,"_erasAbbrRegex")||MD.call(this),o?this._erasAbbrRegex:this._erasRegex}function Qee(o){return ii(this,"_erasNarrowRegex")||MD.call(this),o?this._erasNarrowRegex:this._erasRegex}function LD(o,d){return d.erasAbbrRegex(o)}function $ee(o,d){return d.erasNameRegex(o)}function ete(o,d){return d.erasNarrowRegex(o)}function tte(o,d){return d._eraYearOrdinalRegex||X_}function MD(){var o=[],d=[],m=[],_=[],v,w,D,B,W,F=this.eras();for(v=0,w=F.length;v<w;++v)D=vd(F[v].name),B=vd(F[v].abbr),W=vd(F[v].narrow),d.push(D),o.push(B),m.push(W),_.push(D),_.push(B),_.push(W);this._erasRegex=new RegExp("^("+_.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+d.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+o.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+m.join("|")+")","i")}Lt(0,["gg",2],0,function(){return this.weekYear()%100});Lt(0,["GG",2],0,function(){return this.isoWeekYear()%100});function tw(o,d){Lt(0,[o,o.length],0,d)}tw("gggg","weekYear");tw("ggggg","weekYear");tw("GGGG","isoWeekYear");tw("GGGGG","isoWeekYear");vt("G",JC);vt("g",JC);vt("GG",Li,Da);vt("gg",Li,Da);vt("GGGG",TD,vD);vt("gggg",TD,vD);vt("GGGGG",XC,KC);vt("ggggg",XC,KC);iv(["gggg","ggggg","GGGG","GGGGG"],function(o,d,m,_){d[_.substr(0,2)]=xn(o)});iv(["gg","GG"],function(o,d,m,_){d[_]=ft.parseTwoDigitYear(o)});function nte(o){return MB.call(this,o,this.week(),this.weekday()+this.localeData()._week.dow,this.localeData()._week.dow,this.localeData()._week.doy)}function ite(o){return MB.call(this,o,this.isoWeek(),this.isoWeekday(),1,4)}function rte(){return Td(this.year(),1,4)}function ste(){return Td(this.isoWeekYear(),1,4)}function ate(){var o=this.localeData()._week;return Td(this.year(),o.dow,o.doy)}function ote(){var o=this.localeData()._week;return Td(this.weekYear(),o.dow,o.doy)}function MB(o,d,m,_,v){var w;return o==null?YS(this,_,v).year:(w=Td(o,_,v),d>w&&(d=w),cte.call(this,o,d,m,_,v))}function cte(o,d,m,_,v){var w=fB(o,d,m,_,v),D=WS(w.year,0,w.dayOfYear);return this.year(D.getUTCFullYear()),this.month(D.getUTCMonth()),this.date(D.getUTCDate()),this}Lt("Q",0,"Qo","quarter");vt("Q",iB);yi("Q",function(o,d){d[gd]=(xn(o)-1)*3});function lte(o){return o==null?Math.ceil((this.month()+1)/3):this.month((o-1)*3+this.month()%3)}Lt("D",["DD",2],"Do","date");vt("D",Li,J_);vt("DD",Li,Da);vt("Do",function(o,d){return o?d._dayOfMonthOrdinalParse||d._ordinalParse:d._dayOfMonthOrdinalParseLenient});yi(["D","DD"],pl);yi("Do",function(o,d){d[pl]=xn(o.match(Li)[0])});var xB=Z_("Date",!0);Lt("DDD",["DDDD",3],"DDDo","dayOfYear");vt("DDD",qC);vt("DDDD",rB);yi(["DDD","DDDD"],function(o,d,m){m._dayOfYear=xn(o)});function dte(o){var d=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return o==null?d:this.add(o-d,"d")}Lt("m",["mm",2],0,"minute");vt("m",Li,RD);vt("mm",Li,Da);yi(["m","mm"],rc);var ute=Z_("Minutes",!1);Lt("s",["ss",2],0,"second");vt("s",Li,RD);vt("ss",Li,Da);yi(["s","ss"],yd);var hte=Z_("Seconds",!1);Lt("S",0,0,function(){return~~(this.millisecond()/100)});Lt(0,["SS",2],0,function(){return~~(this.millisecond()/10)});Lt(0,["SSS",3],0,"millisecond");Lt(0,["SSSS",4],0,function(){return this.millisecond()*10});Lt(0,["SSSSS",5],0,function(){return this.millisecond()*100});Lt(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});Lt(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});Lt(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});Lt(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});vt("S",qC,iB);vt("SS",qC,Da);vt("SSS",qC,rB);var th,UB;for(th="SSSS";th.length<=9;th+="S")vt(th,X_);function pte(o,d){d[tf]=xn(("0."+o)*1e3)}for(th="S";th.length<=9;th+="S")yi(th,pte);UB=Z_("Milliseconds",!1);Lt("z",0,0,"zoneAbbr");Lt("zz",0,0,"zoneName");function fte(){return this._isUTC?"UTC":""}function mte(){return this._isUTC?"Coordinated Universal Time":""}var $e=tv.prototype;$e.add=oee;$e.calendar=fee;$e.clone=mee;$e.diff=Tee;$e.endOf=kee;$e.format=wee;$e.from=Aee;$e.fromNow=Oee;$e.to=Iee;$e.toNow=Nee;$e.get=CQ;$e.invalidAt=Bee;$e.isAfter=_ee;$e.isBefore=Eee;$e.isBetween=gee;$e.isSame=yee;$e.isSameOrAfter=See;$e.isSameOrBefore=vee;$e.isValid=jee;$e.lang=NB;$e.locale=IB;$e.localeData=DB;$e.max=j$;$e.min=V$;$e.parsingFlags=Fee;$e.set=wQ;$e.startOf=Dee;$e.subtract=cee;$e.toArray=xee;$e.toObject=Uee;$e.toDate=Mee;$e.toISOString=bee;$e.inspect=Cee;typeof Symbol<"u"&&Symbol.for!=null&&($e[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"});$e.toJSON=Vee;$e.toString=Ree;$e.unix=Lee;$e.valueOf=Pee;$e.creationData=Gee;$e.eraName=zee;$e.eraNarrow=Kee;$e.eraAbbr=qee;$e.eraYear=Xee;$e.year=oB;$e.isLeapYear=bQ;$e.weekYear=nte;$e.isoWeekYear=ite;$e.quarter=$e.quarters=lte;$e.month=hB;$e.daysInMonth=MQ;$e.week=$e.weeks=HQ;$e.isoWeek=$e.isoWeeks=WQ;$e.weeksInYear=ate;$e.weeksInWeekYear=ote;$e.isoWeeksInYear=rte;$e.isoWeeksInISOWeekYear=ste;$e.date=xB;$e.day=$e.days=i$;$e.weekday=r$;$e.isoWeekday=s$;$e.dayOfYear=dte;$e.hour=$e.hours=h$;$e.minute=$e.minutes=ute;$e.second=$e.seconds=hte;$e.millisecond=$e.milliseconds=UB;$e.utcOffset=q$;$e.utc=J$;$e.local=Z$;$e.parseZone=Q$;$e.hasAlignedHourOffset=$$;$e.isDST=eee;$e.isLocal=nee;$e.isUtcOffset=iee;$e.isUtc=CB;$e.isUTC=CB;$e.zoneAbbr=fte;$e.zoneName=mte;$e.dates=yo("dates accessor is deprecated. Use date instead.",xB);$e.months=yo("months accessor is deprecated. Use month instead",hB);$e.years=yo("years accessor is deprecated. Use year instead",oB);$e.zone=yo("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",X$);$e.isDSTShifted=yo("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",tee);function _te(o){return Pi(o*1e3)}function Ete(){return Pi.apply(null,arguments).parseZone()}function VB(o){return o}var ri=gD.prototype;ri.calendar=nQ;ri.longDateFormat=aQ;ri.invalidDate=cQ;ri.ordinal=uQ;ri.preparse=VB;ri.postformat=VB;ri.relativeTime=pQ;ri.pastFuture=fQ;ri.set=eQ;ri.eras=Hee;ri.erasParse=Wee;ri.erasConvertYear=Yee;ri.erasAbbrRegex=Zee;ri.erasNameRegex=Jee;ri.erasNarrowRegex=Qee;ri.months=DQ;ri.monthsShort=kQ;ri.monthsParse=LQ;ri.monthsRegex=UQ;ri.monthsShortRegex=xQ;ri.week=jQ;ri.firstDayOfYear=GQ;ri.firstDayOfWeek=BQ;ri.weekdays=QQ;ri.weekdaysMin=e$;ri.weekdaysShort=$Q;ri.weekdaysParse=n$;ri.weekdaysRegex=a$;ri.weekdaysShortRegex=o$;ri.weekdaysMinRegex=c$;ri.isPM=d$;ri.meridiem=p$;function UC(o,d,m,_){var v=Od(),w=El().set(_,d);return v[m](w,o)}function jB(o,d,m){if(bd(o)&&(d=o,o=void 0),o=o||"",d!=null)return UC(o,d,m,"month");var _,v=[];for(_=0;_<12;_++)v[_]=UC(o,_,m,"month");return v}function xD(o,d,m,_){typeof o=="boolean"?(bd(d)&&(m=d,d=void 0),d=d||""):(d=o,m=d,o=!1,bd(d)&&(m=d,d=void 0),d=d||"");var v=Od(),w=o?v._week.dow:0,D,B=[];if(m!=null)return UC(d,(m+w)%7,_,"day");for(D=0;D<7;D++)B[D]=UC(d,(D+w)%7,_,"day");return B}function gte(o,d){return jB(o,d,"months")}function yte(o,d){return jB(o,d,"monthsShort")}function Ste(o,d,m){return xD(o,d,m,"weekdays")}function vte(o,d,m){return xD(o,d,m,"weekdaysShort")}function Tte(o,d,m){return xD(o,d,m,"weekdaysMin")}nh("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(o){var d=o%10,m=xn(o%100/10)===1?"th":d===1?"st":d===2?"nd":d===3?"rd":"th";return o+m}});ft.lang=yo("moment.lang is deprecated. Use moment.locale instead.",nh);ft.langData=yo("moment.langData is deprecated. Use moment.localeData instead.",Od);var _d=Math.abs;function Rte(){var o=this._data;return this._milliseconds=_d(this._milliseconds),this._days=_d(this._days),this._months=_d(this._months),o.milliseconds=_d(o.milliseconds),o.seconds=_d(o.seconds),o.minutes=_d(o.minutes),o.hours=_d(o.hours),o.months=_d(o.months),o.years=_d(o.years),this}function FB(o,d,m,_){var v=uc(d,m);return o._milliseconds+=_*v._milliseconds,o._days+=_*v._days,o._months+=_*v._months,o._bubble()}function bte(o,d){return FB(this,o,d,1)}function Cte(o,d){return FB(this,o,d,-1)}function Kj(o){return o<0?Math.floor(o):Math.ceil(o)}function wte(){var o=this._milliseconds,d=this._days,m=this._months,_=this._data,v,w,D,B,W;return o>=0&&d>=0&&m>=0||o<=0&&d<=0&&m<=0||(o+=Kj(K1(m)+d)*864e5,d=0,m=0),_.milliseconds=o%1e3,v=mo(o/1e3),_.seconds=v%60,w=mo(v/60),_.minutes=w%60,D=mo(w/60),_.hours=D%24,d+=mo(D/24),W=mo(BB(d)),m+=W,d-=Kj(K1(W)),B=mo(m/12),m%=12,_.days=d,_.months=m,_.years=B,this}function BB(o){return o*4800/146097}function K1(o){return o*146097/4800}function Ate(o){if(!this.isValid())return NaN;var d,m,_=this._milliseconds;if(o=So(o),o==="month"||o==="quarter"||o==="year")switch(d=this._days+_/864e5,m=this._months+BB(d),o){case"month":return m;case"quarter":return m/3;case"year":return m/12}else switch(d=this._days+Math.round(K1(this._months)),o){case"week":return d/7+_/6048e5;case"day":return d+_/864e5;case"hour":return d*24+_/36e5;case"minute":return d*1440+_/6e4;case"second":return d*86400+_/1e3;case"millisecond":return Math.floor(d*864e5)+_;default:throw new Error("Unknown unit "+o)}}function Id(o){return function(){return this.as(o)}}var GB=Id("ms"),Ote=Id("s"),Ite=Id("m"),Nte=Id("h"),Dte=Id("d"),kte=Id("w"),Pte=Id("M"),Lte=Id("Q"),Mte=Id("y"),xte=GB;function Ute(){return uc(this)}function Vte(o){return o=So(o),this.isValid()?this[o+"s"]():NaN}function lf(o){return function(){return this.isValid()?this._data[o]:NaN}}var jte=lf("milliseconds"),Fte=lf("seconds"),Bte=lf("minutes"),Gte=lf("hours"),Hte=lf("days"),Wte=lf("months"),Yte=lf("years");function zte(){return mo(this.days()/7)}var Ed=Math.round,V_={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function Kte(o,d,m,_,v){return v.relativeTime(d||1,!!m,o,_)}function qte(o,d,m,_){var v=uc(o).abs(),w=Ed(v.as("s")),D=Ed(v.as("m")),B=Ed(v.as("h")),W=Ed(v.as("d")),F=Ed(v.as("M")),X=Ed(v.as("w")),Q=Ed(v.as("y")),oe=w<=m.ss&&["s",w]||w<m.s&&["ss",w]||D<=1&&["m"]||D<m.m&&["mm",D]||B<=1&&["h"]||B<m.h&&["hh",B]||W<=1&&["d"]||W<m.d&&["dd",W];return m.w!=null&&(oe=oe||X<=1&&["w"]||X<m.w&&["ww",X]),oe=oe||F<=1&&["M"]||F<m.M&&["MM",F]||Q<=1&&["y"]||["yy",Q],oe[2]=d,oe[3]=+o>0,oe[4]=_,Kte.apply(null,oe)}function Xte(o){return o===void 0?Ed:typeof o=="function"?(Ed=o,!0):!1}function Jte(o,d){return V_[o]===void 0?!1:d===void 0?V_[o]:(V_[o]=d,o==="s"&&(V_.ss=d-1),!0)}function Zte(o,d){if(!this.isValid())return this.localeData().invalidDate();var m=!1,_=V_,v,w;return typeof o=="object"&&(d=o,o=!1),typeof o=="boolean"&&(m=o),typeof d=="object"&&(_=Object.assign({},V_,d),d.s!=null&&d.ss==null&&(_.ss=d.s-1)),v=this.localeData(),w=qte(this,!m,_,v),m&&(w=v.pastFuture(+this,w)),v.postformat(w)}var A1=Math.abs;function L_(o){return(o>0)-(o<0)||+o}function nw(){if(!this.isValid())return this.localeData().invalidDate();var o=A1(this._milliseconds)/1e3,d=A1(this._days),m=A1(this._months),_,v,w,D,B=this.asSeconds(),W,F,X,Q;return B?(_=mo(o/60),v=mo(_/60),o%=60,_%=60,w=mo(m/12),m%=12,D=o?o.toFixed(3).replace(/\.?0+$/,""):"",W=B<0?"-":"",F=L_(this._months)!==L_(B)?"-":"",X=L_(this._days)!==L_(B)?"-":"",Q=L_(this._milliseconds)!==L_(B)?"-":"",W+"P"+(w?F+w+"Y":"")+(m?F+m+"M":"")+(d?X+d+"D":"")+(v||_||o?"T":"")+(v?Q+v+"H":"")+(_?Q+_+"M":"")+(o?Q+D+"S":"")):"P0D"}var zn=ew.prototype;zn.isValid=W$;zn.abs=Rte;zn.add=bte;zn.subtract=Cte;zn.as=Ate;zn.asMilliseconds=GB;zn.asSeconds=Ote;zn.asMinutes=Ite;zn.asHours=Nte;zn.asDays=Dte;zn.asWeeks=kte;zn.asMonths=Pte;zn.asQuarters=Lte;zn.asYears=Mte;zn.valueOf=xte;zn._bubble=wte;zn.clone=Ute;zn.get=Vte;zn.milliseconds=jte;zn.seconds=Fte;zn.minutes=Bte;zn.hours=Gte;zn.days=Hte;zn.weeks=zte;zn.months=Wte;zn.years=Yte;zn.humanize=Zte;zn.toISOString=nw;zn.toString=nw;zn.toJSON=nw;zn.locale=IB;zn.localeData=DB;zn.toIsoString=yo("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",nw);zn.lang=NB;Lt("X",0,0,"unix");Lt("x",0,0,"valueOf");vt("x",JC);vt("X",gQ);yi("X",function(o,d,m){m._d=new Date(parseFloat(o)*1e3)});yi("x",function(o,d,m){m._d=new Date(xn(o))});//! moment.js
ft.version="2.30.1";QZ(Pi);ft.fn=$e;ft.min=F$;ft.max=B$;ft.now=G$;ft.utc=El;ft.unix=_te;ft.months=gte;ft.isDate=ev;ft.locale=nh;ft.invalid=zC;ft.duration=uc;ft.isMoment=oc;ft.weekdays=Ste;ft.parseZone=Ete;ft.localeData=Od;ft.isDuration=SC;ft.monthsShort=yte;ft.weekdaysMin=Tte;ft.defineLocale=OD;ft.updateLocale=E$;ft.locales=g$;ft.weekdaysShort=vte;ft.normalizeUnits=So;ft.relativeTimeRounding=Xte;ft.relativeTimeThreshold=Jte;ft.calendarFormat=pee;ft.prototype=$e;ft.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};function Qte(o){return An({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(o)}function $te(o){return An({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M629.657 343.598L528.971 444.284c-9.373 9.372-24.568 9.372-33.941 0L394.343 343.598c-9.373-9.373-9.373-24.569 0-33.941l10.823-10.823c9.562-9.562 25.133-9.34 34.419.492L480 342.118V160H292.451a24.005 24.005 0 0 1-16.971-7.029l-16-16C244.361 121.851 255.069 96 276.451 96H520c13.255 0 24 10.745 24 24v222.118l40.416-42.792c9.285-9.831 24.856-10.054 34.419-.492l10.823 10.823c9.372 9.372 9.372 24.569-.001 33.941zm-265.138 15.431A23.999 23.999 0 0 0 347.548 352H160V169.881l40.416 42.792c9.286 9.831 24.856 10.054 34.419.491l10.822-10.822c9.373-9.373 9.373-24.569 0-33.941L144.971 67.716c-9.373-9.373-24.569-9.373-33.941 0L10.343 168.402c-9.373 9.373-9.373 24.569 0 33.941l10.822 10.822c9.562 9.562 25.133 9.34 34.419-.491L96 169.881V392c0 13.255 10.745 24 24 24h243.549c21.382 0 32.09-25.851 16.971-40.971l-16.001-16z"},child:[]}]})(o)}function ene(o){return An({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M144 208c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32zm112 0c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32zm112 0c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32zM256 32C114.6 32 0 125.1 0 240c0 47.6 19.9 91.2 52.9 126.3C38 405.7 7 439.1 6.5 439.5c-6.6 7-8.4 17.2-4.6 26S14.4 480 24 480c61.5 0 110-25.7 139.1-46.3C192 442.8 223.2 448 256 448c141.4 0 256-93.1 256-208S397.4 32 256 32zm0 368c-26.7 0-53.1-4.1-78.4-12.1l-22.7-7.2-19.5 13.8c-14.3 10.1-33.9 21.4-57.5 29 7.3-12.1 14.4-25.7 19.9-40.2l10.6-28.1-20.6-21.8C69.7 314.1 48 282.2 48 240c0-88.2 93.3-160 208-160s208 71.8 208 160-93.3 160-208 160z"},child:[]}]})(o)}function tne(o){return An({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},child:[]}]})(o)}function nne(o){return An({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},child:[]}]})(o)}function ine(o){return An({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"},child:[]},{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z"},child:[]}]})(o)}function rne(o){return An({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"},child:[]}]})(o)}function sne(o){return An({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"},child:[]}]})(o)}const ml=Object.create(null);ml.open="0";ml.close="1";ml.ping="2";ml.pong="3";ml.message="4";ml.upgrade="5";ml.noop="6";const TC=Object.create(null);Object.keys(ml).forEach(o=>{TC[ml[o]]=o});const q1={type:"error",data:"parser error"},HB=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",WB=typeof ArrayBuffer=="function",YB=o=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(o):o&&o.buffer instanceof ArrayBuffer,UD=({type:o,data:d},m,_)=>HB&&d instanceof Blob?m?_(d):qj(d,_):WB&&(d instanceof ArrayBuffer||YB(d))?m?_(d):qj(new Blob([d]),_):_(ml[o]+(d||"")),qj=(o,d)=>{const m=new FileReader;return m.onload=function(){const _=m.result.split(",")[1];d("b"+(_||""))},m.readAsDataURL(o)};function Xj(o){return o instanceof Uint8Array?o:o instanceof ArrayBuffer?new Uint8Array(o):new Uint8Array(o.buffer,o.byteOffset,o.byteLength)}let O1;function ane(o,d){if(HB&&o.data instanceof Blob)return o.data.arrayBuffer().then(Xj).then(d);if(WB&&(o.data instanceof ArrayBuffer||YB(o.data)))return d(Xj(o.data));UD(o,!1,m=>{O1||(O1=new TextEncoder),d(O1.encode(m))})}const Jj="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",VS=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let o=0;o<Jj.length;o++)VS[Jj.charCodeAt(o)]=o;const one=o=>{let d=o.length*.75,m=o.length,_,v=0,w,D,B,W;o[o.length-1]==="="&&(d--,o[o.length-2]==="="&&d--);const F=new ArrayBuffer(d),X=new Uint8Array(F);for(_=0;_<m;_+=4)w=VS[o.charCodeAt(_)],D=VS[o.charCodeAt(_+1)],B=VS[o.charCodeAt(_+2)],W=VS[o.charCodeAt(_+3)],X[v++]=w<<2|D>>4,X[v++]=(D&15)<<4|B>>2,X[v++]=(B&3)<<6|W&63;return F},cne=typeof ArrayBuffer=="function",VD=(o,d)=>{if(typeof o!="string")return{type:"message",data:zB(o,d)};const m=o.charAt(0);return m==="b"?{type:"message",data:lne(o.substring(1),d)}:TC[m]?o.length>1?{type:TC[m],data:o.substring(1)}:{type:TC[m]}:q1},lne=(o,d)=>{if(cne){const m=one(o);return zB(m,d)}else return{base64:!0,data:o}},zB=(o,d)=>{switch(d){case"blob":return o instanceof Blob?o:new Blob([o]);case"arraybuffer":default:return o instanceof ArrayBuffer?o:o.buffer}},KB="",dne=(o,d)=>{const m=o.length,_=new Array(m);let v=0;o.forEach((w,D)=>{UD(w,!1,B=>{_[D]=B,++v===m&&d(_.join(KB))})})},une=(o,d)=>{const m=o.split(KB),_=[];for(let v=0;v<m.length;v++){const w=VD(m[v],d);if(_.push(w),w.type==="error")break}return _};function hne(){return new TransformStream({transform(o,d){ane(o,m=>{const _=m.length;let v;if(_<126)v=new Uint8Array(1),new DataView(v.buffer).setUint8(0,_);else if(_<65536){v=new Uint8Array(3);const w=new DataView(v.buffer);w.setUint8(0,126),w.setUint16(1,_)}else{v=new Uint8Array(9);const w=new DataView(v.buffer);w.setUint8(0,127),w.setBigUint64(1,BigInt(_))}o.data&&typeof o.data!="string"&&(v[0]|=128),d.enqueue(v),d.enqueue(m)})}})}let I1;function lC(o){return o.reduce((d,m)=>d+m.length,0)}function dC(o,d){if(o[0].length===d)return o.shift();const m=new Uint8Array(d);let _=0;for(let v=0;v<d;v++)m[v]=o[0][_++],_===o[0].length&&(o.shift(),_=0);return o.length&&_<o[0].length&&(o[0]=o[0].slice(_)),m}function pne(o,d){I1||(I1=new TextDecoder);const m=[];let _=0,v=-1,w=!1;return new TransformStream({transform(D,B){for(m.push(D);;){if(_===0){if(lC(m)<1)break;const W=dC(m,1);w=(W[0]&128)===128,v=W[0]&127,v<126?_=3:v===126?_=1:_=2}else if(_===1){if(lC(m)<2)break;const W=dC(m,2);v=new DataView(W.buffer,W.byteOffset,W.length).getUint16(0),_=3}else if(_===2){if(lC(m)<8)break;const W=dC(m,8),F=new DataView(W.buffer,W.byteOffset,W.length),X=F.getUint32(0);if(X>Math.pow(2,21)-1){B.enqueue(q1);break}v=X*Math.pow(2,32)+F.getUint32(4),_=3}else{if(lC(m)<v)break;const W=dC(m,v);B.enqueue(VD(w?W:I1.decode(W),d)),_=0}if(v===0||v>o){B.enqueue(q1);break}}}})}const qB=4;function Rr(o){if(o)return fne(o)}function fne(o){for(var d in Rr.prototype)o[d]=Rr.prototype[d];return o}Rr.prototype.on=Rr.prototype.addEventListener=function(o,d){return this._callbacks=this._callbacks||{},(this._callbacks["$"+o]=this._callbacks["$"+o]||[]).push(d),this};Rr.prototype.once=function(o,d){function m(){this.off(o,m),d.apply(this,arguments)}return m.fn=d,this.on(o,m),this};Rr.prototype.off=Rr.prototype.removeListener=Rr.prototype.removeAllListeners=Rr.prototype.removeEventListener=function(o,d){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var m=this._callbacks["$"+o];if(!m)return this;if(arguments.length==1)return delete this._callbacks["$"+o],this;for(var _,v=0;v<m.length;v++)if(_=m[v],_===d||_.fn===d){m.splice(v,1);break}return m.length===0&&delete this._callbacks["$"+o],this};Rr.prototype.emit=function(o){this._callbacks=this._callbacks||{};for(var d=new Array(arguments.length-1),m=this._callbacks["$"+o],_=1;_<arguments.length;_++)d[_-1]=arguments[_];if(m){m=m.slice(0);for(var _=0,v=m.length;_<v;++_)m[_].apply(this,d)}return this};Rr.prototype.emitReserved=Rr.prototype.emit;Rr.prototype.listeners=function(o){return this._callbacks=this._callbacks||{},this._callbacks["$"+o]||[]};Rr.prototype.hasListeners=function(o){return!!this.listeners(o).length};const iw=typeof Promise=="function"&&typeof Promise.resolve=="function"?d=>Promise.resolve().then(d):(d,m)=>m(d,0),_o=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),mne="arraybuffer";function XB(o,...d){return d.reduce((m,_)=>(o.hasOwnProperty(_)&&(m[_]=o[_]),m),{})}const _ne=_o.setTimeout,Ene=_o.clearTimeout;function rw(o,d){d.useNativeTimers?(o.setTimeoutFn=_ne.bind(_o),o.clearTimeoutFn=Ene.bind(_o)):(o.setTimeoutFn=_o.setTimeout.bind(_o),o.clearTimeoutFn=_o.clearTimeout.bind(_o))}const gne=1.33;function yne(o){return typeof o=="string"?Sne(o):Math.ceil((o.byteLength||o.size)*gne)}function Sne(o){let d=0,m=0;for(let _=0,v=o.length;_<v;_++)d=o.charCodeAt(_),d<128?m+=1:d<2048?m+=2:d<55296||d>=57344?m+=3:(_++,m+=4);return m}function JB(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function vne(o){let d="";for(let m in o)o.hasOwnProperty(m)&&(d.length&&(d+="&"),d+=encodeURIComponent(m)+"="+encodeURIComponent(o[m]));return d}function Tne(o){let d={},m=o.split("&");for(let _=0,v=m.length;_<v;_++){let w=m[_].split("=");d[decodeURIComponent(w[0])]=decodeURIComponent(w[1])}return d}class Rne extends Error{constructor(d,m,_){super(d),this.description=m,this.context=_,this.type="TransportError"}}class jD extends Rr{constructor(d){super(),this.writable=!1,rw(this,d),this.opts=d,this.query=d.query,this.socket=d.socket,this.supportsBinary=!d.forceBase64}onError(d,m,_){return super.emitReserved("error",new Rne(d,m,_)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(d){this.readyState==="open"&&this.write(d)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(d){const m=VD(d,this.socket.binaryType);this.onPacket(m)}onPacket(d){super.emitReserved("packet",d)}onClose(d){this.readyState="closed",super.emitReserved("close",d)}pause(d){}createUri(d,m={}){return d+"://"+this._hostname()+this._port()+this.opts.path+this._query(m)}_hostname(){const d=this.opts.hostname;return d.indexOf(":")===-1?d:"["+d+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(d){const m=vne(d);return m.length?"?"+m:""}}class bne extends jD{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(d){this.readyState="pausing";const m=()=>{this.readyState="paused",d()};if(this._polling||!this.writable){let _=0;this._polling&&(_++,this.once("pollComplete",function(){--_||m()})),this.writable||(_++,this.once("drain",function(){--_||m()}))}else m()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(d){const m=_=>{if(this.readyState==="opening"&&_.type==="open"&&this.onOpen(),_.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(_)};une(d,this.socket.binaryType).forEach(m),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const d=()=>{this.write([{type:"close"}])};this.readyState==="open"?d():this.once("open",d)}write(d){this.writable=!1,dne(d,m=>{this.doWrite(m,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const d=this.opts.secure?"https":"http",m=this.query||{};return this.opts.timestampRequests!==!1&&(m[this.opts.timestampParam]=JB()),!this.supportsBinary&&!m.sid&&(m.b64=1),this.createUri(d,m)}}let ZB=!1;try{ZB=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Cne=ZB;function wne(){}class Ane extends bne{constructor(d){if(super(d),typeof location<"u"){const m=location.protocol==="https:";let _=location.port;_||(_=m?"443":"80"),this.xd=typeof location<"u"&&d.hostname!==location.hostname||_!==d.port}}doWrite(d,m){const _=this.request({method:"POST",data:d});_.on("success",m),_.on("error",(v,w)=>{this.onError("xhr post error",v,w)})}doPoll(){const d=this.request();d.on("data",this.onData.bind(this)),d.on("error",(m,_)=>{this.onError("xhr poll error",m,_)}),this.pollXhr=d}}let G_=class RC extends Rr{constructor(d,m,_){super(),this.createRequest=d,rw(this,_),this._opts=_,this._method=_.method||"GET",this._uri=m,this._data=_.data!==void 0?_.data:null,this._create()}_create(){var d;const m=XB(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");m.xdomain=!!this._opts.xd;const _=this._xhr=this.createRequest(m);try{_.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){_.setDisableHeaderCheck&&_.setDisableHeaderCheck(!0);for(let v in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(v)&&_.setRequestHeader(v,this._opts.extraHeaders[v])}}catch{}if(this._method==="POST")try{_.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{_.setRequestHeader("Accept","*/*")}catch{}(d=this._opts.cookieJar)===null||d===void 0||d.addCookies(_),"withCredentials"in _&&(_.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(_.timeout=this._opts.requestTimeout),_.onreadystatechange=()=>{var v;_.readyState===3&&((v=this._opts.cookieJar)===null||v===void 0||v.parseCookies(_.getResponseHeader("set-cookie"))),_.readyState===4&&(_.status===200||_.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof _.status=="number"?_.status:0)},0))},_.send(this._data)}catch(v){this.setTimeoutFn(()=>{this._onError(v)},0);return}typeof document<"u"&&(this._index=RC.requestsCount++,RC.requests[this._index]=this)}_onError(d){this.emitReserved("error",d,this._xhr),this._cleanup(!0)}_cleanup(d){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=wne,d)try{this._xhr.abort()}catch{}typeof document<"u"&&delete RC.requests[this._index],this._xhr=null}}_onLoad(){const d=this._xhr.responseText;d!==null&&(this.emitReserved("data",d),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};G_.requestsCount=0;G_.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Zj);else if(typeof addEventListener=="function"){const o="onpagehide"in _o?"pagehide":"unload";addEventListener(o,Zj,!1)}}function Zj(){for(let o in G_.requests)G_.requests.hasOwnProperty(o)&&G_.requests[o].abort()}const One=function(){const o=QB({xdomain:!1});return o&&o.responseType!==null}();class Ine extends Ane{constructor(d){super(d);const m=d&&d.forceBase64;this.supportsBinary=One&&!m}request(d={}){return Object.assign(d,{xd:this.xd},this.opts),new G_(QB,this.uri(),d)}}function QB(o){const d=o.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!d||Cne))return new XMLHttpRequest}catch{}if(!d)try{return new _o[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const $B=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Nne extends jD{get name(){return"websocket"}doOpen(){const d=this.uri(),m=this.opts.protocols,_=$B?{}:XB(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(_.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(d,m,_)}catch(v){return this.emitReserved("error",v)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=d=>this.onClose({description:"websocket connection closed",context:d}),this.ws.onmessage=d=>this.onData(d.data),this.ws.onerror=d=>this.onError("websocket error",d)}write(d){this.writable=!1;for(let m=0;m<d.length;m++){const _=d[m],v=m===d.length-1;UD(_,this.supportsBinary,w=>{try{this.doWrite(_,w)}catch{}v&&iw(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const d=this.opts.secure?"wss":"ws",m=this.query||{};return this.opts.timestampRequests&&(m[this.opts.timestampParam]=JB()),this.supportsBinary||(m.b64=1),this.createUri(d,m)}}const N1=_o.WebSocket||_o.MozWebSocket;class Dne extends Nne{createSocket(d,m,_){return $B?new N1(d,m,_):m?new N1(d,m):new N1(d)}doWrite(d,m){this.ws.send(m)}}class kne extends jD{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(d){return this.emitReserved("error",d)}this._transport.closed.then(()=>{this.onClose()}).catch(d=>{this.onError("webtransport error",d)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(d=>{const m=pne(Number.MAX_SAFE_INTEGER,this.socket.binaryType),_=d.readable.pipeThrough(m).getReader(),v=hne();v.readable.pipeTo(d.writable),this._writer=v.writable.getWriter();const w=()=>{_.read().then(({done:B,value:W})=>{B||(this.onPacket(W),w())}).catch(B=>{})};w();const D={type:"open"};this.query.sid&&(D.data=`{"sid":"${this.query.sid}"}`),this._writer.write(D).then(()=>this.onOpen())})})}write(d){this.writable=!1;for(let m=0;m<d.length;m++){const _=d[m],v=m===d.length-1;this._writer.write(_).then(()=>{v&&iw(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var d;(d=this._transport)===null||d===void 0||d.close()}}const Pne={websocket:Dne,webtransport:kne,polling:Ine},Lne=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Mne=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function X1(o){if(o.length>8e3)throw"URI too long";const d=o,m=o.indexOf("["),_=o.indexOf("]");m!=-1&&_!=-1&&(o=o.substring(0,m)+o.substring(m,_).replace(/:/g,";")+o.substring(_,o.length));let v=Lne.exec(o||""),w={},D=14;for(;D--;)w[Mne[D]]=v[D]||"";return m!=-1&&_!=-1&&(w.source=d,w.host=w.host.substring(1,w.host.length-1).replace(/;/g,":"),w.authority=w.authority.replace("[","").replace("]","").replace(/;/g,":"),w.ipv6uri=!0),w.pathNames=xne(w,w.path),w.queryKey=Une(w,w.query),w}function xne(o,d){const m=/\/{2,9}/g,_=d.replace(m,"/").split("/");return(d.slice(0,1)=="/"||d.length===0)&&_.splice(0,1),d.slice(-1)=="/"&&_.splice(_.length-1,1),_}function Une(o,d){const m={};return d.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(_,v,w){v&&(m[v]=w)}),m}const J1=typeof addEventListener=="function"&&typeof removeEventListener=="function",bC=[];J1&&addEventListener("offline",()=>{bC.forEach(o=>o())},!1);class ih extends Rr{constructor(d,m){if(super(),this.binaryType=mne,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,d&&typeof d=="object"&&(m=d,d=null),d){const _=X1(d);m.hostname=_.host,m.secure=_.protocol==="https"||_.protocol==="wss",m.port=_.port,_.query&&(m.query=_.query)}else m.host&&(m.hostname=X1(m.host).host);rw(this,m),this.secure=m.secure!=null?m.secure:typeof location<"u"&&location.protocol==="https:",m.hostname&&!m.port&&(m.port=this.secure?"443":"80"),this.hostname=m.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=m.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},m.transports.forEach(_=>{const v=_.prototype.name;this.transports.push(v),this._transportsByName[v]=_}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},m),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Tne(this.opts.query)),J1&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},bC.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(d){const m=Object.assign({},this.opts.query);m.EIO=qB,m.transport=d,this.id&&(m.sid=this.id);const _=Object.assign({},this.opts,{query:m,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[d]);return new this._transportsByName[d](_)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const d=this.opts.rememberUpgrade&&ih.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const m=this.createTransport(d);m.open(),this.setTransport(m)}setTransport(d){this.transport&&this.transport.removeAllListeners(),this.transport=d,d.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",m=>this._onClose("transport close",m))}onOpen(){this.readyState="open",ih.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(d){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",d),this.emitReserved("heartbeat"),d.type){case"open":this.onHandshake(JSON.parse(d.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const m=new Error("server error");m.code=d.data,this._onError(m);break;case"message":this.emitReserved("data",d.data),this.emitReserved("message",d.data);break}}onHandshake(d){this.emitReserved("handshake",d),this.id=d.sid,this.transport.query.sid=d.sid,this._pingInterval=d.pingInterval,this._pingTimeout=d.pingTimeout,this._maxPayload=d.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const d=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+d,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},d),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const d=this._getWritablePackets();this.transport.send(d),this._prevBufferLen=d.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let m=1;for(let _=0;_<this.writeBuffer.length;_++){const v=this.writeBuffer[_].data;if(v&&(m+=yne(v)),_>0&&m>this._maxPayload)return this.writeBuffer.slice(0,_);m+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const d=Date.now()>this._pingTimeoutTime;return d&&(this._pingTimeoutTime=0,iw(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),d}write(d,m,_){return this._sendPacket("message",d,m,_),this}send(d,m,_){return this._sendPacket("message",d,m,_),this}_sendPacket(d,m,_,v){if(typeof m=="function"&&(v=m,m=void 0),typeof _=="function"&&(v=_,_=null),this.readyState==="closing"||this.readyState==="closed")return;_=_||{},_.compress=_.compress!==!1;const w={type:d,data:m,options:_};this.emitReserved("packetCreate",w),this.writeBuffer.push(w),v&&this.once("flush",v),this.flush()}close(){const d=()=>{this._onClose("forced close"),this.transport.close()},m=()=>{this.off("upgrade",m),this.off("upgradeError",m),d()},_=()=>{this.once("upgrade",m),this.once("upgradeError",m)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?_():d()}):this.upgrading?_():d()),this}_onError(d){if(ih.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",d),this._onClose("transport error",d)}_onClose(d,m){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),J1&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const _=bC.indexOf(this._offlineEventListener);_!==-1&&bC.splice(_,1)}this.readyState="closed",this.id=null,this.emitReserved("close",d,m),this.writeBuffer=[],this._prevBufferLen=0}}}ih.protocol=qB;class Vne extends ih{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let d=0;d<this._upgrades.length;d++)this._probe(this._upgrades[d])}_probe(d){let m=this.createTransport(d),_=!1;ih.priorWebsocketSuccess=!1;const v=()=>{_||(m.send([{type:"ping",data:"probe"}]),m.once("packet",Q=>{if(!_)if(Q.type==="pong"&&Q.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",m),!m)return;ih.priorWebsocketSuccess=m.name==="websocket",this.transport.pause(()=>{_||this.readyState!=="closed"&&(X(),this.setTransport(m),m.send([{type:"upgrade"}]),this.emitReserved("upgrade",m),m=null,this.upgrading=!1,this.flush())})}else{const oe=new Error("probe error");oe.transport=m.name,this.emitReserved("upgradeError",oe)}}))};function w(){_||(_=!0,X(),m.close(),m=null)}const D=Q=>{const oe=new Error("probe error: "+Q);oe.transport=m.name,w(),this.emitReserved("upgradeError",oe)};function B(){D("transport closed")}function W(){D("socket closed")}function F(Q){m&&Q.name!==m.name&&w()}const X=()=>{m.removeListener("open",v),m.removeListener("error",D),m.removeListener("close",B),this.off("close",W),this.off("upgrading",F)};m.once("open",v),m.once("error",D),m.once("close",B),this.once("close",W),this.once("upgrading",F),this._upgrades.indexOf("webtransport")!==-1&&d!=="webtransport"?this.setTimeoutFn(()=>{_||m.open()},200):m.open()}onHandshake(d){this._upgrades=this._filterUpgrades(d.upgrades),super.onHandshake(d)}_filterUpgrades(d){const m=[];for(let _=0;_<d.length;_++)~this.transports.indexOf(d[_])&&m.push(d[_]);return m}}let jne=class extends Vne{constructor(d,m={}){const _=typeof d=="object"?d:m;(!_.transports||_.transports&&typeof _.transports[0]=="string")&&(_.transports=(_.transports||["polling","websocket","webtransport"]).map(v=>Pne[v]).filter(v=>!!v)),super(d,_)}};function Fne(o,d="",m){let _=o;m=m||typeof location<"u"&&location,o==null&&(o=m.protocol+"//"+m.host),typeof o=="string"&&(o.charAt(0)==="/"&&(o.charAt(1)==="/"?o=m.protocol+o:o=m.host+o),/^(https?|wss?):\/\//.test(o)||(typeof m<"u"?o=m.protocol+"//"+o:o="https://"+o),_=X1(o)),_.port||(/^(http|ws)$/.test(_.protocol)?_.port="80":/^(http|ws)s$/.test(_.protocol)&&(_.port="443")),_.path=_.path||"/";const w=_.host.indexOf(":")!==-1?"["+_.host+"]":_.host;return _.id=_.protocol+"://"+w+":"+_.port+d,_.href=_.protocol+"://"+w+(m&&m.port===_.port?"":":"+_.port),_}const Bne=typeof ArrayBuffer=="function",Gne=o=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(o):o.buffer instanceof ArrayBuffer,e6=Object.prototype.toString,Hne=typeof Blob=="function"||typeof Blob<"u"&&e6.call(Blob)==="[object BlobConstructor]",Wne=typeof File=="function"||typeof File<"u"&&e6.call(File)==="[object FileConstructor]";function FD(o){return Bne&&(o instanceof ArrayBuffer||Gne(o))||Hne&&o instanceof Blob||Wne&&o instanceof File}function CC(o,d){if(!o||typeof o!="object")return!1;if(Array.isArray(o)){for(let m=0,_=o.length;m<_;m++)if(CC(o[m]))return!0;return!1}if(FD(o))return!0;if(o.toJSON&&typeof o.toJSON=="function"&&arguments.length===1)return CC(o.toJSON(),!0);for(const m in o)if(Object.prototype.hasOwnProperty.call(o,m)&&CC(o[m]))return!0;return!1}function Yne(o){const d=[],m=o.data,_=o;return _.data=Z1(m,d),_.attachments=d.length,{packet:_,buffers:d}}function Z1(o,d){if(!o)return o;if(FD(o)){const m={_placeholder:!0,num:d.length};return d.push(o),m}else if(Array.isArray(o)){const m=new Array(o.length);for(let _=0;_<o.length;_++)m[_]=Z1(o[_],d);return m}else if(typeof o=="object"&&!(o instanceof Date)){const m={};for(const _ in o)Object.prototype.hasOwnProperty.call(o,_)&&(m[_]=Z1(o[_],d));return m}return o}function zne(o,d){return o.data=Q1(o.data,d),delete o.attachments,o}function Q1(o,d){if(!o)return o;if(o&&o._placeholder===!0){if(typeof o.num=="number"&&o.num>=0&&o.num<d.length)return d[o.num];throw new Error("illegal attachments")}else if(Array.isArray(o))for(let m=0;m<o.length;m++)o[m]=Q1(o[m],d);else if(typeof o=="object")for(const m in o)Object.prototype.hasOwnProperty.call(o,m)&&(o[m]=Q1(o[m],d));return o}const Kne=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],qne=5;var Bn;(function(o){o[o.CONNECT=0]="CONNECT",o[o.DISCONNECT=1]="DISCONNECT",o[o.EVENT=2]="EVENT",o[o.ACK=3]="ACK",o[o.CONNECT_ERROR=4]="CONNECT_ERROR",o[o.BINARY_EVENT=5]="BINARY_EVENT",o[o.BINARY_ACK=6]="BINARY_ACK"})(Bn||(Bn={}));class Xne{constructor(d){this.replacer=d}encode(d){return(d.type===Bn.EVENT||d.type===Bn.ACK)&&CC(d)?this.encodeAsBinary({type:d.type===Bn.EVENT?Bn.BINARY_EVENT:Bn.BINARY_ACK,nsp:d.nsp,data:d.data,id:d.id}):[this.encodeAsString(d)]}encodeAsString(d){let m=""+d.type;return(d.type===Bn.BINARY_EVENT||d.type===Bn.BINARY_ACK)&&(m+=d.attachments+"-"),d.nsp&&d.nsp!=="/"&&(m+=d.nsp+","),d.id!=null&&(m+=d.id),d.data!=null&&(m+=JSON.stringify(d.data,this.replacer)),m}encodeAsBinary(d){const m=Yne(d),_=this.encodeAsString(m.packet),v=m.buffers;return v.unshift(_),v}}function Qj(o){return Object.prototype.toString.call(o)==="[object Object]"}class BD extends Rr{constructor(d){super(),this.reviver=d}add(d){let m;if(typeof d=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");m=this.decodeString(d);const _=m.type===Bn.BINARY_EVENT;_||m.type===Bn.BINARY_ACK?(m.type=_?Bn.EVENT:Bn.ACK,this.reconstructor=new Jne(m),m.attachments===0&&super.emitReserved("decoded",m)):super.emitReserved("decoded",m)}else if(FD(d)||d.base64)if(this.reconstructor)m=this.reconstructor.takeBinaryData(d),m&&(this.reconstructor=null,super.emitReserved("decoded",m));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+d)}decodeString(d){let m=0;const _={type:Number(d.charAt(0))};if(Bn[_.type]===void 0)throw new Error("unknown packet type "+_.type);if(_.type===Bn.BINARY_EVENT||_.type===Bn.BINARY_ACK){const w=m+1;for(;d.charAt(++m)!=="-"&&m!=d.length;);const D=d.substring(w,m);if(D!=Number(D)||d.charAt(m)!=="-")throw new Error("Illegal attachments");_.attachments=Number(D)}if(d.charAt(m+1)==="/"){const w=m+1;for(;++m&&!(d.charAt(m)===","||m===d.length););_.nsp=d.substring(w,m)}else _.nsp="/";const v=d.charAt(m+1);if(v!==""&&Number(v)==v){const w=m+1;for(;++m;){const D=d.charAt(m);if(D==null||Number(D)!=D){--m;break}if(m===d.length)break}_.id=Number(d.substring(w,m+1))}if(d.charAt(++m)){const w=this.tryParse(d.substr(m));if(BD.isPayloadValid(_.type,w))_.data=w;else throw new Error("invalid payload")}return _}tryParse(d){try{return JSON.parse(d,this.reviver)}catch{return!1}}static isPayloadValid(d,m){switch(d){case Bn.CONNECT:return Qj(m);case Bn.DISCONNECT:return m===void 0;case Bn.CONNECT_ERROR:return typeof m=="string"||Qj(m);case Bn.EVENT:case Bn.BINARY_EVENT:return Array.isArray(m)&&(typeof m[0]=="number"||typeof m[0]=="string"&&Kne.indexOf(m[0])===-1);case Bn.ACK:case Bn.BINARY_ACK:return Array.isArray(m)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Jne{constructor(d){this.packet=d,this.buffers=[],this.reconPack=d}takeBinaryData(d){if(this.buffers.push(d),this.buffers.length===this.reconPack.attachments){const m=zne(this.reconPack,this.buffers);return this.finishedReconstruction(),m}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Zne=Object.freeze(Object.defineProperty({__proto__:null,Decoder:BD,Encoder:Xne,get PacketType(){return Bn},protocol:qne},Symbol.toStringTag,{value:"Module"}));function ic(o,d,m){return o.on(d,m),function(){o.off(d,m)}}const Qne=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class t6 extends Rr{constructor(d,m,_){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=d,this.nsp=m,_&&_.auth&&(this.auth=_.auth),this._opts=Object.assign({},_),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const d=this.io;this.subs=[ic(d,"open",this.onopen.bind(this)),ic(d,"packet",this.onpacket.bind(this)),ic(d,"error",this.onerror.bind(this)),ic(d,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...d){return d.unshift("message"),this.emit.apply(this,d),this}emit(d,...m){var _,v,w;if(Qne.hasOwnProperty(d))throw new Error('"'+d.toString()+'" is a reserved event name');if(m.unshift(d),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(m),this;const D={type:Bn.EVENT,data:m};if(D.options={},D.options.compress=this.flags.compress!==!1,typeof m[m.length-1]=="function"){const X=this.ids++,Q=m.pop();this._registerAckCallback(X,Q),D.id=X}const B=(v=(_=this.io.engine)===null||_===void 0?void 0:_.transport)===null||v===void 0?void 0:v.writable,W=this.connected&&!(!((w=this.io.engine)===null||w===void 0)&&w._hasPingExpired());return this.flags.volatile&&!B||(W?(this.notifyOutgoingListeners(D),this.packet(D)):this.sendBuffer.push(D)),this.flags={},this}_registerAckCallback(d,m){var _;const v=(_=this.flags.timeout)!==null&&_!==void 0?_:this._opts.ackTimeout;if(v===void 0){this.acks[d]=m;return}const w=this.io.setTimeoutFn(()=>{delete this.acks[d];for(let B=0;B<this.sendBuffer.length;B++)this.sendBuffer[B].id===d&&this.sendBuffer.splice(B,1);m.call(this,new Error("operation has timed out"))},v),D=(...B)=>{this.io.clearTimeoutFn(w),m.apply(this,B)};D.withError=!0,this.acks[d]=D}emitWithAck(d,...m){return new Promise((_,v)=>{const w=(D,B)=>D?v(D):_(B);w.withError=!0,m.push(w),this.emit(d,...m)})}_addToQueue(d){let m;typeof d[d.length-1]=="function"&&(m=d.pop());const _={id:this._queueSeq++,tryCount:0,pending:!1,args:d,flags:Object.assign({fromQueue:!0},this.flags)};d.push((v,...w)=>_!==this._queue[0]?void 0:(v!==null?_.tryCount>this._opts.retries&&(this._queue.shift(),m&&m(v)):(this._queue.shift(),m&&m(null,...w)),_.pending=!1,this._drainQueue())),this._queue.push(_),this._drainQueue()}_drainQueue(d=!1){if(!this.connected||this._queue.length===0)return;const m=this._queue[0];m.pending&&!d||(m.pending=!0,m.tryCount++,this.flags=m.flags,this.emit.apply(this,m.args))}packet(d){d.nsp=this.nsp,this.io._packet(d)}onopen(){typeof this.auth=="function"?this.auth(d=>{this._sendConnectPacket(d)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(d){this.packet({type:Bn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},d):d})}onerror(d){this.connected||this.emitReserved("connect_error",d)}onclose(d,m){this.connected=!1,delete this.id,this.emitReserved("disconnect",d,m),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(d=>{if(!this.sendBuffer.some(_=>String(_.id)===d)){const _=this.acks[d];delete this.acks[d],_.withError&&_.call(this,new Error("socket has been disconnected"))}})}onpacket(d){if(d.nsp===this.nsp)switch(d.type){case Bn.CONNECT:d.data&&d.data.sid?this.onconnect(d.data.sid,d.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Bn.EVENT:case Bn.BINARY_EVENT:this.onevent(d);break;case Bn.ACK:case Bn.BINARY_ACK:this.onack(d);break;case Bn.DISCONNECT:this.ondisconnect();break;case Bn.CONNECT_ERROR:this.destroy();const _=new Error(d.data.message);_.data=d.data.data,this.emitReserved("connect_error",_);break}}onevent(d){const m=d.data||[];d.id!=null&&m.push(this.ack(d.id)),this.connected?this.emitEvent(m):this.receiveBuffer.push(Object.freeze(m))}emitEvent(d){if(this._anyListeners&&this._anyListeners.length){const m=this._anyListeners.slice();for(const _ of m)_.apply(this,d)}super.emit.apply(this,d),this._pid&&d.length&&typeof d[d.length-1]=="string"&&(this._lastOffset=d[d.length-1])}ack(d){const m=this;let _=!1;return function(...v){_||(_=!0,m.packet({type:Bn.ACK,id:d,data:v}))}}onack(d){const m=this.acks[d.id];typeof m=="function"&&(delete this.acks[d.id],m.withError&&d.data.unshift(null),m.apply(this,d.data))}onconnect(d,m){this.id=d,this.recovered=m&&this._pid===m,this._pid=m,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(d=>this.emitEvent(d)),this.receiveBuffer=[],this.sendBuffer.forEach(d=>{this.notifyOutgoingListeners(d),this.packet(d)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(d=>d()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Bn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(d){return this.flags.compress=d,this}get volatile(){return this.flags.volatile=!0,this}timeout(d){return this.flags.timeout=d,this}onAny(d){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(d),this}prependAny(d){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(d),this}offAny(d){if(!this._anyListeners)return this;if(d){const m=this._anyListeners;for(let _=0;_<m.length;_++)if(d===m[_])return m.splice(_,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(d){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(d),this}prependAnyOutgoing(d){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(d),this}offAnyOutgoing(d){if(!this._anyOutgoingListeners)return this;if(d){const m=this._anyOutgoingListeners;for(let _=0;_<m.length;_++)if(d===m[_])return m.splice(_,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(d){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const m=this._anyOutgoingListeners.slice();for(const _ of m)_.apply(this,d.data)}}}function Q_(o){o=o||{},this.ms=o.min||100,this.max=o.max||1e4,this.factor=o.factor||2,this.jitter=o.jitter>0&&o.jitter<=1?o.jitter:0,this.attempts=0}Q_.prototype.duration=function(){var o=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var d=Math.random(),m=Math.floor(d*this.jitter*o);o=(Math.floor(d*10)&1)==0?o-m:o+m}return Math.min(o,this.max)|0};Q_.prototype.reset=function(){this.attempts=0};Q_.prototype.setMin=function(o){this.ms=o};Q_.prototype.setMax=function(o){this.max=o};Q_.prototype.setJitter=function(o){this.jitter=o};class $1 extends Rr{constructor(d,m){var _;super(),this.nsps={},this.subs=[],d&&typeof d=="object"&&(m=d,d=void 0),m=m||{},m.path=m.path||"/socket.io",this.opts=m,rw(this,m),this.reconnection(m.reconnection!==!1),this.reconnectionAttempts(m.reconnectionAttempts||1/0),this.reconnectionDelay(m.reconnectionDelay||1e3),this.reconnectionDelayMax(m.reconnectionDelayMax||5e3),this.randomizationFactor((_=m.randomizationFactor)!==null&&_!==void 0?_:.5),this.backoff=new Q_({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(m.timeout==null?2e4:m.timeout),this._readyState="closed",this.uri=d;const v=m.parser||Zne;this.encoder=new v.Encoder,this.decoder=new v.Decoder,this._autoConnect=m.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(d){return arguments.length?(this._reconnection=!!d,d||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(d){return d===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=d,this)}reconnectionDelay(d){var m;return d===void 0?this._reconnectionDelay:(this._reconnectionDelay=d,(m=this.backoff)===null||m===void 0||m.setMin(d),this)}randomizationFactor(d){var m;return d===void 0?this._randomizationFactor:(this._randomizationFactor=d,(m=this.backoff)===null||m===void 0||m.setJitter(d),this)}reconnectionDelayMax(d){var m;return d===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=d,(m=this.backoff)===null||m===void 0||m.setMax(d),this)}timeout(d){return arguments.length?(this._timeout=d,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(d){if(~this._readyState.indexOf("open"))return this;this.engine=new jne(this.uri,this.opts);const m=this.engine,_=this;this._readyState="opening",this.skipReconnect=!1;const v=ic(m,"open",function(){_.onopen(),d&&d()}),w=B=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",B),d?d(B):this.maybeReconnectOnOpen()},D=ic(m,"error",w);if(this._timeout!==!1){const B=this._timeout,W=this.setTimeoutFn(()=>{v(),w(new Error("timeout")),m.close()},B);this.opts.autoUnref&&W.unref(),this.subs.push(()=>{this.clearTimeoutFn(W)})}return this.subs.push(v),this.subs.push(D),this}connect(d){return this.open(d)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const d=this.engine;this.subs.push(ic(d,"ping",this.onping.bind(this)),ic(d,"data",this.ondata.bind(this)),ic(d,"error",this.onerror.bind(this)),ic(d,"close",this.onclose.bind(this)),ic(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(d){try{this.decoder.add(d)}catch(m){this.onclose("parse error",m)}}ondecoded(d){iw(()=>{this.emitReserved("packet",d)},this.setTimeoutFn)}onerror(d){this.emitReserved("error",d)}socket(d,m){let _=this.nsps[d];return _?this._autoConnect&&!_.active&&_.connect():(_=new t6(this,d,m),this.nsps[d]=_),_}_destroy(d){const m=Object.keys(this.nsps);for(const _ of m)if(this.nsps[_].active)return;this._close()}_packet(d){const m=this.encoder.encode(d);for(let _=0;_<m.length;_++)this.engine.write(m[_],d.options)}cleanup(){this.subs.forEach(d=>d()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(d,m){var _;this.cleanup(),(_=this.engine)===null||_===void 0||_.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",d,m),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const d=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const m=this.backoff.duration();this._reconnecting=!0;const _=this.setTimeoutFn(()=>{d.skipReconnect||(this.emitReserved("reconnect_attempt",d.backoff.attempts),!d.skipReconnect&&d.open(v=>{v?(d._reconnecting=!1,d.reconnect(),this.emitReserved("reconnect_error",v)):d.onreconnect()}))},m);this.opts.autoUnref&&_.unref(),this.subs.push(()=>{this.clearTimeoutFn(_)})}}onreconnect(){const d=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",d)}}const xS={};function rh(o,d){typeof o=="object"&&(d=o,o=void 0),d=d||{};const m=Fne(o,d.path||"/socket.io"),_=m.source,v=m.id,w=m.path,D=xS[v]&&w in xS[v].nsps,B=d.forceNew||d["force new connection"]||d.multiplex===!1||D;let W;return B?W=new $1(_,d):(xS[v]||(xS[v]=new $1(_,d)),W=xS[v]),m.query&&!d.query&&(d.query=m.queryKey),W.socket(m.path,d)}Object.assign(rh,{Manager:$1,Socket:t6,io:rh,connect:rh});const D1=rh();function n6({userId:o}){let{serverUrl:d}=J.useContext(go),{userData:m,setUserData:_}=J.useContext(dc),[v,w]=J.useState(""),D=Ad();const B=async()=>{try{let Q=await wt.post(`${d}/api/connection/send/${o}`,{},{withCredentials:!0});console.log(Q)}catch(Q){console.log(Q)}},W=async()=>{try{let Q=await wt.delete(`${d}/api/connection/remove/${o}`,{withCredentials:!0});console.log(Q)}catch(Q){console.log(Q)}},F=async()=>{try{let Q=await wt.get(`${d}/api/connection/getStatus/${o}`,{withCredentials:!0});console.log(Q),w(Q.data.status)}catch(Q){console.log(Q)}};J.useEffect(()=>(D1.emit("register",m._id),F(),D1.on("statusUpdate",({updatedUserId:Q,newStatus:oe})=>{Q==o&&w(oe)}),()=>{D1.off("statusUpdate")}),[o]);const X=async()=>{v=="disconnect"?await W():v=="received"?D("/network"):await B()};return N.jsx("button",{className:"min-w-[100px] h-[40px] rounded-full border-2 border-[#2dc0ff] text-[#2dc0ff]",onClick:X,disabled:v=="pending",children:v})}const uC=rh();class $ne extends Qn.Component{constructor(){super(...arguments);aj(this,"state",{hasError:!1})}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(m,_){console.error(m,_)}render(){return this.state.hasError?N.jsx("div",{children:"Something went wrong in Post!"}):this.props.children}}function i6({id:o,author:d,like:m=[],comment:_=[],description:v="",image:w,createdAt:D}){const[B,W]=J.useState(!1),{serverUrl:F}=J.useContext(go),{userData:X,getPost:Q,handleGetProfile:oe}=J.useContext(dc),[Ae,ie]=J.useState(Array.isArray(m)?m:[]),[fe,ae]=J.useState(Array.isArray(_)?_:[]),[ve,be]=J.useState(""),[_e,Qe]=J.useState(!1),[Ye,Et]=J.useState(!1),[Ge,Je]=J.useState(!1),[we,We]=J.useState(!1),[ct,Tt]=J.useState(!1),[rn,fn]=J.useState(!1),bn=J.useRef(null),De=J.useRef(null),Ue=["","","","","","","","","",""],rt=[{type:"like",icon:sne,color:"text-blue-500",label:"Like"},{type:"love",icon:rne,color:"text-red-500",label:"Love"},{type:"haha",icon:tne,color:"text-yellow-500",label:"Haha"},{type:"sad",icon:nne,color:"text-yellow-600",label:"Sad"},{type:"wow",icon:ine,color:"text-orange-500",label:"Wow"}],sn=(X==null?void 0:X._id)===(d==null?void 0:d._id);J.useEffect(()=>(uC.on("likeUpdated",({postId:ke,likes:qe})=>{ke===o&&ie(Array.isArray(qe)?qe:[])}),uC.on("commentAdded",({postId:ke,comments:qe})=>{ke===o&&ae(Array.isArray(qe)?qe:[])}),()=>{uC.off("likeUpdated"),uC.off("commentAdded")}),[o]),J.useEffect(()=>{Q()},[Ae,fe]),J.useEffect(()=>{const ke=qe=>{bn.current&&!bn.current.contains(qe.target)&&Et(!1),De.current&&!De.current.contains(qe.target)&&We(!1)};return document.addEventListener("mousedown",ke),()=>document.removeEventListener("mousedown",ke)},[]);const ne=async()=>{try{const ke=await wt.get(`${F}/api/post/like/${o}`,{withCredentials:!0});ie(Array.isArray(ke.data.like)?ke.data.like:[])}catch(ke){console.error(ke)}},Ke=async ke=>{try{const qe=await wt.post(`${F}/api/post/reaction/${o}`,{reaction:ke},{withCredentials:!0});ie(Array.isArray(qe.data.like)?qe.data.like:[]),Je(!1)}catch(qe){console.error(qe)}},gt=async ke=>{if(ke.preventDefault(),!!ve.trim())try{const qe=await wt.post(`${F}/api/post/comment/${o}`,{content:ve},{withCredentials:!0});ae(Array.isArray(qe.data.comment)?qe.data.comment:[]),be("")}catch(qe){console.error(qe)}},bt=ke=>{be(qe=>qe+ke),fn(!1)},it=async()=>{if(sn){Tt(!0);try{await wt.delete(`${F}/api/post/delete/${o}`,{withCredentials:!0}),Q()}catch(ke){console.error(ke)}finally{Tt(!1),Et(!1)}}},en=async()=>{try{await wt.post(`${F}/api/post/repost/${o}`,{},{withCredentials:!0}),Q()}catch(ke){console.error(ke)}},Nt=ke=>{const qe=`${window.location.origin}/post/${o}`,qt=(v==null?void 0:v.slice(0,100))+(v.length>100?"...":"");switch(ke){case"copy":navigator.clipboard.writeText(qe),alert("Link copied!");break;case"twitter":window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(qt)}&url=${encodeURIComponent(qe)}`,"_blank");break;case"facebook":window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(qe)}`,"_blank");break;case"email":window.open(`mailto:?subject=Check out this post&body=${encodeURIComponent(qt+`

`+qe)}`,"_blank");break}We(!1)};return N.jsx($ne,{children:N.jsxs("div",{className:"w-full bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100",children:[N.jsxs("div",{className:"flex justify-between items-start p-6 pb-4",children:[N.jsxs("div",{className:"flex gap-4 items-start cursor-pointer group",onClick:()=>oe(d==null?void 0:d.userName),children:[N.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-gray-200 group-hover:border-blue-300 transition-colors shadow-sm",children:N.jsx("img",{src:(d==null?void 0:d.profileImage)||Eo,alt:"",className:"h-full w-full object-cover"})}),N.jsxs("div",{className:"flex-1",children:[N.jsxs("div",{className:"text-base font-semibold hover:text-blue-600 transition-colors group-hover:text-blue-600",children:[d==null?void 0:d.firstName," ",d==null?void 0:d.lastName]}),N.jsx("div",{className:"text-sm text-gray-600 mb-1",children:d==null?void 0:d.headline}),N.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[D?ft(D).fromNow():"",N.jsx("span",{className:"w-1 h-1 bg-gray-400 rounded-full"}),N.jsx("span",{children:" Public"})]})]})]}),N.jsxs("div",{className:"flex items-center gap-2",children:[!sn&&N.jsx(n6,{userId:d==null?void 0:d._id}),N.jsxs("div",{className:"relative",ref:bn,children:[N.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 transition-colors",onClick:ke=>{ke.stopPropagation(),Et(!Ye)},children:N.jsx(zZ,{className:"w-5 h-5 text-gray-600"})}),Ye&&N.jsxs("div",{className:"absolute right-0 top-full mt-2 bg-white rounded-xl shadow-2xl border border-gray-200 py-2 w-48 z-50",children:[sn?N.jsxs("button",{className:"w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center gap-3 text-red-600",onClick:it,disabled:ct,children:[N.jsx(cJ,{className:"w-4 h-4"})," Delete post"]}):N.jsxs("button",{className:"w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center gap-3 text-gray-700",children:[N.jsx(tJ,{className:"w-4 h-4"})," Report post"]}),N.jsxs("button",{className:"w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center gap-3 text-gray-700",onClick:()=>Nt("copy"),children:[N.jsx(iJ,{className:"w-4 h-4"})," Copy link"]})]})]})]})]}),N.jsxs("div",{className:"px-6 pb-4",children:[N.jsx("div",{className:`text-gray-800 leading-relaxed ${!B&&(v==null?void 0:v.length)>300?"max-h-20 overflow-hidden":""}`,children:v}),v&&v.length>300&&N.jsx("button",{className:"text-blue-600 hover:text-blue-700 text-sm font-medium mt-2 hover:underline",onClick:()=>W(!B),children:B?"Show less":"Show more"})]}),w&&N.jsx("div",{className:"w-full max-h-96 overflow-hidden bg-gray-100",children:N.jsx("img",{src:w,alt:"",className:"w-full h-full object-cover hover:scale-105 transition-transform duration-500 cursor-pointer"})}),N.jsxs("div",{className:"flex justify-between items-center px-6 py-3 border-t border-gray-100",children:[N.jsxs("div",{className:"flex items-center gap-2 text-gray-600 text-sm",children:[N.jsxs("div",{className:"flex -space-x-1",children:[N.jsx("div",{className:"w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center border-2 border-white",children:N.jsx(jj,{className:"text-white w-3 h-3"})}),N.jsx("div",{className:"w-5 h-5 bg-red-500 rounded-full flex items-center justify-center border-2 border-white",children:N.jsx(Qte,{className:"text-white w-2.5 h-2.5"})})]}),N.jsx("span",{className:"hover:underline cursor-pointer",children:Ae.length})]}),N.jsxs("div",{className:"flex items-center gap-4 text-gray-600 text-sm",children:[N.jsxs("button",{className:"hover:text-blue-600 hover:underline cursor-pointer transition-colors",onClick:()=>Qe(!_e),children:[fe.length," comments"]}),N.jsx("span",{className:"hover:underline cursor-pointer",children:"12 shares"})]})]}),N.jsxs("div",{className:"flex justify-around items-center px-6 py-3 border-t border-gray-100 bg-gray-50",children:[N.jsxs("div",{className:"relative",children:[Ae.includes(X==null?void 0:X._id)?N.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-50 text-blue-600 font-semibold",onClick:ne,onMouseEnter:()=>Je(!0),onMouseLeave:()=>setTimeout(()=>Je(!1),300),children:[N.jsx(KZ,{className:"w-5 h-5 animate-pulse"}),N.jsx("span",{children:"Liked"})]}):N.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-blue-50 text-gray-700 hover:text-blue-600 font-medium group",onClick:ne,onMouseEnter:()=>Je(!0),onMouseLeave:()=>setTimeout(()=>Je(!1),300),children:[N.jsx(jj,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),N.jsx("span",{children:"Like"})]}),Ge&&N.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-white rounded-full shadow-2xl border border-gray-200 px-2 py-1 flex gap-1 z-50",onMouseEnter:()=>Je(!0),onMouseLeave:()=>Je(!1),children:rt.map(({type:ke,icon:qe,color:qt,label:an})=>N.jsx("button",{className:`p-2 rounded-full hover:bg-gray-100 hover:scale-125 transition-all duration-200 ${qt}`,onClick:()=>Ke(ke),title:an,children:N.jsx(qe,{className:"w-6 h-6"})},ke))})]}),N.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-green-50 text-gray-700 hover:text-green-600 font-medium group",onClick:()=>Qe(!_e),children:[N.jsx(ene,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),N.jsx("span",{children:"Comment"})]}),N.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-purple-50 text-gray-700 hover:text-purple-600 font-medium group",onClick:en,children:[N.jsx($te,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),N.jsx("span",{children:"Repost"})]}),N.jsxs("div",{className:"relative",ref:De,children:[N.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-yellow-50 text-gray-700 hover:text-yellow-600 font-medium group",onClick:()=>We(!we),children:[N.jsx(XZ,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),N.jsx("span",{children:"Share"})]}),we&&N.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-white rounded-xl shadow-2xl border border-gray-200 py-2 w-48 z-50",children:[N.jsx("button",{onClick:()=>Nt("copy"),className:"w-full px-4 py-2 hover:bg-gray-50 flex items-center gap-3 text-gray-700",children:"Copy Link"}),N.jsx("button",{onClick:()=>Nt("twitter"),className:"w-full px-4 py-2 hover:bg-gray-50 flex items-center gap-3 text-blue-500",children:"Twitter"}),N.jsx("button",{onClick:()=>Nt("facebook"),className:"w-full px-4 py-2 hover:bg-gray-50 flex items-center gap-3 text-blue-800",children:"Facebook"}),N.jsx("button",{onClick:()=>Nt("email"),className:"w-full px-4 py-2 hover:bg-gray-50 flex items-center gap-3 text-red-600",children:"Email"})]})]})]}),_e&&N.jsxs("form",{onSubmit:gt,className:"flex gap-2 items-center px-6 py-3 border-t border-gray-100",children:[N.jsx("img",{src:(X==null?void 0:X.profileImage)||Eo,alt:"",className:"w-10 h-10 rounded-full"}),N.jsxs("div",{className:"flex-1 relative",children:[N.jsx("input",{type:"text",placeholder:"Write a comment...",value:ve,onChange:ke=>be(ke.target.value),className:"w-full border border-gray-200 rounded-full py-2 px-4 pl-10 focus:outline-none focus:ring-1 focus:ring-blue-500"}),N.jsx("button",{type:"button",onClick:()=>fn(!rn),className:"absolute left-2 top-2 text-gray-500 hover:text-yellow-500",children:N.jsx(gC,{})}),rn&&N.jsx("div",{className:"absolute bottom-full left-0 mb-2 flex flex-wrap gap-1 bg-white border border-gray-200 rounded-lg p-2 shadow-xl z-50",children:Ue.map(ke=>N.jsx("button",{type:"button",onClick:()=>bt(ke),className:"p-1",children:ke},ke))})]}),N.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-700 transition-colors",children:"Post"})]}),fe.length>0&&_e&&N.jsx("div",{className:"px-6 pb-4",children:fe.map(ke=>{var qe,qt,an;return N.jsxs("div",{className:"flex gap-3 items-start my-2",children:[N.jsx("img",{src:((qe=ke.user)==null?void 0:qe.profileImage)||Eo,alt:"",className:"w-8 h-8 rounded-full"}),N.jsxs("div",{className:"bg-gray-100 p-2 rounded-xl flex-1",children:[N.jsxs("div",{className:"text-sm font-semibold",children:[(qt=ke.user)==null?void 0:qt.firstName," ",(an=ke.user)==null?void 0:an.lastName]}),N.jsx("div",{className:"text-sm",children:ke.content}),N.jsx("div",{className:"text-xs text-gray-400",children:ke.createdAt?ft(ke.createdAt).fromNow():""})]})]},ke._id)})})]})})}function eie(){const[o,d]=J.useState([{from:"ai",text:"Hi! Im your Global Connect assistant. How can I help you today?"}]),[m,_]=J.useState(""),[v,w]=J.useState(!1),D=async()=>{var W;if(!m.trim())return;const B={from:"user",text:m};d(F=>[...F,B]),_(""),w(!0);try{const X=((W=(await wt.post("/api/ai/get-res",{code:m})).data)==null?void 0:W.reply)||"Sorry, I couldnt respond.";d(Q=>[...Q,{from:"ai",text:X}])}catch(F){console.error("Error sending message:",F),d(X=>[...X,{from:"ai",text:"Sorry, I couldnt respond."}])}finally{w(!1)}};return N.jsxs("div",{className:"w-full lg:w-[25%] bg-[#2C2C2C] rounded-2xl p-4 shadow-lg flex flex-col h-[90vh] mt-[90px]",children:[N.jsx("h3",{className:"font-bold text-lg mb-3",children:"AI Assistant"}),N.jsx("div",{className:"flex-1 mb-3 flex flex-col gap-2 overflow-y-auto p-1 hide-scrollbar",children:o.map((B,W)=>N.jsx("div",{className:`p-2 rounded-lg max-w-[80%] ${B.from==="ai"?"bg-[#1A1F71] self-start":"bg-[#FFD700] text-[#1A1F71] self-end"}`,children:B.text},W))}),N.jsxs("div",{className:"flex gap-2",children:[N.jsx("input",{className:"flex-1 p-2 rounded-lg bg-[#1A1F71] text-white focus:outline-none",placeholder:"Type a message...",value:m,onChange:B=>_(B.target.value),onKeyDown:B=>B.key==="Enter"&&D(),disabled:v}),N.jsx("button",{className:"px-4 py-3 bg-[#FFD700] text-[#1A1F71] rounded-lg font-bold",onClick:D,disabled:v,children:v?"...":"Send"})]})]})}const $j=[{firstName:"Elon",lastName:"Musk",userName:"elonmusk",headline:"CEO of Tesla & SpaceX  Visionary Entrepreneur",profileImage:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face",verified:!0,followers:"150M"},{firstName:"Oprah",lastName:"Winfrey",userName:"oprah",headline:"Media Mogul  Philanthropist  Author",profileImage:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=100&h=100&fit=crop&crop=face",verified:!0,followers:"45M"},{firstName:"Bill",lastName:"Gates",userName:"billgates",headline:"Co-founder Microsoft  Philanthropist",profileImage:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face",verified:!0,followers:"60M"},{firstName:"Michelle",lastName:"Obama",userName:"michelleobama",headline:"Former First Lady  Author  Advocate",profileImage:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop&crop=face",verified:!0,followers:"52M"},{firstName:"Tim",lastName:"Cook",userName:"timcook",headline:"CEO of Apple  Technology Leader",profileImage:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop&crop=face",verified:!0,followers:"15M"}];function tie(){const{userData:o,edit:d,setEdit:m,postData:_,getPost:v,handleGetProfile:w}=J.useContext(dc),{serverUrl:D}=J.useContext(go),[B,W]=J.useState(""),[F,X]=J.useState(""),[Q,oe]=J.useState(""),[Ae,ie]=J.useState(!1),[fe,ae]=J.useState(!1),[ve,be]=J.useState([]),[_e,Qe]=J.useState(!1),[Ye,Et]=J.useState(!1),[Ge,Je]=J.useState("text"),[we,We]=J.useState(["",""]),[ct,Tt]=J.useState(new Set),[rn,fn]=J.useState({followers:0,following:0,posts:0}),bn=J.useRef(),De=ke=>{const qe=ke.target.files[0];X(qe),W(URL.createObjectURL(qe)),Je("image")},Ue=async()=>{ae(!0);try{const ke=new FormData;ke.append("description",Q),F&&ke.append("image",F),Ge==="poll"&&ke.append("pollOptions",JSON.stringify(we.filter(qe=>qe.trim()))),ke.append("postType",Ge),await wt.post(D+"/api/post/create",ke,{withCredentials:!0}),ae(!1),ie(!1),oe(""),W(""),X(""),Je("text"),We(["",""]),v(),sn()}catch(ke){ae(!1),console.log(ke)}},rt=async()=>{try{const ke=await wt.get(D+"/api/user/suggestedusers",{withCredentials:!0}),qe=[...$j.slice(0,3),...ke.data.slice(0,2)];be(qe)}catch(ke){console.log(ke),be($j.slice(0,5))}},sn=async()=>{try{const ke=await wt.get(D+"/api/user/stats",{withCredentials:!0});fn(ke.data)}catch(ke){console.log("Error fetching user stats:",ke)}},ne=()=>{we.length<4&&We([...we,""])},Ke=(ke,qe)=>{const qt=[...we];qt[ke]=qe,We(qt)},gt=ke=>{if(we.length>2){const qe=we.filter((qt,an)=>an!==ke);We(qe)}},bt=async ke=>{try{await wt.post(D+`/api/post/like/${ke}`,{},{withCredentials:!0});const qe=new Set(ct);qe.has(ke)?qe.delete(ke):qe.add(ke),Tt(qe),v()}catch(qe){console.log("Error toggling like:",qe)}};J.useEffect(()=>{rt(),sn()},[]),J.useEffect(()=>{v()},[Ae]);const it=_e?"bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white":"bg-gradient-to-br from-[#1A1F71] to-[#2C2C2C] text-white",en=_e?"bg-gray-800 border border-gray-700":"bg-gradient-to-r from-[#1A1F71] to-[#d19a9a]",Nt=_e?"bg-gray-900 border border-gray-700":"bg-[#2C2C2C]";return N.jsxs("div",{className:`w-full h-screen ${it} flex flex-col lg:flex-row p-5 gap-5 relative transition-all duration-500 overflow-y-auto custom-scrollbar`,children:[d&&N.jsx(ZF,{}),N.jsx("div",{className:"fixed top-5 right-5 z-30",children:N.jsx("button",{onClick:()=>Qe(!_e),className:`p-3 rounded-full ${_e?"bg-yellow-500 text-gray-900":"bg-gray-800 text-yellow-500"}
            hover:scale-110 transform transition-all duration-300 shadow-lg hover:shadow-xl`,children:_e?N.jsx(oJ,{size:20}):N.jsx(sJ,{size:20})})}),N.jsxs("div",{className:"w-full lg:w-[25%] flex flex-col gap-5 mt-[90px] overflow-y-auto custom-scrollbar",children:[N.jsxs("div",{className:`${en} rounded-2xl p-6 shadow-2xl flex flex-col items-center relative
          hover:scale-105 transform transition-all duration-500 hover:shadow-3xl group`,children:[N.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),N.jsxs("div",{className:`relative w-[100px] h-[100px] rounded-full overflow-hidden border-4 border-[#FFD700] cursor-pointer\r
              hover:border-purple-500 transition-all duration-300 hover:scale-110 transform group`,onClick:()=>m(!0),children:[N.jsx("img",{src:o.profileImage||Eo,alt:"Profile",className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"}),N.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 flex items-center justify-center",children:N.jsx(bF,{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300",size:24})})]}),N.jsx("h2",{className:"mt-4 font-bold text-xl bg-gradient-to-r from-white to-gray-300 bg-clip-text text-transparent",children:`${o.firstName} ${o.lastName}`}),N.jsx("p",{className:"text-sm text-gray-300 text-center mt-1",children:o.headline}),N.jsxs("div",{className:"flex gap-6 mt-4",children:[N.jsxs("div",{className:"text-center",children:[N.jsx("div",{className:"font-bold text-lg text-[#FFD700]",children:rn.followers}),N.jsx("div",{className:"text-xs text-gray-400",children:"Followers"})]}),N.jsxs("div",{className:"text-center",children:[N.jsx("div",{className:"font-bold text-lg text-[#FFD700]",children:rn.following}),N.jsx("div",{className:"text-xs text-gray-400",children:"Following"})]}),N.jsxs("div",{className:"text-center",children:[N.jsx("div",{className:"font-bold text-lg text-[#FFD700]",children:rn.posts}),N.jsx("div",{className:"text-xs text-gray-400",children:"Posts"})]})]}),N.jsxs("button",{className:`mt-4 px-6 py-2 bg-gradient-to-r from-[#FFD700] to-[#FFCC00] text-[#1A1F71] font-semibold rounded-full\r
              shadow-lg hover:shadow-xl hover:scale-105 transform transition-all duration-300 flex items-center gap-2`,onClick:()=>m(!0),children:[N.jsx(R1,{size:16}),"Edit Profile"]})]}),N.jsxs("div",{className:`${Nt} rounded-2xl p-5 shadow-lg hover:shadow-xl transition-shadow duration-300`,children:[N.jsxs("div",{className:"flex items-center justify-between mb-4",children:[N.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[N.jsx(lJ,{className:"text-[#FFD700]"}),"Trending"]}),N.jsx("button",{onClick:()=>Et(!Ye),className:"text-[#FFD700] hover:text-yellow-400 transition-colors",children:Ye?"Hide":"Show"})]}),Ye&&N.jsx("div",{className:"space-y-3 animate-fadeIn",children:["#ReactJS","#WebDevelopment","#AI","#TechTrends","#Innovation"].map((ke,qe)=>N.jsx("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-[#1A1F71] cursor-pointer transition-colors",children:N.jsx("span",{className:"text-[#FFD700] font-medium",children:ke})},qe))})]}),N.jsxs("div",{className:`${Nt} rounded-2xl p-5 shadow-lg hover:shadow-xl transition-shadow duration-300`,children:[N.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[N.jsx(R1,{className:"text-[#FFD700]"}),"Suggested Personalities"]}),N.jsx("div",{className:"flex flex-col gap-3 max-h-[500px] overflow-y-auto custom-scrollbar",children:ve.length>0?ve.map((ke,qe)=>N.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg hover:bg-[#1A1F71] cursor-pointer\r
            transition-all duration-300 hover:scale-102 hover:shadow-md group`,onClick:()=>ke.userName&&w(ke.userName),children:[N.jsxs("div",{className:"relative w-[55px] h-[55px] rounded-full overflow-hidden border-2 border-[#FFD700] group-hover:border-purple-500 transition-colors",children:[N.jsx("img",{src:ke.profileImage||Eo,alt:"User",className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"}),ke.verified&&N.jsx(Fj,{className:"absolute -bottom-1 -right-1 bg-blue-500 text-white rounded-full p-0.5",size:18})]}),N.jsxs("div",{className:"flex flex-col flex-1",children:[N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("span",{className:"font-semibold group-hover:text-[#FFD700] transition-colors",children:ke.firstName&&ke.lastName?`${ke.firstName} ${ke.lastName}`:ke.userName||"New User"}),ke.verified&&N.jsx(Fj,{className:"text-blue-500",size:16})]}),N.jsx("span",{className:"text-xs text-gray-300 line-clamp-1",children:ke.headline||"No headline available"}),ke.followers&&N.jsxs("span",{className:"text-xs text-[#FFD700] mt-1",children:[ke.followers," followers"]})]}),N.jsx("button",{className:`opacity-0 group-hover:opacity-100 px-3 py-1 bg-[#FFD700] text-[#1A1F71]\r
            rounded-full text-xs font-medium hover:bg-yellow-400 transition-all duration-300`,children:"Follow"})]},qe)):N.jsx("p",{className:"text-gray-400",children:"No suggestions"})})]})]}),N.jsxs("div",{className:"w-full lg:w-[50%] flex flex-col gap-5 mt-[90px] overflow-y-auto custom-scrollbar",children:[N.jsxs("div",{className:`${Nt} rounded-2xl p-4 shadow-lg`,children:[N.jsxs("button",{className:`w-full py-4 bg-gradient-to-r from-[#FFD700] via-[#FFCC00] to-[#FFB700] text-[#1A1F71]\r
              font-bold rounded-xl shadow-lg flex items-center justify-center gap-3\r
              hover:scale-105 transform transition-all duration-300 hover:shadow-2xl group relative overflow-hidden`,onClick:()=>ie(!0),children:[N.jsx("div",{className:"absolute inset-0 bg-white/20 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700 skew-x-12"}),N.jsx(CF,{size:24,className:"group-hover:rotate-180 transition-transform duration-300"}),N.jsx("span",{className:"text-lg",children:"What's on your mind?"})]}),N.jsxs("div",{className:"flex gap-2 mt-3",children:[N.jsxs("button",{onClick:()=>{ie(!0),Je("image")},className:`flex-1 py-2 px-3 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg text-blue-400\r
                hover:text-blue-300 transition-all duration-300 flex items-center justify-center gap-2 text-sm`,children:[N.jsx(v1,{size:16})," Photo"]}),N.jsxs("button",{onClick:()=>{ie(!0),Je("poll")},className:`flex-1 py-2 px-3 bg-green-500/20 hover:bg-green-500/30 rounded-lg text-green-400\r
                hover:text-green-300 transition-all duration-300 flex items-center justify-center gap-2 text-sm`,children:[N.jsx(T1,{size:16})," Poll"]}),N.jsxs("button",{className:`flex-1 py-2 px-3 bg-purple-500/20 hover:bg-purple-500/30 rounded-lg text-purple-400\r
                hover:text-purple-300 transition-all duration-300 flex items-center justify-center gap-2 text-sm`,children:[N.jsx(gC,{size:16})," Feeling"]})]})]}),N.jsx("div",{className:"space-y-4",children:_.map((ke,qe)=>{var qt,an,br;return N.jsxs("div",{className:`${Nt} rounded-2xl p-6 shadow-lg
              hover:shadow-xl transition-all duration-300 hover:scale-[1.02] group`,children:[N.jsx(i6,{...ke}),N.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-600",children:[N.jsxs("button",{onClick:()=>bt(ke._id||ke.id),className:`flex items-center gap-2 px-4 py-2 rounded-full transition-all duration-300
                    ${ke.isLiked||ct.has(ke._id||ke.id)?"bg-red-500/20 text-red-400 hover:bg-red-500/30":"hover:bg-gray-700 text-gray-400 hover:text-red-400"}`,children:[N.jsx(nJ,{className:ke.isLiked||ct.has(ke._id||ke.id)?"fill-current":"",size:18}),N.jsx("span",{className:"text-sm",children:((qt=ke.likes)==null?void 0:qt.length)||0})]}),N.jsxs("button",{className:`flex items-center gap-2 px-4 py-2 rounded-full hover:bg-gray-700\r
                  text-gray-400 hover:text-blue-400 transition-all duration-300`,children:[N.jsx(rJ,{size:18}),N.jsx("span",{className:"text-sm",children:((an=ke.comments)==null?void 0:an.length)||0})]}),N.jsxs("button",{className:`flex items-center gap-2 px-4 py-2 rounded-full hover:bg-gray-700\r
                  text-gray-400 hover:text-green-400 transition-all duration-300`,children:[N.jsx(aJ,{size:18}),N.jsx("span",{className:"text-sm",children:((br=ke.shares)==null?void 0:br.length)||0})]}),N.jsx("button",{className:`flex items-center gap-2 px-4 py-2 rounded-full hover:bg-gray-700\r
                  text-gray-400 hover:text-yellow-400 transition-all duration-300`,children:N.jsx(YZ,{size:18})})]})]},qe)})})]}),N.jsx(eie,{}),Ae&&N.jsxs(N.Fragment,{children:[N.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm z-40 animate-fadeIn",onClick:()=>ie(!1)}),N.jsxs("div",{className:`fixed top-1/2 left-1/2 w-[95%] max-w-2xl ${Nt} rounded-3xl
            shadow-2xl p-6 transform -translate-x-1/2 -translate-y-1/2 z-50 text-white
            animate-scaleIn border border-gray-600`,children:[N.jsxs("div",{className:"flex justify-between items-center mb-4",children:[N.jsxs("h2",{className:"font-bold text-xl flex items-center gap-2",children:[N.jsx(R1,{className:"text-[#FFD700]"}),"Create ",Ge==="poll"?"Poll":Ge==="image"?"Photo Post":"Post"]}),N.jsx("button",{onClick:()=>ie(!1),className:"p-2 hover:bg-gray-700 rounded-full transition-colors",children:N.jsx(rf,{size:20})})]}),N.jsx("div",{className:"flex gap-2 mb-4",children:["text","image","poll"].map(ke=>N.jsxs("button",{onClick:()=>Je(ke),className:`px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 capitalize
                    ${Ge===ke?"bg-[#FFD700] text-[#1A1F71]":"bg-gray-700 hover:bg-gray-600 text-gray-300"}`,children:[ke==="text"&&N.jsx(gC,{className:"inline mr-1"}),ke==="image"&&N.jsx(v1,{className:"inline mr-1"}),ke==="poll"&&N.jsx(T1,{className:"inline mr-1"}),ke]},ke))}),N.jsx("textarea",{className:`w-full p-4 ${_e?"bg-gray-800":"bg-[#1A1F71]"} rounded-xl resize-none
                focus:outline-none focus:ring-2 focus:ring-[#FFD700] transition-all duration-300
                placeholder-gray-400 text-lg`,placeholder:Ge==="poll"?"Ask a question...":"What's on your mind?",value:Q,onChange:ke=>oe(ke.target.value),rows:4}),Ge==="poll"&&N.jsxs("div",{className:"mt-4 space-y-2",children:[N.jsxs("label",{className:"text-sm text-gray-400 flex items-center gap-2",children:[N.jsx(T1,{}),"Poll Options"]}),we.map((ke,qe)=>N.jsxs("div",{className:"flex gap-2",children:[N.jsx("input",{type:"text",placeholder:`Option ${qe+1}`,value:ke,onChange:qt=>Ke(qe,qt.target.value),className:`flex-1 p-3 ${_e?"bg-gray-800":"bg-[#1A1F71]"} rounded-lg
                        focus:outline-none focus:ring-2 focus:ring-[#FFD700] transition-all duration-300`}),we.length>2&&N.jsx("button",{onClick:()=>gt(qe),className:"px-3 py-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-colors",children:N.jsx(rf,{})})]},qe)),we.length<4&&N.jsx("button",{onClick:ne,className:`w-full p-3 border-2 border-dashed border-gray-600 rounded-lg\r
                      text-gray-400 hover:border-[#FFD700] hover:text-[#FFD700] transition-colors`,children:"+ Add Option"})]}),B&&N.jsxs("div",{className:"mt-4 relative",children:[N.jsx("img",{src:B,alt:"Preview",className:"w-full max-h-64 object-cover rounded-xl"}),N.jsx("button",{onClick:()=>{W(""),X(""),Je("text")},className:`absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full\r
                    hover:bg-red-600 transition-colors`,children:N.jsx(rf,{size:16})})]}),N.jsxs("div",{className:"flex justify-between items-center mt-6",children:[N.jsxs("div",{className:"flex gap-3",children:[N.jsx("button",{onClick:()=>bn.current.click(),className:`p-3 bg-blue-500/20 text-blue-400 rounded-full hover:bg-blue-500/30\r
                    transition-colors hover:scale-110 transform duration-200`,title:"Add Image",children:N.jsx(v1,{size:20})}),N.jsx("button",{className:`p-3 bg-yellow-500/20 text-yellow-400 rounded-full hover:bg-yellow-500/30\r
                    transition-colors hover:scale-110 transform duration-200`,title:"Add Emoji",children:N.jsx(gC,{size:20})})]}),N.jsx("button",{className:`px-8 py-3 bg-gradient-to-r from-[#FFD700] to-[#FFCC00] text-[#1A1F71]\r
                  rounded-full font-bold hover:scale-105 transform transition-all duration-300\r
                  disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\r
                  shadow-lg hover:shadow-xl`,onClick:Ue,disabled:fe||!Q.trim()&&!B,children:fe?N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("div",{className:"w-4 h-4 border-2 border-[#1A1F71] border-t-transparent rounded-full animate-spin"}),"Posting..."]}):`Post ${Ge==="poll"?"Poll":""}`})]}),N.jsx("input",{type:"file",ref:bn,hidden:!0,onChange:De,accept:"image/*"})]})]})]})}/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nie=o=>o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),iie=o=>o.replace(/^([A-Z])|[\s-_]+(\w)/g,(d,m,_)=>_?_.toUpperCase():m.toLowerCase()),eF=o=>{const d=iie(o);return d.charAt(0).toUpperCase()+d.slice(1)},r6=(...o)=>o.filter((d,m,_)=>!!d&&d.trim()!==""&&_.indexOf(d)===m).join(" ").trim(),rie=o=>{for(const d in o)if(d.startsWith("aria-")||d==="role"||d==="title")return!0};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var sie={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aie=J.forwardRef(({color:o="currentColor",size:d=24,strokeWidth:m=2,absoluteStrokeWidth:_,className:v="",children:w,iconNode:D,...B},W)=>J.createElement("svg",{ref:W,...sie,width:d,height:d,stroke:o,strokeWidth:_?Number(m)*24/Number(d):m,className:r6("lucide",v),...!w&&!rie(B)&&{"aria-hidden":"true"},...B},[...D.map(([F,X])=>J.createElement(F,X)),...Array.isArray(w)?w:[w]]));/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=(o,d)=>{const m=J.forwardRef(({className:_,...v},w)=>J.createElement(aie,{ref:w,iconNode:d,className:r6(`lucide-${nie(eF(o))}`,`lucide-${o}`,_),...v}));return m.displayName=eF(o),m};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oie=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],s6=Hr("arrow-right",oie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cie=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],lie=Hr("briefcase",cie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const die=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],uie=Hr("building",die);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hie=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],a6=Hr("circle-alert",hie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pie=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],o6=Hr("circle-check-big",pie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fie=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],mie=Hr("eye-off",fie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _ie=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Eie=Hr("eye",_ie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gie=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],yie=Hr("lock",gie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sie=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],vie=Hr("log-in",Sie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tie=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],c6=Hr("mail",Tie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rie=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],bie=Hr("map-pin",Rie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cie=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],wie=Hr("plus",Cie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aie=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],H_=Hr("refresh-cw",Aie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oie=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Iie=Hr("search",Oie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nie=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Die=Hr("shield",Nie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kie=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Pie=Hr("upload",kie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lie=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],hC=Hr("user",Lie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mie=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],tF=Hr("x",Mie);function xie(){const o=Ad(),{serverUrl:d}=J.useContext(go),{setUserData:m}=J.useContext(dc),[_,v]=J.useState(1),[w,D]=J.useState(!1),[B,W]=J.useState({firstName:"",lastName:"",userName:"",email:"",password:""}),[F,X]=J.useState(["","","","","",""]),[Q,oe]=J.useState(!1),[Ae,ie]=J.useState(""),[fe,ae]=J.useState(""),[ve,be]=J.useState(!1),_e=(we,We)=>{W(ct=>({...ct,[we]:We})),Ae&&ie("")},Qe=async we=>{var We,ct;we.preventDefault(),oe(!0),ie(""),ae("");try{await wt.post(`${d}/api/auth/send-signup-otp`,B,{withCredentials:!0}),ae("OTP sent to your email!"),v(2)}catch(Tt){ie(((ct=(We=Tt.response)==null?void 0:We.data)==null?void 0:ct.message)||"Failed to send OTP")}finally{oe(!1)}},Ye=(we,We)=>{if(We.length<=1){const ct=[...F];if(ct[we]=We,X(ct),We&&we<5){const Tt=document.querySelector(`input[name="otp-${we+1}"]`);Tt&&Tt.focus()}}},Et=async we=>{var ct,Tt;we.preventDefault();const We=F.join("");if(We.length!==6){ie("Please enter a complete 6-digit OTP");return}oe(!0),ie(""),ae("");try{const rn=await wt.post(`${d}/api/auth/verify-signup-otp`,{email:B.email,otp:We},{withCredentials:!0});ae(rn.data.message),localStorage.setItem("token",rn.data.token),localStorage.setItem("userId",rn.data.user._id),localStorage.setItem("email",rn.data.user.email),m(rn.data.user),o("/")}catch(rn){ie(((Tt=(ct=rn.response)==null?void 0:ct.data)==null?void 0:Tt.message)||"Invalid OTP or verification failed")}finally{oe(!1)}},Ge=async()=>{var we,We;be(!0),ie(""),ae("");try{await wt.post(`${d}/api/auth/resend-otp`,{email:B.email,type:"signup"},{withCredentials:!0}),ae("OTP resent successfully!"),X(["","","","","",""])}catch(ct){ie(((We=(we=ct.response)==null?void 0:we.data)==null?void 0:We.message)||"Failed to resend OTP")}finally{be(!1)}},Je=()=>{o("/login")};return N.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-cyan-50 flex items-center justify-center p-4",children:[N.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[N.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-blue-100 rounded-full opacity-20 blur-3xl"}),N.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-cyan-100 rounded-full opacity-20 blur-3xl"})]}),N.jsxs("div",{className:"relative w-full max-w-md",children:[N.jsx("div",{className:"flex justify-center mb-8",children:N.jsxs("div",{className:"flex items-center space-x-4",children:[N.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold transition-all ${_>=1?"bg-blue-500 text-white shadow-lg shadow-blue-500/30":"bg-gray-200 text-gray-500"}`,children:"1"}),N.jsx("div",{className:`w-12 h-0.5 transition-all ${_>=2?"bg-blue-500":"bg-gray-200"}`}),N.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold transition-all ${_>=2?"bg-blue-500 text-white shadow-lg shadow-blue-500/30":"bg-gray-200 text-gray-500"}`,children:"2"})]})}),N.jsxs("div",{className:"bg-white/70 backdrop-blur-xl border border-white/20 rounded-3xl shadow-2xl p-8",children:[N.jsxs("div",{className:"text-center mb-8",children:[N.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-blue-500/30",children:N.jsx(hC,{className:"w-10 h-10 text-white"})}),N.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent",children:_===1?"Create Account":"Verify Email"}),N.jsx("p",{className:"text-gray-600 mt-2",children:_===1?"Join us today and get started":`Enter the 6-digit code sent to ${B.email}`})]}),fe&&N.jsxs("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-xl flex items-center space-x-3 animate-pulse",children:[N.jsx(o6,{className:"w-5 h-5 text-green-500"}),N.jsx("p",{className:"text-green-700 text-sm",children:fe})]}),Ae&&N.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-xl flex items-center space-x-3 animate-pulse",children:[N.jsx(a6,{className:"w-5 h-5 text-red-500"}),N.jsx("p",{className:"text-red-700 text-sm",children:Ae})]}),_===1?N.jsxs("div",{className:"space-y-4",children:[N.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[N.jsxs("div",{className:"relative group",children:[N.jsx("input",{type:"text",placeholder:"First Name",required:!0,className:"w-full h-12 pl-12 pr-4 bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all group-hover:shadow-md",value:B.firstName,onChange:we=>_e("firstName",we.target.value)}),N.jsx(hC,{className:"absolute left-4 top-3.5 w-5 h-5 text-gray-400 transition-colors group-focus-within:text-blue-500"})]}),N.jsxs("div",{className:"relative group",children:[N.jsx("input",{type:"text",placeholder:"Last Name",required:!0,className:"w-full h-12 pl-12 pr-4 bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all group-hover:shadow-md",value:B.lastName,onChange:we=>_e("lastName",we.target.value)}),N.jsx(hC,{className:"absolute left-4 top-3.5 w-5 h-5 text-gray-400 transition-colors group-focus-within:text-blue-500"})]})]}),N.jsxs("div",{className:"relative group",children:[N.jsx("input",{type:"text",placeholder:"Username",required:!0,className:"w-full h-12 pl-12 pr-4 bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all group-hover:shadow-md",value:B.userName,onChange:we=>_e("userName",we.target.value)}),N.jsx(hC,{className:"absolute left-4 top-3.5 w-5 h-5 text-gray-400 transition-colors group-focus-within:text-blue-500"})]}),N.jsxs("div",{className:"relative group",children:[N.jsx("input",{type:"email",placeholder:"Email Address",required:!0,className:"w-full h-12 pl-12 pr-4 bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all group-hover:shadow-md",value:B.email,onChange:we=>_e("email",we.target.value)}),N.jsx(c6,{className:"absolute left-4 top-3.5 w-5 h-5 text-gray-400 transition-colors group-focus-within:text-blue-500"})]}),N.jsxs("div",{className:"relative group",children:[N.jsx("input",{type:w?"text":"password",placeholder:"Password",required:!0,className:"w-full h-12 pl-12 pr-12 bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all group-hover:shadow-md",value:B.password,onChange:we=>_e("password",we.target.value)}),N.jsx(yie,{className:"absolute left-4 top-3.5 w-5 h-5 text-gray-400 transition-colors group-focus-within:text-blue-500"}),N.jsx("button",{type:"button",className:"absolute right-4 top-3.5 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>D(!w),children:w?N.jsx(mie,{className:"w-5 h-5"}):N.jsx(Eie,{className:"w-5 h-5"})})]}),N.jsx("button",{type:"button",onClick:Qe,disabled:Q,className:"w-full h-12 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-cyan-600 transition-all transform hover:scale-[1.02] hover:shadow-lg hover:shadow-blue-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center space-x-2",children:Q?N.jsx(H_,{className:"w-5 h-5 animate-spin"}):N.jsxs(N.Fragment,{children:[N.jsx("span",{children:"Send OTP"}),N.jsx(s6,{className:"w-5 h-5"})]})})]}):N.jsxs("div",{className:"space-y-6",children:[N.jsx("div",{className:"flex justify-center space-x-3",children:F.map((we,We)=>N.jsx("input",{type:"text",name:`otp-${We}`,maxLength:"1",className:"w-12 h-12 text-center text-xl font-bold bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all hover:shadow-md",value:we,onChange:ct=>Ye(We,ct.target.value),onKeyDown:ct=>{if(ct.key==="Backspace"&&!we&&We>0){const Tt=document.querySelector(`input[name="otp-${We-1}"]`);Tt&&Tt.focus()}}},We))}),N.jsx("button",{type:"button",onClick:Et,disabled:Q,className:"w-full h-12 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-cyan-600 transition-all transform hover:scale-[1.02] hover:shadow-lg hover:shadow-blue-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center space-x-2",children:Q?N.jsx(H_,{className:"w-5 h-5 animate-spin"}):N.jsx("span",{children:"Verify & Create Account"})}),N.jsxs("div",{className:"text-center space-y-3",children:[N.jsx("p",{className:"text-gray-600 text-sm",children:"Didn't receive the code?"}),N.jsx("button",{type:"button",onClick:Ge,disabled:ve,className:"text-blue-500 hover:text-blue-600 font-medium text-sm flex items-center justify-center space-x-1 mx-auto transition-colors hover:underline",children:ve?N.jsx(H_,{className:"w-4 h-4 animate-spin"}):N.jsx("span",{children:"Resend OTP"})})]})]}),N.jsx("div",{className:"mt-8 text-center",children:N.jsxs("p",{className:"text-gray-600",children:["Already have an account?"," ",N.jsx("button",{onClick:Je,className:"text-blue-500 hover:text-blue-600 font-medium transition-colors hover:underline",children:"Sign In"})]})})]})]})]})}function Uie(){const o=Ad(),{serverUrl:d}=J.useContext(go),{setUserData:m}=J.useContext(dc),[_,v]=J.useState(1),[w,D]=J.useState(""),[B,W]=J.useState(["","","","","",""]),[F,X]=J.useState(!1),[Q,oe]=J.useState(""),[Ae,ie]=J.useState(""),[fe,ae]=J.useState(!1),ve=async Ge=>{var Je,we;if(Ge.preventDefault(),!w){oe("Please enter your email address");return}X(!0),oe(""),ie("");try{await wt.post(`${d}/api/auth/send-login-otp`,{email:w},{withCredentials:!0}),ie("OTP sent to your email!"),v(2)}catch(We){oe(((we=(Je=We.response)==null?void 0:Je.data)==null?void 0:we.message)||"Failed to send OTP")}finally{X(!1)}},be=(Ge,Je)=>{if(Je.length<=1){const we=[...B];if(we[Ge]=Je,W(we),Je&&Ge<5){const We=document.querySelector(`input[name="login-otp-${Ge+1}"]`);We&&We.focus()}}},_e=async Ge=>{var we,We;Ge.preventDefault();const Je=B.join("");if(Je.length!==6){oe("Please enter a complete 6-digit OTP");return}X(!0),oe(""),ie("");try{const ct=await wt.post(`${d}/api/auth/verify-login-otp`,{email:w,otp:Je},{withCredentials:!0});ie(ct.data.message),localStorage.setItem("token",ct.data.token),localStorage.setItem("userId",ct.data.user._id),localStorage.setItem("email",ct.data.user.email),m(ct.data.user),o("/")}catch(ct){oe(((We=(we=ct.response)==null?void 0:we.data)==null?void 0:We.message)||"Invalid OTP or login failed")}finally{X(!1)}},Qe=async()=>{var Ge,Je;ae(!0),oe(""),ie("");try{await wt.post(`${d}/api/auth/resend-otp`,{email:w,type:"login"},{withCredentials:!0}),ie("OTP resent successfully!"),W(["","","","","",""])}catch(we){oe(((Je=(Ge=we.response)==null?void 0:Ge.data)==null?void 0:Je.message)||"Failed to resend OTP")}finally{ae(!1)}},Ye=()=>{o("/signup")},Et=()=>{v(1),W(["","","","","",""]),oe(""),ie("")};return N.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-pink-50 flex items-center justify-center p-4",children:[N.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[N.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-purple-100 rounded-full opacity-20 blur-3xl"}),N.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-pink-100 rounded-full opacity-20 blur-3xl"}),N.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-blue-50 rounded-full opacity-10 blur-3xl"})]}),N.jsxs("div",{className:"relative w-full max-w-md",children:[N.jsx("div",{className:"flex justify-center mb-8",children:N.jsxs("div",{className:"flex items-center space-x-4",children:[N.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold transition-all ${_>=1?"bg-purple-500 text-white shadow-lg shadow-purple-500/30":"bg-gray-200 text-gray-500"}`,children:"1"}),N.jsx("div",{className:`w-12 h-0.5 transition-all ${_>=2?"bg-purple-500":"bg-gray-200"}`}),N.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold transition-all ${_>=2?"bg-purple-500 text-white shadow-lg shadow-purple-500/30":"bg-gray-200 text-gray-500"}`,children:"2"})]})}),N.jsxs("div",{className:"bg-white/70 backdrop-blur-xl border border-white/20 rounded-3xl shadow-2xl p-8",children:[N.jsxs("div",{className:"text-center mb-8",children:[N.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-purple-500/30",children:_===1?N.jsx(vie,{className:"w-10 h-10 text-white"}):N.jsx(Die,{className:"w-10 h-10 text-white"})}),N.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:_===1?"Welcome Back":"Verify Identity"}),N.jsx("p",{className:"text-gray-600 mt-2",children:_===1?"Sign in to your account":`Enter the 6-digit code sent to ${w}`})]}),Ae&&N.jsxs("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-xl flex items-center space-x-3 animate-pulse",children:[N.jsx(o6,{className:"w-5 h-5 text-green-500"}),N.jsx("p",{className:"text-green-700 text-sm",children:Ae})]}),Q&&N.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-xl flex items-center space-x-3 animate-pulse",children:[N.jsx(a6,{className:"w-5 h-5 text-red-500"}),N.jsx("p",{className:"text-red-700 text-sm",children:Q})]}),_===1?N.jsxs("div",{className:"space-y-6",children:[N.jsxs("div",{className:"relative group",children:[N.jsx("input",{type:"email",placeholder:"Enter your email address",required:!0,className:"w-full h-14 pl-12 pr-4 bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500 outline-none transition-all group-hover:shadow-md text-lg",value:w,onChange:Ge=>{D(Ge.target.value),Q&&oe("")}}),N.jsx(c6,{className:"absolute left-4 top-4.5 w-5 h-5 text-gray-400 transition-colors group-focus-within:text-purple-500"})]}),N.jsx("button",{type:"button",onClick:ve,disabled:F,className:"w-full h-14 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-semibold hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-[1.02] hover:shadow-lg hover:shadow-purple-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center space-x-2 text-lg",children:F?N.jsx(H_,{className:"w-5 h-5 animate-spin"}):N.jsxs(N.Fragment,{children:[N.jsx("span",{children:"Send OTP"}),N.jsx(s6,{className:"w-5 h-5"})]})})]}):N.jsxs("div",{className:"space-y-6",children:[N.jsx("div",{className:"flex justify-center space-x-3",children:B.map((Ge,Je)=>N.jsx("input",{type:"text",name:`login-otp-${Je}`,maxLength:"1",className:"w-12 h-12 text-center text-xl font-bold bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500 outline-none transition-all hover:shadow-md",value:Ge,onChange:we=>be(Je,we.target.value),onKeyDown:we=>{if(we.key==="Backspace"&&!Ge&&Je>0){const We=document.querySelector(`input[name="login-otp-${Je-1}"]`);We&&We.focus()}}},Je))}),N.jsx("button",{type:"button",onClick:_e,disabled:F,className:"w-full h-14 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-semibold hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-[1.02] hover:shadow-lg hover:shadow-purple-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center space-x-2 text-lg",children:F?N.jsx(H_,{className:"w-5 h-5 animate-spin"}):N.jsx("span",{children:"Verify & Sign In"})}),N.jsxs("div",{className:"text-center space-y-3",children:[N.jsx("p",{className:"text-gray-600 text-sm",children:"Didn't receive the code?"}),N.jsxs("div",{className:"flex justify-center space-x-4",children:[N.jsx("button",{type:"button",onClick:Qe,disabled:fe,className:"text-purple-500 hover:text-purple-600 font-medium text-sm flex items-center space-x-1 transition-colors hover:underline",children:fe?N.jsx(H_,{className:"w-4 h-4 animate-spin"}):N.jsx("span",{children:"Resend OTP"})}),N.jsx("span",{className:"text-gray-300",children:"|"}),N.jsx("button",{type:"button",onClick:Et,className:"text-gray-500 hover:text-gray-600 font-medium text-sm transition-colors hover:underline",children:"Change Email"})]})]})]}),N.jsx("div",{className:"mt-8 text-center",children:N.jsxs("p",{className:"text-gray-600",children:["Don't have an account?"," ",N.jsx("button",{onClick:Ye,className:"text-purple-500 hover:text-purple-600 font-medium transition-colors hover:underline",children:"Sign Up"})]})})]})]})]})}const Vie="/assets/GC-SbsYtVzo.jpg";function jie(o){return An({attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 3s-6.186 5.34-9.643 8.232c-.203.184-.357.452-.357.768 0 .553.447 1 1 1h2v7c0 .553.447 1 1 1h3c.553 0 1-.448 1-1v-4h4v4c0 .552.447 1 1 1h3c.553 0 1-.447 1-1v-7h2c.553 0 1-.447 1-1 0-.316-.154-.584-.383-.768-3.433-2.892-9.617-8.232-9.617-8.232z"},child:[]}]})(o)}function nF(o){return An({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304l91.4 0C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7L29.7 512C13.3 512 0 498.7 0 482.3zM609.3 512l-137.8 0c5.4-9.4 8.6-20.3 8.6-32l0-8c0-60.7-27.1-115.2-69.8-151.8c2.4-.1 4.7-.2 7.1-.2l61.4 0C567.8 320 640 392.2 640 481.3c0 17-13.8 30.7-30.7 30.7zM432 256c-31 0-59-12.6-79.3-32.9C372.4 196.5 384 163.6 384 128c0-26.8-6.6-52.1-18.3-74.3C384.3 40.1 407.2 32 432 32c61.9 0 112 50.1 112 112s-50.1 112-112 112z"},child:[]}]})(o)}function $_(){const[o,d]=J.useState(!1),{userData:m,setUserData:_,handleGetProfile:v}=J.useContext(dc),[w,D]=J.useState(!1),B=Ad(),W=wd(),{serverUrl:F}=J.useContext(go),[X,Q]=J.useState(""),[oe,Ae]=J.useState([]),ie=async()=>{try{await wt.get(F+"/api/auth/logout",{withCredentials:!0}),_(null),B("/login")}catch(ve){console.log(ve)}},fe=async()=>{if(!X.trim()){Ae([]);return}try{let ve=await wt.get(`${F}/api/user/search?query=${X}`,{withCredentials:!0});Ae(ve.data)}catch{Ae([])}};J.useEffect(()=>{fe()},[X]);const ae=ve=>W.pathname===ve;return N.jsxs("div",{className:"w-full h-[80px] bg-gradient-to-br from-[#1A1F71] to-[#2C2C2C] fixed top-0 shadow-md flex items-center px-4 lg:px-12 z-[80]",children:[N.jsxs("div",{className:"flex items-center gap-4 flex-1 rounded-md",children:[N.jsx("img",{src:Vie,alt:"Logo",className:"w-[50px] cursor-pointer rounded-lg",onClick:()=>{d(!1),B("/")}}),!o&&N.jsx(Bj,{className:"w-[23px] h-[23px] text-gray-300 lg:hidden cursor-pointer",onClick:()=>d(!0)}),N.jsxs("form",{className:`bg-[#f0efe7] h-[40px] rounded-md flex items-center gap-2 px-3 transition-all duration-300 ${o?"flex":"hidden"} lg:flex w-[200px] lg:w-[350px]`,children:[N.jsx(Bj,{className:"w-[20px] h-[20px] text-gray-600"}),N.jsx("input",{type:"text",placeholder:"Search users...",className:"w-full bg-transparent outline-none text-gray-800",value:X,onChange:ve=>Q(ve.target.value)})]})]}),oe.length>0&&N.jsx("div",{className:"absolute top-[65px] left-0 lg:left-12 shadow-lg w-full lg:w-[500px] bg-white rounded-lg border border-gray-200 overflow-auto max-h-[250px] z-[90]",children:oe.map(ve=>N.jsxs("div",{className:"flex gap-3 items-center border-b border-gray-100 px-3 py-2 hover:bg-gray-100 cursor-pointer transition",onClick:()=>v(ve.userName),children:[N.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0",children:N.jsx("img",{src:ve.profileImage||Eo,alt:"",className:"w-full h-full object-cover"})}),N.jsxs("div",{className:"flex flex-col",children:[N.jsx("span",{className:"text-sm font-medium text-gray-800",children:`${ve.firstName} ${ve.lastName}`}),N.jsx("span",{className:"text-xs text-gray-500 truncate max-w-[200px]",children:ve.headline})]})]},ve._id))}),N.jsxs("div",{className:"flex items-center gap-6",children:[N.jsxs("div",{className:`hidden lg:flex flex-col items-center cursor-pointer ${ae("/")?"text-yellow-400 font-semibold":"text-gray-300"}`,onClick:()=>B("/"),children:[N.jsx(jie,{className:"w-[23px] h-[23px]"}),N.jsx("span",{className:"text-sm",children:"Home"})]}),N.jsxs("div",{className:`hidden md:flex flex-col items-center cursor-pointer ${ae("/network")?"text-yellow-400 font-semibold":"text-gray-300"}`,onClick:()=>B("/network"),children:[N.jsx(nF,{className:"w-[23px] h-[23px]"}),N.jsx("span",{className:"text-sm",children:"My Networks"})]}),N.jsxs("div",{className:`flex flex-col items-center cursor-pointer ${ae("/chat")?"text-yellow-400 font-semibold":"text-gray-300"}`,onClick:()=>B("/chat"),children:[N.jsx(JZ,{className:"w-[23px] h-[23px]"}),N.jsx("span",{className:"hidden md:block text-sm",children:"Chat"})]}),N.jsxs("div",{className:`flex flex-col items-center cursor-pointer ${ae("/jobs")?"text-yellow-400 font-semibold":"text-gray-300"}`,onClick:()=>B("/jobs"),children:[N.jsx(qZ,{className:"w-[23px] h-[23px]"}),N.jsx("span",{className:"hidden md:block text-sm",children:"Jobs"})]}),N.jsxs("div",{className:`flex flex-col items-center cursor-pointer ${ae("/notification")?"text-yellow-400 font-semibold":"text-gray-300"}`,onClick:()=>B("/notification"),children:[N.jsx(ZZ,{className:"w-[23px] h-[23px]"}),N.jsx("span",{className:"hidden md:block text-sm",children:"Notifications"})]}),N.jsx("div",{className:"w-[50px] h-[50px] rounded-full overflow-hidden cursor-pointer border-2 border-yellow-400",onClick:()=>D(ve=>!ve),children:N.jsx("img",{src:(m==null?void 0:m.profileImage)||Eo,alt:"Profile",className:"w-full h-full object-cover"})})]}),w&&N.jsxs("div",{className:"absolute top-[75px] right-4 lg:right-12 w-[300px] bg-white shadow-lg rounded-lg p-4 flex flex-col items-center gap-4 z-[90]",children:[N.jsx("div",{className:"w-[70px] h-[70px] rounded-full overflow-hidden",children:N.jsx("img",{src:(m==null?void 0:m.profileImage)||Eo,alt:"",className:"w-full h-full object-cover"})}),N.jsx("div",{className:"text-lg font-semibold text-gray-800",children:`${m.firstName} ${m.lastName}`}),N.jsx("button",{className:"w-full h-[40px] rounded-full border border-yellow-400 bg-gradient-to-r from-[#FFD700] to-[#FFCC00] text-[#1A1F71] hover:bg-yellow-50",onClick:()=>v(m.userName),children:"View Profile"}),N.jsx("div",{className:"w-full h-[1px] bg-gray-300"}),N.jsxs("div",{className:"flex items-center gap-2 text-gray-600 cursor-pointer w-full hover:text-yellow-400",onClick:()=>B("/network"),children:[N.jsx(nF,{className:"w-[20px] h-[20px]"}),N.jsx("span",{children:"My Networks"})]}),N.jsx("button",{className:"w-full h-[40px] rounded-full border border-red-500 bg-gradient-to-r from-[#aa0c0c] to-[#d23805] text-[#f1f2ff] hover:bg-red-50",onClick:ie,children:"Sign Out"})]})]})}function Fie(o){return An({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M362.6 192.9L345 174.8c-.7-.8-1.8-1.2-2.8-1.2-1.1 0-2.1.4-2.8 1.2l-122 122.9-44.4-44.4c-.8-.8-1.8-1.2-2.8-1.2-1 0-2 .4-2.8 1.2l-17.8 17.8c-1.6 1.6-1.6 4.1 0 5.7l56 56c3.6 3.6 8 5.7 11.7 5.7 5.3 0 9.9-3.9 11.6-5.5h.1l133.7-134.4c1.4-1.7 1.4-4.2-.1-5.7z"},child:[]},{tag:"path",attr:{d:"M256 76c48.1 0 93.3 18.7 127.3 52.7S436 207.9 436 256s-18.7 93.3-52.7 127.3S304.1 436 256 436c-48.1 0-93.3-18.7-127.3-52.7S76 304.1 76 256s18.7-93.3 52.7-127.3S207.9 76 256 76m0-28C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48z"},child:[]}]})(o)}rh();function Bie(){let{serverUrl:o}=J.useContext(go),[d,m]=J.useState([]);const _=async()=>{try{let D=await wt.get(`${o}/api/connection/requests`,{withCredentials:!0});m(Array.isArray(D.data)?D.data:[])}catch(D){console.log(D)}},v=async D=>{try{await wt.put(`${o}/api/connection/accept/${D}`,{},{withCredentials:!0}),m(d.filter(B=>B._id!==D))}catch(B){console.log(B)}},w=async D=>{try{await wt.put(`${o}/api/connection/reject/${D}`,{},{withCredentials:!0}),m(d.filter(B=>B._id!==D))}catch(B){console.log(B)}};return J.useEffect(()=>{_()},[]),N.jsxs("div",{className:"w-screen min-h-screen bg-gradient-to-br from-[#1A1F71] to-[#2C2C2C] flex flex-col items-center",children:[N.jsx("div",{className:"fixed top-0 w-full z-50",children:N.jsx($_,{})}),N.jsxs("div",{className:"w-full max-w-[900px] mt-[90px] px-4 sm:px-6 lg:px-8 flex flex-col gap-6",children:[N.jsxs("div",{className:"bg-white shadow-md rounded-lg p-4 flex items-center justify-between text-lg font-semibold text-gray-700",children:[N.jsx("span",{children:"Invitations"}),N.jsx("span",{className:"text-[#0a66c2]",children:d.length})]}),d.length>0?N.jsx("div",{className:"bg-white shadow-lg rounded-lg divide-y",children:d.map((D,B)=>{var W,F,X;return N.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center p-4 gap-4 sm:gap-6",children:[N.jsxs("div",{className:"flex items-center gap-4",children:[N.jsx("div",{className:"w-14 h-14 rounded-full overflow-hidden border border-gray-300",children:N.jsx("img",{src:((W=D.sender)==null?void 0:W.profileImage)||Eo,alt:"",className:"w-full h-full object-cover"})}),N.jsx("div",{className:"text-base sm:text-lg font-medium text-gray-800",children:`${((F=D.sender)==null?void 0:F.firstName)||""} ${((X=D.sender)==null?void 0:X.lastName)||""}`})]}),N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("button",{className:"text-[#18c5ff] hover:text-[#0ea5e9] transition-colors",onClick:()=>v(D._id),children:N.jsx(Fie,{className:"w-9 h-9"})}),N.jsx("button",{className:"text-[#ff4218] hover:text-red-600 transition-colors",onClick:()=>w(D._id),children:N.jsx(GZ,{className:"w-8 h-8"})})]})]},B)})}):N.jsx("div",{className:"bg-white shadow-lg rounded-lg p-6 text-center text-gray-500",children:"No new invitations."})]})]})}function Gie(o){return An({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M21.731 2.269a2.625 2.625 0 0 0-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 0 0 0-3.712ZM19.513 8.199l-3.712-3.712-12.15 12.15a5.25 5.25 0 0 0-1.32 2.214l-.8 2.685a.75.75 0 0 0 .933.933l2.685-.8a5.25 5.25 0 0 0 2.214-1.32L19.513 8.2Z"},child:[]}]})(o)}const M_=rh();function Hie(){var ie;const{userData:o,edit:d,setEdit:m,postData:_,profileData:v,handleGetProfile:w,getPost:D}=J.useContext(dc),{serverUrl:B}=J.useContext(go),[W,F]=J.useState([]);J.useEffect(()=>{if(v&&_){const fe=_.filter(ae=>{var ve;return((ve=ae.author)==null?void 0:ve._id)===v._id});F(fe)}else F([])},[v,_]),J.useEffect(()=>(M_.on("likeUpdated",({postId:fe,likes:ae})=>{F(ve=>ve.map(be=>be._id===fe?{...be,like:Array.isArray(ae)?ae:[]}:be))}),M_.on("commentAdded",({postId:fe,comments:ae})=>{F(ve=>ve.map(be=>be._id===fe?{...be,comment:Array.isArray(ae)?ae:[]}:be))}),M_.on("postReposted",({postId:fe,newPost:ae})=>{F(ve=>[ae,...ve])}),()=>{M_.off("likeUpdated"),M_.off("commentAdded"),M_.off("postReposted")}),[]);const X=(v==null?void 0:v.skills)??[],Q=(v==null?void 0:v.education)??[],oe=(v==null?void 0:v.experience)??[],Ae=((ie=v==null?void 0:v.connection)==null?void 0:ie.length)??0;return N.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#1A1A71] to-[#2C2C3C] text-white flex flex-col items-center",children:[N.jsx($_,{}),d&&N.jsx(ZF,{}),N.jsxs("div",{className:"max-w-7xl w-full flex flex-col lg:flex-row gap-6 px-4 py-10",children:[N.jsxs("section",{className:"flex-1 space-y-6",children:[N.jsxs("div",{className:"bg-white text-black rounded-xl shadow p-6 relative",children:[N.jsx("div",{className:"h-36 rounded-t-xl overflow-hidden",children:v!=null&&v.coverImage?N.jsx("img",{src:v.coverImage,alt:"Cover",className:"w-full h-full object-cover"}):N.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:"No Cover Photo"})}),N.jsxs("div",{className:"relative -top-16 flex items-center space-x-6",children:[N.jsx("div",{className:"h-32 w-32 rounded-full border-4 border-white overflow-hidden cursor-pointer",onClick:()=>m(!0),children:N.jsx("img",{src:(v==null?void 0:v.profileImage)||Eo,alt:"Profile",className:"h-full w-full object-cover"})}),N.jsxs("div",{children:[N.jsxs("h1",{className:"text-3xl font-bold",children:[v==null?void 0:v.firstName," ",v==null?void 0:v.lastName]}),N.jsx("p",{className:"text-gray-600",children:(v==null?void 0:v.headline)||"No headline"}),N.jsx("p",{className:"text-gray-500",children:(v==null?void 0:v.location)||"No location"}),N.jsxs("p",{className:"text-gray-500",children:[Ae," connection",Ae!==1?"s":""]}),(v==null?void 0:v._id)===(o==null?void 0:o._id)?N.jsxs("button",{onClick:()=>m(!0),className:"mt-4 px-5 py-2 bg-gradient-to-r from-yellow-400 to-yellow-500 text-black rounded-full font-semibold hover:brightness-105 transition",children:["Edit Profile ",N.jsx(Gie,{className:"inline ml-1"})]}):N.jsx(n6,{userId:v==null?void 0:v._id})]})]})]}),N.jsxs("div",{className:"bg-white text-black rounded-xl shadow p-6",children:[N.jsxs("h2",{className:"text-2xl font-semibold mb-4",children:["Posts (",W.length,")"]}),W.length===0?N.jsx("p",{className:"text-gray-500",children:"No posts available"}):W.map(fe=>N.jsx(i6,{id:fe._id,author:fe.author,description:fe.description,image:fe.image,like:fe.like,comment:fe.comment,createdAt:fe.createdAt},fe._id))]})]}),N.jsxs("aside",{className:"w-80 space-y-6",children:[X.length>0&&N.jsxs(k1,{title:"Skills",children:[N.jsx("div",{className:"flex flex-wrap gap-2",children:X.map((fe,ae)=>N.jsx("span",{className:"bg-gray-200 text-black rounded-full px-3 py-1 text-sm",children:fe},ae))}),(v==null?void 0:v._id)===(o==null?void 0:o._id)&&N.jsx("button",{onClick:()=>m(!0),className:"mt-3 w-full px-4 py-2 rounded-full border-2 border-blue-600 text-blue-600 hover:bg-blue-100 transition",children:"Add Skills"})]}),Q.length>0&&N.jsxs(k1,{title:"Education",children:[Q.map((fe,ae)=>N.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 mb-3",children:[N.jsx("p",{className:"font-semibold",children:fe.college}),N.jsxs("p",{children:[fe.degree," - ",fe.fieldOfStudy]})]},ae)),(v==null?void 0:v._id)===(o==null?void 0:o._id)&&N.jsx("button",{onClick:()=>m(!0),className:"mt-3 w-full px-4 py-2 rounded-full border-2 border-blue-600 text-blue-600 hover:bg-blue-100 transition",children:"Add Education"})]}),oe.length>0&&N.jsxs(k1,{title:"Experience",children:[oe.map((fe,ae)=>N.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 mb-3",children:[N.jsxs("p",{className:"font-semibold",children:[fe.title," at ",fe.company]}),N.jsx("p",{children:fe.description})]},ae)),(v==null?void 0:v._id)===(o==null?void 0:o._id)&&N.jsx("button",{onClick:()=>m(!0),className:"mt-3 w-full px-4 py-2 rounded-full border-2 border-blue-600 text-blue-600 hover:bg-blue-100 transition",children:"Add Experience"})]})]})]})]})}function k1({title:o,children:d}){return N.jsxs("div",{className:"bg-white text-black rounded-xl shadow p-6",children:[N.jsx("h3",{className:"text-xl font-semibold mb-4",children:o}),d]})}function Wie(){let{serverUrl:o}=J.useContext(go),[d,m]=J.useState([]),{userData:_}=J.useContext(dc);const v=async()=>{try{let F=await wt.get(o+"/api/notification/get",{withCredentials:!0});m(F.data)}catch(F){console.log(F)}},w=async F=>{try{await wt.delete(o+`/api/notification/deleteone/${F}`,{withCredentials:!0}),await v()}catch(X){console.log(X)}},D=async()=>{try{await wt.delete(o+"/api/notification",{withCredentials:!0}),await v()}catch(F){console.log(F)}},B=F=>F==="like"?"liked your post":F==="comment"?"commented on your post":"accepted your connection",W=F=>F==="like"?"bg-pink-100 border-pink-300":F==="comment"?"bg-blue-100 border-blue-300":"bg-green-100 border-green-300";return J.useEffect(()=>{v()},[]),N.jsxs("div",{className:"w-screen min-h-screen bg-gradient-to-br from-[#1A1F71] to-[#2C2C2C] pt-[80px] px-[20px] flex flex-col items-center",children:[N.jsx($_,{}),N.jsxs("div",{className:"w-full max-w-[900px] sticky top-[80px] z-10 bg-white shadow-lg rounded-lg flex items-center p-4 text-lg text-gray-700 justify-between mt-5",children:[N.jsxs("span",{className:"font-semibold",children:["Notifications (",d.length,")"]}),d.length>0&&N.jsx("button",{className:"px-4 py-1 rounded-full border-2 border-red-500 text-red-500 hover:bg-red-500 hover:text-white transition-all",onClick:D,children:"Clear All"})]}),d.length>0?N.jsx("div",{className:"w-full max-w-[900px] bg-white shadow-lg rounded-lg flex flex-col divide-y divide-gray-200 mt-4",children:d.map((F,X)=>{var Q,oe,Ae;return N.jsxs("div",{className:`flex flex-col gap-2 p-4 border-l-4 ${W(F.type)} hover:bg-gray-50 transition-all`,children:[N.jsxs("div",{className:"flex justify-between items-center",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("div",{className:"w-[50px] h-[50px] rounded-full overflow-hidden",children:N.jsx("img",{src:((Q=F.relatedUser)==null?void 0:Q.profileImage)||Eo,alt:"",className:"w-full h-full object-cover"})}),N.jsx("div",{className:"text-[16px] font-medium text-gray-700",children:`${((oe=F.relatedUser)==null?void 0:oe.firstName)||""} ${((Ae=F.relatedUser)==null?void 0:Ae.lastName)||""} ${B(F.type)}`})]}),N.jsx(rf,{className:"w-6 h-6 text-gray-500 hover:text-red-500 cursor-pointer",onClick:()=>w(F._id)})]}),F.relatedPost&&N.jsxs("div",{className:"flex items-center gap-3 ml-[60px]",children:[N.jsx("div",{className:"w-[80px] h-[50px] rounded overflow-hidden border",children:N.jsx("img",{src:F.relatedPost.image,alt:"",className:"w-full h-full object-cover"})}),N.jsx("p",{className:"text-gray-600 text-sm",children:F.relatedPost.description})]})]},X)})}):N.jsx("div",{className:"text-gray-500 mt-10",children:"No notifications yet."})]})}function l6(o){var d,m,_="";if(typeof o=="string"||typeof o=="number")_+=o;else if(typeof o=="object")if(Array.isArray(o)){var v=o.length;for(d=0;d<v;d++)o[d]&&(m=l6(o[d]))&&(_&&(_+=" "),_+=m)}else for(m in o)o[m]&&(_&&(_+=" "),_+=m);return _}function af(){for(var o,d,m=0,_="",v=arguments.length;m<v;m++)(o=arguments[m])&&(d=l6(o))&&(_&&(_+=" "),_+=d);return _}function Yie(o){if(typeof document>"u")return;let d=document.head||document.getElementsByTagName("head")[0],m=document.createElement("style");m.type="text/css",d.firstChild?d.insertBefore(m,d.firstChild):d.appendChild(m),m.styleSheet?m.styleSheet.cssText=o:m.appendChild(document.createTextNode(o))}Yie(`:root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
`);var rv=o=>typeof o=="number"&&!isNaN(o),cf=o=>typeof o=="string",Cd=o=>typeof o=="function",zie=o=>cf(o)||rv(o),eD=o=>cf(o)||Cd(o)?o:null,Kie=(o,d)=>o===!1||rv(o)&&o>0?o:d,tD=o=>J.isValidElement(o)||cf(o)||Cd(o)||rv(o);function qie(o,d,m=300){let{scrollHeight:_,style:v}=o;requestAnimationFrame(()=>{v.minHeight="initial",v.height=_+"px",v.transition=`all ${m}ms`,requestAnimationFrame(()=>{v.height="0",v.padding="0",v.margin="0",setTimeout(d,m)})})}function Xie({enter:o,exit:d,appendPosition:m=!1,collapse:_=!0,collapseDuration:v=300}){return function({children:w,position:D,preventExitTransition:B,done:W,nodeRef:F,isIn:X,playToast:Q}){let oe=m?`${o}--${D}`:o,Ae=m?`${d}--${D}`:d,ie=J.useRef(0);return J.useLayoutEffect(()=>{let fe=F.current,ae=oe.split(" "),ve=be=>{be.target===F.current&&(Q(),fe.removeEventListener("animationend",ve),fe.removeEventListener("animationcancel",ve),ie.current===0&&be.type!=="animationcancel"&&fe.classList.remove(...ae))};fe.classList.add(...ae),fe.addEventListener("animationend",ve),fe.addEventListener("animationcancel",ve)},[]),J.useEffect(()=>{let fe=F.current,ae=()=>{fe.removeEventListener("animationend",ae),_?qie(fe,W,v):W()};X||(B?ae():(ie.current=1,fe.className+=` ${Ae}`,fe.addEventListener("animationend",ae)))},[X]),Qn.createElement(Qn.Fragment,null,w)}}function iF(o,d){return{content:d6(o.content,o.props),containerId:o.props.containerId,id:o.props.toastId,theme:o.props.theme,type:o.props.type,data:o.props.data||{},isLoading:o.props.isLoading,icon:o.props.icon,reason:o.removalReason,status:d}}function d6(o,d,m=!1){return J.isValidElement(o)&&!cf(o.type)?J.cloneElement(o,{closeToast:d.closeToast,toastProps:d,data:d.data,isPaused:m}):Cd(o)?o({closeToast:d.closeToast,toastProps:d,data:d.data,isPaused:m}):o}function Jie({closeToast:o,theme:d,ariaLabel:m="close"}){return Qn.createElement("button",{className:`Toastify__close-button Toastify__close-button--${d}`,type:"button",onClick:_=>{_.stopPropagation(),o(!0)},"aria-label":m},Qn.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},Qn.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function Zie({delay:o,isRunning:d,closeToast:m,type:_="default",hide:v,className:w,controlledProgress:D,progress:B,rtl:W,isIn:F,theme:X}){let Q=v||D&&B===0,oe={animationDuration:`${o}ms`,animationPlayState:d?"running":"paused"};D&&(oe.transform=`scaleX(${B})`);let Ae=af("Toastify__progress-bar",D?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${X}`,`Toastify__progress-bar--${_}`,{"Toastify__progress-bar--rtl":W}),ie=Cd(w)?w({rtl:W,type:_,defaultClassName:Ae}):af(Ae,w),fe={[D&&B>=1?"onTransitionEnd":"onAnimationEnd"]:D&&B<1?null:()=>{F&&m()}};return Qn.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":Q},Qn.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${X} Toastify__progress-bar--${_}`}),Qn.createElement("div",{role:"progressbar","aria-hidden":Q?"true":"false","aria-label":"notification timer",className:ie,style:oe,...fe}))}var Qie=1,u6=()=>`${Qie++}`;function $ie(o,d,m){let _=1,v=0,w=[],D=[],B=d,W=new Map,F=new Set,X=be=>(F.add(be),()=>F.delete(be)),Q=()=>{D=Array.from(W.values()),F.forEach(be=>be())},oe=({containerId:be,toastId:_e,updateId:Qe})=>{let Ye=be?be!==o:o!==1,Et=W.has(_e)&&Qe==null;return Ye||Et},Ae=(be,_e)=>{W.forEach(Qe=>{var Ye;(_e==null||_e===Qe.props.toastId)&&((Ye=Qe.toggle)==null||Ye.call(Qe,be))})},ie=be=>{var _e,Qe;(Qe=(_e=be.props)==null?void 0:_e.onClose)==null||Qe.call(_e,be.removalReason),be.isActive=!1},fe=be=>{if(be==null)W.forEach(ie);else{let _e=W.get(be);_e&&ie(_e)}Q()},ae=()=>{v-=w.length,w=[]},ve=be=>{var _e,Qe;let{toastId:Ye,updateId:Et}=be.props,Ge=Et==null;be.staleId&&W.delete(be.staleId),be.isActive=!0,W.set(Ye,be),Q(),m(iF(be,Ge?"added":"updated")),Ge&&((Qe=(_e=be.props).onOpen)==null||Qe.call(_e))};return{id:o,props:B,observe:X,toggle:Ae,removeToast:fe,toasts:W,clearQueue:ae,buildToast:(be,_e)=>{if(oe(_e))return;let{toastId:Qe,updateId:Ye,data:Et,staleId:Ge,delay:Je}=_e,we=Ye==null;we&&v++;let We={...B,style:B.toastStyle,key:_++,...Object.fromEntries(Object.entries(_e).filter(([Tt,rn])=>rn!=null)),toastId:Qe,updateId:Ye,data:Et,isIn:!1,className:eD(_e.className||B.toastClassName),progressClassName:eD(_e.progressClassName||B.progressClassName),autoClose:_e.isLoading?!1:Kie(_e.autoClose,B.autoClose),closeToast(Tt){W.get(Qe).removalReason=Tt,fe(Qe)},deleteToast(){let Tt=W.get(Qe);if(Tt!=null){if(m(iF(Tt,"removed")),W.delete(Qe),v--,v<0&&(v=0),w.length>0){ve(w.shift());return}Q()}}};We.closeButton=B.closeButton,_e.closeButton===!1||tD(_e.closeButton)?We.closeButton=_e.closeButton:_e.closeButton===!0&&(We.closeButton=tD(B.closeButton)?B.closeButton:!0);let ct={content:be,props:We,staleId:Ge};B.limit&&B.limit>0&&v>B.limit&&we?w.push(ct):rv(Je)?setTimeout(()=>{ve(ct)},Je):ve(ct)},setProps(be){B=be},setToggle:(be,_e)=>{let Qe=W.get(be);Qe&&(Qe.toggle=_e)},isToastActive:be=>{var _e;return(_e=W.get(be))==null?void 0:_e.isActive},getSnapshot:()=>D}}var Ls=new Map,KS=[],nD=new Set,ere=o=>nD.forEach(d=>d(o)),h6=()=>Ls.size>0;function tre(){KS.forEach(o=>f6(o.content,o.options)),KS=[]}var nre=(o,{containerId:d})=>{var m;return(m=Ls.get(d||1))==null?void 0:m.toasts.get(o)};function p6(o,d){var m;if(d)return!!((m=Ls.get(d))!=null&&m.isToastActive(o));let _=!1;return Ls.forEach(v=>{v.isToastActive(o)&&(_=!0)}),_}function ire(o){if(!h6()){KS=KS.filter(d=>o!=null&&d.options.toastId!==o);return}if(o==null||zie(o))Ls.forEach(d=>{d.removeToast(o)});else if(o&&("containerId"in o||"id"in o)){let d=Ls.get(o.containerId);d?d.removeToast(o.id):Ls.forEach(m=>{m.removeToast(o.id)})}}var rre=(o={})=>{Ls.forEach(d=>{d.props.limit&&(!o.containerId||d.id===o.containerId)&&d.clearQueue()})};function f6(o,d){tD(o)&&(h6()||KS.push({content:o,options:d}),Ls.forEach(m=>{m.buildToast(o,d)}))}function sre(o){var d;(d=Ls.get(o.containerId||1))==null||d.setToggle(o.id,o.fn)}function m6(o,d){Ls.forEach(m=>{(d==null||!(d!=null&&d.containerId)||(d==null?void 0:d.containerId)===m.id)&&m.toggle(o,d==null?void 0:d.id)})}function are(o){let d=o.containerId||1;return{subscribe(m){let _=$ie(d,o,ere);Ls.set(d,_);let v=_.observe(m);return tre(),()=>{v(),Ls.delete(d)}},setProps(m){var _;(_=Ls.get(d))==null||_.setProps(m)},getSnapshot(){var m;return(m=Ls.get(d))==null?void 0:m.getSnapshot()}}}function ore(o){return nD.add(o),()=>{nD.delete(o)}}function cre(o){return o&&(cf(o.toastId)||rv(o.toastId))?o.toastId:u6()}function sv(o,d){return f6(o,d),d.toastId}function sw(o,d){return{...d,type:d&&d.type||o,toastId:cre(d)}}function aw(o){return(d,m)=>sv(d,sw(o,m))}function ln(o,d){return sv(o,sw("default",d))}ln.loading=(o,d)=>sv(o,sw("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...d}));function lre(o,{pending:d,error:m,success:_},v){let w;d&&(w=cf(d)?ln.loading(d,v):ln.loading(d.render,{...v,...d}));let D={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},B=(F,X,Q)=>{if(X==null){ln.dismiss(w);return}let oe={type:F,...D,...v,data:Q},Ae=cf(X)?{render:X}:X;return w?ln.update(w,{...oe,...Ae}):ln(Ae.render,{...oe,...Ae}),Q},W=Cd(o)?o():o;return W.then(F=>B("success",_,F)).catch(F=>B("error",m,F)),W}ln.promise=lre;ln.success=aw("success");ln.info=aw("info");ln.error=aw("error");ln.warning=aw("warning");ln.warn=ln.warning;ln.dark=(o,d)=>sv(o,sw("default",{theme:"dark",...d}));function dre(o){ire(o)}ln.dismiss=dre;ln.clearWaitingQueue=rre;ln.isActive=p6;ln.update=(o,d={})=>{let m=nre(o,d);if(m){let{props:_,content:v}=m,w={delay:100,..._,...d,toastId:d.toastId||o,updateId:u6()};w.toastId!==o&&(w.staleId=o);let D=w.render||v;delete w.render,sv(D,w)}};ln.done=o=>{ln.update(o,{progress:1})};ln.onChange=ore;ln.play=o=>m6(!0,o);ln.pause=o=>m6(!1,o);function ure(o){var d;let{subscribe:m,getSnapshot:_,setProps:v}=J.useRef(are(o)).current;v(o);let w=(d=J.useSyncExternalStore(m,_,_))==null?void 0:d.slice();function D(B){if(!w)return[];let W=new Map;return o.newestOnTop&&w.reverse(),w.forEach(F=>{let{position:X}=F.props;W.has(X)||W.set(X,[]),W.get(X).push(F)}),Array.from(W,F=>B(F[0],F[1]))}return{getToastToRender:D,isToastActive:p6,count:w==null?void 0:w.length}}function hre(o){let[d,m]=J.useState(!1),[_,v]=J.useState(!1),w=J.useRef(null),D=J.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:B,pauseOnHover:W,closeToast:F,onClick:X,closeOnClick:Q}=o;sre({id:o.toastId,containerId:o.containerId,fn:m}),J.useEffect(()=>{if(o.pauseOnFocusLoss)return oe(),()=>{Ae()}},[o.pauseOnFocusLoss]);function oe(){document.hasFocus()||ve(),window.addEventListener("focus",ae),window.addEventListener("blur",ve)}function Ae(){window.removeEventListener("focus",ae),window.removeEventListener("blur",ve)}function ie(Ge){if(o.draggable===!0||o.draggable===Ge.pointerType){be();let Je=w.current;D.canCloseOnClick=!0,D.canDrag=!0,Je.style.transition="none",o.draggableDirection==="x"?(D.start=Ge.clientX,D.removalDistance=Je.offsetWidth*(o.draggablePercent/100)):(D.start=Ge.clientY,D.removalDistance=Je.offsetHeight*(o.draggablePercent===80?o.draggablePercent*1.5:o.draggablePercent)/100)}}function fe(Ge){let{top:Je,bottom:we,left:We,right:ct}=w.current.getBoundingClientRect();Ge.nativeEvent.type!=="touchend"&&o.pauseOnHover&&Ge.clientX>=We&&Ge.clientX<=ct&&Ge.clientY>=Je&&Ge.clientY<=we?ve():ae()}function ae(){m(!0)}function ve(){m(!1)}function be(){D.didMove=!1,document.addEventListener("pointermove",Qe),document.addEventListener("pointerup",Ye)}function _e(){document.removeEventListener("pointermove",Qe),document.removeEventListener("pointerup",Ye)}function Qe(Ge){let Je=w.current;if(D.canDrag&&Je){D.didMove=!0,d&&ve(),o.draggableDirection==="x"?D.delta=Ge.clientX-D.start:D.delta=Ge.clientY-D.start,D.start!==Ge.clientX&&(D.canCloseOnClick=!1);let we=o.draggableDirection==="x"?`${D.delta}px, var(--y)`:`0, calc(${D.delta}px + var(--y))`;Je.style.transform=`translate3d(${we},0)`,Je.style.opacity=`${1-Math.abs(D.delta/D.removalDistance)}`}}function Ye(){_e();let Ge=w.current;if(D.canDrag&&D.didMove&&Ge){if(D.canDrag=!1,Math.abs(D.delta)>D.removalDistance){v(!0),o.closeToast(!0),o.collapseAll();return}Ge.style.transition="transform 0.2s, opacity 0.2s",Ge.style.removeProperty("transform"),Ge.style.removeProperty("opacity")}}let Et={onPointerDown:ie,onPointerUp:fe};return B&&W&&(Et.onMouseEnter=ve,o.stacked||(Et.onMouseLeave=ae)),Q&&(Et.onClick=Ge=>{X&&X(Ge),D.canCloseOnClick&&F(!0)}),{playToast:ae,pauseToast:ve,isRunning:d,preventExitTransition:_,toastRef:w,eventHandlers:Et}}var pre=typeof window<"u"?J.useLayoutEffect:J.useEffect,ow=({theme:o,type:d,isLoading:m,..._})=>Qn.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:o==="colored"?"currentColor":`var(--toastify-icon-color-${d})`,..._});function fre(o){return Qn.createElement(ow,{...o},Qn.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))}function mre(o){return Qn.createElement(ow,{...o},Qn.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))}function _re(o){return Qn.createElement(ow,{...o},Qn.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))}function Ere(o){return Qn.createElement(ow,{...o},Qn.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))}function gre(){return Qn.createElement("div",{className:"Toastify__spinner"})}var iD={info:mre,warning:fre,success:_re,error:Ere,spinner:gre},yre=o=>o in iD;function Sre({theme:o,type:d,isLoading:m,icon:_}){let v=null,w={theme:o,type:d};return _===!1||(Cd(_)?v=_({...w,isLoading:m}):J.isValidElement(_)?v=J.cloneElement(_,w):m?v=iD.spinner():yre(d)&&(v=iD[d](w))),v}var vre=o=>{let{isRunning:d,preventExitTransition:m,toastRef:_,eventHandlers:v,playToast:w}=hre(o),{closeButton:D,children:B,autoClose:W,onClick:F,type:X,hideProgressBar:Q,closeToast:oe,transition:Ae,position:ie,className:fe,style:ae,progressClassName:ve,updateId:be,role:_e,progress:Qe,rtl:Ye,toastId:Et,deleteToast:Ge,isIn:Je,isLoading:we,closeOnClick:We,theme:ct,ariaLabel:Tt}=o,rn=af("Toastify__toast",`Toastify__toast-theme--${ct}`,`Toastify__toast--${X}`,{"Toastify__toast--rtl":Ye},{"Toastify__toast--close-on-click":We}),fn=Cd(fe)?fe({rtl:Ye,position:ie,type:X,defaultClassName:rn}):af(rn,fe),bn=Sre(o),De=!!Qe||!W,Ue={closeToast:oe,type:X,theme:ct},rt=null;return D===!1||(Cd(D)?rt=D(Ue):J.isValidElement(D)?rt=J.cloneElement(D,Ue):rt=Jie(Ue)),Qn.createElement(Ae,{isIn:Je,done:Ge,position:ie,preventExitTransition:m,nodeRef:_,playToast:w},Qn.createElement("div",{id:Et,tabIndex:0,onClick:F,"data-in":Je,className:fn,...v,style:ae,ref:_,...Je&&{role:_e,"aria-label":Tt}},bn!=null&&Qn.createElement("div",{className:af("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!we})},bn),d6(B,o,!d),rt,!o.customProgressBar&&Qn.createElement(Zie,{...be&&!De?{key:`p-${be}`}:{},rtl:Ye,theme:ct,delay:W,isRunning:d,isIn:Je,closeToast:oe,hide:Q,type:X,className:ve,controlledProgress:De,progress:Qe||0})))},Tre=(o,d=!1)=>({enter:`Toastify--animate Toastify__${o}-enter`,exit:`Toastify--animate Toastify__${o}-exit`,appendPosition:d}),Rre=Xie(Tre("bounce",!0)),bre={position:"top-right",transition:Rre,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light","aria-label":"Notifications Alt+T",hotKeys:o=>o.altKey&&o.code==="KeyT"};function Cre(o){let d={...bre,...o},m=o.stacked,[_,v]=J.useState(!0),w=J.useRef(null),{getToastToRender:D,isToastActive:B,count:W}=ure(d),{className:F,style:X,rtl:Q,containerId:oe,hotKeys:Ae}=d;function ie(ae){let ve=af("Toastify__toast-container",`Toastify__toast-container--${ae}`,{"Toastify__toast-container--rtl":Q});return Cd(F)?F({position:ae,rtl:Q,defaultClassName:ve}):af(ve,eD(F))}function fe(){m&&(v(!0),ln.play())}return pre(()=>{var ae;if(m){let ve=w.current.querySelectorAll('[data-in="true"]'),be=12,_e=(ae=d.position)==null?void 0:ae.includes("top"),Qe=0,Ye=0;Array.from(ve).reverse().forEach((Et,Ge)=>{let Je=Et;Je.classList.add("Toastify__toast--stacked"),Ge>0&&(Je.dataset.collapsed=`${_}`),Je.dataset.pos||(Je.dataset.pos=_e?"top":"bot");let we=Qe*(_?.2:1)+(_?0:be*Ge);Je.style.setProperty("--y",`${_e?we:we*-1}px`),Je.style.setProperty("--g",`${be}`),Je.style.setProperty("--s",`${1-(_?Ye:0)}`),Qe+=Je.offsetHeight,Ye+=.025})}},[_,W,m]),J.useEffect(()=>{function ae(ve){var be;let _e=w.current;Ae(ve)&&((be=_e.querySelector('[tabIndex="0"]'))==null||be.focus(),v(!1),ln.pause()),ve.key==="Escape"&&(document.activeElement===_e||_e!=null&&_e.contains(document.activeElement))&&(v(!0),ln.play())}return document.addEventListener("keydown",ae),()=>{document.removeEventListener("keydown",ae)}},[Ae]),Qn.createElement("section",{ref:w,className:"Toastify",id:oe,onMouseEnter:()=>{m&&(v(!1),ln.pause())},onMouseLeave:fe,"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text","aria-label":d["aria-label"]},D((ae,ve)=>{let be=ve.length?{...X}:{...X,pointerEvents:"none"};return Qn.createElement("div",{tabIndex:-1,className:ie(ae),"data-stacked":m,style:be,key:`c-${ae}`},ve.map(({content:_e,props:Qe})=>Qn.createElement(vre,{...Qe,stacked:m,collapseAll:fe,isIn:B(Qe.toastId,Qe.containerId),key:`t-${Qe.key}`},_e)))}))}function wre(){const[o,d]=J.useState([]),[m,_]=J.useState(!1),[v,w]=J.useState(!1),[D,B]=J.useState(""),[W,F]=J.useState(""),[X,Q]=J.useState(""),[oe,Ae]=J.useState(""),[ie,fe]=J.useState(""),[ae,ve]=J.useState(null),[be,_e]=J.useState(""),[Qe,Ye]=J.useState(""),[Et,Ge]=J.useState(null),[Je,we]=J.useState(!1);J.useEffect(()=>{const De=localStorage.getItem("token");De&&(wt.defaults.headers.common.Authorization=`Bearer ${De}`)},[]);const We=async()=>{var De;try{const Ue=await wt.get("/api/jobs");d(Ue.data)}catch(Ue){console.error("Fetch jobs error:",Ue),((De=Ue.response)==null?void 0:De.status)===401&&ln.error("Please login to continue")}};J.useEffect(()=>{We()},[]);const ct=async()=>{var De;if(!D||!W||!oe||!X){ln.error("All fields are required!");return}try{const rt={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};await wt.post("/api/jobs/add",{title:D,company:W,location:oe,description:X},rt),ln.success("Job added successfully!"),B(""),F(""),Ae(""),Q(""),_(!1),We()}catch(Ue){console.error("Add job error:",Ue),((De=Ue.response)==null?void 0:De.status)===401?ln.error("Please login to post jobs"):ln.error("Failed to add job!")}},Tt=async De=>{var Ue;if(window.confirm("Are you sure you want to delete this job?"))try{const sn={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};await wt.delete(`/api/jobs/${De}`,sn),ln.success("Job deleted successfully!"),We()}catch(rt){console.error("Delete job error:",rt),((Ue=rt.response)==null?void 0:Ue.status)===401?ln.error("Please login to delete jobs"):ln.error("Failed to delete job!")}},rn=De=>{const Ue=De.target.files[0];Ue&&Ue.type==="application/pdf"?Ge(Ue):(Ge(null),ln.error("Please upload a PDF file."))},fn=async De=>{if(De.preventDefault(),!be||!Qe||!Et){ln.error("Please fill all fields and upload your resume.");return}we(!0);try{const Ue=new FormData;Ue.append("name",be),Ue.append("email",Qe),Ue.append("resume",Et),Ue.append("jobId",ae._id),console.log("Submitting application with data:",{name:be,email:Qe,jobId:ae._id,resumeName:Et.name});const rt=await wt.post("/api/jobs/apply",Ue,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0});console.log("Application response:",rt.data),ln.success("Application submitted successfully!"),w(!1),_e(""),Ye(""),Ge(null),ve(null)}catch(Ue){console.error("Application error:",Ue),Ue.response?(console.log("Error response data:",Ue.response.data),console.log("Error status:",Ue.response.status),Ue.response.status===401?ln.error("Authentication failed. Please login again."):Ue.response.status===400?ln.error(Ue.response.data.message||"Invalid application data"):ln.error("Server error. Please try again later.")):Ue.request?ln.error("Network error. Please check your connection."):ln.error("Failed to submit application.")}finally{we(!1)}},bn=o.filter(De=>De.title.toLowerCase().includes(ie.toLowerCase())||De.company.toLowerCase().includes(ie.toLowerCase())||De.location.toLowerCase().includes(ie.toLowerCase()));return N.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900",children:[N.jsx($_,{}),N.jsx(Cre,{position:"top-right",autoClose:3e3}),N.jsx("div",{className:"bg-white/10 backdrop-blur-md border-b border-white/20 mt-[80px]",children:N.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[N.jsxs("div",{className:"text-center mb-8",children:[N.jsx("h1",{className:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent",children:"Find Your Dream Job"}),N.jsx("p",{className:"text-white/80 text-lg",children:"Discover amazing opportunities from top companies"})]}),N.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[N.jsxs("div",{className:"relative flex-1 max-w-md",children:[N.jsx(Iie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),N.jsx("input",{type:"text",placeholder:"Search jobs...",value:ie,onChange:De=>fe(De.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl bg-white/20 border border-white/30 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-purple-400"})]}),N.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-xl hover:from-pink-600 hover:to-purple-700 transform hover:scale-105 transition-all shadow-lg",children:[N.jsx(wie,{className:"w-5 h-5"}),"Post New Job"]})]})]})}),N.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:bn.length>0?N.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:bn.map(De=>N.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 hover:bg-white/20 hover:border-white/30 transition-all duration-300",children:[N.jsxs("div",{className:"flex items-start justify-between mb-4 gap-2",children:[N.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-xl",children:N.jsx(lie,{className:"w-6 h-6 text-purple-300"})}),N.jsxs("div",{className:"flex space-x-2",children:[N.jsx("button",{onClick:()=>{ve(De),w(!0)},className:"px-4 py-1 bg-green-500 hover:bg-green-600 text-white rounded-md text-sm transition-all",children:"Apply"}),N.jsx("button",{onClick:()=>Tt(De._id),className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded-md text-sm transition-all",children:"Delete"})]})]}),N.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:De.title}),N.jsxs("div",{className:"flex items-center gap-2 text-white/80 mb-2",children:[N.jsx(uie,{className:"w-4 h-4"}),N.jsx("span",{children:De.company})]}),N.jsxs("div",{className:"flex items-center gap-2 text-white/80 mb-3",children:[N.jsx(bie,{className:"w-4 h-4"}),N.jsx("span",{children:De.location})]}),N.jsx("p",{className:"text-white/70 text-sm line-clamp-3 mb-4",children:De.description})]},De._id))}):N.jsxs("div",{className:"text-center py-16",children:[N.jsx("p",{className:"text-white/60 text-lg mb-2",children:"No jobs found"}),N.jsx("p",{className:"text-white/40",children:"Try adjusting your search terms"})]})}),m&&N.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-md",children:N.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 relative",children:[N.jsx("button",{onClick:()=>_(!1),className:"absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100",children:N.jsx(tF,{className:"w-5 h-5 text-gray-600"})}),N.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Post a New Job"}),N.jsxs("div",{className:"space-y-4",children:[N.jsx("input",{type:"text",placeholder:"Job Title",value:D,onChange:De=>B(De.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500"}),N.jsx("input",{type:"text",placeholder:"Company Name",value:W,onChange:De=>F(De.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500"}),N.jsx("input",{type:"text",placeholder:"Location",value:oe,onChange:De=>Ae(De.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500"}),N.jsx("textarea",{placeholder:"Job Description",value:X,onChange:De=>Q(De.target.value),rows:"4",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500"}),N.jsxs("div",{className:"flex gap-3",children:[N.jsx("button",{onClick:()=>_(!1),className:"flex-1 py-3 border rounded-lg text-gray-700 hover:bg-gray-100",children:"Cancel"}),N.jsx("button",{onClick:ct,className:"flex-1 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700",children:"Post Job"})]})]})]})}),v&&N.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-md",children:N.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 relative",children:[N.jsx("button",{onClick:()=>w(!1),className:"absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100",children:N.jsx(tF,{className:"w-5 h-5 text-gray-600"})}),N.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:["Apply for ",ae==null?void 0:ae.title," at ",ae==null?void 0:ae.company]}),N.jsxs("form",{className:"space-y-4",onSubmit:fn,children:[N.jsx("input",{type:"text",placeholder:"Your Name",value:be,onChange:De=>_e(De.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500",required:!0}),N.jsx("input",{type:"email",placeholder:"Your Email",value:Qe,onChange:De=>Ye(De.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500",required:!0}),N.jsxs("div",{className:"relative flex flex-col items-center justify-center p-6 border-2 border-dashed border-gray-300 rounded-lg text-center",children:[Et?N.jsxs("p",{className:"text-green-600",children:["Resume uploaded: ",Et.name]}):N.jsxs(N.Fragment,{children:[N.jsx(Pie,{className:"w-8 h-8 text-gray-400 mb-2"}),N.jsx("p",{className:"text-gray-500 text-sm",children:"Upload your resume (PDF only)"})]}),N.jsx("input",{type:"file",accept:".pdf",onChange:rn,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",style:{zIndex:1},required:!0})]}),N.jsxs("div",{className:"flex gap-3",children:[N.jsx("button",{type:"button",onClick:()=>w(!1),className:"flex-1 py-3 border rounded-lg text-gray-700 hover:bg-gray-100",children:"Cancel"}),N.jsx("button",{type:"submit",disabled:Je,className:"flex-1 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 disabled:opacity-50 disabled:cursor-not-allowed",children:Je?"Submitting...":"Submit Application"})]})]})]})})]})}function Are(){const[o,d]=J.useState({title:"",company:"",location:"",type:"",description:"",salaryRange:""}),m=Ad(),_=v=>{v.preventDefault(),wt.post("/api/jobs",o).then(()=>{alert("Job posted successfully"),m("/jobs")})};return N.jsxs("div",{className:"p-6 max-w-lg mx-auto",children:[N.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Post a Job"}),N.jsxs("form",{onSubmit:_,className:"space-y-3",children:[["title","company","location","salaryRange"].map(v=>N.jsx("input",{type:"text",placeholder:v,className:"border p-2 rounded w-full",value:o[v],onChange:w=>d({...o,[v]:w.target.value}),required:v!=="salaryRange"},v)),N.jsxs("select",{className:"border p-2 rounded w-full",value:o.type,onChange:v=>d({...o,type:v.target.value}),required:!0,children:[N.jsx("option",{value:"",children:"Select Job Type"}),N.jsx("option",{children:"Full-time"}),N.jsx("option",{children:"Part-time"}),N.jsx("option",{children:"Contract"}),N.jsx("option",{children:"Internship"})]}),N.jsx("textarea",{placeholder:"Description",className:"border p-2 rounded w-full",value:o.description,onChange:v=>d({...o,description:v.target.value}),required:!0}),N.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded w-full",children:"Post Job"})]})]})}var wC={exports:{}},Ore=wC.exports,rF;function Ire(){return rF||(rF=1,function(o,d){(function(m,_){o.exports=_()})(Ore,function(){function m(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}var _=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof c1<"u"?c1:typeof self<"u"?self:{};function v(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var w=function(e){try{return!!e()}catch{return!0}},D=!w(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),B=D,W=Function.prototype,F=W.call,X=B&&W.bind.bind(F,F),Q=B?X:function(e){return function(){return F.apply(e,arguments)}},oe=Q({}.isPrototypeOf),Ae=function(e){return e&&e.Math===Math&&e},ie=Ae(typeof globalThis=="object"&&globalThis)||Ae(typeof window=="object"&&window)||Ae(typeof self=="object"&&self)||Ae(typeof _=="object"&&_)||Ae(typeof _=="object"&&_)||function(){return this}()||Function("return this")(),fe=D,ae=Function.prototype,ve=ae.apply,be=ae.call,_e=typeof Reflect=="object"&&Reflect.apply||(fe?be.bind(ve):function(){return be.apply(ve,arguments)}),Qe=Q,Ye=Qe({}.toString),Et=Qe("".slice),Ge=function(e){return Et(Ye(e),8,-1)},Je=Ge,we=Q,We=function(e){if(Je(e)==="Function")return we(e)},ct=typeof document=="object"&&document.all,Tt=ct===void 0&&ct!==void 0?function(e){return typeof e=="function"||e===ct}:function(e){return typeof e=="function"},rn={},fn=!w(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),bn=D,De=Function.prototype.call,Ue=bn?De.bind(De):function(){return De.apply(De,arguments)},rt={},sn={}.propertyIsEnumerable,ne=Object.getOwnPropertyDescriptor,Ke=ne&&!sn.call({1:2},1);rt.f=Ke?function(e){var t=ne(this,e);return!!t&&t.enumerable}:sn;var gt,bt,it=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},en=w,Nt=Ge,ke=Object,qe=Q("".split),qt=en(function(){return!ke("z").propertyIsEnumerable(0)})?function(e){return Nt(e)==="String"?qe(e,""):ke(e)}:ke,an=function(e){return e==null},br=an,da=TypeError,at=function(e){if(br(e))throw new da("Can't call method on "+e);return e},Ze=qt,St=at,Ht=function(e){return Ze(St(e))},$n=Tt,Un=function(e){return typeof e=="object"?e!==null:$n(e)},Ci={},_s=Ci,hc=ie,df=Tt,sh=function(e){return df(e)?e:void 0},Xt=function(e,t){return arguments.length<2?sh(_s[e])||sh(hc[e]):_s[e]&&_s[e][t]||hc[e]&&hc[e][t]},pc=ie.navigator,fc=pc&&pc.userAgent,Ms=fc?String(fc):"",Nd=ie,eE=Ms,tE=Nd.process,av=Nd.Deno,ov=tE&&tE.versions||av&&av.version,Dd=ov&&ov.v8;Dd&&(bt=(gt=Dd.split("."))[0]>0&&gt[0]<4?1:+(gt[0]+gt[1])),!bt&&eE&&(!(gt=eE.match(/Edge\/(\d+)/))||gt[1]>=74)&&(gt=eE.match(/Chrome\/(\d+)/))&&(bt=+gt[1]);var sr=bt,cv=sr,mc=w,Es=ie.String,kd=!!Object.getOwnPropertySymbols&&!mc(function(){var e=Symbol("symbol detection");return!Es(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&cv&&cv<41}),lv=kd&&!Symbol.sham&&typeof Symbol.iterator=="symbol",cw=Xt,uf=Tt,hf=oe,yl=Object,_c=lv?function(e){return typeof e=="symbol"}:function(e){var t=cw("Symbol");return uf(t)&&hf(t.prototype,yl(e))},ah=String,Pd=function(e){try{return ah(e)}catch{return"Object"}},dv=Tt,uv=Pd,nE=TypeError,mr=function(e){if(dv(e))return e;throw new nE(uv(e)+" is not a function")},lw=mr,hv=an,oh=function(e,t){var n=e[t];return hv(n)?void 0:lw(n)},iE=Ue,rE=Tt,pv=Un,Ec=TypeError,Cr={exports:{}},Wr=ie,Ld=Object.defineProperty,sE=ie,dw=function(e,t){try{Ld(Wr,e,{value:t,configurable:!0,writable:!0})}catch{Wr[e]=t}return t},fv="__core-js_shared__",aE=Cr.exports=sE[fv]||dw(fv,{});(aE.versions||(aE.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Sl=Cr.exports,pf=Sl,xs=function(e,t){return pf[e]||(pf[e]=t||{})},Md=at,ch=Object,Yr=function(e){return ch(Md(e))},_r=Yr,mv=Q({}.hasOwnProperty),Hi=Object.hasOwn||function(e,t){return mv(_r(e),t)},vl=Q,xd=0,vo=Math.random(),uw=vl(1 .toString),ff=function(e){return"Symbol("+(e===void 0?"":e)+")_"+uw(++xd+vo,36)},_v=xs,Ev=Hi,mf=ff,_f=kd,To=lv,wr=ie.Symbol,Ef=_v("wks"),hw=To?wr.for||wr:wr&&wr.withoutSetter||mf,ei=function(e){return Ev(Ef,e)||(Ef[e]=_f&&Ev(wr,e)?wr[e]:hw("Symbol."+e)),Ef[e]},gv=Ue,lh=Un,yv=_c,Us=oh,oE=function(e,t){var n,i;if(rE(n=e.toString)&&!pv(i=iE(n,e))||rE(n=e.valueOf)&&!pv(i=iE(n,e)))return i;throw new Ec("Can't convert object to primitive value")},Sv=TypeError,cE=ei("toPrimitive"),Ud=function(e,t){if(!lh(e)||yv(e))return e;var n,i=Us(e,cE);if(i){if(n=gv(i,e,t),!lh(n)||yv(n))return n;throw new Sv("Can't convert object to primitive value")}return oE(e)},vv=_c,gf=function(e){var t=Ud(e,"string");return vv(t)?t:t+""},Tl=Un,lE=ie.document,Tv=Tl(lE)&&Tl(lE.createElement),yf=function(e){return Tv?lE.createElement(e):{}},dE=yf,Rv=!fn&&!w(function(){return Object.defineProperty(dE("div"),"a",{get:function(){return 7}}).a!==7}),pw=fn,Sf=Ue,uE=rt,hE=it,Vd=Ht,jd=gf,bv=Hi,pE=Rv,fE=Object.getOwnPropertyDescriptor;rn.f=pw?fE:function(e,t){if(e=Vd(e),t=jd(t),pE)try{return fE(e,t)}catch{}if(bv(e,t))return hE(!Sf(uE.f,e,t),e[t])};var dh=w,mE=Tt,uh=/#|\.prototype\./,Vs=function(e,t){var n=vf[_E(e)];return n===Tf||n!==Cv&&(mE(t)?dh(t):!!t)},_E=Vs.normalize=function(e){return String(e).replace(uh,".").toLowerCase()},vf=Vs.data={},Cv=Vs.NATIVE="N",Tf=Vs.POLYFILL="P",hh=Vs,wv=mr,ns=D,Rl=We(We.bind),ua=function(e,t){return wv(e),t===void 0?e:ns?Rl(e,t):function(){return e.apply(t,arguments)}},Mr={},Av=fn&&w(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),EE=Un,gE=String,ph=TypeError,Er=function(e){if(EE(e))return e;throw new ph(gE(e)+" is not an object")},Ov=fn,fw=Rv,mw=Av,Rf=Er,bf=gf,_w=TypeError,yE=Object.defineProperty,Ew=Object.getOwnPropertyDescriptor,SE="enumerable",vE="configurable",Cf="writable";Mr.f=Ov?mw?function(e,t,n){if(Rf(e),t=bf(t),Rf(n),typeof e=="function"&&t==="prototype"&&"value"in n&&Cf in n&&!n[Cf]){var i=Ew(e,t);i&&i[Cf]&&(e[t]=n.value,n={configurable:vE in n?n[vE]:i[vE],enumerable:SE in n?n[SE]:i[SE],writable:!1})}return yE(e,t,n)}:yE:function(e,t,n){if(Rf(e),t=bf(t),Rf(n),fw)try{return yE(e,t,n)}catch{}if("get"in n||"set"in n)throw new _w("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var gw=Mr,yw=it,bl=fn?function(e,t,n){return gw.f(e,t,yw(1,n))}:function(e,t,n){return e[t]=n,e},fh=ie,TE=_e,Sw=We,vw=Tt,Tw=rn.f,Iv=hh,Fd=Ci,Rw=ua,Bd=bl,Nv=Hi,bw=function(e){var t=function(n,i,r){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,i)}return new e(n,i,r)}return TE(e,this,arguments)};return t.prototype=e.prototype,t},Jt=function(e,t){var n,i,r,a,l,u,h,f,E,y=e.target,S=e.global,T=e.stat,k=e.proto,O=S?fh:T?fh[y]:fh[y]&&fh[y].prototype,I=S?Fd:Fd[y]||Bd(Fd,y,{})[y],M=I.prototype;for(a in t)i=!(n=Iv(S?a:y+(T?".":"#")+a,e.forced))&&O&&Nv(O,a),u=I[a],i&&(h=e.dontCallGetSet?(E=Tw(O,a))&&E.value:O[a]),l=i&&h?h:t[a],(n||k||typeof u!=typeof l)&&(f=e.bind&&i?Rw(l,fh):e.wrap&&i?bw(l):k&&vw(l)?Sw(l):l,(e.sham||l&&l.sham||u&&u.sham)&&Bd(f,"sham",!0),Bd(I,a,f),k&&(Nv(Fd,r=y+"Prototype")||Bd(Fd,r,{}),Bd(Fd[r],a,l),e.real&&M&&(n||!M[a])&&Bd(M,a,l)))},Cw=Math.ceil,ww=Math.floor,Aw=Math.trunc||function(e){var t=+e;return(t>0?ww:Cw)(t)},RE=Aw,Cl=function(e){var t=+e;return t!=t||t===0?0:RE(t)},Ow=Cl,Dv=Math.max,kv=Math.min,wf=function(e,t){var n=Ow(e);return n<0?Dv(n+t,0):kv(n,t)},Pv=Cl,Lv=Math.min,wl=function(e){var t=Pv(e);return t>0?Lv(t,9007199254740991):0},Iw=wl,gc=function(e){return Iw(e.length)},Nw=Ht,Mv=wf,xv=gc,Gd=function(e){return function(t,n,i){var r=Nw(t),a=xv(r);if(a===0)return!e&&-1;var l,u=Mv(i,a);if(e&&n!=n){for(;a>u;)if((l=r[u++])!=l)return!0}else for(;a>u;u++)if((e||u in r)&&r[u]===n)return e||u||0;return!e&&-1}},Al={includes:Gd(!0),indexOf:Gd(!1)},Dw=Al.includes;Jt({target:"Array",proto:!0,forced:w(function(){return!Array(1).includes()})},{includes:function(e){return Dw(this,e,arguments.length>1?arguments[1]:void 0)}});var Af=ie,Uv=Ci,gs=function(e,t){var n=Uv[e+"Prototype"],i=n&&n[t];if(i)return i;var r=Af[e],a=r&&r.prototype;return a&&a[t]},bE=gs("Array","includes"),CE=Un,Vv=Ge,jv=ei("match"),wE=function(e){var t;return CE(e)&&((t=e[jv])!==void 0?!!t:Vv(e)==="RegExp")},kw=wE,Pw=TypeError,Fv={};Fv[ei("toStringTag")]="z";var AE=String(Fv)==="[object z]",Lw=AE,ys=Tt,yc=Ge,Bv=ei("toStringTag"),Gv=Object,Hv=yc(function(){return arguments}())==="Arguments",Ro=Lw?yc:function(e){var t,n,i;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(r,a){try{return r[a]}catch{}}(t=Gv(e),Bv))=="string"?n:Hv?yc(t):(i=yc(t))==="Object"&&ys(t.callee)?"Arguments":i},OE=Ro,Mw=String,is=function(e){if(OE(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return Mw(e)},Hd=ei("match"),IE=Jt,mh=function(e){if(kw(e))throw new Pw("The method doesn't accept regular expressions");return e},NE=at,DE=is,Ol=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[Hd]=!1,"/./"[e](t)}catch{}}return!1},Wd=Q("".indexOf);IE({target:"String",proto:!0,forced:!Ol("includes")},{includes:function(e){return!!~Wd(DE(NE(this)),DE(mh(e)),arguments.length>1?arguments[1]:void 0)}});var kE=gs("String","includes"),PE=oe,Il=bE,Wv=kE,Of=Array.prototype,If=String.prototype,xw=function(e){var t=e.includes;return e===Of||PE(Of,e)&&t===Of.includes?Il:typeof e=="string"||e===If||PE(If,e)&&t===If.includes?Wv:t},Re=v(xw),Uw=mr,Yv=Yr,zv=qt,Kv=gc,js=TypeError,Ss="Reduce of empty array with no initial value",Yd=function(e){return function(t,n,i,r){var a=Yv(t),l=zv(a),u=Kv(a);if(Uw(n),u===0&&i<2)throw new js(Ss);var h=e?u-1:0,f=e?-1:1;if(i<2)for(;;){if(h in l){r=l[h],h+=f;break}if(h+=f,e?h<0:u<=h)throw new js(Ss)}for(;e?h>=0:u>h;h+=f)h in l&&(r=n(r,l[h],h,a));return r}},LE={left:Yd(!1)},Nf=w,Nl=function(e,t){var n=[][e];return!!n&&Nf(function(){n.call(null,t||function(){return 1},1)})},Dl=ie,Sc=Ms,qv=Ge,kl=function(e){return Sc.slice(0,e.length)===e},vc=kl("Bun/")?"BUN":kl("Cloudflare-Workers")?"CLOUDFLARE":kl("Deno/")?"DENO":kl("Node.js/")?"NODE":Dl.Bun&&typeof Bun.version=="string"?"BUN":Dl.Deno&&typeof Deno.version=="object"?"DENO":qv(Dl.process)==="process"?"NODE":Dl.window&&Dl.document?"BROWSER":"REST",_h=vc==="NODE",Fs=LE.left;Jt({target:"Array",proto:!0,forced:!_h&&sr>79&&sr<83||!Nl("reduce")},{reduce:function(e){var t=arguments.length;return Fs(this,e,t,t>1?arguments[1]:void 0)}});var zd=gs("Array","reduce"),Kd=oe,Df=zd,qd=Array.prototype,Bs=function(e){var t=e.reduce;return e===qd||Kd(qd,e)&&t===qd.reduce?Df:t},vs=Bs,gr=v(vs),bo=Ge,Ts=Array.isArray||function(e){return bo(e)==="Array"},Pl=Jt,Xv=Ts,ME=Q([].reverse),kf=[1,2];Pl({target:"Array",proto:!0,forced:String(kf)===String(kf.reverse())},{reverse:function(){return Xv(this)&&(this.length=this.length),ME(this)}});var zr=gs("Array","reverse"),Ar=oe,Gn=zr,Rs=Array.prototype,ka=function(e){var t=e.reverse;return e===Rs||Ar(Rs,e)&&t===Rs.reverse?Gn:t},Pf=ka,Tc=v(Pf),Jv=ff,xE=xs("keys"),Rc=function(e){return xE[e]||(xE[e]=Jv(e))},Eh=!w(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),gh=Hi,yh=Tt,Zv=Yr,UE=Eh,VE=Rc("IE_PROTO"),Xd=Object,Qv=Xd.prototype,Ll=UE?Xd.getPrototypeOf:function(e){var t=Zv(e);if(gh(t,VE))return t[VE];var n=t.constructor;return yh(n)&&t instanceof n?n.prototype:t instanceof Xd?Qv:null},$v=Q,Jd=mr,Sh=Un,Lf=function(e){return Sh(e)||e===null},vh=String,Mf=TypeError,e0=function(e,t,n){try{return $v(Jd(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},t0=Un,Ml=at,n0=function(e){if(Lf(e))return e;throw new Mf("Can't set "+vh(e)+" as a prototype")},Zd=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=e0(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,r){return Ml(i),n0(r),t0(i)&&(t?e(i,r):i.__proto__=r),i}}():void 0),xl={},Th={},Rh=Hi,jE=Ht,Gs=Al.indexOf,Pa=Th,Co=Q([].push),FE=function(e,t){var n,i=jE(e),r=0,a=[];for(n in i)!Rh(Pa,n)&&Rh(i,n)&&Co(a,n);for(;t.length>r;)Rh(i,n=t[r++])&&(~Gs(a,n)||Co(a,n));return a},La=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],wo=FE,ar=La.concat("length","prototype");xl.f=Object.getOwnPropertyNames||function(e){return wo(e,ar)};var bc={};bc.f=Object.getOwnPropertySymbols;var Vw=Xt,jw=xl,Fw=bc,or=Er,BE=Q([].concat),bh=Vw("Reflect","ownKeys")||function(e){var t=jw.f(or(e)),n=Fw.f;return n?BE(t,n(e)):t},Qd=Hi,GE=bh,$d=rn,eu=Mr,HE={},i0=FE,Bw=La,Ch=Object.keys||function(e){return i0(e,Bw)},Ul=fn,WE=Av,xf=Mr,r0=Er,Cc=Ht,mn=Ch;HE.f=Ul&&!WE?Object.defineProperties:function(e,t){r0(e);for(var n,i=Cc(t),r=mn(t),a=r.length,l=0;a>l;)xf.f(e,n=r[l++],i[n]);return e};var Kn,Wi=Xt("document","documentElement"),Uf=Er,tu=HE,wc=La,Vf=Th,wh=Wi,nu=yf,YE="prototype",Ii="script",jf=Rc("IE_PROTO"),Ah=function(){},zE=function(e){return"<"+Ii+">"+e+"</"+Ii+">"},KE=function(e){e.write(zE("")),e.close();var t=e.parentWindow.Object;return e=null,t},Ff=function(){try{Kn=new ActiveXObject("htmlfile")}catch{}var e,t,n;Ff=typeof document<"u"?document.domain&&Kn?KE(Kn):(t=nu("iframe"),n="java"+Ii+":",t.style.display="none",wh.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(zE("document.F=Object")),e.close(),e.F):KE(Kn);for(var i=wc.length;i--;)delete Ff[YE][wc[i]];return Ff()};Vf[jf]=!0;var Vl=Object.create||function(e,t){var n;return e!==null?(Ah[YE]=Uf(e),n=new Ah,Ah[YE]=null,n[jf]=e):n=Ff(),t===void 0?n:tu.f(n,t)},qE=Un,XE=bl,Kr=Error,Qi=Q("".replace),Bf=String(new Kr("zxcasd").stack),iu=/\n\s*at [^:]*:[^\n]*/,Gf=iu.test(Bf),JE=it,Ao=!w(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",JE(1,7)),e.stack!==7)}),Hf=bl,ZE=function(e,t){if(Gf&&typeof e=="string"&&!Kr.prepareStackTrace)for(;t--;)e=Qi(e,iu,"");return e},QE=Ao,$E=Error.captureStackTrace,jl={},s0=jl,a0=ei("iterator"),o0=Array.prototype,eg=function(e){return e!==void 0&&(s0.Array===e||o0[a0]===e)},tg=Ro,ng=oh,Gw=an,c0=jl,l0=ei("iterator"),Oh=function(e){if(!Gw(e))return ng(e,l0)||ng(e,"@@iterator")||c0[tg(e)]},ig=Ue,d0=mr,u0=Er,h0=Pd,p0=Oh,f0=TypeError,rg=function(e,t){var n=arguments.length<2?p0(e):t;if(d0(n))return u0(ig(n,e));throw new f0(h0(e)+" is not iterable")},m0=Ue,Fl=Er,_0=oh,Ih=function(e,t,n){var i,r;Fl(e);try{if(!(i=_0(e,"return"))){if(t==="throw")throw n;return n}i=m0(i,e)}catch(a){r=!0,i=a}if(t==="throw")throw n;if(r)throw i;return Fl(i),n},Wf=ua,E0=Ue,sg=Er,g0=Pd,y0=eg,S0=gc,ag=oe,og=rg,v0=Oh,cg=Ih,lg=TypeError,Nh=function(e,t){this.stopped=e,this.result=t},dg=Nh.prototype,Dh=function(e,t,n){var i,r,a,l,u,h,f,E=n&&n.that,y=!(!n||!n.AS_ENTRIES),S=!(!n||!n.IS_RECORD),T=!(!n||!n.IS_ITERATOR),k=!(!n||!n.INTERRUPTED),O=Wf(t,E),I=function(L){return i&&cg(i,"normal",L),new Nh(!0,L)},M=function(L){return y?(sg(L),k?O(L[0],L[1],I):O(L[0],L[1])):k?O(L,I):O(L)};if(S)i=e.iterator;else if(T)i=e;else{if(!(r=v0(e)))throw new lg(g0(e)+" is not iterable");if(y0(r)){for(a=0,l=S0(e);l>a;a++)if((u=M(e[a]))&&ag(dg,u))return u;return new Nh(!1)}i=og(e,r)}for(h=S?e.next:i.next;!(f=E0(h,i)).done;){try{u=M(f.value)}catch(L){cg(i,"throw",L)}if(typeof u=="object"&&u&&ag(dg,u))return u}return new Nh(!1)},ug=is,T0=Jt,R0=oe,hg=Ll,kh=Zd,b0=function(e,t,n){for(var i=GE(t),r=eu.f,a=$d.f,l=0;l<i.length;l++){var u=i[l];Qd(e,u)||n&&Qd(n,u)||r(e,u,a(t,u))}},C0=Vl,pg=bl,Yf=it,Ph=function(e,t){qE(t)&&"cause"in t&&XE(e,"cause",t.cause)},fg=function(e,t,n,i){QE&&($E?$E(e,t):Hf(e,"stack",ZE(n,i)))},zf=Dh,w0=function(e,t){return e===void 0?arguments.length<2?"":t:ug(e)},A0=ei("toStringTag"),bs=Error,Bl=[].push,Cs=function(e,t){var n,i=R0(Oo,this);kh?n=kh(new bs,i?hg(this):Oo):(n=i?this:C0(Oo),pg(n,A0,"Error")),t!==void 0&&pg(n,"message",w0(t)),fg(n,Cs,n.stack,1),arguments.length>2&&Ph(n,arguments[2]);var r=[];return zf(e,Bl,{that:r}),pg(n,"errors",r),n};kh?kh(Cs,bs):b0(Cs,bs,{name:!0});var Oo=Cs.prototype=C0(bs.prototype,{constructor:Yf(1,Cs),message:Yf(1,""),name:Yf(1,"AggregateError")});T0({global:!0},{AggregateError:Cs});var ru,Gl,Lh,O0=Tt,Ac=ie.WeakMap,Kf=O0(Ac)&&/native code/.test(String(Ac)),mg=ie,I0=Un,N0=bl,su=Hi,qf=Sl,_g=Rc,D0=Th,Eg="Object already initialized",gg=mg.TypeError,k0=mg.WeakMap;if(Kf||qf.state){var di=qf.state||(qf.state=new k0);di.get=di.get,di.has=di.has,di.set=di.set,ru=function(e,t){if(di.has(e))throw new gg(Eg);return t.facade=e,di.set(e,t),t},Gl=function(e){return di.get(e)||{}},Lh=function(e){return di.has(e)}}else{var Mi=_g("state");D0[Mi]=!0,ru=function(e,t){if(su(e,Mi))throw new gg(Eg);return t.facade=e,N0(e,Mi,t),t},Gl=function(e){return su(e,Mi)?e[Mi]:{}},Lh=function(e){return su(e,Mi)}}var Oc,yg,Sg,Ic={set:ru,get:Gl,has:Lh,enforce:function(e){return Lh(e)?Gl(e):ru(e,{})},getterFor:function(e){return function(t){var n;if(!I0(t)||(n=Gl(t)).type!==e)throw new gg("Incompatible receiver, "+e+" required");return n}}},Xf=fn,Mh=Hi,Jf=Function.prototype,P0=Xf&&Object.getOwnPropertyDescriptor,vg=Mh(Jf,"name"),Tg={PROPER:vg&&(function(){}).name==="something",CONFIGURABLE:vg&&(!Xf||Xf&&P0(Jf,"name").configurable)},Rg=bl,Ma=function(e,t,n,i){return i&&i.enumerable?e[t]=n:Rg(e,t,n),e},bg=w,L0=Tt,Cg=Un,wg=Vl,Zf=Ll,M0=Ma,xh=ei("iterator"),Ag=!1;[].keys&&("next"in(Sg=[].keys())?(yg=Zf(Zf(Sg)))!==Object.prototype&&(Oc=yg):Ag=!0);var Io=!Cg(Oc)||bg(function(){var e={};return Oc[xh].call(e)!==e});L0((Oc=Io?{}:wg(Oc))[xh])||M0(Oc,xh,function(){return this});var Qf={IteratorPrototype:Oc,BUGGY_SAFARI_ITERATORS:Ag},Hw=Ro,x0=AE?{}.toString:function(){return"[object "+Hw(this)+"]"},Og=AE,Hl=Mr.f,No=bl,Nc=Hi,Do=x0,$f=ei("toStringTag"),ha=function(e,t,n,i){var r=n?e:e&&e.prototype;r&&(Nc(r,$f)||Hl(r,$f,{configurable:!0,value:t}),i&&!Og&&No(r,"toString",Do))},Uh=Qf.IteratorPrototype,em=Vl,Wl=it,xr=ha,tm=jl,U0=function(){return this},xa=function(e,t,n,i){var r=t+" Iterator";return e.prototype=em(Uh,{next:Wl(+!i,n)}),xr(e,r,!1,!0),tm[r]=U0,e},Ig=Jt,Ng=Ue,Dc=Tg,kc=xa,Vh=Ll,Dg=ha,nm=Ma,au=jl,jh=Qf,V0=Dc.PROPER,Fh=jh.BUGGY_SAFARI_ITERATORS,Yl=ei("iterator"),ko="keys",Bh="values",kg="entries",zl=function(){return this},rs=function(e,t,n,i,r,a,l){kc(n,t,i);var u,h,f,E=function(M){if(M===r&&O)return O;if(!Fh&&M&&M in T)return T[M];switch(M){case ko:case Bh:case kg:return function(){return new n(this,M)}}return function(){return new n(this)}},y=t+" Iterator",S=!1,T=e.prototype,k=T[Yl]||T["@@iterator"]||r&&T[r],O=!Fh&&k||E(r),I=t==="Array"&&T.entries||k;if(I&&(u=Vh(I.call(new e)))!==Object.prototype&&u.next&&(Dg(u,y,!0,!0),au[y]=zl),V0&&r===Bh&&k&&k.name!==Bh&&(S=!0,O=function(){return Ng(k,this)}),r)if(h={values:E(Bh),keys:a?O:E(ko),entries:E(kg)},l)for(f in h)(Fh||S||!(f in T))&&nm(T,f,h[f]);else Ig({target:t,proto:!0,forced:Fh||S},h);return l&&T[Yl]!==O&&nm(T,Yl,O,{}),au[t]=O,h},Gh=function(e,t){return{value:e,done:t}},j0=Ht,Pg=jl,im=Ic;Mr.f;var Lg=rs,Kl=Gh,Ua="Array Iterator",xi=im.set,Mg=im.getterFor(Ua);Lg(Array,"Array",function(e,t){xi(this,{type:Ua,target:j0(e),index:0,kind:t})},function(){var e=Mg(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Kl(void 0,!0);switch(e.kind){case"keys":return Kl(n,!1);case"values":return Kl(t[n],!1)}return Kl([n,t[n]],!1)},"values"),Pg.Arguments=Pg.Array;var F0=Mr,Yi=function(e,t,n){return F0.f(e,t,n)},B0=Xt,Ww=Yi,G0=fn,xg=ei("species"),$i=oe,ws=TypeError,pa=function(e,t){if($i(t,e))return e;throw new ws("Incorrect invocation")},H0=Tt,rm=Sl,Yw=Q(Function.toString);H0(rm.inspectSource)||(rm.inspectSource=function(e){return Yw(e)});var sm=rm.inspectSource,Hs=Q,fa=w,Ug=Tt,Ws=Ro,W0=sm,Va=function(){},ql=Xt("Reflect","construct"),ja=/^\s*(?:class|function)\b/,Vg=Hs(ja.exec),jg=!ja.test(Va),Ys=function(e){if(!Ug(e))return!1;try{return ql(Va,[],e),!0}catch{return!1}},Fg=function(e){if(!Ug(e))return!1;switch(Ws(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return jg||!!Vg(ja,W0(e))}catch{return!0}};Fg.sham=!0;var Fa,Ba,ou,Pc,Hh=!ql||fa(function(){var e;return Ys(Ys.call)||!Ys(Object)||!Ys(function(){e=!0})||e})?Fg:Ys,Y0=Hh,Wh=Pd,z0=TypeError,Yh=Er,K0=function(e){if(Y0(e))return e;throw new z0(Wh(e)+" is not a constructor")},zw=an,zs=ei("species"),zh=function(e,t){var n,i=Yh(e).constructor;return i===void 0||zw(n=Yh(i)[zs])?t:K0(n)},qr=Q([].slice),q0=TypeError,Ga=function(e,t){if(e<t)throw new q0("Not enough arguments");return e},Lc=/(?:ipad|iphone|ipod).*applewebkit/i.test(Ms),ss=ie,Bg=_e,Gg=ua,Ha=Tt,X0=Hi,Kh=w,cu=Wi,Ni=qr,J0=yf,Kw=Ga,Z0=Lc,qw=_h,Hg=ss.setImmediate,Si=ss.clearImmediate,mi=ss.process,_n=ss.Dispatch,Pn=ss.Function,ui=ss.MessageChannel,As=ss.String,ma=0,Wa={},am="onreadystatechange";Kh(function(){Fa=ss.location});var _a=function(e){if(X0(Wa,e)){var t=Wa[e];delete Wa[e],t()}},wi=function(e){return function(){_a(e)}},Po=function(e){_a(e.data)},Mc=function(e){ss.postMessage(As(e),Fa.protocol+"//"+Fa.host)};Hg&&Si||(Hg=function(e){Kw(arguments.length,1);var t=Ha(e)?e:Pn(e),n=Ni(arguments,1);return Wa[++ma]=function(){Bg(t,void 0,n)},Ba(ma),ma},Si=function(e){delete Wa[e]},qw?Ba=function(e){mi.nextTick(wi(e))}:_n&&_n.now?Ba=function(e){_n.now(wi(e))}:ui&&!Z0?(Pc=(ou=new ui).port2,ou.port1.onmessage=Po,Ba=Gg(Pc.postMessage,Pc)):ss.addEventListener&&Ha(ss.postMessage)&&!ss.importScripts&&Fa&&Fa.protocol!=="file:"&&!Kh(Mc)?(Ba=Mc,ss.addEventListener("message",Po,!1)):Ba=am in J0("script")?function(e){cu.appendChild(J0("script"))[am]=function(){cu.removeChild(this),_a(e)}}:function(e){setTimeout(wi(e),0)});var lu={set:Hg,clear:Si},Os=ie,du=fn,qh=Object.getOwnPropertyDescriptor,Ea=function(e){if(!du)return Os[e];var t=qh(Os,e);return t&&t.value},om=function(){this.head=null,this.tail=null};om.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var xc,uu,hu,Ya,Xh,Uc=om,Jh=/ipad|iphone|ipod/i.test(Ms)&&typeof Pebble<"u",Wg=/web0s(?!.*chrome)/i.test(Ms),Vc=ie,Zh=Ea,cm=ua,Xr=lu.set,Q0=Uc,Jr=Lc,$0=Jh,Yg=Wg,lm=_h,eT=Vc.MutationObserver||Vc.WebKitMutationObserver,za=Vc.document,Qh=Vc.process,pu=Vc.Promise,jc=Zh("queueMicrotask");if(!jc){var $h=new Q0,ep=function(){var e,t;for(lm&&(e=Qh.domain)&&e.exit();t=$h.get();)try{t()}catch(n){throw $h.head&&xc(),n}e&&e.enter()};Jr||lm||Yg||!eT||!za?!$0&&pu&&pu.resolve?((Ya=pu.resolve(void 0)).constructor=pu,Xh=cm(Ya.then,Ya),xc=function(){Xh(ep)}):lm?xc=function(){Qh.nextTick(ep)}:(Xr=cm(Xr,Vc),xc=function(){Xr(ep)}):(uu=!0,hu=za.createTextNode(""),new eT(ep).observe(hu,{characterData:!0}),xc=function(){hu.data=uu=!uu}),jc=function(e){$h.head||xc(),$h.add(e)}}var zg=jc,Fc=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Lo=ie.Promise,Xw=ie,tp=Lo,Jw=Tt,tT=hh,nT=sm,fu=ei,np=vc,dm=sr,Kg=tp&&tp.prototype,Zw=fu("species"),qg=Jw(Xw.PromiseRejectionEvent),mu=tT("Promise",function(){var e=nT(tp),t=e!==String(tp);if(!t&&dm===66||!Kg.catch||!Kg.finally)return!0;if(!dm||dm<51||!/native code/.test(e)){var n=new tp(function(r){r(1)}),i=function(r){r(function(){},function(){})};if((n.constructor={})[Zw]=i,!(n.then(function(){})instanceof i))return!0}return!(t||np!=="BROWSER"&&np!=="DENO"||qg)}),_u={CONSTRUCTOR:mu,REJECTION_EVENT:qg},On={},um=mr,Qw=TypeError,iT=function(e){var t,n;this.promise=new e(function(i,r){if(t!==void 0||n!==void 0)throw new Qw("Bad Promise constructor");t=i,n=r}),this.resolve=um(t),this.reject=um(n)};On.f=function(e){return new iT(e)};var Xg,rT,$w=Jt,Xl=_h,Is=ie,Jl=Ue,hm=Ma,Jg=ha,Zl=function(e){var t=B0(e);G0&&t&&!t[xg]&&Ww(t,xg,{configurable:!0,get:function(){return this}})},Ka=mr,Ql=Tt,eA=Un,sT=pa,aT=zh,Zg=lu.set,Qg=zg,$g=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},oT=Fc,cT=Uc,lT=Ic,ip=Lo,pm=_u,dT=On,fm="Promise",Eu=pm.CONSTRUCTOR,tA=pm.REJECTION_EVENT,mm=lT.getterFor(fm),kn=lT.set,ey=ip&&ip.prototype,Bc=ip,rp=ey,ty=Is.TypeError,sp=Is.document,$l=Is.process,gu=dT.f,yu=gu,uT=!!(sp&&sp.createEvent&&Is.dispatchEvent),hT="unhandledrejection",pT=function(e){var t;return!(!eA(e)||!Ql(t=e.then))&&t},ny=function(e,t){var n,i,r,a=t.value,l=t.state===1,u=l?e.ok:e.fail,h=e.resolve,f=e.reject,E=e.domain;try{u?(l||(t.rejection===2&&Or(t),t.rejection=1),u===!0?n=a:(E&&E.enter(),n=u(a),E&&(E.exit(),r=!0)),n===e.promise?f(new ty("Promise-chain cycle")):(i=pT(n))?Jl(i,n,h,f):h(n)):f(a)}catch(y){E&&!r&&E.exit(),f(y)}},iy=function(e,t){e.notified||(e.notified=!0,Qg(function(){for(var n,i=e.reactions;n=i.get();)ny(n,e);e.notified=!1,t&&!e.rejection&&oi(e)}))},ap=function(e,t,n){var i,r;uT?((i=sp.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),Is.dispatchEvent(i)):i={promise:t,reason:n},!tA&&(r=Is["on"+e])?r(i):e===hT&&$g("Unhandled promise rejection",n)},oi=function(e){Jl(Zg,Is,function(){var t,n=e.facade,i=e.value;if(_m(e)&&(t=oT(function(){Xl?$l.emit("unhandledRejection",i,n):ap(hT,n,i)}),e.rejection=Xl||_m(e)?2:1,t.error))throw t.value})},_m=function(e){return e.rejection!==1&&!e.parent},Or=function(e){Jl(Zg,Is,function(){var t=e.facade;Xl?$l.emit("rejectionHandled",t):ap("rejectionhandled",t,e.value)})},Su=function(e,t,n){return function(i){e(t,i,n)}},Gc=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,iy(e,!0))},op=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new ty("Promise can't be resolved itself");var i=pT(t);i?Qg(function(){var r={done:!1};try{Jl(i,t,Su(op,r,e),Su(Gc,r,e))}catch(a){Gc(r,a,e)}}):(e.value=t,e.state=1,iy(e,!1))}catch(r){Gc({done:!1},r,e)}}};Eu&&(rp=(Bc=function(e){sT(this,rp),Ka(e),Jl(Xg,this);var t=mm(this);try{e(Su(op,t),Su(Gc,t))}catch(n){Gc(t,n)}}).prototype,(Xg=function(e){kn(this,{type:fm,done:!1,notified:!1,parent:!1,reactions:new cT,rejection:!1,state:0,value:null})}).prototype=hm(rp,"then",function(e,t){var n=mm(this),i=gu(aT(this,Bc));return n.parent=!0,i.ok=!Ql(e)||e,i.fail=Ql(t)&&t,i.domain=Xl?$l.domain:void 0,n.state===0?n.reactions.add(i):Qg(function(){ny(i,n)}),i.promise}),rT=function(){var e=new Xg,t=mm(e);this.promise=e,this.resolve=Su(op,t),this.reject=Su(Gc,t)},dT.f=gu=function(e){return e===Bc||e===void 0?new rT(e):yu(e)}),$w({global:!0,wrap:!0,forced:Eu},{Promise:Bc}),Jg(Bc,fm,!1,!0),Zl(fm);var cp=ei("iterator"),ry=!1;try{var fT=0,Em={next:function(){return{done:!!fT++}},return:function(){ry=!0}};Em[cp]=function(){return this},Array.from(Em,function(){throw 2})}catch{}var sy=Lo,nA=function(e,t){try{if(!t&&!ry)return!1}catch{return!1}var n=!1;try{var i={};i[cp]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch{}return n},lp=_u.CONSTRUCTOR||!nA(function(e){sy.all(e).then(void 0,function(){})}),iA=Ue,mT=mr,rA=On,sA=Fc,ay=Dh;Jt({target:"Promise",stat:!0,forced:lp},{all:function(e){var t=this,n=rA.f(t),i=n.resolve,r=n.reject,a=sA(function(){var l=mT(t.resolve),u=[],h=0,f=1;ay(e,function(E){var y=h++,S=!1;f++,iA(l,t,E).then(function(T){S||(S=!0,u[y]=T,--f||i(u))},r)}),--f||i(u)});return a.error&&r(a.value),n.promise}});var oy=Jt,aA=_u.CONSTRUCTOR;Lo&&Lo.prototype,oy({target:"Promise",proto:!0,forced:aA,real:!0},{catch:function(e){return this.then(void 0,e)}});var oA=Ue,ga=mr,_T=On,ET=Fc,Ks=Dh;Jt({target:"Promise",stat:!0,forced:lp},{race:function(e){var t=this,n=_T.f(t),i=n.reject,r=ET(function(){var a=ga(t.resolve);Ks(e,function(l){oA(a,t,l).then(n.resolve,i)})});return r.error&&i(r.value),n.promise}});var gT=On;Jt({target:"Promise",stat:!0,forced:_u.CONSTRUCTOR},{reject:function(e){var t=gT.f(this);return(0,t.reject)(e),t.promise}});var gm=Er,Mo=Un,cA=On,yT=function(e,t){if(gm(e),Mo(t)&&t.constructor===e)return t;var n=cA.f(e);return(0,n.resolve)(t),n.promise},vu=Jt,ST=Lo,lA=_u.CONSTRUCTOR,dA=yT,uA=Xt("Promise"),hA=!lA;vu({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return dA(hA&&this===uA?ST:this,e)}});var pA=Ue,fA=mr,mA=On,vT=Fc,Tu=Dh;Jt({target:"Promise",stat:!0,forced:lp},{allSettled:function(e){var t=this,n=mA.f(t),i=n.resolve,r=n.reject,a=vT(function(){var l=fA(t.resolve),u=[],h=0,f=1;Tu(e,function(E){var y=h++,S=!1;f++,pA(l,t,E).then(function(T){S||(S=!0,u[y]={status:"fulfilled",value:T},--f||i(u))},function(T){S||(S=!0,u[y]={status:"rejected",reason:T},--f||i(u))})}),--f||i(u)});return a.error&&r(a.value),n.promise}});var dp=Ue,TT=mr,_A=Xt,Ru=On,up=Fc,RT=Dh,hp="No one promise resolved";Jt({target:"Promise",stat:!0,forced:lp},{any:function(e){var t=this,n=_A("AggregateError"),i=Ru.f(t),r=i.resolve,a=i.reject,l=up(function(){var u=TT(t.resolve),h=[],f=0,E=1,y=!1;RT(e,function(S){var T=f++,k=!1;E++,dp(u,t,S).then(function(O){k||y||(y=!0,r(O))},function(O){k||y||(k=!0,h[T]=O,--E||a(new n(h,hp)))})}),--E||a(new n(h,hp))});return l.error&&a(l.value),i.promise}});var cy=Jt,ly=_e,ym=qr,bT=On,CT=mr,wT=Fc,Sm=ie.Promise,bu=!1;cy({target:"Promise",stat:!0,forced:!Sm||!Sm.try||wT(function(){Sm.try(function(e){bu=e===8},8)}).error||!bu},{try:function(e){var t=arguments.length>1?ym(arguments,1):[],n=bT.f(this),i=wT(function(){return ly(CT(e),void 0,t)});return(i.error?n.reject:n.resolve)(i.value),n.promise}});var EA=On;Jt({target:"Promise",stat:!0},{withResolvers:function(){var e=EA.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var gA=Jt,dy=Lo,vm=w,Tm=Xt,uy=Tt,yA=zh,Cu=yT,SA=dy&&dy.prototype;gA({target:"Promise",proto:!0,real:!0,forced:!!dy&&vm(function(){SA.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=yA(this,Tm("Promise")),n=uy(e);return this.then(n?function(i){return Cu(t,e()).then(function(){return i})}:e,n?function(i){return Cu(t,e()).then(function(){throw i})}:e)}});var Rm=Q,AT=Cl,OT=is,IT=at,hy=Rm("".charAt),py=Rm("".charCodeAt),bm=Rm("".slice),NT=function(e){return function(t,n){var i,r,a=OT(IT(t)),l=AT(n),u=a.length;return l<0||l>=u?e?"":void 0:(i=py(a,l))<55296||i>56319||l+1===u||(r=py(a,l+1))<56320||r>57343?e?hy(a,l):i:e?bm(a,l,l+2):r-56320+(i-55296<<10)+65536}},fy={codeAt:NT(!1),charAt:NT(!0)},my=fy.charAt,_y=is,pp=Ic,Ey=rs,gy=Gh,Cm="String Iterator",Hc=pp.set,Wc=pp.getterFor(Cm);Ey(String,"String",function(e){Hc(this,{type:Cm,string:_y(e),index:0})},function(){var e,t=Wc(this),n=t.string,i=t.index;return i>=n.length?gy(void 0,!0):(e=my(n,i),t.index+=e.length,gy(e,!1))});var Yc=Ci.Promise,fp={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},mp=ie,zc=ha,DT=jl;for(var wm in fp)zc(mp[wm],wm),DT[wm]=DT.Array;var wu=Yc,Ne=v(wu),kT=gs("Array","values"),Am=Ro,PT=Hi,vA=oe,Om=kT,Au=Array.prototype,LT={DOMTokenList:!0,NodeList:!0},_p=function(e){var t=e.values;return e===Au||vA(Au,e)&&t===Au.values||PT(LT,Am(e))?Om:t},Ir=v(_p),Ep=Pd,MT=TypeError,xT=qr,Im=Math.floor,s=function(e,t){var n=e.length;if(n<8)for(var i,r,a=1;a<n;){for(r=a,i=e[a];r&&t(e[r-1],i)>0;)e[r]=e[--r];r!==a++&&(e[r]=i)}else for(var l=Im(n/2),u=s(xT(e,0,l),t),h=s(xT(e,l),t),f=u.length,E=h.length,y=0,S=0;y<f||S<E;)e[y+S]=y<f&&S<E?t(u[y],h[S])<=0?u[y++]:h[S++]:y<f?u[y++]:h[S++];return e},c=s,p=Ms.match(/firefox\/(\d+)/i),g=!!p&&+p[1],R=/MSIE|Trident/.test(Ms),C=Ms.match(/AppleWebKit\/(\d+)\./),V=!!C&&+C[1],q=Jt,ee=Q,de=mr,Me=Yr,ze=gc,Ce=function(e,t){if(!delete e[t])throw new MT("Cannot delete property "+Ep(t)+" of "+Ep(e))},Pe=is,Ct=w,Zt=c,Ui=Nl,pe=g,ce=R,ye=sr,Fe=V,pt=[],En=ee(pt.sort),Dt=ee(pt.push),jt=Ct(function(){pt.sort(void 0)}),yr=Ct(function(){pt.sort(null)}),Hn=Ui("sort"),xo=!Ct(function(){if(ye)return ye<70;if(!(pe&&pe>3)){if(ce)return!0;if(Fe)return Fe<603;var e,t,n,i,r="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)pt.push({k:t+i,v:n})}for(pt.sort(function(a,l){return l.v-a.v}),i=0;i<pt.length;i++)t=pt[i].k.charAt(0),r.charAt(r.length-1)!==t&&(r+=t);return r!=="DGBEFHACIJK"}});q({target:"Array",proto:!0,forced:jt||!yr||!Hn||!xo},{sort:function(e){e!==void 0&&de(e);var t=Me(this);if(xo)return e===void 0?En(t):En(t,e);var n,i,r=[],a=ze(t);for(i=0;i<a;i++)i in t&&Dt(r,t[i]);for(Zt(r,function(l){return function(u,h){return h===void 0?-1:u===void 0?1:l!==void 0?+l(u,h)||0:Pe(u)>Pe(h)?1:-1}}(e)),n=ze(r),i=0;i<n;)t[i]=r[i++];for(;i<a;)Ce(t,i++);return t}});var TA=gs("Array","sort"),g6=oe,y6=TA,RA=Array.prototype,S6=function(e){var t=e.sort;return e===RA||g6(RA,e)&&t===RA.sort?y6:t},gp=v(S6),v6=Jt,T6=Q,R6=wf,b6=RangeError,GD=String.fromCharCode,HD=String.fromCodePoint,C6=T6([].join);v6({target:"String",stat:!0,forced:!!HD&&HD.length!==1},{fromCodePoint:function(e){for(var t,n=[],i=arguments.length,r=0;i>r;){if(t=+arguments[r++],R6(t,1114111)!==t)throw new b6(t+" is not a valid code point");n[r]=t<65536?GD(t):GD(55296+((t-=65536)>>10),t%1024+56320)}return C6(n,"")}});var w6=w,A6=ei("iterator"),UT=!w6(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return e.pathname="c%20d",t.forEach(function(r,a){t.delete("b"),i+=a+r}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[A6]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"}),O6=Ma,bA=Jt,WD=ie,CA=Ea,I6=Xt,VT=Ue,Uo=Q,yy=fn,YD=UT,zD=Ma,N6=Yi,D6=function(e,t,n){for(var i in t)n&&n.unsafe&&e[i]?e[i]=t[i]:O6(e,i,t[i],n);return e},k6=ha,P6=xa,wA=Ic,KD=pa,AA=Tt,L6=Hi,M6=ua,x6=Ro,U6=Er,qD=Un,Ns=is,V6=Vl,XD=it,JD=rg,j6=Oh,jT=Gh,Nm=Ga,F6=c,B6=ei("iterator"),Dm="URLSearchParams",ZD=Dm+"Iterator",QD=wA.set,qa=wA.getterFor(Dm),G6=wA.getterFor(ZD),$D=CA("fetch"),FT=CA("Request"),Sy=CA("Headers"),OA=FT&&FT.prototype,ek=Sy&&Sy.prototype,H6=WD.TypeError,W6=WD.encodeURIComponent,Y6=String.fromCharCode,z6=I6("String","fromCodePoint"),K6=parseInt,BT=Uo("".charAt),tk=Uo([].join),Ou=Uo([].push),nk=Uo("".replace),q6=Uo([].shift),ik=Uo([].splice),rk=Uo("".split),sk=Uo("".slice),X6=Uo(/./.exec),J6=/\+/g,Z6=/^[0-9a-f]+$/i,ak=function(e,t){var n=sk(e,t,t+2);return X6(Z6,n)?K6(n,16):NaN},Q6=function(e){for(var t=0,n=128;n>0&&(e&n)!=0;n>>=1)t++;return t},$6=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},ok=function(e){for(var t=(e=nk(e,J6," ")).length,n="",i=0;i<t;){var r=BT(e,i);if(r==="%"){if(BT(e,i+1)==="%"||i+3>t){n+="%",i++;continue}var a=ak(e,i+1);if(a!=a){n+=r,i++;continue}i+=2;var l=Q6(a);if(l===0)r=Y6(a);else{if(l===1||l>4){n+="",i++;continue}for(var u=[a],h=1;h<l&&!(++i+3>t||BT(e,i)!=="%");){var f=ak(e,i+1);if(f!=f){i+=3;break}if(f>191||f<128)break;Ou(u,f),i+=2,h++}if(u.length!==l){n+="";continue}var E=$6(u);E===null?n+="":r=z6(E)}}n+=r,i++}return n},e8=/[!'()~]|%20/g,t8={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},n8=function(e){return t8[e]},ck=function(e){return nk(W6(e),e8,n8)},IA=P6(function(e,t){QD(this,{type:ZD,target:qa(e).entries,index:0,kind:t})},Dm,function(){var e=G6(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,jT(void 0,!0);var i=t[n];switch(e.kind){case"keys":return jT(i.key,!1);case"values":return jT(i.value,!1)}return jT([i.key,i.value],!1)},!0),lk=function(e){this.entries=[],this.url=null,e!==void 0&&(qD(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?BT(e,0)==="?"?sk(e,1):e:Ns(e)))};lk.prototype={type:Dm,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,i,r,a,l,u,h=this.entries,f=j6(e);if(f)for(n=(t=JD(e,f)).next;!(i=VT(n,t)).done;){if(a=(r=JD(U6(i.value))).next,(l=VT(a,r)).done||(u=VT(a,r)).done||!VT(a,r).done)throw new H6("Expected sequence with length 2");Ou(h,{key:Ns(l.value),value:Ns(u.value)})}else for(var E in e)L6(e,E)&&Ou(h,{key:E,value:Ns(e[E])})},parseQuery:function(e){if(e)for(var t,n,i=this.entries,r=rk(e,"&"),a=0;a<r.length;)(t=r[a++]).length&&(n=rk(t,"="),Ou(i,{key:ok(q6(n)),value:ok(tk(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],i=0;i<t.length;)e=t[i++],Ou(n,ck(e.key)+"="+ck(e.value));return tk(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var GT=function(){KD(this,km);var e=QD(this,new lk(arguments.length>0?arguments[0]:void 0));yy||(this.size=e.entries.length)},km=GT.prototype;if(D6(km,{append:function(e,t){var n=qa(this);Nm(arguments.length,2),Ou(n.entries,{key:Ns(e),value:Ns(t)}),yy||this.length++,n.updateURL()},delete:function(e){for(var t=qa(this),n=Nm(arguments.length,1),i=t.entries,r=Ns(e),a=n<2?void 0:arguments[1],l=a===void 0?a:Ns(a),u=0;u<i.length;){var h=i[u];if(h.key!==r||l!==void 0&&h.value!==l)u++;else if(ik(i,u,1),l!==void 0)break}yy||(this.size=i.length),t.updateURL()},get:function(e){var t=qa(this).entries;Nm(arguments.length,1);for(var n=Ns(e),i=0;i<t.length;i++)if(t[i].key===n)return t[i].value;return null},getAll:function(e){var t=qa(this).entries;Nm(arguments.length,1);for(var n=Ns(e),i=[],r=0;r<t.length;r++)t[r].key===n&&Ou(i,t[r].value);return i},has:function(e){for(var t=qa(this).entries,n=Nm(arguments.length,1),i=Ns(e),r=n<2?void 0:arguments[1],a=r===void 0?r:Ns(r),l=0;l<t.length;){var u=t[l++];if(u.key===i&&(a===void 0||u.value===a))return!0}return!1},set:function(e,t){var n=qa(this);Nm(arguments.length,1);for(var i,r=n.entries,a=!1,l=Ns(e),u=Ns(t),h=0;h<r.length;h++)(i=r[h]).key===l&&(a?ik(r,h--,1):(a=!0,i.value=u));a||Ou(r,{key:l,value:u}),yy||(this.size=r.length),n.updateURL()},sort:function(){var e=qa(this);F6(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=qa(this).entries,i=M6(e,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((t=n[r++]).value,t.key,this)},keys:function(){return new IA(this,"keys")},values:function(){return new IA(this,"values")},entries:function(){return new IA(this,"entries")}},{enumerable:!0}),zD(km,B6,km.entries,{}),zD(km,"toString",function(){return qa(this).serialize()},{enumerable:!0}),yy&&N6(km,"size",{get:function(){return qa(this).entries.length},configurable:!0,enumerable:!0}),k6(GT,Dm),bA({global:!0,forced:!YD},{URLSearchParams:GT}),!YD&&AA(Sy)){var i8=Uo(ek.has),r8=Uo(ek.set),dk=function(e){if(qD(e)){var t,n=e.body;if(x6(n)===Dm)return t=e.headers?new Sy(e.headers):new Sy,i8(t,"content-type")||r8(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),V6(e,{body:XD(0,Ns(n)),headers:XD(0,t)})}return e};if(AA($D)&&bA({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return $D(e,arguments.length>1?dk(arguments[1]):{})}}),AA(FT)){var NA=function(e){return KD(this,OA),new FT(e,arguments.length>1?dk(arguments[1]):{})};OA.constructor=NA,NA.prototype=OA,bA({global:!0,dontCallGetSet:!0,forced:!0},{Request:NA})}}var Xa,s8={URLSearchParams:GT,getState:qa},a8=Ci.URLSearchParams,uk=fn,o8=Q,c8=Ue,l8=w,DA=Ch,d8=bc,u8=rt,h8=Yr,p8=qt,Pm=Object.assign,hk=Object.defineProperty,f8=o8([].concat),m8=!Pm||l8(function(){if(uk&&Pm({b:1},Pm(hk({},"a",{enumerable:!0,get:function(){hk(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(r){t[r]=r}),Pm({},e)[n]!==7||DA(Pm({},t)).join("")!==i})?function(e,t){for(var n=h8(e),i=arguments.length,r=1,a=d8.f,l=u8.f;i>r;)for(var u,h=p8(arguments[r++]),f=a?f8(DA(h),a(h)):DA(h),E=f.length,y=0;E>y;)u=f[y++],uk&&!c8(l,h,u)||(n[u]=h[u]);return n}:Pm,_8=Er,E8=Ih,g8=fn,y8=Mr,S8=it,kA=function(e,t,n){g8?y8.f(e,t,S8(0,n)):e[t]=n},v8=ua,T8=Ue,R8=Yr,b8=function(e,t,n,i){try{return i?t(_8(n)[0],n[1]):t(n)}catch(r){E8(e,"throw",r)}},C8=eg,w8=Hh,A8=gc,pk=kA,O8=rg,I8=Oh,fk=Array,yp=Q,PA=2147483647,N8=/[^\0-\u007E]/,mk=/[.\u3002\uFF0E\uFF61]/g,_k="Overflow: input needs wider integers to process",Ek=RangeError,D8=yp(mk.exec),Lm=Math.floor,LA=String.fromCharCode,gk=yp("".charCodeAt),yk=yp([].join),Iu=yp([].push),k8=yp("".replace),P8=yp("".split),L8=yp("".toLowerCase),Sk=function(e){return e+22+75*(e<26)},M8=function(e,t,n){var i=0;for(e=n?Lm(e/700):e>>1,e+=Lm(e/t);e>455;)e=Lm(e/35),i+=36;return Lm(i+36*e/(e+38))},x8=function(e){var t=[];e=function(M){for(var L=[],j=0,K=M.length;j<K;){var z=gk(M,j++);if(z>=55296&&z<=56319&&j<K){var H=gk(M,j++);(64512&H)==56320?Iu(L,((1023&z)<<10)+(1023&H)+65536):(Iu(L,z),j--)}else Iu(L,z)}return L}(e);var n,i,r=e.length,a=128,l=0,u=72;for(n=0;n<e.length;n++)(i=e[n])<128&&Iu(t,LA(i));var h=t.length,f=h;for(h&&Iu(t,"-");f<r;){var E=PA;for(n=0;n<e.length;n++)(i=e[n])>=a&&i<E&&(E=i);var y=f+1;if(E-a>Lm((PA-l)/y))throw new Ek(_k);for(l+=(E-a)*y,a=E,n=0;n<e.length;n++){if((i=e[n])<a&&++l>PA)throw new Ek(_k);if(i===a){for(var S=l,T=36;;){var k=T<=u?1:T>=u+26?26:T-u;if(S<k)break;var O=S-k,I=36-k;Iu(t,LA(Sk(k+O%I))),S=Lm(O/I),T+=36}Iu(t,LA(Sk(S))),u=M8(l,y,f===h),l=0,f++}}l++,a++}return yk(t,"")},U8=Jt,MA=fn,V8=UT,xA=ie,vk=ua,Ja=Q,HT=Ma,Za=Yi,j8=pa,UA=Hi,VA=m8,Mm=function(e){var t=R8(e),n=w8(this),i=arguments.length,r=i>1?arguments[1]:void 0,a=r!==void 0;a&&(r=v8(r,i>2?arguments[2]:void 0));var l,u,h,f,E,y,S=I8(t),T=0;if(!S||this===fk&&C8(S))for(l=A8(t),u=n?new this(l):fk(l);l>T;T++)y=a?r(t[T],T):t[T],pk(u,T,y);else for(u=n?new this:[],E=(f=O8(t,S)).next;!(h=T8(E,f)).done;T++)y=a?b8(f,r,[h.value,T],!0):h.value,pk(u,T,y);return u.length=T,u},Vo=qr,F8=fy.codeAt,B8=function(e){var t,n,i=[],r=P8(k8(L8(e),mk,"."),".");for(t=0;t<r.length;t++)n=r[t],Iu(i,D8(N8,n)?"xn--"+x8(n):n);return yk(i,".")},ed=is,G8=ha,H8=Ga,Tk=s8,Rk=Ic,W8=Rk.set,WT=Rk.getterFor("URL"),Y8=Tk.URLSearchParams,z8=Tk.getState,vy=xA.URL,jA=xA.TypeError,YT=xA.parseInt,K8=Math.floor,bk=Math.pow,Qa=Ja("".charAt),jo=Ja(/./.exec),Ty=Ja([].join),q8=Ja(1 .toString),X8=Ja([].pop),xm=Ja([].push),FA=Ja("".replace),J8=Ja([].shift),Z8=Ja("".split),Ry=Ja("".slice),zT=Ja("".toLowerCase),Q8=Ja([].unshift),BA="Invalid scheme",Sp="Invalid host",Ck="Invalid port",wk=/[a-z]/i,$8=/[\d+-.a-z]/i,GA=/\d/,eG=/^0x/i,tG=/^[0-7]+$/,nG=/^\d+$/,Ak=/^[\da-f]+$/i,iG=/[\0\t\n\r #%/:<>?@[\\\]^|]/,rG=/[\0\t\n\r #/:<>?@[\\\]^|]/,sG=/^[\u0000-\u0020]+/,aG=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,oG=/[\t\n\r]/g,by=function(e){var t,n,i,r;if(typeof e=="number"){for(t=[],n=0;n<4;n++)Q8(t,e%256),e=K8(e/256);return Ty(t,".")}if(typeof e=="object"){for(t="",i=function(a){for(var l=null,u=1,h=null,f=0,E=0;E<8;E++)a[E]!==0?(f>u&&(l=h,u=f),h=null,f=0):(h===null&&(h=E),++f);return f>u?h:l}(e),n=0;n<8;n++)r&&e[n]===0||(r&&(r=!1),i===n?(t+=n?":":"::",r=!0):(t+=q8(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},KT={},Ok=VA({},KT,{" ":1,'"':1,"<":1,">":1,"`":1}),Ik=VA({},Ok,{"#":1,"?":1,"{":1,"}":1}),HA=VA({},Ik,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Nu=function(e,t){var n=F8(e,0);return n>32&&n<127&&!UA(t,e)?e:encodeURIComponent(e)},qT={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Cy=function(e,t){var n;return e.length===2&&jo(wk,Qa(e,0))&&((n=Qa(e,1))===":"||!t&&n==="|")},Nk=function(e){var t;return e.length>1&&Cy(Ry(e,0,2))&&(e.length===2||(t=Qa(e,2))==="/"||t==="\\"||t==="?"||t==="#")},cG=function(e){return e==="."||zT(e)==="%2e"},WA={},Dk={},YA={},kk={},Pk={},zA={},Lk={},Mk={},XT={},JT={},KA={},qA={},XA={},JA={},xk={},ZA={},Um={},Kc={},Uk={},vp={},td={},QA=function(e,t,n){var i,r,a,l=ed(e);if(t){if(r=this.parse(l))throw new jA(r);this.searchParams=null}else{if(n!==void 0&&(i=new QA(n,!0)),r=this.parse(l,null,i))throw new jA(r);(a=z8(new Y8)).bindURL(this),this.searchParams=a}};QA.prototype={type:"URL",parse:function(e,t,n){var i,r,a,l,u,h=this,f=t||WA,E=0,y="",S=!1,T=!1,k=!1;for(e=ed(e),t||(h.scheme="",h.username="",h.password="",h.host=null,h.port=null,h.path=[],h.query=null,h.fragment=null,h.cannotBeABaseURL=!1,e=FA(e,sG,""),e=FA(e,aG,"$1")),e=FA(e,oG,""),i=Mm(e);E<=i.length;){switch(r=i[E],f){case WA:if(!r||!jo(wk,r)){if(t)return BA;f=YA;continue}y+=zT(r),f=Dk;break;case Dk:if(r&&(jo($8,r)||r==="+"||r==="-"||r==="."))y+=zT(r);else{if(r!==":"){if(t)return BA;y="",f=YA,E=0;continue}if(t&&(h.isSpecial()!==UA(qT,y)||y==="file"&&(h.includesCredentials()||h.port!==null)||h.scheme==="file"&&!h.host))return;if(h.scheme=y,t)return void(h.isSpecial()&&qT[h.scheme]===h.port&&(h.port=null));y="",h.scheme==="file"?f=JA:h.isSpecial()&&n&&n.scheme===h.scheme?f=kk:h.isSpecial()?f=Mk:i[E+1]==="/"?(f=Pk,E++):(h.cannotBeABaseURL=!0,xm(h.path,""),f=Uk)}break;case YA:if(!n||n.cannotBeABaseURL&&r!=="#")return BA;if(n.cannotBeABaseURL&&r==="#"){h.scheme=n.scheme,h.path=Vo(n.path),h.query=n.query,h.fragment="",h.cannotBeABaseURL=!0,f=td;break}f=n.scheme==="file"?JA:zA;continue;case kk:if(r!=="/"||i[E+1]!=="/"){f=zA;continue}f=XT,E++;break;case Pk:if(r==="/"){f=JT;break}f=Kc;continue;case zA:if(h.scheme=n.scheme,r===Xa)h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=Vo(n.path),h.query=n.query;else if(r==="/"||r==="\\"&&h.isSpecial())f=Lk;else if(r==="?")h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=Vo(n.path),h.query="",f=vp;else{if(r!=="#"){h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=Vo(n.path),h.path.length--,f=Kc;continue}h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=Vo(n.path),h.query=n.query,h.fragment="",f=td}break;case Lk:if(!h.isSpecial()||r!=="/"&&r!=="\\"){if(r!=="/"){h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,f=Kc;continue}f=JT}else f=XT;break;case Mk:if(f=XT,r!=="/"||Qa(y,E+1)!=="/")continue;E++;break;case XT:if(r!=="/"&&r!=="\\"){f=JT;continue}break;case JT:if(r==="@"){S&&(y="%40"+y),S=!0,a=Mm(y);for(var O=0;O<a.length;O++){var I=a[O];if(I!==":"||k){var M=Nu(I,HA);k?h.password+=M:h.username+=M}else k=!0}y=""}else if(r===Xa||r==="/"||r==="?"||r==="#"||r==="\\"&&h.isSpecial()){if(S&&y==="")return"Invalid authority";E-=Mm(y).length+1,y="",f=KA}else y+=r;break;case KA:case qA:if(t&&h.scheme==="file"){f=ZA;continue}if(r!==":"||T){if(r===Xa||r==="/"||r==="?"||r==="#"||r==="\\"&&h.isSpecial()){if(h.isSpecial()&&y==="")return Sp;if(t&&y===""&&(h.includesCredentials()||h.port!==null))return;if(l=h.parseHost(y))return l;if(y="",f=Um,t)return;continue}r==="["?T=!0:r==="]"&&(T=!1),y+=r}else{if(y==="")return Sp;if(l=h.parseHost(y))return l;if(y="",f=XA,t===qA)return}break;case XA:if(!jo(GA,r)){if(r===Xa||r==="/"||r==="?"||r==="#"||r==="\\"&&h.isSpecial()||t){if(y!==""){var L=YT(y,10);if(L>65535)return Ck;h.port=h.isSpecial()&&L===qT[h.scheme]?null:L,y=""}if(t)return;f=Um;continue}return Ck}y+=r;break;case JA:if(h.scheme="file",r==="/"||r==="\\")f=xk;else{if(!n||n.scheme!=="file"){f=Kc;continue}switch(r){case Xa:h.host=n.host,h.path=Vo(n.path),h.query=n.query;break;case"?":h.host=n.host,h.path=Vo(n.path),h.query="",f=vp;break;case"#":h.host=n.host,h.path=Vo(n.path),h.query=n.query,h.fragment="",f=td;break;default:Nk(Ty(Vo(i,E),""))||(h.host=n.host,h.path=Vo(n.path),h.shortenPath()),f=Kc;continue}}break;case xk:if(r==="/"||r==="\\"){f=ZA;break}n&&n.scheme==="file"&&!Nk(Ty(Vo(i,E),""))&&(Cy(n.path[0],!0)?xm(h.path,n.path[0]):h.host=n.host),f=Kc;continue;case ZA:if(r===Xa||r==="/"||r==="\\"||r==="?"||r==="#"){if(!t&&Cy(y))f=Kc;else if(y===""){if(h.host="",t)return;f=Um}else{if(l=h.parseHost(y))return l;if(h.host==="localhost"&&(h.host=""),t)return;y="",f=Um}continue}y+=r;break;case Um:if(h.isSpecial()){if(f=Kc,r!=="/"&&r!=="\\")continue}else if(t||r!=="?")if(t||r!=="#"){if(r!==Xa&&(f=Kc,r!=="/"))continue}else h.fragment="",f=td;else h.query="",f=vp;break;case Kc:if(r===Xa||r==="/"||r==="\\"&&h.isSpecial()||!t&&(r==="?"||r==="#")){if((u=zT(u=y))===".."||u==="%2e."||u===".%2e"||u==="%2e%2e"?(h.shortenPath(),r==="/"||r==="\\"&&h.isSpecial()||xm(h.path,"")):cG(y)?r==="/"||r==="\\"&&h.isSpecial()||xm(h.path,""):(h.scheme==="file"&&!h.path.length&&Cy(y)&&(h.host&&(h.host=""),y=Qa(y,0)+":"),xm(h.path,y)),y="",h.scheme==="file"&&(r===Xa||r==="?"||r==="#"))for(;h.path.length>1&&h.path[0]==="";)J8(h.path);r==="?"?(h.query="",f=vp):r==="#"&&(h.fragment="",f=td)}else y+=Nu(r,Ik);break;case Uk:r==="?"?(h.query="",f=vp):r==="#"?(h.fragment="",f=td):r!==Xa&&(h.path[0]+=Nu(r,KT));break;case vp:t||r!=="#"?r!==Xa&&(r==="'"&&h.isSpecial()?h.query+="%27":h.query+=r==="#"?"%23":Nu(r,KT)):(h.fragment="",f=td);break;case td:r!==Xa&&(h.fragment+=Nu(r,Ok))}E++}},parseHost:function(e){var t,n,i;if(Qa(e,0)==="["){if(Qa(e,e.length-1)!=="]"||(t=function(r){var a,l,u,h,f,E,y,S=[0,0,0,0,0,0,0,0],T=0,k=null,O=0,I=function(){return Qa(r,O)};if(I()===":"){if(Qa(r,1)!==":")return;O+=2,k=++T}for(;I();){if(T===8)return;if(I()!==":"){for(a=l=0;l<4&&jo(Ak,I());)a=16*a+YT(I(),16),O++,l++;if(I()==="."){if(l===0||(O-=l,T>6))return;for(u=0;I();){if(h=null,u>0){if(!(I()==="."&&u<4))return;O++}if(!jo(GA,I()))return;for(;jo(GA,I());){if(f=YT(I(),10),h===null)h=f;else{if(h===0)return;h=10*h+f}if(h>255)return;O++}S[T]=256*S[T]+h,++u!=2&&u!==4||T++}if(u!==4)return;break}if(I()===":"){if(O++,!I())return}else if(I())return;S[T++]=a}else{if(k!==null)return;O++,k=++T}}if(k!==null)for(E=T-k,T=7;T!==0&&E>0;)y=S[T],S[T--]=S[k+E-1],S[k+--E]=y;else if(T!==8)return;return S}(Ry(e,1,-1)),!t))return Sp;this.host=t}else if(this.isSpecial()){if(e=B8(e),jo(iG,e)||(t=function(r){var a,l,u,h,f,E,y,S=Z8(r,".");if(S.length&&S[S.length-1]===""&&S.length--,(a=S.length)>4)return r;for(l=[],u=0;u<a;u++){if((h=S[u])==="")return r;if(f=10,h.length>1&&Qa(h,0)==="0"&&(f=jo(eG,h)?16:8,h=Ry(h,f===8?1:2)),h==="")E=0;else{if(!jo(f===10?nG:f===8?tG:Ak,h))return r;E=YT(h,f)}xm(l,E)}for(u=0;u<a;u++)if(E=l[u],u===a-1){if(E>=bk(256,5-a))return null}else if(E>255)return null;for(y=X8(l),u=0;u<l.length;u++)y+=l[u]*bk(256,3-u);return y}(e),t===null))return Sp;this.host=t}else{if(jo(rG,e))return Sp;for(t="",n=Mm(e),i=0;i<n.length;i++)t+=Nu(n[i],KT);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return UA(qT,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&Cy(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,i=e.password,r=e.host,a=e.port,l=e.path,u=e.query,h=e.fragment,f=t+":";return r!==null?(f+="//",e.includesCredentials()&&(f+=n+(i?":"+i:"")+"@"),f+=by(r),a!==null&&(f+=":"+a)):t==="file"&&(f+="//"),f+=e.cannotBeABaseURL?l[0]:l.length?"/"+Ty(l,"/"):"",u!==null&&(f+="?"+u),h!==null&&(f+="#"+h),f},setHref:function(e){var t=this.parse(e);if(t)throw new jA(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Vm(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+by(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(ed(e)+":",WA)},getUsername:function(){return this.username},setUsername:function(e){var t=Mm(ed(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Nu(t[n],HA)}},getPassword:function(){return this.password},setPassword:function(e){var t=Mm(ed(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Nu(t[n],HA)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?by(e):by(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,KA)},getHostname:function(){var e=this.host;return e===null?"":by(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,qA)},getPort:function(){var e=this.port;return e===null?"":ed(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=ed(e))===""?this.port=null:this.parse(e,XA))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Ty(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Um))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=ed(e))===""?this.query=null:(Qa(e,0)==="?"&&(e=Ry(e,1)),this.query="",this.parse(e,vp)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=ed(e))!==""?(Qa(e,0)==="#"&&(e=Ry(e,1)),this.fragment="",this.parse(e,td)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Vm=function(e){var t=j8(this,Ds),n=H8(arguments.length,1)>1?arguments[1]:void 0,i=W8(t,new QA(e,!1,n));MA||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},Ds=Vm.prototype,$a=function(e,t){return{get:function(){return WT(this)[e]()},set:t&&function(n){return WT(this)[t](n)},configurable:!0,enumerable:!0}};if(MA&&(Za(Ds,"href",$a("serialize","setHref")),Za(Ds,"origin",$a("getOrigin")),Za(Ds,"protocol",$a("getProtocol","setProtocol")),Za(Ds,"username",$a("getUsername","setUsername")),Za(Ds,"password",$a("getPassword","setPassword")),Za(Ds,"host",$a("getHost","setHost")),Za(Ds,"hostname",$a("getHostname","setHostname")),Za(Ds,"port",$a("getPort","setPort")),Za(Ds,"pathname",$a("getPathname","setPathname")),Za(Ds,"search",$a("getSearch","setSearch")),Za(Ds,"searchParams",$a("getSearchParams")),Za(Ds,"hash",$a("getHash","setHash"))),HT(Ds,"toJSON",function(){return WT(this).serialize()},{enumerable:!0}),HT(Ds,"toString",function(){return WT(this).serialize()},{enumerable:!0}),vy){var Vk=vy.createObjectURL,jk=vy.revokeObjectURL;Vk&&HT(Vm,"createObjectURL",vk(Vk,vy)),jk&&HT(Vm,"revokeObjectURL",vk(jk,vy))}G8(Vm,"URL"),U8({global:!0,forced:!V8,sham:!MA},{URL:Vm});var lG=Jt,Fk=w,dG=Ga,Bk=is,uG=UT,$A=Xt("URL"),hG=uG&&Fk(function(){$A.canParse()}),pG=Fk(function(){return $A.canParse.length!==1});lG({target:"URL",stat:!0,forced:!hG||pG},{canParse:function(e){var t=dG(arguments.length,1),n=Bk(e),i=t<2||arguments[1]===void 0?void 0:Bk(arguments[1]);try{return!!new $A(n,i)}catch{return!1}}});var fG=Jt,mG=Ga,Gk=is,_G=UT,EG=Xt("URL");fG({target:"URL",stat:!0,forced:!_G},{parse:function(e){var t=mG(arguments.length,1),n=Gk(e),i=t<2||arguments[1]===void 0?void 0:Gk(arguments[1]);try{return new EG(n,i)}catch{return null}}});var ZT=v(Ci.URL);let Hk=!0,Wk=!0;function QT(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function Tp(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(l,u){if(l!==t)return r.apply(this,arguments);const h=f=>{const E=n(f);E&&(u.handleEvent?u.handleEvent(E):u(E))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,h),r.apply(this,[l,h])};const a=i.removeEventListener;i.removeEventListener=function(l,u){if(l!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(u))return a.apply(this,arguments);const h=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[l,h])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(l){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),l&&this.addEventListener(t,this["_on"+t]=l)},enumerable:!0,configurable:!0})}function gG(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Hk=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function yG(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Wk=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Yk(){if(typeof window=="object"){if(Hk)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function eO(e,t){Wk&&console.warn(e+" is deprecated, please use "+t+" instead.")}function zk(e){return Object.prototype.toString.call(e)==="[object Object]"}function Kk(e){var t;return zk(e)?gr(t=Object.keys(e)).call(t,function(n,i){const r=zk(e[i]),a=r?Kk(e[i]):e[i],l=r&&!Object.keys(a).length;return a===void 0||l?n:Object.assign(n,{[i]:a})},{}):e}function tO(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?tO(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(r=>{tO(e,e.get(r),n)})}))}function qk(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(t===null)return r;const a=[];return e.forEach(l=>{l.type==="track"&&l.trackIdentifier===t.id&&a.push(l)}),a.forEach(l=>{e.forEach(u=>{u.type===i&&u.trackId===l.id&&tO(e,u,r)})}),r}const Xk=Yk;function Jk(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const u={};return Object.keys(l).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const f=typeof l[h]=="object"?l[h]:{ideal:l[h]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);const E=function(y,S){return y?y+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(f.ideal!==void 0){u.optional=u.optional||[];let y={};typeof f.ideal=="number"?(y[E("min",h)]=f.ideal,u.optional.push(y),y={},y[E("max",h)]=f.ideal,u.optional.push(y)):(y[E("",h)]=f.ideal,u.optional.push(y))}f.exact!==void 0&&typeof f.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[E("",h)]=f.exact):["min","max"].forEach(y=>{f[y]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[E(y,h)]=f[y])})}),l.advanced&&(u.optional=(u.optional||[]).concat(l.advanced)),u},r=function(l,u){if(t.version>=61)return u(l);if((l=JSON.parse(JSON.stringify(l)))&&typeof l.audio=="object"){const h=function(f,E,y){E in f&&!(y in f)&&(f[y]=f[E],delete f[E])};h((l=JSON.parse(JSON.stringify(l))).audio,"autoGainControl","googAutoGainControl"),h(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=i(l.audio)}if(l&&typeof l.video=="object"){let h=l.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const f=t.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||f)){let E;if(delete l.video.facingMode,h.exact==="environment"||h.ideal==="environment"?E=["back","rear"]:h.exact!=="user"&&h.ideal!=="user"||(E=["front"]),E)return n.mediaDevices.enumerateDevices().then(y=>{y=y.filter(T=>T.kind==="videoinput");let S=y.find(T=>E.some(k=>{var O;return Re(O=T.label.toLowerCase()).call(O,k)}));return!S&&y.length&&Re(E).call(E,"back")&&(S=y[y.length-1]),S&&(l.video.deviceId=h.exact?{exact:S.deviceId}:{ideal:S.deviceId}),l.video=i(l.video),Xk("chrome: "+JSON.stringify(l)),u(l)})}l.video=i(l.video)}return Xk("chrome: "+JSON.stringify(l)),u(l)},a=function(l){return t.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(l,u,h){r(l,f=>{n.webkitGetUserMedia(f,u,E=>{h&&h(a(E))})})}).bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(u){return r(u,h=>l(h).then(f=>{if(h.audio&&!f.getAudioTracks().length||h.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(E=>{E.stop()}),new DOMException("","NotFoundError");return f},f=>Ne.reject(a(f))))}}}function Zk(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Qk(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(l=>l.track&&l.track.id===i.track.id):{track:i.track};const a=new Event("track");a.track=i.track,a.receiver=r,a.transceiver={receiver:r},a.streams=[n.stream],this.dispatchEvent(a)}),n.stream.getTracks().forEach(i=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(l=>l.track&&l.track.id===i.id):{track:i};const a=new Event("track");a.track=i,a.receiver=r,a.transceiver={receiver:r},a.streams=[n.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Tp(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function $k(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(r,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=r.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:r}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,u){let h=r.apply(this,arguments);return h||(h=t(this,l),this._senders.push(h)),h};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){a.apply(this,arguments);const u=this._senders.indexOf(l);u!==-1&&this._senders.splice(u,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(a=>{this._senders.push(t(this,a))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(a=>{const l=this._senders.find(u=>u.track===a);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function eP(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,r]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const a=function(u){const h={};return u.result().forEach(f=>{const E={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(y=>{E[y]=f.stat(y)}),h[E.id]=E}),h},l=function(u){return new Map(Object.keys(u).map(h=>[h,u[h]]))};if(arguments.length>=2){const u=function(h){i(l(a(h)))};return t.apply(this,[u,n])}return new Ne((u,h)=>{t.apply(this,[function(f){u(l(a(f)))},h])}).then(i,r)}}function tP(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(a=>a._pc=this),r});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(a=>qk(a,r.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Tp(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>qk(r,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,r,a;return this.getSenders().forEach(l=>{l.track===n&&(i?a=!0:i=l)}),this.getReceivers().forEach(l=>(l.track===n&&(r?a=!0:r=l),l.track===n)),a||i&&r?Ne.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():Ne.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function nP(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,l){if(!l)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=t.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(u)===-1&&this._shimmedLocalStreams[l.id].push(u):this._shimmedLocalStreams[l.id]=[l,u],u};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(h=>{if(this.getSenders().find(E=>E.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const u=this.getSenders().filter(h=>l.indexOf(h)===-1);this._shimmedLocalStreams[a.id]=[a].concat(u)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const u=this._shimmedLocalStreams[l].indexOf(a);u!==-1&&this._shimmedLocalStreams[l].splice(u,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),r.apply(this,arguments)}}function iP(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return nP(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const h=n.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(f=>this._reverseStreams[f.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(f=>{if(this.getSenders().find(y=>y.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const f=new e.MediaStream(h.getTracks());this._streams[h.id]=f,this._reverseStreams[f.id]=h,h=f}i.apply(this,[h])};const r=e.RTCPeerConnection.prototype.removeStream;function a(h,f){let E=f.sdp;return Object.keys(h._reverseStreams||[]).forEach(y=>{const S=h._reverseStreams[y],T=h._streams[S.id];E=E.replace(new RegExp(T.id,"g"),S.id)}),new RTCSessionDescription({type:f.type,sdp:E})}e.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},e.RTCPeerConnection.prototype.addTrack=function(h,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const E=[].slice.call(arguments,1);if(E.length!==1||!E[0].getTracks().find(T=>T===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(T=>T.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const S=this._streams[f.id];if(S)S.addTrack(h),Ne.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const T=new e.MediaStream([h]);this._streams[f.id]=T,this._reverseStreams[T.id]=f,this.addStream(T)}return this.getSenders().find(T=>T.track===h)},["createOffer","createAnswer"].forEach(function(h){const f=e.RTCPeerConnection.prototype[h],E={[h](){const y=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[S=>{const T=a(this,S);y[0].apply(null,[T])},S=>{y[1]&&y[1].apply(null,S)},arguments[2]]):f.apply(this,arguments).then(S=>a(this,S))}};e.RTCPeerConnection.prototype[h]=E[h]});const l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(h,f){let E=f.sdp;return Object.keys(h._reverseStreams||[]).forEach(y=>{const S=h._reverseStreams[y],T=h._streams[S.id];E=E.replace(new RegExp(S.id,"g"),T.id)}),new RTCSessionDescription({type:f.type,sdp:E})}(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};const u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const h=u.get.apply(this);return h.type===""?h:a(this,h)}}),e.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(h._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let f;this._streams=this._streams||{},Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(y=>h.track===y)&&(f=this._streams[E])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function nO(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=r[n]})}function rP(e,t){Tp(e,"negotiationneeded",n=>{const i=n.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var sP=Object.freeze({__proto__:null,fixNegotiationNeeded:rP,shimAddTrackRemoveTrack:iP,shimAddTrackRemoveTrackWithNative:nP,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const r=n.video&&n.video.width,a=n.video&&n.video.height,l=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:l||3}},r&&(n.video.mandatory.maxWidth=r),a&&(n.video.mandatory.maxHeight=a),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:$k,shimGetStats:eP,shimGetUserMedia:Jk,shimMediaStream:Zk,shimOnTrack:Qk,shimPeerConnection:nO,shimSenderReceiverGetStats:tP});function aP(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(r,a,l){eO("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(a,l)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(l,u,h){u in l&&!(h in l)&&(l[h]=l[u],delete l[u])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(l){return typeof l=="object"&&typeof l.audio=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l.audio,"autoGainControl","mozAutoGainControl"),r(l.audio,"noiseSuppression","mozNoiseSuppression")),a(l)},i&&i.prototype.getSettings){const l=i.prototype.getSettings;i.prototype.getSettings=function(){const u=l.apply(this,arguments);return r(u,"mozAutoGainControl","autoGainControl"),r(u,"mozNoiseSuppression","noiseSuppression"),u}}if(i&&i.prototype.applyConstraints){const l=i.prototype.applyConstraints;i.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),r(u,"autoGainControl","mozAutoGainControl"),r(u,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[u])}}}}function oP(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function iO(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const a=e.RTCPeerConnection.prototype[r],l={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=l[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,a,l]=arguments;return i.apply(this,[r||null]).then(u=>{if(t.version<53&&!a)try{u.forEach(h=>{h.type=n[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;u.forEach((f,E)=>{u.set(E,Object.assign({},f,{type:n[f.type]||f.type}))})}return u}).then(a,l)}}function cP(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Ne.resolve(new Map)}}function lP(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Tp(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function dP(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){eO("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&Re(i=t.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function uP(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function hP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(i){const{sender:a}=r,l=a.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=n,a.sendEncodings=n,this.setParametersPromises.push(a.setParameters(l).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return r})}function pP(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function fP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ne.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function mP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ne.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var _P=Object.freeze({__proto__:null,shimAddTransceiver:hP,shimCreateAnswer:mP,shimCreateOffer:fP,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Ne.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:pP,shimGetUserMedia:aP,shimOnTrack:oP,shimPeerConnection:iO,shimRTCDataChannel:uP,shimReceiverGetStats:lP,shimRemoveStream:dP,shimSenderGetStats:cP});function EP(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),Re(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>t.call(this,r,n)),n.getVideoTracks().forEach(r=>t.call(this,r,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return r&&r.forEach(l=>{var u;this._localStreams?Re(u=this._localStreams).call(u,l)||this._localStreams.push(l):this._localStreams=[l]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const i=t.getTracks();this.getSenders().forEach(r=>{Re(i).call(i,r.track)&&this.removeTrack(r)})})}}function gP(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{var a;if(this._remoteStreams||(this._remoteStreams=[]),Re(a=this._remoteStreams).call(a,r))return;this._remoteStreams.push(r);const l=new Event("addstream");l.stream=r,this.dispatchEvent(l)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(r)>=0)return;n._remoteStreams.push(r);const a=new Event("addstream");a.stream=r,n.dispatchEvent(a)})}),t.apply(n,arguments)}}}function yP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,a=t.setRemoteDescription,l=t.addIceCandidate;t.createOffer=function(h,f){const E=arguments.length>=2?arguments[2]:arguments[0],y=n.apply(this,[E]);return f?(y.then(h,f),Ne.resolve()):y},t.createAnswer=function(h,f){const E=arguments.length>=2?arguments[2]:arguments[0],y=i.apply(this,[E]);return f?(y.then(h,f),Ne.resolve()):y};let u=function(h,f,E){const y=r.apply(this,[h]);return E?(y.then(f,E),Ne.resolve()):y};t.setLocalDescription=u,u=function(h,f,E){const y=a.apply(this,[h]);return E?(y.then(f,E),Ne.resolve()):y},t.setRemoteDescription=u,u=function(h,f,E){const y=l.apply(this,[h]);return E?(y.then(f,E),Ne.resolve()):y},t.addIceCandidate=u}function SP(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=r=>i(vP(r))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,i,r){t.mediaDevices.getUserMedia(n).then(i,r)}).bind(t))}function vP(e){return e&&e.video!==void 0?Object.assign({},e,{video:Kk(e.video)}):e}function TP(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const r=[];for(let a=0;a<n.iceServers.length;a++){let l=n.iceServers[a];!l.hasOwnProperty("urls")&&l.hasOwnProperty("url")?(eO("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,r.push(l)):r.push(n.iceServers[a])}n.iceServers=r}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function RP(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function bP(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveVideo!==!0||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function CP(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var wP=Object.freeze({__proto__:null,shimAudioContext:CP,shimCallbacksAPI:yP,shimConstraints:vP,shimCreateOfferLegacy:bP,shimGetUserMedia:SP,shimLocalStreamsAPI:EP,shimRTCIceServerUrls:TP,shimRemoteStreamsAPI:gP,shimTrackEventTransceiver:RP}),AP=`	
\v\f\r \u2028\u2029\uFEFF`,SG=at,vG=is,rO=AP,OP=Q("".replace),TG=RegExp("^["+rO+"]+"),RG=RegExp("(^|[^"+rO+"])["+rO+"]+$"),bG=function(e){return function(t){var n=vG(SG(t));return 1&e&&(n=OP(n,TG,"")),2&e&&(n=OP(n,RG,"$1")),n}},CG={trim:bG(3)},wG=Tg.PROPER,AG=w,IP=AP,OG=CG.trim;Jt({target:"String",proto:!0,forced:function(e){return AG(function(){return!!IP[e]()||""[e]()!==""||wG&&IP[e].name!==e})}("trim")},{trim:function(){return OG(this)}});var IG=gs("String","trim"),NG=oe,DG=IG,sO=String.prototype,kG=function(e){var t=e.trim;return typeof e=="string"||e===sO||NG(sO,e)&&t===sO.trim?DG:t},Nr=v(kG),NP={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(n){return n.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(r=>r.indexOf(i)===0)},t.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let a=8;a<i.length;a+=2)switch(i[a]){case"raddr":r.relatedAddress=i[a+1];break;case"rport":r.relatedPort=parseInt(i[a+1],10);break;case"tcptype":r.tcpType=i[a+1];break;case"ufrag":r.ufrag=i[a+1],r.usernameFragment=i[a+1];break;default:r[i[a]]===void 0&&(r[i[a]]=i[a+1])}return r},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const a=n.type;return i.push("typ"),i.push(a),a!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},t.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const i={};let r;const a=n.substring(n.indexOf(" ")+1).split(";");for(let l=0;l<a.length;l++)r=a[l].trim().split("="),i[r[0].trim()]=r[1];return i},t.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const a=[];Object.keys(n.parameters).forEach(l=>{n.parameters[l]!==void 0?a.push(l+"="+n.parameters[l]):a.push(l)}),i+="a=fmtp:"+r+" "+a.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(a=>{i+="a=rtcp-fb:"+r+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},a=n.indexOf(":",i);return a>-1?(r.attribute=n.substring(i+1,a),r.value=n.substring(a+1)):r.attribute=n.substring(i+1),r},t.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(a=>{r+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),r},t.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const r=t.matchPrefix(n+i,"a=ice-ufrag:")[0],a=t.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&a?{usernameFragment:r.substring(12),password:a.substring(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(n)[0].split(" ");i.profile=r[2];for(let l=3;l<r.length;l++){const u=r[l],h=t.matchPrefix(n,"a=rtpmap:"+u+" ")[0];if(h){const f=t.parseRtpMap(h),E=t.matchPrefix(n,"a=fmtp:"+u+" ");switch(f.parameters=E.length?t.parseFmtp(E[0]):{},f.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+u+" ").map(t.parseRtcpFb),i.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(f.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(l=>{i.headerExtensions.push(t.parseExtmap(l))});const a=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(l=>{a.forEach(u=>{l.rtcpFeedback.find(h=>h.type===u.type&&h.parameter===u.parameter)||l.rtcpFeedback.push(u)})}),i},t.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(l=>l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(l=>{r+=t.writeRtpMap(l),r+=t.writeFmtp(l),r+=t.writeRtcpFb(l)});let a=0;return i.codecs.forEach(l=>{l.maxptime>a&&(a=l.maxptime)}),a>0&&(r+="a=maxptime:"+a+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(l=>{r+=t.writeExtmap(l)}),r},t.parseRtpEncodingParameters=function(n){const i=[],r=t.parseRtpParameters(n),a=r.fecMechanisms.indexOf("RED")!==-1,l=r.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(n,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),h=u.length>0&&u[0].ssrc;let f;const E=t.matchPrefix(n,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(T=>parseInt(T,10)));E.length>0&&E[0].length>1&&E[0][0]===h&&(f=E[0][1]),r.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let T={ssrc:h,codecPayloadType:parseInt(S.parameters.apt,10)};h&&f&&(T.rtx={ssrc:f}),i.push(T),a&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:h,mechanism:l?"red+ulpfec":"red"},i.push(T))}}),i.length===0&&h&&i.push({ssrc:h});let y=t.matchPrefix(n,"b=");return y.length&&(y=y[0].indexOf("b=TIAS:")===0?parseInt(y[0].substring(7),10):y[0].indexOf("b=AS:")===0?1e3*parseInt(y[0].substring(5),10)*.95-16e3:void 0,i.forEach(S=>{S.maxBitrate=y})),i},t.parseRtcpParameters=function(n){const i={},r=t.matchPrefix(n,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const a=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=a.length>0,i.compound=a.length===0;const l=t.matchPrefix(n,"a=rtcp-mux");return i.mux=l.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const r=t.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const a=t.matchPrefix(n,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="msid");return a.length>0?(i=a[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(n){const i=t.parseMLine(n),r=t.matchPrefix(n,"a=max-message-size:");let a;r.length>0&&(a=parseInt(r[0].substring(19),10)),isNaN(a)&&(a=65536);const l=t.matchPrefix(n,"a=sctp-port:");if(l.length>0)return{port:parseInt(l[0].substring(12),10),protocol:i.fmt,maxMessageSize:a};const u=t.matchPrefix(n,"a=sctpmap:");if(u.length>0){const h=u[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:a}}},t.writeSctpDescription=function(n,i){let r=[];return r=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,i,r){let a;const l=i!==void 0?i:2;return a=n||t.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+a+" "+l+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const r=t.splitLines(n);for(let a=0;a<r.length;a++)switch(r[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[a].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},e.exports=t})(NP);var DP=NP.exports,jm=v(DP),PG=m({__proto__:null,default:jm},[DP]);function $T(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),r=jm.parseCandidate(n.candidate),a=Object.assign(i,r);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,Tp(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function aO(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Tp(e,"icecandidate",t=>{if(t.candidate){const n=jm.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function eR(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(u){if(!u||!u.sdp)return!1;const h=jm.splitSections(u.sdp);return h.shift(),h.some(f=>{const E=jm.parseMLine(f);return E&&E.kind==="application"&&E.protocol.indexOf("SCTP")!==-1})},i=function(u){const h=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;const f=parseInt(h[1],10);return f!=f?-1:f},r=function(u){let h=65536;return t.browser==="firefox"&&(h=t.version<57?u===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),h},a=function(u,h){let f=65536;t.browser==="firefox"&&t.version===57&&(f=65535);const E=jm.matchPrefix(u.sdp,"a=max-message-size:");return E.length>0?f=parseInt(E[0].substr(19),10):t.browser==="firefox"&&h!==-1&&(f=2147483637),f},l=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const u=i(arguments[0]),h=r(u),f=a(arguments[0],u);let E;E=h===0&&f===0?Number.POSITIVE_INFINITY:h===0||f===0?Math.max(h,f):Math.min(h,f);const y={};Object.defineProperty(y,"maxMessageSize",{get:()=>E}),this._sctp=y}return l.apply(this,arguments)}}function tR(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,r){const a=i.send;i.send=function(){const l=arguments[0],u=l.length||l.size||l.byteLength;if(i.readyState==="open"&&r.sctp&&u>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return a.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},Tp(e,"datachannel",i=>(t(i.channel,i.target),i))}function oO(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const a=r.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const l=new Event("connectionstatechange",r);a.dispatchEvent(l)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function cO(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=i.sdp.split(`
`).filter(a=>Nr(a).call(a)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function nR(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Ne.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Ne.resolve())})}function iR(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(r=>n.apply(this,[r]))})}var LG=Object.freeze({__proto__:null,removeExtmapAllowMixed:cO,shimAddIceCandidateNullOrEmpty:nR,shimConnectionState:oO,shimMaxMessageSize:eR,shimParameterlessSetLocalDescription:iR,shimRTCIceCandidate:$T,shimRTCIceCandidateRelayProtocol:aO,shimSendThrowTypeError:tR});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Yk,i=function(a){const l={browser:null,version:null};if(a===void 0||!a.navigator)return l.browser="Not a browser.",l;const{navigator:u}=a;if(u.mozGetUserMedia)l.browser="firefox",l.version=QT(u.userAgent,/Firefox\/(\d+)\./,1);else if(u.webkitGetUserMedia||a.isSecureContext===!1&&a.webkitRTCPeerConnection)l.browser="chrome",l.version=QT(u.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!a.RTCPeerConnection||!u.userAgent.match(/AppleWebKit\/(\d+)\./))return l.browser="Not a supported browser.",l;l.browser="safari",l.version=QT(u.userAgent,/AppleWebKit\/(\d+)\./,1),l.supportsUnifiedPlan=a.RTCRtpTransceiver&&"currentDirection"in a.RTCRtpTransceiver.prototype}return l}(e),r={browserDetails:i,commonShim:LG,extractVersion:QT,disableLog:gG,disableWarnings:yG,sdp:PG};switch(i.browser){case"chrome":if(!sP||!nO||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=sP,nR(e,i),iR(e),Jk(e,i),Zk(e),nO(e,i),Qk(e),iP(e,i),$k(e),eP(e),tP(e),rP(e,i),$T(e),aO(e),oO(e),eR(e,i),tR(e),cO(e,i);break;case"firefox":if(!_P||!iO||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=_P,nR(e,i),iR(e),aP(e,i),iO(e,i),oP(e),dP(e),cP(e),lP(e),uP(e),hP(e),pP(e),fP(e),mP(e),$T(e),oO(e),eR(e,i),tR(e);break;case"safari":if(!wP||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=wP,nR(e,i),iR(e),TP(e),bP(e),yP(e),EP(e),gP(e),RP(e),SP(e),CP(e),$T(e),aO(e),eR(e,i),tR(e),cO(e,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var lO=ie;Jt({global:!0,forced:lO.globalThis!==lO},{globalThis:lO});var kP=v(ie),dO={exports:{}};(function(e,t){(function(n,i){var r="function",a="undefined",l="object",u="string",h="major",f="model",E="name",y="type",S="vendor",T="version",k="architecture",O="console",I="mobile",M="tablet",L="smarttv",j="wearable",K="embedded",z="Amazon",H="Apple",Z="ASUS",se="BlackBerry",ue="Browser",Ee="Chrome",Rt="Firefox",At="Google",ot="Huawei",Kt="LG",Yt="Microsoft",pr="Motorola",le="Opera",Te="Samsung",Ve="Sharp",he="Sony",A="Xiaomi",G="Zebra",Y="Facebook",Se="Chromium OS",mt="Mac OS",Rn=" Browser",Ri=function(gi){for(var bi={},Dn=0;Dn<gi.length;Dn++)bi[gi[Dn].toUpperCase()]=gi[Dn];return bi},Ia=function(gi,bi){return typeof gi===u&&fo(bi).indexOf(fo(gi))!==-1},fo=function(gi){return gi.toLowerCase()},IS=function(gi,bi){if(typeof gi===u)return gi=gi.replace(/^\s\s*/,""),typeof bi===a?gi:gi.substring(0,500)},Jp=function(gi,bi){for(var Dn,hs,tc,li,md,Vt,nc=0;nc<bi.length&&!md;){var Zp=bi[nc],dl=bi[nc+1];for(Dn=hs=0;Dn<Zp.length&&!md&&Zp[Dn];)if(md=Zp[Dn++].exec(gi))for(tc=0;tc<dl.length;tc++)Vt=md[++hs],typeof(li=dl[tc])===l&&li.length>0?li.length===2?typeof li[1]==r?this[li[0]]=li[1].call(this,Vt):this[li[0]]=li[1]:li.length===3?typeof li[1]!==r||li[1].exec&&li[1].test?this[li[0]]=Vt?Vt.replace(li[1],li[2]):i:this[li[0]]=Vt?li[1].call(this,Vt,li[2]):i:li.length===4&&(this[li[0]]=Vt?li[3].call(this,Vt.replace(li[1],li[2])):i):this[li]=Vt||i;nc+=2}},k_=function(gi,bi){for(var Dn in bi)if(typeof bi[Dn]===l&&bi[Dn].length>0){for(var hs=0;hs<bi[Dn].length;hs++)if(Ia(bi[Dn][hs],gi))return Dn==="?"?i:Dn}else if(Ia(bi[Dn],gi))return Dn==="?"?i:Dn;return bi.hasOwnProperty("*")?bi["*"]:gi},iC={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},rC={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[E,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[E,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[E,T],[/opios[\/ ]+([\w\.]+)/i],[T,[E,le+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[T,[E,le+" GX"]],[/\bopr\/([\w\.]+)/i],[T,[E,le]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[T,[E,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[T,[E,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[E,T],[/quark(?:pc)?\/([-\w\.]+)/i],[T,[E,"Quark"]],[/\bddg\/([\w\.]+)/i],[T,[E,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[E,"UC"+ue]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[T,[E,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[E,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[E,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[T,[E,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[T,[E,"Smart Lenovo "+ue]],[/(avast|avg)\/([\w\.]+)/i],[[E,/(.+)/,"$1 Secure "+ue],T],[/\bfocus\/([\w\.]+)/i],[T,[E,Rt+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[E,le+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[E,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[E,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[E,le+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[E,"MIUI"+Rn]],[/fxios\/([\w\.-]+)/i],[T,[E,Rt]],[/\bqihoobrowser\/?([\w\.]*)/i],[T,[E,"360"]],[/\b(qq)\/([\w\.]+)/i],[[E,/(.+)/,"$1Browser"],T],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[E,/(.+)/,"$1"+Rn],T],[/samsungbrowser\/([\w\.]+)/i],[T,[E,Te+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[T,[E,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[E,"Sogou Mobile"],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[E,T],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[E],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[T,E],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[E,Y],T],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[E,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[E,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[T,[E,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[E,Ee+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[E,Ee+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[E,"Android "+ue]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[E,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[E,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,E],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[E,[T,k_,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[E,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[E,"Netscape"],T],[/(wolvic|librewolf)\/([\w\.]+)/i],[E,T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[E,Rt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[E,[T,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[E,[T,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[k,"amd64"]],[/(ia32(?=;))/i],[[k,fo]],[/((?:i[346]|x)86)[;\)]/i],[[k,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[k,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[k,"armhf"]],[/windows (ce|mobile); ppc;/i],[[k,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[k,/ower/,"",fo]],[/(sun4\w)[;\)]/i],[[k,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[k,fo]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[S,Te],[y,M]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[f,[S,Te],[y,I]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[f,[S,H],[y,I]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[S,H],[y,M]],[/(macintosh);/i],[f,[S,H]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[S,Ve],[y,I]],[/(?:honor)([-\w ]+)[;\)]/i],[f,[S,"Honor"],[y,I]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[f,[S,ot],[y,M]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[S,ot],[y,I]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[f,/_/g," "],[S,A],[y,I]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[f,/_/g," "],[S,A],[y,M]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[S,"OPPO"],[y,I]],[/\b(opd2\d{3}a?) bui/i],[f,[S,"OPPO"],[y,M]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[S,"Vivo"],[y,I]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[f,[S,"Realme"],[y,I]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[S,pr],[y,I]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[S,pr],[y,M]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[S,Kt],[y,M]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[S,Kt],[y,I]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[f,[S,"Lenovo"],[y,M]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[f,/_/g," "],[S,"Nokia"],[y,I]],[/(pixel c)\b/i],[f,[S,At],[y,M]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[S,At],[y,I]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[S,he],[y,I]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[S,he],[y,M]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[S,"OnePlus"],[y,I]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[S,z],[y,M]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[S,z],[y,I]],[/(playbook);[-\w\),; ]+(rim)/i],[f,S,[y,M]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[S,se],[y,I]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[S,Z],[y,M]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[S,Z],[y,I]],[/(nexus 9)/i],[f,[S,"HTC"],[y,M]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[f,/_/g," "],[y,I]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[f,[S,"TCL"],[y,M]],[/(itel) ((\w+))/i],[[S,fo],f,[y,k_,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[S,"Acer"],[y,M]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[S,"Meizu"],[y,I]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[f,[S,"Ulefone"],[y,I]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[f,[S,"Energizer"],[y,I]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[f,[S,"Cat"],[y,I]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[f,[S,"Smartfren"],[y,I]],[/droid.+; (a(?:015|06[35]|142p?))/i],[f,[S,"Nothing"],[y,I]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[S,f,[y,I]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,f,[y,M]],[/(surface duo)/i],[f,[S,Yt],[y,M]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[S,"Fairphone"],[y,I]],[/(u304aa)/i],[f,[S,"AT&T"],[y,I]],[/\bsie-(\w*)/i],[f,[S,"Siemens"],[y,I]],[/\b(rct\w+) b/i],[f,[S,"RCA"],[y,M]],[/\b(venue[\d ]{2,7}) b/i],[f,[S,"Dell"],[y,M]],[/\b(q(?:mv|ta)\w+) b/i],[f,[S,"Verizon"],[y,M]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[S,"Barnes & Noble"],[y,M]],[/\b(tm\d{3}\w+) b/i],[f,[S,"NuVision"],[y,M]],[/\b(k88) b/i],[f,[S,"ZTE"],[y,M]],[/\b(nx\d{3}j) b/i],[f,[S,"ZTE"],[y,I]],[/\b(gen\d{3}) b.+49h/i],[f,[S,"Swiss"],[y,I]],[/\b(zur\d{3}) b/i],[f,[S,"Swiss"],[y,M]],[/\b((zeki)?tb.*\b) b/i],[f,[S,"Zeki"],[y,M]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],f,[y,M]],[/\b(ns-?\w{0,9}) b/i],[f,[S,"Insignia"],[y,M]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[S,"NextBook"],[y,M]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],f,[y,I]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],f,[y,I]],[/\b(ph-1) /i],[f,[S,"Essential"],[y,I]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[S,"Envizen"],[y,M]],[/\b(trio[-\w\. ]+) b/i],[f,[S,"MachSpeed"],[y,M]],[/\btu_(1491) b/i],[f,[S,"Rotor"],[y,M]],[/(shield[\w ]+) b/i],[f,[S,"Nvidia"],[y,M]],[/(sprint) (\w+)/i],[S,f,[y,I]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[S,Yt],[y,I]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[S,G],[y,M]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[S,G],[y,I]],[/smart-tv.+(samsung)/i],[S,[y,L]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[S,Te],[y,L]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,Kt],[y,L]],[/(apple) ?tv/i],[S,[f,H+" TV"],[y,L]],[/crkey/i],[[f,Ee+"cast"],[S,At],[y,L]],[/droid.+aft(\w+)( bui|\))/i],[f,[S,z],[y,L]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[S,Ve],[y,L]],[/(bravia[\w ]+)( bui|\))/i],[f,[S,he],[y,L]],[/(mitv-\w{5}) bui/i],[f,[S,A],[y,L]],[/Hbbtv.*(technisat) (.*);/i],[S,f,[y,L]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,IS],[f,IS],[y,L]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[y,L]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,f,[y,O]],[/droid.+; (shield) bui/i],[f,[S,"Nvidia"],[y,O]],[/(playstation [345portablevi]+)/i],[f,[S,he],[y,O]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[S,Yt],[y,O]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[f,[S,Te],[y,j]],[/((pebble))app/i],[S,f,[y,j]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[S,H],[y,j]],[/droid.+; (glass) \d/i],[f,[S,At],[y,j]],[/droid.+; (wt63?0{2,3})\)/i],[f,[S,G],[y,j]],[/droid.+; (glass) \d/i],[f,[S,At],[y,j]],[/(pico) (4|neo3(?: link|pro)?)/i],[S,f,[y,j]],[/; (quest( \d| pro)?)/i],[f,[S,Y],[y,j]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[y,K]],[/(aeobc)\b/i],[f,[S,z],[y,K]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[f,[y,I]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[y,M]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[y,M]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[y,I]],[/(android[-\w\. ]{0,9});.+buil/i],[f,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[E,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[E,T],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[E,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[E,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,E]],os:[[/microsoft (windows) (vista|xp)/i],[E,T],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[E,[T,k_,iC]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[T,k_,iC],[E,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[E,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[E,mt],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,E],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[E,T],[/\(bb(10);/i],[T,[E,se]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[E,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[E,Rt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[E,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[E,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[E,Ee+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[E,Se],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[E,T],[/(sunos) ?([\w\.\d]*)/i],[[E,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[E,T]]},Na=function(gi,bi){if(typeof gi===l&&(bi=gi,gi=i),!(this instanceof Na))return new Na(gi,bi).getResult();var Dn=typeof n!==a&&n.navigator?n.navigator:i,hs=gi||(Dn&&Dn.userAgent?Dn.userAgent:""),tc=Dn&&Dn.userAgentData?Dn.userAgentData:i,li=bi?function(Vt,nc){var Zp={};for(var dl in Vt)nc[dl]&&nc[dl].length%2==0?Zp[dl]=nc[dl].concat(Vt[dl]):Zp[dl]=Vt[dl];return Zp}(rC,bi):rC,md=Dn&&Dn.userAgent==hs;return this.getBrowser=function(){var Vt={};return Vt[E]=i,Vt[T]=i,Jp.call(Vt,hs,li.browser),Vt[h]=function(nc){return typeof nc===u?nc.replace(/[^\d\.]/g,"").split(".")[0]:i}(Vt[T]),md&&Dn&&Dn.brave&&typeof Dn.brave.isBrave==r&&(Vt[E]="Brave"),Vt},this.getCPU=function(){var Vt={};return Vt[k]=i,Jp.call(Vt,hs,li.cpu),Vt},this.getDevice=function(){var Vt={};return Vt[S]=i,Vt[f]=i,Vt[y]=i,Jp.call(Vt,hs,li.device),md&&!Vt[y]&&tc&&tc.mobile&&(Vt[y]=I),md&&Vt[f]=="Macintosh"&&Dn&&typeof Dn.standalone!==a&&Dn.maxTouchPoints&&Dn.maxTouchPoints>2&&(Vt[f]="iPad",Vt[y]=M),Vt},this.getEngine=function(){var Vt={};return Vt[E]=i,Vt[T]=i,Jp.call(Vt,hs,li.engine),Vt},this.getOS=function(){var Vt={};return Vt[E]=i,Vt[T]=i,Jp.call(Vt,hs,li.os),md&&!Vt[E]&&tc&&tc.platform&&tc.platform!="Unknown"&&(Vt[E]=tc.platform.replace(/chrome os/i,Se).replace(/macos/i,mt)),Vt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return hs},this.setUA=function(Vt){return hs=typeof Vt===u&&Vt.length>500?IS(Vt,500):Vt,this},this.setUA(hs),this};Na.VERSION="0.7.40",Na.BROWSER=Ri([E,T,h]),Na.CPU=Ri([k]),Na.DEVICE=Ri([f,S,y,O,I,L,M,j,K]),Na.ENGINE=Na.OS=Ri([E,T]),e.exports&&(t=e.exports=Na),t.UAParser=Na;var fd=typeof n!==a&&(n.jQuery||n.Zepto);if(fd&&!fd.ua){var sC=new Na;fd.ua=sC.getResult(),fd.ua.get=function(){return sC.getUA()},fd.ua.set=function(gi){sC.setUA(gi);var bi=sC.getResult();for(var Dn in bi)fd.ua[Dn]=bi[Dn]}}})(typeof window=="object"?window:_)})(dO,dO.exports);var MG=v(dO.exports),PP=lu.clear;Jt({global:!0,bind:!0,forced:ie.clearImmediate!==PP},{clearImmediate:PP});var LP=ie,xG=_e,UG=Tt,VG=vc,jG=Ms,FG=qr,BG=Ga,GG=LP.Function,HG=/MSIE .\./.test(jG)||VG==="BUN"&&function(){var e=LP.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),WG=Jt,MP=ie,xP=lu.set,YG=function(e,t){var n=1;return HG?function(i,r){var a=BG(arguments.length,1)>n,l=UG(i)?i:GG(i),u=a?FG(arguments,n):[],h=a?function(){xG(l,this,u)}:l;return e(h)}:e},UP=MP.setImmediate?YG(xP):xP;WG({global:!0,bind:!0,forced:MP.setImmediate!==UP},{setImmediate:UP});var VP=v(Ci.setImmediate),zG=ie,KG=zg,qG=mr,XG=Ga,JG=fn;Jt({global:!0,dontCallGetSet:!0,forced:w(function(){return JG&&Object.getOwnPropertyDescriptor(zG,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){XG(arguments.length,1),KG(qG(e))}});var jP=v(Ci.queueMicrotask);function FP(e,t){return function(){return e.apply(t,arguments)}}const{toString:ZG}=Object.prototype,{getPrototypeOf:uO}=Object,{iterator:rR,toStringTag:BP}=Symbol,sR=(hO=Object.create(null),e=>{const t=ZG.call(e);return hO[t]||(hO[t]=t.slice(8,-1).toLowerCase())});var hO;const Fo=e=>(e=e.toLowerCase(),t=>sR(t)===e),aR=e=>t=>typeof t===e,{isArray:Fm}=Array,wy=aR("undefined"),GP=Fo("ArrayBuffer"),QG=aR("string"),qs=aR("function"),HP=aR("number"),oR=e=>e!==null&&typeof e=="object",cR=e=>{if(sR(e)!=="object")return!1;const t=uO(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||BP in e||rR in e)},$G=Fo("Date"),eH=Fo("File"),tH=Fo("Blob"),nH=Fo("FileList"),iH=Fo("URLSearchParams"),[rH,sH,aH,oH]=["ReadableStream","Request","Response","Headers"].map(Fo);function Ay(e,t){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Fm(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const a=r?Object.getOwnPropertyNames(e):Object.keys(e),l=a.length;let u;for(n=0;n<l;n++)u=a[n],t.call(null,e[u],u,e)}}function WP(e,t){t=t.toLowerCase();const n=Object.keys(e);let i,r=n.length;for(;r-- >0;)if(i=n[r],t===i.toLowerCase())return i;return null}const Rp=kP!==void 0?kP:typeof self<"u"?self:typeof window<"u"?window:c1,YP=e=>!wy(e)&&e!==Rp,cH=(pO=typeof Uint8Array<"u"&&uO(Uint8Array),e=>pO&&e instanceof pO);var pO;const lH=Fo("HTMLFormElement"),zP=(e=>{let{hasOwnProperty:t}=e;return(n,i)=>t.call(n,i)})(Object.prototype),dH=Fo("RegExp"),KP=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};Ay(n,(r,a)=>{let l;(l=t(r,a,e))!==!1&&(i[a]=l||r)}),Object.defineProperties(e,i)},uH=Fo("AsyncFunction"),qP=(XP=typeof VP=="function",JP=qs(Rp.postMessage),XP?VP:JP?(fO="axios@".concat(Math.random()),lR=[],Rp.addEventListener("message",e=>{let{source:t,data:n}=e;t===Rp&&n===fO&&lR.length&&lR.shift()()},!1),e=>{lR.push(e),Rp.postMessage(fO,"*")}):e=>setTimeout(e));var XP,JP,fO,lR;const hH=jP!==void 0?jP.bind(Rp):typeof process<"u"&&process.nextTick||qP;var Oe={isArray:Fm,isArrayBuffer:GP,isBuffer:function(e){return e!==null&&!wy(e)&&e.constructor!==null&&!wy(e.constructor)&&qs(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||qs(e.append)&&((t=sR(e))==="formdata"||t==="object"&&qs(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&GP(e.buffer),t},isString:QG,isNumber:HP,isBoolean:e=>e===!0||e===!1,isObject:oR,isPlainObject:cR,isReadableStream:rH,isRequest:sH,isResponse:aH,isHeaders:oH,isUndefined:wy,isDate:$G,isFile:eH,isBlob:tH,isRegExp:dH,isFunction:qs,isStream:e=>oR(e)&&qs(e.pipe),isURLSearchParams:iH,isTypedArray:cH,isFileList:nH,forEach:Ay,merge:function e(){const{caseless:t}=YP(this)&&this||{},n={},i=(r,a)=>{const l=t&&WP(n,a)||a;cR(n[l])&&cR(r)?n[l]=e(n[l],r):cR(r)?n[l]=e({},r):Fm(r)?n[l]=r.slice():n[l]=r};for(let r=0,a=arguments.length;r<a;r++)arguments[r]&&Ay(arguments[r],i);return n},extend:function(e,t,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Ay(t,(r,a)=>{n&&qs(r)?e[a]=FP(r,n):e[a]=r},{allOwnKeys:i}),e},trim:e=>Nr(e)?Nr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let r,a,l;const u={};if(t=t||{},e==null)return t;do{for(r=Object.getOwnPropertyNames(e),a=r.length;a-- >0;)l=r[a],i&&!i(l,e,t)||u[l]||(t[l]=e[l],u[l]=!0);e=n!==!1&&uO(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:sR,kindOfTest:Fo,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return i!==-1&&i===n},toArray:e=>{if(!e)return null;if(Fm(e))return e;let t=e.length;if(!HP(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[rR]).call(e);let i;for(;(i=n.next())&&!i.done;){const r=i.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let n;const i=[];for(;(n=e.exec(t))!==null;)i.push(n);return i},isHTMLForm:lH,hasOwnProperty:zP,hasOwnProp:zP,reduceDescriptors:KP,freezeMethods:e=>{KP(e,(t,n)=>{if(qs(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=e[n];qs(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},i=r=>{r.forEach(a=>{n[a]=!0})};return Fm(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:WP,global:Rp,isContextDefined:YP,isSpecCompliantForm:function(e){return!!(e&&qs(e.append)&&e[BP]==="FormData"&&e[rR])},toJSONObject:e=>{const t=new Array(10),n=(i,r)=>{if(oR(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[r]=i;const a=Fm(i)?[]:{};return Ay(i,(l,u)=>{const h=n(l,r+1);!wy(h)&&(a[u]=h)}),t[r]=void 0,a}}return i};return n(e,0)},isAsyncFn:uH,isThenable:e=>e&&(oR(e)||qs(e))&&qs(e.then)&&qs(e.catch),setImmediate:qP,asap:hH,isIterable:e=>e!=null&&qs(e[rR])};function dn(e,t,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}Oe.inherits(dn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Oe.toJSONObject(this.config),code:this.code,status:this.status}}});const ZP=dn.prototype,QP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{QP[e]={value:e}}),Object.defineProperties(dn,QP),Object.defineProperty(ZP,"isAxiosError",{value:!0}),dn.from=(e,t,n,i,r,a)=>{const l=Object.create(ZP);return Oe.toFlatObject(e,l,function(u){return u!==Error.prototype},u=>u!=="isAxiosError"),dn.call(l,e.message,t,n,i,r),l.cause=e,l.name=e.name,a&&Object.assign(l,a),l};function mO(e){return Oe.isPlainObject(e)||Oe.isArray(e)}function $P(e){return Oe.endsWith(e,"[]")?e.slice(0,-2):e}function eL(e,t,n){return e?e.concat(t).map(function(i,r){return i=$P(i),!n&&r?"["+i+"]":i}).join(n?".":""):t}const pH=Oe.toFlatObject(Oe,{},null,function(e){return/^is[A-Z]/.test(e)});function dR(e,t,n){if(!Oe.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=Oe.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,T){return!Oe.isUndefined(T[S])})).metaTokens,r=n.visitor||f,a=n.dots,l=n.indexes,u=(n.Blob||typeof Blob<"u"&&Blob)&&Oe.isSpecCompliantForm(t);if(!Oe.isFunction(r))throw new TypeError("visitor must be a function");function h(S){if(S===null)return"";if(Oe.isDate(S))return S.toISOString();if(!u&&Oe.isBlob(S))throw new dn("Blob is not supported. Use a Buffer instead.");return Oe.isArrayBuffer(S)||Oe.isTypedArray(S)?u&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function f(S,T,k){let O=S;if(S&&!k&&typeof S=="object"){if(Oe.endsWith(T,"{}"))T=i?T:T.slice(0,-2),S=JSON.stringify(S);else if(Oe.isArray(S)&&function(I){return Oe.isArray(I)&&!I.some(mO)}(S)||(Oe.isFileList(S)||Oe.endsWith(T,"[]"))&&(O=Oe.toArray(S)))return T=$P(T),O.forEach(function(I,M){!Oe.isUndefined(I)&&I!==null&&t.append(l===!0?eL([T],M,a):l===null?T:T+"[]",h(I))}),!1}return!!mO(S)||(t.append(eL(k,T,a),h(S)),!1)}const E=[],y=Object.assign(pH,{defaultVisitor:f,convertValue:h,isVisitable:mO});if(!Oe.isObject(e))throw new TypeError("data must be an object");return function S(T,k){if(!Oe.isUndefined(T)){if(E.indexOf(T)!==-1)throw Error("Circular reference detected in "+k.join("."));E.push(T),Oe.forEach(T,function(O,I){(!(Oe.isUndefined(O)||O===null)&&r.call(t,O,Oe.isString(I)?Nr(I).call(I):I,k,y))===!0&&S(O,k?k.concat(I):[I])}),E.pop()}}(e),t}function tL(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function _O(e,t){this._pairs=[],e&&dR(e,this,t)}const nL=_O.prototype;function fH(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function iL(e,t,n){if(!t)return e;const i=n&&n.encode||fH;Oe.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let a;if(a=r?r(t,n):Oe.isURLSearchParams(t)?t.toString():new _O(t,n).toString(i),a){const l=e.indexOf("#");l!==-1&&(e=e.slice(0,l)),e+=(e.indexOf("?")===-1?"?":"&")+a}return e}nL.append=function(e,t){this._pairs.push([e,t])},nL.toString=function(e){const t=e?function(n){return e.call(this,n,tL)}:tL;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var rL=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Oe.forEach(this.handlers,function(t){t!==null&&e(t)})}},sL={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},aL={exports:{}},mH=Jt,_H=fn,oL=Mr.f;mH({target:"Object",stat:!0,forced:Object.defineProperty!==oL,sham:!_H},{defineProperty:oL});var cL=Ci.Object,EH=aL.exports=function(e,t,n){return cL.defineProperty(e,t,n)};cL.defineProperty.sham&&(EH.sham=!0);var lL=v(aL.exports),gH=TypeError,dL=Ts,yH=Hh,SH=Un,vH=ei("species"),uL=Array,TH=function(e){var t;return dL(e)&&(t=e.constructor,(yH(t)&&(t===uL||dL(t.prototype))||SH(t)&&(t=t[vH])===null)&&(t=void 0)),t===void 0?uL:t},hL=function(e,t){return new(TH(e))(t===0?0:t)},RH=w,bH=sr,CH=ei("species"),pL=function(e){return bH>=51||!RH(function(){var t=[];return(t.constructor={})[CH]=function(){return{foo:1}},t[e](Boolean).foo!==1})},wH=Jt,AH=w,OH=Ts,IH=Un,NH=Yr,DH=gc,fL=function(e){if(e>9007199254740991)throw gH("Maximum allowed index exceeded");return e},mL=kA,kH=hL,PH=pL,LH=sr,_L=ei("isConcatSpreadable"),MH=LH>=51||!AH(function(){var e=[];return e[_L]=!1,e.concat()[0]!==e}),xH=function(e){if(!IH(e))return!1;var t=e[_L];return t!==void 0?!!t:OH(e)};wH({target:"Array",proto:!0,forced:!MH||!PH("concat")},{concat:function(e){var t,n,i,r,a,l=NH(this),u=kH(l,0),h=0;for(t=-1,i=arguments.length;t<i;t++)if(xH(a=t===-1?l:arguments[t]))for(r=DH(a),fL(h+r),n=0;n<r;n++,h++)n in a&&mL(u,h,a[n]);else fL(h+1),mL(u,h++,a);return u.length=h,u}});var EL={},UH=Ge,VH=Ht,gL=xl.f,jH=qr,yL=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];EL.f=function(e){return yL&&UH(e)==="Window"?function(t){try{return gL(t)}catch{return jH(yL)}}(e):gL(VH(e))};var Bm={},FH=ei;Bm.f=FH;var SL=Ci,BH=Hi,GH=Bm,HH=Mr.f,zi=function(e){var t=SL.Symbol||(SL.Symbol={});BH(t,e)||HH(t,e,{value:GH.f(e)})},WH=Ue,YH=Xt,zH=ei,KH=Ma,vL=function(){var e=YH("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,i=zH("toPrimitive");t&&!t[i]&&KH(t,i,function(r){return WH(n,this)},{})},qH=ua,XH=qt,JH=Yr,ZH=gc,QH=hL,TL=Q([].push),$H=function(e){var t=e===1,n=e===2,i=e===3,r=e===4,a=e===6,l=e===7,u=e===5||a;return function(h,f,E,y){for(var S,T,k=JH(h),O=XH(k),I=ZH(O),M=qH(f,E),L=0,j=y||QH,K=t?j(h,I):n||l?j(h,0):void 0;I>L;L++)if((u||L in O)&&(T=M(S=O[L],L,k),e))if(t)K[L]=T;else if(T)switch(e){case 3:return!0;case 5:return S;case 6:return L;case 2:TL(K,S)}else switch(e){case 4:return!1;case 7:TL(K,S)}return a?-1:i||r?r:K}},RL={forEach:$H(0)},uR=Jt,Oy=ie,EO=Ue,e7=Q,Gm=fn,Hm=kd,t7=w,Ur=Hi,n7=oe,gO=Er,hR=Ht,yO=gf,i7=is,SO=it,Wm=Vl,bL=Ch,r7=xl,CL=EL,s7=bc,wL=rn,AL=Mr,a7=HE,OL=rt,IL=Ma,o7=Yi,vO=xs,NL=Th,DL=ff,c7=ei,l7=Bm,d7=zi,u7=vL,h7=ha,kL=Ic,pR=RL.forEach,Xs=Rc("hidden"),fR="Symbol",Iy="prototype",p7=kL.set,PL=kL.getterFor(fR),Bo=Object[Iy],bp=Oy.Symbol,mR=bp&&bp[Iy],f7=Oy.RangeError,m7=Oy.TypeError,TO=Oy.QObject,LL=wL.f,Cp=AL.f,ML=CL.f,_7=OL.f,xL=e7([].push),nd=vO("symbols"),Ny=vO("op-symbols"),E7=vO("wks"),RO=!TO||!TO[Iy]||!TO[Iy].findChild,UL=function(e,t,n){var i=LL(Bo,t);i&&delete Bo[t],Cp(e,t,n),i&&e!==Bo&&Cp(Bo,t,i)},bO=Gm&&t7(function(){return Wm(Cp({},"a",{get:function(){return Cp(this,"a",{value:7}).a}})).a!==7})?UL:Cp,CO=function(e,t){var n=nd[e]=Wm(mR);return p7(n,{type:fR,tag:e,description:t}),Gm||(n.description=t),n},_R=function(e,t,n){e===Bo&&_R(Ny,t,n),gO(e);var i=yO(t);return gO(n),Ur(nd,i)?(n.enumerable?(Ur(e,Xs)&&e[Xs][i]&&(e[Xs][i]=!1),n=Wm(n,{enumerable:SO(0,!1)})):(Ur(e,Xs)||Cp(e,Xs,SO(1,Wm(null))),e[Xs][i]=!0),bO(e,i,n)):Cp(e,i,n)},wO=function(e,t){gO(e);var n=hR(t),i=bL(n).concat(BL(n));return pR(i,function(r){Gm&&!EO(VL,n,r)||_R(e,r,n[r])}),e},VL=function(e){var t=yO(e),n=EO(_7,this,t);return!(this===Bo&&Ur(nd,t)&&!Ur(Ny,t))&&(!(n||!Ur(this,t)||!Ur(nd,t)||Ur(this,Xs)&&this[Xs][t])||n)},jL=function(e,t){var n=hR(e),i=yO(t);if(n!==Bo||!Ur(nd,i)||Ur(Ny,i)){var r=LL(n,i);return!r||!Ur(nd,i)||Ur(n,Xs)&&n[Xs][i]||(r.enumerable=!0),r}},FL=function(e){var t=ML(hR(e)),n=[];return pR(t,function(i){Ur(nd,i)||Ur(NL,i)||xL(n,i)}),n},BL=function(e){var t=e===Bo,n=ML(t?Ny:hR(e)),i=[];return pR(n,function(r){!Ur(nd,r)||t&&!Ur(Bo,r)||xL(i,nd[r])}),i};Hm||(bp=function(){if(n7(mR,this))throw new m7("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?i7(arguments[0]):void 0,t=DL(e),n=function(i){var r=this===void 0?Oy:this;r===Bo&&EO(n,Ny,i),Ur(r,Xs)&&Ur(r[Xs],t)&&(r[Xs][t]=!1);var a=SO(1,i);try{bO(r,t,a)}catch(l){if(!(l instanceof f7))throw l;UL(r,t,a)}};return Gm&&RO&&bO(Bo,t,{configurable:!0,set:n}),CO(t,e)},IL(mR=bp[Iy],"toString",function(){return PL(this).tag}),IL(bp,"withoutSetter",function(e){return CO(DL(e),e)}),OL.f=VL,AL.f=_R,a7.f=wO,wL.f=jL,r7.f=CL.f=FL,s7.f=BL,l7.f=function(e){return CO(c7(e),e)},Gm&&o7(mR,"description",{configurable:!0,get:function(){return PL(this).description}})),uR({global:!0,wrap:!0,forced:!Hm,sham:!Hm},{Symbol:bp}),pR(bL(E7),function(e){d7(e)}),uR({target:fR,stat:!0,forced:!Hm},{useSetter:function(){RO=!0},useSimple:function(){RO=!1}}),uR({target:"Object",stat:!0,forced:!Hm,sham:!Gm},{create:function(e,t){return t===void 0?Wm(e):wO(Wm(e),t)},defineProperty:_R,defineProperties:wO,getOwnPropertyDescriptor:jL}),uR({target:"Object",stat:!0,forced:!Hm},{getOwnPropertyNames:FL}),u7(),h7(bp,fR),NL[Xs]=!0;var GL=kd&&!!Symbol.for&&!!Symbol.keyFor,g7=Jt,y7=Xt,S7=Hi,v7=is,HL=xs,T7=GL,AO=HL("string-to-symbol-registry"),R7=HL("symbol-to-string-registry");g7({target:"Symbol",stat:!0,forced:!T7},{for:function(e){var t=v7(e);if(S7(AO,t))return AO[t];var n=y7("Symbol")(t);return AO[t]=n,R7[n]=t,n}});var b7=Jt,C7=Hi,w7=_c,A7=Pd,O7=GL,WL=xs("symbol-to-string-registry");b7({target:"Symbol",stat:!0,forced:!O7},{keyFor:function(e){if(!w7(e))throw new TypeError(A7(e)+" is not a symbol");if(C7(WL,e))return WL[e]}});var YL=Ts,I7=Tt,zL=Ge,N7=is,KL=Q([].push),D7=Jt,qL=Xt,XL=_e,k7=Ue,Dy=Q,JL=w,ZL=Tt,QL=_c,$L=qr,P7=function(e){if(I7(e))return e;if(YL(e)){for(var t=e.length,n=[],i=0;i<t;i++){var r=e[i];typeof r=="string"?KL(n,r):typeof r!="number"&&zL(r)!=="Number"&&zL(r)!=="String"||KL(n,N7(r))}var a=n.length,l=!0;return function(u,h){if(l)return l=!1,h;if(YL(this))return h;for(var f=0;f<a;f++)if(n[f]===u)return h}}},L7=kd,M7=String,Du=qL("JSON","stringify"),ER=Dy(/./.exec),e2=Dy("".charAt),x7=Dy("".charCodeAt),U7=Dy("".replace),V7=Dy(1 .toString),j7=/[\uD800-\uDFFF]/g,t2=/^[\uD800-\uDBFF]$/,n2=/^[\uDC00-\uDFFF]$/,i2=!L7||JL(function(){var e=qL("Symbol")("stringify detection");return Du([e])!=="[null]"||Du({a:e})!=="{}"||Du(Object(e))!=="{}"}),r2=JL(function(){return Du("\uDF06\uD834")!=='"\\udf06\\ud834"'||Du("\uDEAD")!=='"\\udead"'}),F7=function(e,t){var n=$L(arguments),i=P7(t);if(ZL(i)||e!==void 0&&!QL(e))return n[1]=function(r,a){if(ZL(i)&&(a=k7(i,this,M7(r),a)),!QL(a))return a},XL(Du,null,n)},B7=function(e,t,n){var i=e2(n,t-1),r=e2(n,t+1);return ER(t2,e)&&!ER(n2,r)||ER(n2,e)&&!ER(t2,i)?"\\u"+V7(x7(e,0),16):e};Du&&D7({target:"JSON",stat:!0,forced:i2||r2},{stringify:function(e,t,n){var i=$L(arguments),r=XL(i2?F7:Du,null,i);return r2&&typeof r=="string"?U7(r,j7,B7):r}});var s2=bc,G7=Yr;Jt({target:"Object",stat:!0,forced:!kd||w(function(){s2.f(1)})},{getOwnPropertySymbols:function(e){var t=s2.f;return t?t(G7(e)):[]}}),zi("asyncIterator"),zi("hasInstance"),zi("isConcatSpreadable"),zi("iterator"),zi("match"),zi("matchAll"),zi("replace"),zi("search"),zi("species"),zi("split");var H7=vL;zi("toPrimitive"),H7();var W7=Xt,Y7=ha;zi("toStringTag"),Y7(W7("Symbol"),"Symbol"),zi("unscopables"),ha(ie.JSON,"JSON",!0);var z7=Ci.Symbol,K7=ei,q7=Mr.f,a2=K7("metadata"),o2=Function.prototype;o2[a2]===void 0&&q7(o2,a2,{value:null}),zi("asyncDispose"),zi("dispose"),zi("metadata");var X7=z7,J7=Q,OO=Xt("Symbol"),Z7=OO.keyFor,Q7=J7(OO.prototype.valueOf),c2=OO.isRegisteredSymbol||function(e){try{return Z7(Q7(e))!==void 0}catch{return!1}};Jt({target:"Symbol",stat:!0},{isRegisteredSymbol:c2});for(var $7=xs,l2=Xt,e9=Q,t9=_c,n9=ei,gR=l2("Symbol"),d2=gR.isWellKnownSymbol,u2=l2("Object","getOwnPropertyNames"),i9=e9(gR.prototype.valueOf),h2=$7("wks"),IO=0,p2=u2(gR),r9=p2.length;IO<r9;IO++)try{var f2=p2[IO];t9(gR[f2])&&n9(f2)}catch{}var m2=function(e){if(d2&&d2(e))return!0;try{for(var t=i9(e),n=0,i=u2(h2),r=i.length;n<r;n++)if(h2[i[n]]==t)return!0}catch{}return!1};Jt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:m2}),zi("customMatcher"),zi("observable"),Jt({target:"Symbol",stat:!0},{isRegistered:c2}),Jt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:m2}),zi("matcher"),zi("metadataKey"),zi("patternMatch"),zi("replaceAll");var Ym=v(X7),_2=v(Bm.f("iterator"));function ky(e){return ky=typeof Ym=="function"&&typeof _2=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Ym=="function"&&t.constructor===Ym&&t!==Ym.prototype?"symbol":typeof t},ky(e)}var s9=v(Bm.f("toPrimitive"));function a9(e){var t=function(n,i){if(ky(n)!="object"||!n)return n;var r=n[s9];if(r!==void 0){var a=r.call(n,i);if(ky(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(e,"string");return ky(t)=="symbol"?t:t+""}function P(e,t,n){return(t=a9(t))in e?lL(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E2=v(a8),o9={isBrowser:!0,classes:{URLSearchParams:E2!==void 0?E2:_O,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const NO=typeof window<"u"&&typeof document<"u",DO=typeof navigator=="object"&&navigator||void 0,c9=NO&&(!DO||["ReactNative","NativeScript","NS"].indexOf(DO.product)<0),l9=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",d9=NO&&window.location.href||"http://localhost";function g2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function y2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?g2(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g2(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var as=y2(y2({},Object.freeze({__proto__:null,hasBrowserEnv:NO,hasStandardBrowserEnv:c9,hasStandardBrowserWebWorkerEnv:l9,navigator:DO,origin:d9})),o9),u9=Er,h9=Ue,p9=Hi,f9=oe,m9=function(){var e=u9(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},S2=RegExp.prototype,v2=function(e){var t=e.flags;return t!==void 0||"flags"in S2||p9(e,"flags")||!f9(S2,e)?t:h9(m9,e)},_9=fy.charAt,T2=Ue,E9=Er,g9=Tt,y9=Ge,S9=/./.exec,v9=TypeError,T9=Jt,R2=Ue,b2=We,R9=xa,yR=Gh,C2=at,w2=wl,Py=is,b9=Er,C9=Un,w9=Ge,A9=wE,A2=v2,O9=oh,I9=w,N9=zh,D9=function(e,t,n){return t+(n?_9(e,t).length:1)},k9=function(e,t){var n=e.exec;if(g9(n)){var i=T2(n,e,t);return i!==null&&E9(i),i}if(y9(e)==="RegExp")return T2(S9,e,t);throw new v9("RegExp#exec called on incompatible receiver")},O2=Ic,P9=ei("matchAll"),I2="RegExp String",N2=I2+" Iterator",L9=O2.set,M9=O2.getterFor(N2),x9=TypeError,kO=b2("".indexOf),SR=b2("".matchAll),PO=!!SR&&!I9(function(){SR("a",/./)}),U9=R9(function(e,t,n,i){L9(this,{type:N2,regexp:e,string:t,global:n,unicode:i,done:!1})},I2,function(){var e=M9(this);if(e.done)return yR(void 0,!0);var t=e.regexp,n=e.string,i=k9(t,n);return i===null?(e.done=!0,yR(void 0,!0)):e.global?(Py(i[0])===""&&(t.lastIndex=D9(n,w2(t.lastIndex),e.unicode)),yR(i,!1)):(e.done=!0,yR(i,!1))}),D2=function(e){var t,n,i,r=b9(this),a=Py(e),l=N9(r,RegExp),u=Py(A2(r));return t=new l(l===RegExp?r.source:r,u),n=!!~kO(u,"g"),i=!!~kO(u,"u"),t.lastIndex=w2(r.lastIndex),new U9(t,a,n,i)};T9({target:"String",proto:!0,forced:PO},{matchAll:function(e){var t,n,i,r,a=C2(this);if(C9(e)){if(A9(e)&&(t=Py(C2(A2(e))),!~kO(t,"g")))throw new x9("`.matchAll` does not allow non-global regexes");if(PO)return SR(a,e);if((i=O9(e,P9))===void 0&&w9(e)==="RegExp"&&(i=D2),i)return R2(i,e,a)}else if(PO)return SR(a,e);return n=Py(a),r=new RegExp(e,"g"),R2(D2,r,n)}});var V9=gs("String","matchAll"),j9=oe,F9=V9,LO=String.prototype,B9=function(e){var t=e.matchAll;return typeof e=="string"||e===LO||j9(LO,e)&&t===LO.matchAll?F9:t},G9=v(B9);function k2(e){function t(n,i,r,a){let l=n[a++];if(l==="__proto__")return!0;const u=Number.isFinite(+l),h=a>=n.length;return l=!l&&Oe.isArray(r)?r.length:l,h?(Oe.hasOwnProp(r,l)?r[l]=[r[l],i]:r[l]=i,!u):(r[l]&&Oe.isObject(r[l])||(r[l]=[]),t(n,i,r[l],a)&&Oe.isArray(r[l])&&(r[l]=function(f){const E={},y=Object.keys(f);let S;const T=y.length;let k;for(S=0;S<T;S++)k=y[S],E[k]=f[k];return E}(r[l])),!u)}if(Oe.isFormData(e)&&Oe.isFunction(e.entries)){const n={};return Oe.forEachEntry(e,(i,r)=>{t(function(a){return G9(Oe).call(Oe,/\w+|\[(\w*)]/g,a).map(l=>l[0]==="[]"?"":l[1]||l[0])}(i),r,n,0)}),n}return null}const MO={transitional:sL,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,r=Oe.isObject(e);if(r&&Oe.isHTMLForm(e)&&(e=new FormData(e)),Oe.isFormData(e))return i?JSON.stringify(k2(e)):e;if(Oe.isArrayBuffer(e)||Oe.isBuffer(e)||Oe.isStream(e)||Oe.isFile(e)||Oe.isBlob(e)||Oe.isReadableStream(e))return e;if(Oe.isArrayBufferView(e))return e.buffer;if(Oe.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(l,u){return dR(l,new as.classes.URLSearchParams,Object.assign({visitor:function(h,f,E,y){return as.isNode&&Oe.isBuffer(h)?(this.append(f,h.toString("base64")),!1):y.defaultVisitor.apply(this,arguments)}},u))}(e,this.formSerializer).toString();if((a=Oe.isFileList(e))||n.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return dR(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return r||i?(t.setContentType("application/json",!1),function(l,u,h){if(Oe.isString(l))try{return(u||JSON.parse)(l),Nr(Oe).call(Oe,l)}catch(f){if(f.name!=="SyntaxError")throw f}return(h||JSON.stringify)(l)}(e)):e}],transformResponse:[function(e){const t=this.transitional||MO.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(Oe.isResponse(e)||Oe.isReadableStream(e))return e;if(e&&Oe.isString(e)&&(n&&!this.responseType||i)){const r=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(r)throw a.name==="SyntaxError"?dn.from(a,dn.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:as.classes.FormData,Blob:as.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Oe.forEach(["delete","get","head","post","put","patch"],e=>{MO.headers[e]={}});var xO=MO;const H9=Oe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),P2=Symbol("internals");function Ly(e){var t;return e&&Nr(t=String(e)).call(t).toLowerCase()}function vR(e){return e===!1||e==null?e:Oe.isArray(e)?e.map(vR):String(e)}function UO(e,t,n,i,r){return Oe.isFunction(i)?i.call(this,t,n):(r&&(t=n),Oe.isString(t)?Oe.isString(i)?t.indexOf(i)!==-1:Oe.isRegExp(i)?i.test(t):void 0:void 0)}class TR{constructor(t){t&&this.set(t)}set(t,n,i){const r=this;function a(h,f,E){const y=Ly(f);if(!y)throw new Error("header name must be a non-empty string");const S=Oe.findKey(r,y);(!S||r[S]===void 0||E===!0||E===void 0&&r[S]!==!1)&&(r[S||f]=vR(h))}const l=(h,f)=>Oe.forEach(h,(E,y)=>a(E,y,f));if(Oe.isPlainObject(t)||t instanceof this.constructor)l(t,n);else if(Oe.isString(t)&&(t=Nr(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Nr(u=t).call(u)))l((h=>{const f={};let E,y,S;return h&&h.split(`
`).forEach(function(T){var k,O;S=T.indexOf(":"),E=Nr(k=T.substring(0,S)).call(k).toLowerCase(),y=Nr(O=T.substring(S+1)).call(O),!E||f[E]&&H9[E]||(E==="set-cookie"?f[E]?f[E].push(y):f[E]=[y]:f[E]=f[E]?f[E]+", "+y:y)}),f})(t),n);else if(Oe.isObject(t)&&Oe.isIterable(t)){let h,f,E={};for(const y of t){if(!Oe.isArray(y))throw TypeError("Object iterator must return a key-value pair");E[f=y[0]]=(h=E[f])?Oe.isArray(h)?[...h,y[1]]:[h,y[1]]:y[1]}l(E,n)}else t!=null&&a(n,t,i);var u;return this}get(t,n){if(t=Ly(t)){const i=Oe.findKey(this,t);if(i){const r=this[i];if(!n)return r;if(n===!0)return function(a){const l=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let h;for(;h=u.exec(a);)l[h[1]]=h[2];return l}(r);if(Oe.isFunction(n))return n.call(this,r,i);if(Oe.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=Ly(t)){const i=Oe.findKey(this,t);return!(!i||this[i]===void 0||n&&!UO(0,this[i],i,n))}return!1}delete(t,n){const i=this;let r=!1;function a(l){if(l=Ly(l)){const u=Oe.findKey(i,l);!u||n&&!UO(0,i[u],u,n)||(delete i[u],r=!0)}}return Oe.isArray(t)?t.forEach(a):a(t),r}clear(t){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const a=n[i];t&&!UO(0,this[a],a,t,!0)||(delete this[a],r=!0)}return r}normalize(t){const n=this,i={};return Oe.forEach(this,(r,a)=>{var l;const u=Oe.findKey(i,a);if(u)return n[u]=vR(r),void delete n[a];const h=t?function(f){return Nr(f).call(f).toLowerCase().replace(/([a-z\d])(\w*)/g,(E,y,S)=>y.toUpperCase()+S)}(a):Nr(l=String(a)).call(l);h!==a&&delete n[a],n[h]=vR(r),i[h]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Oe.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=t&&Oe.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,i]=t;return n+": "+i}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return r.forEach(l=>n.set(l)),n}static accessor(t){const n=(this[P2]=this[P2]={accessors:{}}).accessors,i=this.prototype;function r(a){const l=Ly(a);n[l]||(function(u,h){const f=Oe.toCamelCase(" "+h);["get","set","has"].forEach(E=>{Object.defineProperty(u,E+f,{value:function(y,S,T){return this[E].call(this,h,y,S,T)},configurable:!0})})}(i,a),n[l]=!0)}return Oe.isArray(t)?t.forEach(r):r(t),this}}TR.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Oe.reduceDescriptors(TR.prototype,(e,t)=>{let{value:n}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(r){this[i]=r}}}),Oe.freezeMethods(TR);var Go=TR;function VO(e,t){const n=this||xO,i=t||n,r=Go.from(i.headers);let a=i.data;return Oe.forEach(e,function(l){a=l.call(n,a,r.normalize(),t?t.status:void 0)}),r.normalize(),a}function L2(e){return!(!e||!e.__CANCEL__)}function zm(e,t,n){dn.call(this,e??"canceled",dn.ERR_CANCELED,t,n),this.name="CanceledError"}function M2(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new dn("Request failed with status code "+n.status,[dn.ERR_BAD_REQUEST,dn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Oe.inherits(zm,dn,{__CANCEL__:!0});const RR=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const r=function(a,l){a=a||10;const u=new Array(a),h=new Array(a);let f,E=0,y=0;return l=l!==void 0?l:1e3,function(S){const T=Date.now(),k=h[y];f||(f=T),u[E]=S,h[E]=T;let O=y,I=0;for(;O!==E;)I+=u[O++],O%=a;if(E=(E+1)%a,E===y&&(y=(y+1)%a),T-f<l)return;const M=k&&T-k;return M?Math.round(1e3*I/M):void 0}}(50,250);return function(a,l){let u,h,f=0,E=1e3/l;const y=function(S){f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),u=null,h&&(clearTimeout(h),h=null),a.apply(null,S)};return[function(){const S=Date.now(),T=S-f;for(var k=arguments.length,O=new Array(k),I=0;I<k;I++)O[I]=arguments[I];T>=E?y(O,S):(u=O,h||(h=setTimeout(()=>{h=null,y(u)},E-T)))},()=>u&&y(u)]}(a=>{const l=a.loaded,u=a.lengthComputable?a.total:void 0,h=l-i,f=r(h);i=l,e({loaded:l,total:u,progress:u?l/u:void 0,bytes:h,rate:f||void 0,estimated:f&&u&&l<=u?(u-l)/f:void 0,event:a,lengthComputable:u!=null,[t?"download":"upload"]:!0})},n)},x2=(e,t)=>{const n=e!=null;return[i=>t[0]({lengthComputable:n,total:e,loaded:i}),t[1]]},U2=e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Oe.asap(()=>e(...n))};var W9=as.hasStandardBrowserEnv?((e,t)=>n=>(n=new ZT(n,as.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new ZT(as.origin),as.navigator&&/(msie|trident)/i.test(as.navigator.userAgent)):()=>!0,Y9=as.hasStandardBrowserEnv?{write(e,t,n,i,r,a){const l=[e+"="+encodeURIComponent(t)];Oe.isNumber(n)&&l.push("expires="+new Date(n).toGMTString()),Oe.isString(i)&&l.push("path="+i),Oe.isString(r)&&l.push("domain="+r),a===!0&&l.push("secure"),document.cookie=l.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function V2(e,t,n){let i=!function(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}(t);return e&&(i||n==0)?function(r,a){return a?r.replace(/\/?\/$/,"")+"/"+a.replace(/^\/+/,""):r}(e,t):t}function j2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}const F2=e=>e instanceof Go?function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?j2(Object(i),!0).forEach(function(r){P(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):j2(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}({},e):e;function wp(e,t){t=t||{};const n={};function i(f,E,y,S){return Oe.isPlainObject(f)&&Oe.isPlainObject(E)?Oe.merge.call({caseless:S},f,E):Oe.isPlainObject(E)?Oe.merge({},E):Oe.isArray(E)?E.slice():E}function r(f,E,y,S){return Oe.isUndefined(E)?Oe.isUndefined(f)?void 0:i(void 0,f,0,S):i(f,E,0,S)}function a(f,E){if(!Oe.isUndefined(E))return i(void 0,E)}function l(f,E){return Oe.isUndefined(E)?Oe.isUndefined(f)?void 0:i(void 0,f):i(void 0,E)}function u(f,E,y){return y in t?i(f,E):y in e?i(void 0,f):void 0}const h={url:a,method:a,data:a,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:u,headers:(f,E,y)=>r(F2(f),F2(E),0,!0)};return Oe.forEach(Object.keys(Object.assign({},e,t)),function(f){const E=h[f]||r,y=E(e[f],t[f],f);Oe.isUndefined(y)&&E!==u||(n[f]=y)}),n}var B2=e=>{const t=wp({},e);let n,{data:i,withXSRFToken:r,xsrfHeaderName:a,xsrfCookieName:l,headers:u,auth:h}=t;if(t.headers=u=Go.from(u),t.url=iL(V2(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),h&&u.set("Authorization","Basic "+btoa((h.username||"")+":"+(h.password?unescape(encodeURIComponent(h.password)):""))),Oe.isFormData(i)){if(as.hasStandardBrowserEnv||as.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if((n=u.getContentType())!==!1){const[f,...E]=n?n.split(";").map(y=>Nr(y).call(y)).filter(Boolean):[];u.setContentType([f||"multipart/form-data",...E].join("; "))}}if(as.hasStandardBrowserEnv&&(r&&Oe.isFunction(r)&&(r=r(t)),r||r!==!1&&W9(t.url))){const f=a&&l&&Y9.read(l);f&&u.set(a,f)}return t},z9=typeof XMLHttpRequest<"u"&&function(e){return new Ne(function(t,n){const i=B2(e);let r=i.data;const a=Go.from(i.headers).normalize();let l,u,h,f,E,{responseType:y,onUploadProgress:S,onDownloadProgress:T}=i;function k(){f&&f(),E&&E(),i.cancelToken&&i.cancelToken.unsubscribe(l),i.signal&&i.signal.removeEventListener("abort",l)}let O=new XMLHttpRequest;function I(){if(!O)return;const L=Go.from("getAllResponseHeaders"in O&&O.getAllResponseHeaders());M2(function(j){t(j),k()},function(j){n(j),k()},{data:y&&y!=="text"&&y!=="json"?O.response:O.responseText,status:O.status,statusText:O.statusText,headers:L,config:e,request:O}),O=null}O.open(i.method.toUpperCase(),i.url,!0),O.timeout=i.timeout,"onloadend"in O?O.onloadend=I:O.onreadystatechange=function(){O&&O.readyState===4&&(O.status!==0||O.responseURL&&O.responseURL.indexOf("file:")===0)&&setTimeout(I)},O.onabort=function(){O&&(n(new dn("Request aborted",dn.ECONNABORTED,e,O)),O=null)},O.onerror=function(){n(new dn("Network Error",dn.ERR_NETWORK,e,O)),O=null},O.ontimeout=function(){let L=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const j=i.transitional||sL;i.timeoutErrorMessage&&(L=i.timeoutErrorMessage),n(new dn(L,j.clarifyTimeoutError?dn.ETIMEDOUT:dn.ECONNABORTED,e,O)),O=null},r===void 0&&a.setContentType(null),"setRequestHeader"in O&&Oe.forEach(a.toJSON(),function(L,j){O.setRequestHeader(j,L)}),Oe.isUndefined(i.withCredentials)||(O.withCredentials=!!i.withCredentials),y&&y!=="json"&&(O.responseType=i.responseType),T&&([h,E]=RR(T,!0),O.addEventListener("progress",h)),S&&O.upload&&([u,f]=RR(S),O.upload.addEventListener("progress",u),O.upload.addEventListener("loadend",f)),(i.cancelToken||i.signal)&&(l=L=>{O&&(n(!L||L.type?new zm(null,e,O):L),O.abort(),O=null)},i.cancelToken&&i.cancelToken.subscribe(l),i.signal&&(i.signal.aborted?l():i.signal.addEventListener("abort",l)));const M=function(L){const j=/^([-+\w]{1,25})(:?\/\/|:)/.exec(L);return j&&j[1]||""}(i.url);M&&as.protocols.indexOf(M)===-1?n(new dn("Unsupported protocol "+M+":",dn.ERR_BAD_REQUEST,e)):O.send(r||null)})},K9=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let i,r=new AbortController;const a=function(f){if(!i){i=!0,u();const E=f instanceof Error?f:this.reason;r.abort(E instanceof dn?E:new zm(E instanceof Error?E.message:E))}};let l=t&&setTimeout(()=>{l=null,a(new dn("timeout ".concat(t," of ms exceeded"),dn.ETIMEDOUT))},t);const u=()=>{e&&(l&&clearTimeout(l),l=null,e.forEach(f=>{f.unsubscribe?f.unsubscribe(a):f.removeEventListener("abort",a)}),e=null)};e.forEach(f=>f.addEventListener("abort",a));const{signal:h}=r;return h.unsubscribe=()=>Oe.asap(u),h}},jO=v(wu),G2=Bm.f("asyncIterator"),q9=v(G2);function FO(e,t){this.v=e,this.k=t}function ya(e){return function(){return new My(e.apply(this,arguments))}}function My(e){var t,n;function i(a,l){try{var u=e[a](l),h=u.value,f=h instanceof FO;jO.resolve(f?h.v:h).then(function(E){if(f){var y=a==="return"?"return":"next";if(!h.k||E.done)return i(y,E);E=e[y](E).value}r(u.done?"return":"normal",E)},function(E){i("throw",E)})}catch(E){r("throw",E)}}function r(a,l){switch(a){case"return":t.resolve({value:l,done:!0});break;case"throw":t.reject(l);break;default:t.resolve({value:l,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(a,l){return new jO(function(u,h){var f={key:a,arg:l,resolve:u,reject:h,next:null};n?n=n.next=f:(t=n=f,i(a,l))})},typeof e.return!="function"&&(this.return=void 0)}function Ft(e){return new FO(e,0)}function bR(e){var t={},n=!1;function i(r,a){return n=!0,a=new jO(function(l){l(e[r](a))}),{done:!1,value:new FO(a,1)}}return t[Ym!==void 0&&_2||"@@iterator"]=function(){return this},t.next=function(r){return n?(n=!1,r):i("next",r)},typeof e.throw=="function"&&(t.throw=function(r){if(n)throw n=!1,r;return i("throw",r)}),typeof e.return=="function"&&(t.return=function(r){return n?(n=!1,r):i("return",r)}),t}My.prototype[typeof Ym=="function"&&q9||"@@asyncIterator"]=function(){return this},My.prototype.next=function(e){return this._invoke("next",e)},My.prototype.throw=function(e){return this._invoke("throw",e)},My.prototype.return=function(e){return this._invoke("return",e)};var BO=v(G2);function GO(e){var t,n,i,r=2;for(typeof Symbol<"u"&&(n=BO,i=Symbol.iterator);r--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new CR(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function CR(e){function t(n){if(Object(n)!==n)return Ne.reject(new TypeError(n+" is not an object."));var i=n.done;return Ne.resolve(n.value).then(function(r){return{value:r,done:i}})}return CR=function(n){this.s=n,this.n=n.next},CR.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Ne.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Ne.reject(n):t(i.apply(this.s,arguments))}},new CR(e)}const X9=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let i,r=0;for(;r<n;)i=r+t,yield e.slice(r,i),r=i},J9=function(){var e=ya(function*(t,n){var i,r=!1,a=!1;try{for(var l,u=GO(Z9(t));r=!(l=yield Ft(u.next())).done;r=!1){const h=l.value;yield*bR(GO(X9(h,n)))}}catch(h){a=!0,i=h}finally{try{r&&u.return!=null&&(yield Ft(u.return()))}finally{if(a)throw i}}});return function(t,n){return e.apply(this,arguments)}}(),Z9=function(){var e=ya(function*(t){if(t[BO])return void(yield*bR(GO(t)));const n=t.getReader();try{for(;;){const{done:i,value:r}=yield Ft(n.read());if(i)break;yield r}}finally{yield Ft(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),H2=(e,t,n,i)=>{const r=J9(e,t);let a,l=0,u=h=>{a||(a=!0,i&&i(h))};return new ReadableStream({async pull(h){try{const{done:f,value:E}=await r.next();if(f)return u(),void h.close();let y=E.byteLength;if(n){let S=l+=y;n(S)}h.enqueue(new Uint8Array(E))}catch(f){throw u(f),f}},cancel:h=>(u(h),r.return())},{highWaterMark:2})};function W2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Y2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?W2(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W2(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const wR=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",z2=wR&&typeof ReadableStream=="function",Q9=wR&&(typeof TextEncoder=="function"?(K2=new TextEncoder,e=>K2.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var K2;const q2=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return!!e(...n)}catch{return!1}},$9=z2&&q2(()=>{let e=!1;const t=new Request(as.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),HO=z2&&q2(()=>Oe.isReadableStream(new Response("").body)),AR={stream:HO&&(e=>e.body)};var X2;wR&&(X2=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!AR[e]&&(AR[e]=Oe.isFunction(X2[e])?t=>t[e]():(t,n)=>{throw new dn("Response type '".concat(e,"' is not supported"),dn.ERR_NOT_SUPPORT,n)})}));const eW=async(e,t)=>{const n=Oe.toFiniteNumber(e.getContentLength());return n??(async i=>i==null?0:Oe.isBlob(i)?i.size:Oe.isSpecCompliantForm(i)?(await new Request(as.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:Oe.isArrayBufferView(i)||Oe.isArrayBuffer(i)?i.byteLength:(Oe.isURLSearchParams(i)&&(i+=""),Oe.isString(i)?(await Q9(i)).byteLength:void 0))(t)};var tW=wR&&(async e=>{let{url:t,method:n,data:i,signal:r,cancelToken:a,timeout:l,onDownloadProgress:u,onUploadProgress:h,responseType:f,headers:E,withCredentials:y="same-origin",fetchOptions:S}=B2(e);f=f?(f+"").toLowerCase():"text";let T,k=K9([r,a&&a.toAbortSignal()],l);const O=k&&k.unsubscribe&&(()=>{k.unsubscribe()});let I;try{if(h&&$9&&n!=="get"&&n!=="head"&&(I=await eW(E,i))!==0){let z,H=new Request(t,{method:"POST",body:i,duplex:"half"});if(Oe.isFormData(i)&&(z=H.headers.get("content-type"))&&E.setContentType(z),H.body){const[Z,se]=x2(I,RR(U2(h)));i=H2(H.body,65536,Z,se)}}Oe.isString(y)||(y=y?"include":"omit");const M="credentials"in Request.prototype;T=new Request(t,Y2(Y2({},S),{},{signal:k,method:n.toUpperCase(),headers:E.normalize().toJSON(),body:i,duplex:"half",credentials:M?y:void 0}));let L=await fetch(T);const j=HO&&(f==="stream"||f==="response");if(HO&&(u||j&&O)){const z={};["status","statusText","headers"].forEach(ue=>{z[ue]=L[ue]});const H=Oe.toFiniteNumber(L.headers.get("content-length")),[Z,se]=u&&x2(H,RR(U2(u),!0))||[];L=new Response(H2(L.body,65536,Z,()=>{se&&se(),O&&O()}),z)}f=f||"text";let K=await AR[Oe.findKey(AR,f)||"text"](L,e);return!j&&O&&O(),await new Ne((z,H)=>{M2(z,H,{data:K,headers:Go.from(L.headers),status:L.status,statusText:L.statusText,config:e,request:T})})}catch(M){throw O&&O(),M&&M.name==="TypeError"&&/Load failed|fetch/i.test(M.message)?Object.assign(new dn("Network Error",dn.ERR_NETWORK,e,T),{cause:M.cause||M}):dn.from(M,M&&M.code,e,T)}});const WO={http:null,xhr:z9,fetch:tW};Oe.forEach(WO,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const J2=e=>"- ".concat(e),nW=e=>Oe.isFunction(e)||e===null||e===!1;var Z2={getAdapter:e=>{e=Oe.isArray(e)?e:[e];const{length:t}=e;let n,i;const r={};for(let a=0;a<t;a++){let l;if(n=e[a],i=n,!nW(n)&&(i=WO[(l=String(n)).toLowerCase()],i===void 0))throw new dn("Unknown adapter '".concat(l,"'"));if(i)break;r[l||"#"+a]=i}if(!i){const a=Object.entries(r).map(l=>{let[u,h]=l;return"adapter ".concat(u," ")+(h===!1?"is not supported by the environment":"is not available in the build")});throw new dn("There is no suitable adapter to dispatch the request "+(t?a.length>1?`since :
`+a.map(J2).join(`
`):" "+J2(a[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:WO};function YO(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new zm(null,e)}function Q2(e){return YO(e),e.headers=Go.from(e.headers),e.data=VO.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Z2.getAdapter(e.adapter||xO.adapter)(e).then(function(t){return YO(e),t.data=VO.call(e,e.transformResponse,t),t.headers=Go.from(t.headers),t},function(t){return L2(t)||(YO(e),t&&t.response&&(t.response.data=VO.call(e,e.transformResponse,t.response),t.response.headers=Go.from(t.response.headers))),Ne.reject(t)})}const $2="1.9.0",OR={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{OR[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const eM={};OR.transitional=function(e,t,n){function i(r,a){return"[Axios v"+$2+"] Transitional option '"+r+"'"+a+(n?". "+n:"")}return(r,a,l)=>{if(e===!1)throw new dn(i(a," has been removed"+(t?" in "+t:"")),dn.ERR_DEPRECATED);return t&&!eM[a]&&(eM[a]=!0,console.warn(i(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,a,l)}},OR.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var IR={assertOptions:function(e,t,n){if(typeof e!="object")throw new dn("options must be an object",dn.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let r=i.length;for(;r-- >0;){const a=i[r],l=t[a];if(l){const u=e[a],h=u===void 0||l(u,a,e);if(h!==!0)throw new dn("option "+a+" must be "+h,dn.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new dn("Unknown option "+a,dn.ERR_BAD_OPTION)}},validators:OR};const qc=IR.validators;let NR=class{constructor(e){this.defaults=e||{},this.interceptors={request:new rL,response:new rL}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?r&&!String(n.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+r):n.stack=r}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=wp(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:r}=t;n!==void 0&&IR.assertOptions(n,{silentJSONParsing:qc.transitional(qc.boolean),forcedJSONParsing:qc.transitional(qc.boolean),clarifyTimeoutError:qc.transitional(qc.boolean)},!1),i!=null&&(Oe.isFunction(i)?t.paramsSerializer={serialize:i}:IR.assertOptions(i,{encode:qc.function,serialize:qc.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),IR.assertOptions(t,{baseUrl:qc.spelling("baseURL"),withXsrfToken:qc.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=r&&Oe.merge(r.common,r[t.method]);r&&Oe.forEach(["delete","get","head","post","put","patch","common"],T=>{delete r[T]}),t.headers=Go.concat(a,r);const l=[];let u=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(t)===!1||(u=u&&T.synchronous,l.unshift(T.fulfilled,T.rejected))});const h=[];let f;this.interceptors.response.forEach(function(T){h.push(T.fulfilled,T.rejected)});let E,y=0;if(!u){const T=[Q2.bind(this),void 0];for(T.unshift.apply(T,l),T.push.apply(T,h),E=T.length,f=Ne.resolve(t);y<E;)f=f.then(T[y++],T[y++]);return f}E=l.length;let S=t;for(y=0;y<E;){const T=l[y++],k=l[y++];try{S=T(S)}catch(O){k.call(this,O);break}}try{f=Q2.call(this,S)}catch(T){return Ne.reject(T)}for(y=0,E=h.length;y<E;)f=f.then(h[y++],h[y++]);return f}getUri(e){return iL(V2((e=wp(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Oe.forEach(["delete","get","head","options"],function(e){NR.prototype[e]=function(t,n){return this.request(wp(n||{},{method:e,url:t,data:(n||{}).data}))}}),Oe.forEach(["post","put","patch"],function(e){function t(n){return function(i,r,a){return this.request(wp(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}NR.prototype[e]=t(),NR.prototype[e+"Form"]=t(!0)});var DR=NR;class zO{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Ne(function(r){n=r});const i=this;this.promise.then(r=>{if(!i._listeners)return;let a=i._listeners.length;for(;a-- >0;)i._listeners[a](r);i._listeners=null}),this.promise.then=r=>{let a;const l=new Ne(u=>{i.subscribe(u),a=u}).then(r);return l.cancel=function(){i.unsubscribe(a)},l},t(function(r,a,l){i.reason||(i.reason=new zm(r,a,l),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=i=>{t.abort(i)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new zO(function(i){t=i}),cancel:t}}}var iW=zO;const KO={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(KO).forEach(e=>{let[t,n]=e;KO[n]=t});var rW=KO;const Sr=function e(t){const n=new DR(t),i=FP(DR.prototype.request,n);return Oe.extend(i,DR.prototype,n,{allOwnKeys:!0}),Oe.extend(i,n,null,{allOwnKeys:!0}),i.create=function(r){return e(wp(t,r))},i}(xO);Sr.Axios=DR,Sr.CanceledError=zm,Sr.CancelToken=iW,Sr.isCancel=L2,Sr.VERSION=$2,Sr.toFormData=dR,Sr.AxiosError=dn,Sr.Cancel=Sr.CanceledError,Sr.all=function(e){return Ne.all(e)},Sr.spread=function(e){return function(t){return e.apply(null,t)}},Sr.isAxiosError=function(e){return Oe.isObject(e)&&e.isAxiosError===!0},Sr.mergeConfig=wp,Sr.AxiosHeaders=Go,Sr.formToJSON=e=>k2(Oe.isHTMLForm(e)?new FormData(e):e),Sr.getAdapter=Z2.getAdapter,Sr.HttpStatusCode=rW,Sr.default=Sr;var Zr=Sr;const sW=()=>{};function xy(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:sW};return e.promise=new Ne((t,n)=>{e.resolve=i=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(i),e.value=i)},e.reject=i=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(i))}}),e}const kR=new Map,PR=new Map,Xc=new Map;let Di=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Wt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const tM=new MG;let Ho=tM.getResult(),qO=null;function xt(e){if(!qO){Ho=tM.getResult();const t=function(u){if(u.engine.name==="Blink"&&u.browser.name!=="WeChat")return Wt.CHROME;switch(u.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Wt.CHROME;case"Safari":case"Mobile Safari":return Wt.SAFARI;case"Edge":return Wt.EDGE;case"Firefox":return Wt.FIREFOX;case"QQ":case"QQBrowser":return Wt.QQ;case"Opera":return Wt.OPERA;case"WeChat":return Wt.WECHAT;default:return u.browser.name||""}}(Ho),n=nM(Ho),i=function(u){return u.os.name==="Windows"?u.os.version?u.os.name+" "+u.os.version:u.os.name:u.os.name||""}(Ho),r=Ho.os.version,a=nM(Ho,!1),l=Ho.device.type;if(!(t&&n&&i&&r))return{name:t,version:n,os:i,osVersion:r,browserVersion:a,deviceType:l};qO={name:t,version:n,os:i,osVersion:r,browserVersion:a,deviceType:l}}return qO}function nM(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function LR(){return xt().os}function iM(){const e=xt();return"".concat(e.os," ").concat(e.osVersion)}function MR(){const e=xt();return!!(Ho.engine.name==="WebKit"&&e.os===Di.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Wt.SAFARI||vr()&&e.name!==Wt.SAFARI)}function id(){return xt().name===Wt.CHROME}function er(){return xt().name===Wt.SAFARI}function rM(){const e=xt();if(e.name!==Wt.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function sM(){return xt().name===Wt.EDGE}function qn(){return xt().name===Wt.FIREFOX}function vr(){return xt().os===Di.IOS}function Km(e){const t=xt();return!(t.name!==Wt.CHROME||!t.osVersion)&&Number(t.version)>=e}function aM(e){const t=xt();return!(t.name!==Wt.CHROME||!t.osVersion)&&Number(t.version)<e}function XO(e,t,n){const i=xt();return!(i.name!==e||!i.osVersion)&&(n?Number(i.version)>=t&&Number(i.version)<=n:Number(i.version)===t)}function JO(e){const t=xt();return!(t.name!==Wt.EDGE||!t.osVersion)&&Number(t.version)>=e}function ZO(e){const t=xt();return!(t.name!==Wt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function oM(e){const t=xt();return!(t.name!==Wt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function cM(e,t,n){const i=xt();if(i.os!==Di.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return n?t&&Number(r[0])===e&&Number(r[1])>t||Number(r[0])>e:t?Number(r[0])===e&&Number(r[1])>=t||Number(r[0])>e:Number(r[0])>=e}function lM(e,t,n){const i=xt();if(i.os!==Di.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return t&&Number(r[0])===e&&Number(r[1])<t||Number(r[0])<e}function QO(e,t,n){const i=xt();if(i.name!==Wt.SAFARI||!i.osVersion||!i.browserVersion)return!1;const r=i.browserVersion.split(".");return n?t&&Number(r[0])===e&&Number(r[1])<t||Number(r[0])<e:t?Number(r[0])===e&&Number(r[1])<=t||Number(r[0])<e:Number(r[0])<=e}function $O(e){const t=xt();return!(t.name!==Wt.OPERA||!t.osVersion)&&Number(t.version)>=e}function dM(){const e=xt();if(e.os!==Di.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function qm(){const e=xt();if(e.os!==Di.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function eI(){const e=xt();if(e.os!==Di.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function uM(){const e=xt();if(e.os!==Di.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function eo(){return er()&&navigator.maxTouchPoints>0}function hM(){return xt().name===Wt.WECHAT}function pM(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function tI(){const e=LR();return function(){const{deviceType:t}=xt();return t==="mobile"||t==="tablet"}()||e===Di.ANDROID||e===Di.IOS||e===Di.HARMONY_OS}function rd(){const e=xt();return e.name!==Wt.EDGE&&e.name!==Wt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function xR(){return LR()===Di.ANDROID}function Uy(){const e=xt();return xR()&&(e.name===Wt.CHROME||e.name===Wt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function dt(e,t,n){return(t=function(i){var r=function(a,l){if(typeof a!="object"||!a)return a;var u=a[Symbol.toPrimitive];if(u!==void 0){var h=u.call(a,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(i);return typeof r=="symbol"?r:r+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function ge(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fM(Object(n),!0).forEach(function(i){dt(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fM(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let x=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),re=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),dt(this,"code",void 0),dt(this,"message",void 0),dt(this,"data",void 0),dt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Wo(e,t){if(typeof e!="boolean")throw new re(x.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Ai(e,t,n){if(!Re(n).call(n,e))throw new re(x.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function un(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(r){return typeof r=="number"&&r%1==0}(e))throw new re(x.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function nI(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new re(x.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&un(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&un(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&un(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&un(e.ideal,"".concat(t,".ideal"),1,1/0)}else un(e,t,1,1/0)}function Ki(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new re(x.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!mM(e,n,i,r))throw new re(x.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(r?" ASCII characters only.":""))}function sd(e,t){if(!Array.isArray(e))throw new re(x.INVALID_PARAMS,"".concat(t," should be an array"))}function Xn(e){return e==null}function mM(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!i||function(r){if(typeof r!="string")return!1;for(let a=0;a<r.length;a+=1){const l=r.charCodeAt(a);if(l<0||l>255)return!1}return!0}(e))}var Vy=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Vy||{}),iI=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(iI||{});const _M=new class{constructor(){dt(this,"_clientSize",null),dt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),dt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),dt(this,"getStyle",e=>window.getComputedStyle(e,null)),dt(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const i=this.getStyle(e),{display:r,visibility:a,opacity:l,filter:u}=i;return(r==="none"||Re(t=["hidden","collapse"]).call(t,a)||Number(l)<.1)&&(n=!1),!!n&&(u&&u.split(" ").filter(h=>{var f;const E=h.split("(")[0];return Re(f=["brightness","blur","opacity"]).call(f,E)}).map(h=>{const[f,E]=h.split(/\(|\)/);return[f,Number(E.match(/^[0-9\.]+/))]}).forEach(h=>{const[f,E]=h;switch(f){case"brightness":(E<.1||E>3)&&(n=!1);break;case"blur":E>3&&(n=!1);break;case"opacity":E<.1&&(n=!1)}}),n)}),dt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,i=!0;const r=l=>t(l);let a=e;for(;a&&i;)r(a)||(n=!1,i=!1),a=a.parentElement,a||(i=!1);return n}),dt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),dt(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:i,right:r,top:a,bottom:l}=e.getBoundingClientRect(),u=this.getClientWidth(),h=this.getClientHeight();return{width:t,height:n,left:i,right:r,top:a,bottom:l,clientWidth:u,clientHeight:h,clientMin:Math.min(u,h)}}),dt(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),dt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),dt(this,"checkCoverForAPoint",(e,t,n)=>{const i=this.elementFromPoint(e,t);return i!==null&&i!==n}),dt(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:i}=this._clientSize,r=e/6,a=t/6,l=[],u=10**6;for(let h=0;h<5;h++)for(let f=0;f<5;f++){const E=(n*u+(h===0?.1:h===4?(r*h*u-1e5)/u:r*h)*u)/u,y=(i*u+(f===0?.1:f===4?(a*f*u-1e5)/u:a*f)*u)/u;l.push({x:E,y})}return[...l]}),dt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),dt(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),dt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:i,clientHeight:r,clientWidth:a,clientMin:l}=this._clientSize;let u,h,f,E;if(e<0)u=0;else{if(!(e<a))return!1;u=e}if(t<0)return!1;if(h=t<a?t:a,n<0)f=0;else{if(!(n<r))return!1;f=n}if(i<0)return!1;E=i<r?i:r;const y=h-u,S=E-f;return this.checkSizeIsVisible(y,S,l)}),dt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),dt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Vy.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Vy.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Vy.SIZE)}}return this.returnHiddenResult(Vy.STYLE)}return this.returnHiddenResult(iI.UNMOUNTED)}return this.returnHiddenResult(iI.INVALID_HTML_ELEMENT)}),dt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function rI(e){return new TextEncoder().encode(e)}const EM=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},sI=async e=>function(t,n){let i="";return new Uint8Array(t).forEach(r=>{i+=r.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",rI(e)),16);class Wn{constructor(){dt(this,"_events",{}),dt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(n=>n.listener):[]}on(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const i=this._events[t],r=this._indexOfListener(i,n);r!==-1&&i.splice(r,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map(l=>l);for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];for(let l=0;l<n.length;l+=1){const u=n[l];u.once&&this.off(t,u.listener),u.listener.apply(this,r||[])}}safeEmit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];[...this._events[t]||[]].forEach(a=>{a.once&&this.off(t,a.listener);try{a.listener.apply(this,i)}catch(l){console.error("safeEmit event:".concat(t," error ").concat(l==null?void 0:l.toString()))}})}_indexOfListener(t,n){let i=t.length;for(;i--;)if(t[i].listener===n)return i;return-1}}let jy=null;function gM(){if(jy)return jy;if(window.electron)return jy=window.electron;if(!window.require)return null;try{return jy=window.require("electron"),jy}catch{return null}}let si=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),Vn=function(e){return e.TRACER="tracer",e}({});function yM(e){return un(e.timeout,"config.timeout",0,1e5),un(e.timeoutFactor,"config.timeoutFactor",0,100,!1),un(e.maxRetryCount,"config.maxRetryConfig",0,1/0),un(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let aW=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Qt=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Fy(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function SM(e){return Ki(e.turnServerURL,"turnServerURL"),Ki(e.username,"username"),Ki(e.password,"password"),e.udpport&&un(e.udpport,"udpport",1,99999,!0),e.forceturn&&Wo(e.forceturn,"forceturn"),e.security&&Wo(e.security,"security"),e.tcpport&&un(e.tcpport,"tcpport",1,99999,!0),!0}function aI(e){return e.level!==void 0&&Ai(e.level,"level",[1,2,3]),e.delay!==void 0&&un(e.delay,"delay",0,3e3,!0),!0}let kt=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),tr=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),ks=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Xm=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function nr(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return e.getListeners(t).length===0?Ne.reject(new re(x.UNEXPECTED_ERROR,"can not emit promise")):new Ne((a,l)=>{e.emit(t,...i,a,l)})}function gn(e,t){if(e.getListeners(t).length===0)return Ne.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return nr(e,t,...i)}function Js(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return By(e,t,...i)}function By(e,t){let n=null,i=null;for(var r=arguments.length,a=new Array(r>2?r-2:0),l=2;l<r;l++)a[l-2]=arguments[l];if(e.emit(t,...a,u=>{n=u},u=>{i=u}),i!==null)throw i;if(n===null)throw new re(x.UNEXPECTED_ERROR,"handler is not sync");return n}const hi=new class extends Wn{set networkState(e){this.emit(Xm.NETWORK_STATE_CHANGE,e,this._networkState),e===ks.ONLINE?this.emit(Xm.ONLINE):e===ks.OFFLINE&&(this.onlineWaiter=new Ne(t=>{this.once(Xm.ONLINE,()=>{this.onlineWaiter=void 0,t(ks.ONLINE)})}),this.emit(Xm.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===ks.ONLINE}constructor(){super(),dt(this,"_moduleName","network-indicator"),dt(this,"_networkState",ks.ONLINE),dt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ks.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ks.OFFLINE})}};function UR(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function Jm(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function VR(e){Ne!==void 0?Ne.resolve().then(e):setTimeout(e,0)}function jn(e){return JSON.parse(JSON.stringify(e))}function Ap(e){try{return jn(e)}catch{return e}}const vM={};function ku(e,t){vM[t]||(vM[t]=!0,e())}function Op(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)n[i]=t.charCodeAt(i);return n}function Pu(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function TM(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const i=new Uint8Array(t);i.set(n),n=i}return n}function RM(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=gr(t).call(t,(l,u)=>l+u.length,0),r=new Uint8Array(new ArrayBuffer(i));let a=0;return t.forEach(l=>{r.set(l,a),a+=l.length}),r}function Jc(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function bM(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?Jc(n):n.size}),t+138}function oW(e){const t=new re(x.TIMEOUT,"timeout");return new Ne((n,i)=>{window.setTimeout(()=>i(t),e)})}function qi(e){return new Ne(t=>{window.setTimeout(t,e)})}function yn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+yn(e-n.length,"")}function Ip(){return yn(32,"").toUpperCase()}const jR=()=>{},CM=new class{constructor(){dt(this,"fnMap",new Map)}throttleByKey(e,t,n,i){for(var r=arguments.length,a=new Array(r>4?r-4:0),l=4;l<r;l++)a[l-4]=arguments[l];if(this.fnMap.has(t)){const u=this.fnMap.get(t);if(u.threshold!==n){u.fn(...u.args),clearTimeout(u.timer);const h=window.setTimeout(()=>{const f=this.fnMap.get(t);f&&f.fn(...f.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:h,args:a,skipFn:i})}else u.skipFn&&u.skipFn(...u.args),this.fnMap.set(t,ge(ge({},u),{},{fn:e,args:a,skipFn:i}))}else{const u=window.setTimeout(()=>{const h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:u,args:a,skipFn:i})}}},wM=CM.throttleByKey.bind(CM);function AM(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function oI(e,t){if(!AM(e)||!AM(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let i=0;i<t.length;i++)n[i]=oI(e[i],t[i]);return n}{const n=ge({},e);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?n[i]=oI(e[i],t[i]):n[i]=t[i]);return n}}function OM(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let i=0;for(;e>0&&(n[i]=255&e,e>>=8,i++,i!==t););return n}function Zm(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function cI(e){return gr(e).call(e,(t,n)=>t+n,0)}function IM(e){const t="0123456789abcdef";function n(j){let K,z="";for(K=0;K<=3;K++)z+=t.charAt(j>>8*K+4&15)+t.charAt(j>>8*K&15);return z}function i(j,K){const z=(65535&j)+(65535&K);return(j>>16)+(K>>16)+(z>>16)<<16|65535&z}function r(j,K,z,H,Z,se){return i(function(ue,Ee){return ue<<Ee|ue>>>32-Ee}(i(i(K,j),i(H,se)),Z),z)}function a(j,K,z,H,Z,se,ue){return r(K&z|~K&H,j,K,Z,se,ue)}function l(j,K,z,H,Z,se,ue){return r(K&H|z&~H,j,K,Z,se,ue)}function u(j,K,z,H,Z,se,ue){return r(K^z^H,j,K,Z,se,ue)}function h(j,K,z,H,Z,se,ue){return r(z^(K|~H),j,K,Z,se,ue)}const f=function(j){let K;const z=1+(j.length+8>>6),H=new Array(16*z);for(K=0;K<16*z;K++)H[K]=0;for(K=0;K<j.length;K++)H[K>>2]|=j.charCodeAt(K)<<K%4*8;return H[K>>2]|=128<<K%4*8,H[16*z-2]=8*j.length,H}(e);let E,y,S,T,k,O=1732584193,I=-271733879,M=-1732584194,L=271733878;for(E=0;E<f.length;E+=16)y=O,S=I,T=M,k=L,O=a(O,I,M,L,f[E+0],7,-680876936),L=a(L,O,I,M,f[E+1],12,-389564586),M=a(M,L,O,I,f[E+2],17,606105819),I=a(I,M,L,O,f[E+3],22,-1044525330),O=a(O,I,M,L,f[E+4],7,-176418897),L=a(L,O,I,M,f[E+5],12,1200080426),M=a(M,L,O,I,f[E+6],17,-1473231341),I=a(I,M,L,O,f[E+7],22,-45705983),O=a(O,I,M,L,f[E+8],7,1770035416),L=a(L,O,I,M,f[E+9],12,-1958414417),M=a(M,L,O,I,f[E+10],17,-42063),I=a(I,M,L,O,f[E+11],22,-1990404162),O=a(O,I,M,L,f[E+12],7,1804603682),L=a(L,O,I,M,f[E+13],12,-40341101),M=a(M,L,O,I,f[E+14],17,-1502002290),I=a(I,M,L,O,f[E+15],22,1236535329),O=l(O,I,M,L,f[E+1],5,-165796510),L=l(L,O,I,M,f[E+6],9,-1069501632),M=l(M,L,O,I,f[E+11],14,643717713),I=l(I,M,L,O,f[E+0],20,-373897302),O=l(O,I,M,L,f[E+5],5,-701558691),L=l(L,O,I,M,f[E+10],9,38016083),M=l(M,L,O,I,f[E+15],14,-660478335),I=l(I,M,L,O,f[E+4],20,-405537848),O=l(O,I,M,L,f[E+9],5,568446438),L=l(L,O,I,M,f[E+14],9,-1019803690),M=l(M,L,O,I,f[E+3],14,-187363961),I=l(I,M,L,O,f[E+8],20,1163531501),O=l(O,I,M,L,f[E+13],5,-1444681467),L=l(L,O,I,M,f[E+2],9,-51403784),M=l(M,L,O,I,f[E+7],14,1735328473),I=l(I,M,L,O,f[E+12],20,-1926607734),O=u(O,I,M,L,f[E+5],4,-378558),L=u(L,O,I,M,f[E+8],11,-2022574463),M=u(M,L,O,I,f[E+11],16,1839030562),I=u(I,M,L,O,f[E+14],23,-35309556),O=u(O,I,M,L,f[E+1],4,-1530992060),L=u(L,O,I,M,f[E+4],11,1272893353),M=u(M,L,O,I,f[E+7],16,-155497632),I=u(I,M,L,O,f[E+10],23,-1094730640),O=u(O,I,M,L,f[E+13],4,681279174),L=u(L,O,I,M,f[E+0],11,-358537222),M=u(M,L,O,I,f[E+3],16,-722521979),I=u(I,M,L,O,f[E+6],23,76029189),O=u(O,I,M,L,f[E+9],4,-640364487),L=u(L,O,I,M,f[E+12],11,-421815835),M=u(M,L,O,I,f[E+15],16,530742520),I=u(I,M,L,O,f[E+2],23,-995338651),O=h(O,I,M,L,f[E+0],6,-198630844),L=h(L,O,I,M,f[E+7],10,1126891415),M=h(M,L,O,I,f[E+14],15,-1416354905),I=h(I,M,L,O,f[E+5],21,-57434055),O=h(O,I,M,L,f[E+12],6,1700485571),L=h(L,O,I,M,f[E+3],10,-1894986606),M=h(M,L,O,I,f[E+10],15,-1051523),I=h(I,M,L,O,f[E+1],21,-2054922799),O=h(O,I,M,L,f[E+8],6,1873313359),L=h(L,O,I,M,f[E+15],10,-30611744),M=h(M,L,O,I,f[E+6],15,-1560198380),I=h(I,M,L,O,f[E+13],21,1309151649),O=h(O,I,M,L,f[E+4],6,-145523070),L=h(L,O,I,M,f[E+11],10,-1120210379),M=h(M,L,O,I,f[E+2],15,718787259),I=h(I,M,L,O,f[E+9],21,-343485551),O=i(O,y),I=i(I,S),M=i(M,T),L=i(L,k);return n(O)+n(I)+n(M)+n(L)}let cW=1,NM=console,cr=class{static setLogger(e){NM=e}constructor(e,t){dt(this,"id",void 0),dt(this,"lockingPromise",Ne.resolve()),dt(this,"locks",0),dt(this,"name",""),dt(this,"lockId",void 0),this.lockId=cW++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");NM.debug("".concat(n," ").concat(i))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new Ne(r=>{t=()=>{this.locks-=1,this.logger("unlocked",e),r()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function Qm(e,t){return function(n,i,r){const a=r.value;if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const l=this[t];if(!l)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const u=await l.lock("From ".concat(e,".").concat(i));try{for(var h=arguments.length,f=new Array(h),E=0;E<h;E++)f[E]=arguments[E];return await a.apply(this,f)}finally{u()}},r}}const _i={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function lI(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Yo(e,t,n,i){const r=Object.assign({},_i,i);let a=r.timeout;const l=async()=>{await function(f){return new Ne(E=>{window.setTimeout(E,f)})}(a),a*=r.timeoutFactor,a=Math.min(r.maxRetryTimeout,a)};let u=!1;const h=new Ne(async(f,E)=>{t=t||(()=>!1),n=n||(()=>!0);for(let y=0;y<r.maxRetryCount;y+=1){if(u)return E(new re(x.OPERATION_ABORTED));try{const S=await e();if(!t(S,y)||y+1===r.maxRetryCount)return f(S);await l()}catch(S){if(!n(S,y)||y+1===r.maxRetryCount)return E(S);await l()}}});return h.cancel=()=>u=!0,h}let FR,DM=class{constructor(e){dt(this,"input",[]),dt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:gr(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},BR=0,dI=0;function uI(e,t,n,i){return new Ne((r,a)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),BR+=Jc(t.data)):n&&(t.data.size?BR+=t.data.size:t.data instanceof FormData?BR+=bM(t.data):BR+=Jc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Zr.request(t).then(l=>{typeof l.data=="string"?dI+=Jc(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?dI+=l.data.byteLength:dI+=Jc(JSON.stringify(l.data)),r(l.data)}).catch(l=>{Zr.isCancel(l)?a(new re(x.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?a(new re(x.NETWORK_TIMEOUT,l.message)):l.response?a(new re(x.NETWORK_RESPONSE_ERROR,l.response.status)):a(new re(x.NETWORK_ERROR,l.message))})})}async function lW(e,t){const n=new Blob([t.data],{type:"buffer"});return await uI(e,ge(ge({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const kM=()=>window.isSecureContext!==void 0;function to(e){if(Array.isArray(e))return e.map(n=>n);if(!PM(e))return e;const t={};for(const n in e){const i=e[n];PM(i)||Array.isArray(i)?t[n]=to(i):t[n]=i}return t}function PM(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let hI=class{constructor(e){dt(this,"input",[]),dt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Zc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Gy={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Zc,remoteCandidate:Zc},updateInterval:0},LM={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},MM={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},xM={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},UM={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let pI=class{constructor(e,t){dt(this,"onFirstVideoReceived",void 0),dt(this,"onFirstVideoDecoded",void 0),dt(this,"onFirstAudioReceived",void 0),dt(this,"onFirstVideoDecodedTimeout",void 0),dt(this,"onFirstAudioDecoded",void 0),dt(this,"onSelectedLocalCandidateChanged",void 0),dt(this,"onSelectedRemoteCandidateChanged",void 0),dt(this,"videoIsReady",!1),dt(this,"videoIsReady2",{}),dt(this,"pc",void 0),dt(this,"options",void 0),dt(this,"intervalTimer",void 0),dt(this,"stats",to(Gy)),dt(this,"isFirstVideoReceived",{}),dt(this,"isFirstVideoDecoded",{}),dt(this,"isFirstAudioReceived",{}),dt(this,"isFirstAudioDecoded",{}),dt(this,"isFirstVideoDecodedTimeout",{}),dt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Ne(e=>{e({local:ge({},Zc),remote:ge({},Zc)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,r=0,a=0,l=0;for(const u of n)e[u].forEach((h,f)=>{if(!this.lossRateWindowStats[t-1][u][f]||!this.lossRateWindowStats[0][u][f])return;const E=this.lossRateWindowStats[t-1][u][f].packets-this.lossRateWindowStats[0][u][f].packets,y=this.lossRateWindowStats[t-1][u][f].packetsLost-this.lossRateWindowStats[0][u][f].packetsLost;u==="videoSend"||u==="audioSend"?(i+=E,a+=y):(r+=E,l+=y),Number.isNaN(E)||Number.isNaN(E)?h.packetLostRate=0:h.packetLostRate=E<=0||y<=0?0:y/(E+y)});e.sendPacketLossRate=i<=0||a<=0?0:a/(i+a),e.recvPacketLossRate=r<=0||l<=0?0:l/(r+l)}},dW=class extends pI{constructor(){super(...arguments),dt(this,"_stats",Gy),dt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=to(Gy);const n=t.filter(r=>r.type==="ssrc");this.processSSRCStats(n);const i=t.find(r=>r.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const i=Re(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const r=to(MM);r.codec=t.googCodecName,r.adaptionChangeReason="none",t.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(t.googAvgEncodeMs),r.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},r.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},r.firsCount=Number(t.googFirReceived),r.nacksCount=Number(t.googNacksReceived),r.plisCount=Number(t.googPlisReceived),r.frameCount=Number(t.framesEncoded),r.bytes=Number(t.bytesSent),r.packets=Number(t.packetsSent),r.packetsLost=Number(t.packetsLost),r.ssrc=Number(t.ssrc),r.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(r),this._stats.rtt=r.rttMs;break}case"video_recv":{const r=to(LM),a=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(r.codec=t.googCodecName,r.targetDelayMs=Number(t.googTargetDelayMs),r.renderDelayMs=Number(t.googRenderDelayMs),r.currentDelayMs=Number(t.googCurrentDelayMs),r.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),r.decodeMs=Number(t.googDecodeMs),r.maxDecodeMs=Number(t.googMaxDecodeMs),r.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},r.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},r.decodeFrameRate=Number(t.googFrameRateDecoded),r.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},r.jitterBufferMs=Number(t.googJitterBufferMs),r.firsCount=Number(t.googFirsSent),r.nacksCount=Number(t.googNacksSent),r.plisCount=Number(t.googPlisSent),r.framesDecodeCount=Number(t.framesDecoded),r.bytes=Number(t.bytesReceived),r.packets=Number(t.packetsReceived),r.packetsLost=Number(t.packetsLost),r.ssrc=Number(t.ssrc),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame.width,r.decodedFrame.height),this.isFirstVideoDecoded[r.ssrc]=!0),a){const l=a.stats,u=Date.now()-a.lts;r.framesDecodeFreezeTime=l.framesDecodeFreezeTime,r.framesDecodeInterval=l.framesDecodeInterval,r.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(a.lts=Date.now(),r.framesDecodeInterval=u,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<a.stats.framesDecodeCount&&(r.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:ge({},r),lts:Date.now()}),this._stats.videoRecv.push(r);break}case"audio_recv":{const r=to(UM);r.codec=t.googCodecName,r.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,r.decodingCNG=Number(t.googDecodingCNG),r.decodingCTN=Number(t.googDecodingCTN),r.decodingCTSG=Number(t.googDecodingCTSG),r.decodingNormal=Number(t.googDecodingNormal),r.decodingPLC=Number(t.googDecodingPLC),r.decodingPLCCNG=Number(t.googDecodingPLCCNG),r.expandRate=Number(t.googExpandRate),r.accelerateRate=Number(t.googAccelerateRate),r.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),r.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),r.speechExpandRate=Number(t.googSpeechExpandRate),r.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),r.jitterBufferMs=Number(t.googJitterBufferMs),r.jitterMs=Number(t.googJitterReceived),r.bytes=Number(t.bytesReceived),r.packets=Number(t.packetsReceived),r.packetsLost=Number(t.packetsLost),r.ssrc=Number(t.ssrc),r.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),r.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.decodingNormal>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),this._stats.audioRecv.push(r);break}case"audio_send":{const r=to(xM);r.codec=t.googCodecName,r.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,r.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),r.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),r.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),r.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),r.bytes=Number(t.bytesSent),r.packets=Number(t.packetsSent),r.packetsLost=Number(t.packetsLost),r.ssrc=Number(t.ssrc),r.rttMs=Number(t.googRtt||0),this._stats.rtt=r.rttMs,this._stats.audioSend.push(r);break}}})}_getStats(){return new Ne((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(r=>{i[r]=n.stat(r)}),t.push(i)}),t}},Hy=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),GR=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),fI=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Zs=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var $m=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}($m||{});function Wy(e,t,n,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:$m.kNone;if(!t)return;const a=Number(t[n]);if(typeof a!="number")return;const l=Number(t[i]);if(typeof l!="number")return;if(!e)return l?a/l*r:void 0;const u=Number(e[n]);if(typeof u!="number")return;const h=Number(e[i]);if(typeof h!="number")return;const f=l-h;return f?(a-u)/f*r:void 0}let VM=class extends pI{constructor(){super(...arguments),dt(this,"_stats",Gy),dt(this,"report",void 0),dt(this,"lastDecodeVideoReceiverStats",new Map),dt(this,"lastVideoFramesRecv",new Map),dt(this,"lastVideoFramesSent",new Map),dt(this,"lastVideoFramesDecode",new Map),dt(this,"lastVideoFramesOutput",new Map),dt(this,"lastVideoJBDelay",new Map),dt(this,"lastAudioJBDelay",new Map),dt(this,"mediaBytesSent",new Map),dt(this,"mediaBytesRetransmit",new Map),dt(this,"mediaBytesTargetEncode",new Map),dt(this,"lastDecodeAudioReceiverStats",new Map),dt(this,"lastAudioConcealment",new Map),dt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=to(Gy),this.report.forEach(e=>{switch(e.type){case Zs.OUTBOUND:case Zs.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,i=!t&&!("frameWidth"in e);e.type===Zs.OUTBOUND?t==="audio"||i?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===Zs.INBOUND&&(t==="audio"||i?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case Zs.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Zs.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:ge({},Zc),remote:ge({},Zc)};return e.forEach(n=>{let i;if(n.type===Zs.TRANSPORT&&(i=e.get(n.selectedCandidatePairId)),n.type===Zs.CANDIDATE_PAIR&&n.selected&&(i=n),i){const r=(a,l)=>{a.type=l.type,a.id=l.id,l.address&&(a.address=l.address),l.candidateType&&(a.candidateType=l.candidateType),l.port&&(a.port=l.port),l.priority&&(a.priority=l.priority),l.protocol&&(a.protocol=l.protocol),l.relayProtocol&&(a.relayProtocol=l.relayProtocol)};if(i.localCandidateId){const a=e.get(i.localCandidateId);a&&r(t.local,a)}if(i.remoteCandidateId){const a=e.get(i.remoteCandidateId);a&&r(t.remote,a)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Zs.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Zs.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Zs.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ge({},t),ge({},this.stats.selectedCandidatePair.localCandidate)),e.type===Zs.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ge({},t),ge({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(i=>i.ssrc===e.ssrc);t||(t=to(UM),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Wy(n,t,"totalProcessingDelay","jitterBufferEmittedCount",$m.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,ge({},t))}calculateAudioFreeze(e,t,n){const i=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&i!=null){const r=i.lts,a=n.timestamp,l=a-r;if(l<=0)return;const u=e.concealedSamples-t.concealedSamples-0,h=i.nonSilent+u,f=e.totalSamplesReceived-t.totalSamplesReceived;if(f<=0)return;const E=80*f/l,y=200*f/l,S=l/f;let T=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,h>E&&(i.plc80>0?(e.freezeSamples80+=u,e.freezeMs80+=Math.round(u*S)):(e.freezeSamples80+=h,e.freezeMs80+=Math.round(h*S)),T=i.plc80+1);let k=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,h>y&&(i.plc200>0?(e.freezeSamples200+=u,e.freezeMs200+=Math.round(u*S)):(e.freezeSamples200+=h,e.freezeMs200+=Math.round(h*S)),k=i.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:u,lts:a,plc80:T,plc200:k})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(l=>l.ssrc===e.ssrc);t||(t=to(LM),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),i=this.lastVideoFramesDecode.get(t.ssrc),r=this.lastVideoFramesOutput.get(t.ssrc),a=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const l=t.decodedFrame?t.decodedFrame.width:0,u=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,l,u),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const l=n.stats,u=a-n.lts;t.framesDecodeFreezeTime=l.framesDecodeFreezeTime,t.framesDecodeInterval=l.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&u>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=u,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<l.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Wy(n==null?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Wy(n==null?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",$m.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Wy(n==null?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",$m.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Wy(n==null?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",$m.kMillisecondsFromSeconds),i&&a-i.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-i.count)/((a-i.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:a,rate:t.decodeFrameRate})):i?t.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:a,rate:0}),t.framesDroppedCount&&e.framesReceived&&(r&&a-r.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-r.count)/((a-r.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:a,rate:Math.max(t.outputFrameRate,0)})):r?t.outputFrameRate=r.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:a,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:ge({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(i=>i.ssrc===e.ssrc);t||(t=to(MM),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const i=new hI(10);i.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,i)}if(e.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{const r=new hI(10);r.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,r)}}if(e.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(e.ssrc);if(i)i.add(e.totalEncodedBytesTarget);else{const r=new hI(10);r.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,r)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const i=this.lastEncoderMs.get(e.ssrc);if(!i||i.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const r=e.framesEncoded-i.lastFrameCount,a=e.totalEncodeTime-i.lastEncoderTime;t.avgEncodeMs=1e3*a/r}}if(e.framesEncoded&&e.qpSum){const i=this.lastEncoderMs.get(e.ssrc);!i||i.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-i.lastQpSum)/(e.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const i=this.findRemoteStatsId(e.ssrc,Zs.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=to(xM),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,Zs.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const i=Array.from(Ir(n=this.report).call(n)).find(r=>r.type===t&&r.ssrc===e);return i?i.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var i,r,a,l;const u=t?this.report.get(t):void 0,h=(i=u==null?void 0:u.framesSent)!==null&&i!==void 0?i:e.framesSent;if(typeof h!="number")return;let f=(r=u==null?void 0:u.frameWidth)!==null&&r!==void 0?r:e.frameWidth,E=(a=u==null?void 0:u.frameHeight)!==null&&a!==void 0?a:e.frameHeight,y=(l=u==null?void 0:u.framesPerSecond)!==null&&l!==void 0?l:e.framesPerSecond;if(typeof f=="number"&&typeof E=="number"||(f=0,E=0),y==null){const S=Date.now(),T=this.lastVideoFramesSent.get(n.ssrc);T&&S-T.lts>=800?(y=Math.round((h-T.count)/((S-T.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:h,lts:S,rate:y})):T?y=T.rate:this.lastVideoFramesSent.set(n.ssrc,{count:h,lts:S,rate:0})}n.sentFrame={width:f,height:E,frameRate:Math.max(0,y)}}processVideoTrackReceiverStats(e,t,n){var i,r,a,l,u;const h=t?this.report.get(t):void 0,f=(i=h==null?void 0:h.framesReceived)!==null&&i!==void 0?i:e.framesReceived,E=(r=h==null?void 0:h.frameWidth)!==null&&r!==void 0?r:e.frameWidth,y=(a=h==null?void 0:h.frameHeight)!==null&&a!==void 0?a:e.frameHeight,S=(l=h==null?void 0:h.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,T=(u=h==null?void 0:h.jitterBufferEmittedCount)!==null&&u!==void 0?u:e.jitterBufferEmittedCount;if(typeof f=="number"){const k=this.lastVideoFramesRecv.get(n.ssrc),O=Date.now();n.framesReceivedCount=f;let I=0;k&&O-k.lts>=800?(I=Math.round((f-k.count)/((O-k.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:f,lts:O,rate:I})):k?I=k.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:f,lts:O,rate:0}),n.receivedFrame={width:E||0,height:y||0,frameRate:I||0},n.decodedFrame={width:E||0,height:y||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:E||0,height:y||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(S&&T){const k=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let O=k.jitterBufferMs;const I=T-k.jitterBufferEmittedCount;I>0&&(O=1e3*(S-k.jitterBufferDelay)/I),n.jitterBufferMs=O,n.currentDelayMs=Math.round(O),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:T,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var i,r,a,l;const u=t?this.report.get(t):void 0,h=(i=(r=u==null?void 0:u.echoReturnLoss)!==null&&r!==void 0?r:e.echoReturnLoss)!==null&&i!==void 0?i:0,f=(a=(l=u==null?void 0:u.echoReturnLossEnhancement)!==null&&l!==void 0?l:e.echoReturnLossEnhancement)!==null&&a!==void 0?a:0;n.aecReturnLoss=h,n.aecReturnLossEnhancement=f}processAudioTrackReceiverStats(e,t,n){var i,r,a,l,u,h,f,E,y;const S=t?this.report.get(t):void 0,T=(i=S==null?void 0:S.removedSamplesForAcceleration)!==null&&i!==void 0?i:e.removedSamplesForAcceleration,k=(r=S==null?void 0:S.totalSamplesReceived)!==null&&r!==void 0?r:e.totalSamplesReceived,O=(a=S==null?void 0:S.jitterBufferDelay)!==null&&a!==void 0?a:e.jitterBufferDelay,I=(l=S==null?void 0:S.jitterBufferEmittedCount)!==null&&l!==void 0?l:e.jitterBufferEmittedCount,M=(u=S==null?void 0:S.audioLevel)!==null&&u!==void 0?u:e==null?void 0:e.audioLevel,L=(h=S==null?void 0:S.totalSamplesDuration)!==null&&h!==void 0?h:e==null?void 0:e.totalSamplesDuration,j=(f=S==null?void 0:S.concealedSamples)!==null&&f!==void 0?f:e.concealedSamples,K=(E=S==null?void 0:S.silentConcealedSamples)!==null&&E!==void 0?E:e.silentConcealedSamples,z=(y=S==null?void 0:S.concealmentEvents)!==null&&y!==void 0?y:e.concealmentEvents;if(typeof k=="number"&&(n.totalSamplesReceived=k),typeof K=="number"&&(n.silentConcealedSamples=K),typeof z=="number"&&(n.concealmentEvents=z),typeof j=="number"&&(n.concealedSamples=j),T&&k&&(n.accelerateRate=T/k),O&&I){const Z=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let se=Z.jitterBufferMs;const ue=I-Z.jitterBufferEmittedCount;ue>0&&(se=1e3*(O-Z.jitterBufferDelay)/ue),n.jitterBufferMs=Math.round(se),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:O,jitterBufferEmittedCount:I,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=M;let H=1920;L&&k&&(H=k/L/50,n.receivedFrames=Math.round(k/H)),j&&(n.droppedFrames=Math.round(j/H))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(r=>{e+=r.diffMean()}),this.mediaBytesRetransmit.forEach(r=>{t=t===null?r.diffMean():t+r.diffMean()}),this.mediaBytesTargetEncode.forEach(r=>{n=n===null?r.diffMean():n+r.diffMean()});const i=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},uW=class extends pI{updateStats(){return Ne.resolve()}};function mI(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const a=function(){const l=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return l&&l[0]?Number(l[0].split("/")[1]):null}();return a?a<76?new dW(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new VM(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):function(l){if(!window.RTCStatsReport)return!1;const u=l.getStats();return!!(u instanceof Ne||function(h){return!!h&&(typeof h=="object"||typeof h=="function")&&typeof h.then=="function"}(u))}(e)?new VM(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new uW(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r})}const jM="websdk_ng_install_id";function _I(){try{if(U("INSTALL_ID"))return U("INSTALL_ID");let e=window.localStorage.getItem(jM);return e||(e=Ip(),window.localStorage.setItem(jM,e)),on("INSTALL_ID",e),e}catch{return}}const Sa=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],i=t[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.24.0"),EI=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Np=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const ir=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),r=[];for(let u=0;u<6;u++)r.push("1");const a=r.join(""),l={};return l[e]=i,l[t]=a,Object.assign(l,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ir;const HR={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},gI={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},yI="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",SI={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},Ln=ge(ge(ge(ge({},SI),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:gI,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},HR),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function on(e,t,n){var i,r,a;Re(i=Object.keys(Ln)).call(i,e)&&(!n&&Re(r=Object.keys(zo)).call(r,e)||(Ln[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(Ln.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(a=!!t,Ln.USE_NEW_NETWORK_CONFIG=a,a&&(Ln.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Ln.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Ln.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Ln.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Ln.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Ln.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Ln.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Ln.ENABLE_INSTANT_VIDEO=!0,Ln.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Ln.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Ln.NEW_TURN_MODE||(Ln.NEW_TURN_MODE=4))))}function U(e){return Ln[e]}EI||(Ln.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Ln.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Ln.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Ln.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Ln.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Ln.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Ln.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Ln.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Ln.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Ln.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Ln.AREAS=["NORTH_AMERICA","OVERSEA"]);let FM=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const zo={};var ut=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ut||{});let Yy=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const BM=128,hW=96,GM=1e3,e_=10;let pW=0;var HM=(()=>{var e={8:(i,r,a)=>{a.r(r),a.d(r,{Parser:()=>ue,Printer:()=>Kt,parse:()=>Te,print:()=>Ve});const l=`
`,u="".concat("\r").concat(l),h=" ";let f;function E(he){return he>="0"&&he<="9"}function y(he){return he>="!"&&he<="~"}function S(he){return y(he)||he>=""&&he<=""}function T(he){return he==="!"||he>="#"&&he<="'"||he>="*"&&he<="+"||he>="-"&&he<="."||he>="0"&&he<="9"||he>="A"&&he<="Z"||he>="^"&&he<="~"}function k(he){return he>="1"&&he<="9"}function O(he){return he>="A"&&he<="Z"||he>="a"&&he<="z"}function I(he){return he==="d"||he==="h"||he==="m"||he==="s"}function M(he){return he>""&&he<"	"||he>"\v"&&he<"\f"||he>""&&he<""}function L(he){return O(he)||E(he)||he==="+"||he==="/"}function j(he){return E(he)||O(he)||he==="+"||he==="/"||he==="-"||he==="_"}function K(he){return O(he)||E(he)||he==="+"||he==="/"}function z(he,A){var G=Object.keys(he);if(Object.getOwnPropertySymbols){var Y=Object.getOwnPropertySymbols(he);A&&(Y=Y.filter(function(Se){return Object.getOwnPropertyDescriptor(he,Se).enumerable})),G.push.apply(G,Y)}return G}function H(he){for(var A=1;A<arguments.length;A++){var G=arguments[A]!=null?arguments[A]:{};A%2?z(Object(G),!0).forEach(function(Y){Z(he,Y,G[Y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(he,Object.getOwnPropertyDescriptors(G)):z(Object(G)).forEach(function(Y){Object.defineProperty(he,Y,Object.getOwnPropertyDescriptor(G,Y))})}return he}function Z(he,A,G){return A in he?Object.defineProperty(he,A,{value:G,enumerable:!0,configurable:!0,writable:!0}):he[A]=G,he}(function(he){he.VERSION="v",he.ORIGIN="o",he.SESSION_NAME="s",he.INFORMATION="i",he.URI="u",he.EMAIL="e",he.PHONE="p",he.CONNECTION="c",he.BANDWIDTH="b",he.TIME="t",he.REPEAT="r",he.ZONE_ADJUSTMENTS="z",he.KEY="k",he.ATTRIBUTE="a",he.MEDIA="m"})(f||(f={}));class se{consumeText(A,G){let Y=G;for(;Y<A.length;){const Se=A[Y];if(Se==="\0"||Se==="\r"||Se===l)break;Y+=1}if(Y-G==0)throw new Error("Invalid text, at ".concat(A));return Y}consumeUnicastAddress(A,G,Y){return this.consumeTill(A,G,h)}consumeOneOrMore(A,G,Y){let Se=G;for(;Y(A[Se]);)Se++;if(Se-G==0)throw new Error("Invalid rule at ".concat(G,"."));return Se}consumeSpace(A,G){if(A[G]===h)return G+1;throw new Error("Invalid space at ".concat(G,"."))}consumeIP4Address(A,G){let Y=G;for(let Se=0;Se<4;Se++)if(Y=this.consumeDecimalUChar(A,Y),Se!==3){if(A[Y]!==".")throw new Error("Invalid IP4 address.");Y++}return Y}consumeDecimalUChar(A,G){let Y=G;for(let mt=0;mt<3&&E(A[Y]);mt++,Y++);if(Y-G==0)throw new Error("Invalid decimal uchar.");const Se=parseInt(A.slice(G,Y));if(Se>=0&&Se<=255)return Y;throw new Error("Invalid decimal uchar")}consumeIP6Address(A,G){let Y=this.consumeHexpart(A,G);return A[Y]===":"&&(Y+=1,Y=this.consumeIP4Address(A,Y)),Y}consumeHexpart(A,G){let Y=G;if(A[Y]===":"&&A[Y+1]===":"){Y+=2;try{Y=this.consumeHexseq(A,Y)}catch{}return Y}if(Y=this.consumeHexseq(A,Y),A[Y]===":"&&A[Y+1]===":"){Y+=2;try{Y=this.consumeHexseq(A,Y)}catch{}return Y}return Y}consumeHexseq(A,G){let Y=G;for(;Y=this.consumeHex4(A,Y),A[Y]===":"&&A[Y+1]!==":";)Y+=1;return Y}consumeHex4(A,G){let Y=0;for(;Y<4;Y++)if(!((Se=A[G+Y])>="0"&&Se<="9"||Se>="a"&&Se<="f"||Se>="A"&&Se<="F")){if(Y===0)throw new Error("Invalid hex 4");break}var Se;return G+Y}consumeFQDN(A,G){let Y=G;for(;E(A[Y])||O(A[Y])||A[Y]==="-"||A[Y]===".";)Y+=1;if(Y-G<4)throw new Error("Invalid FQDN");return Y}consumeExtnAddr(A,G){return this.consumeOneOrMore(A,G,S)}consumeMulticastAddress(A,G,Y){switch(Y){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(A,G);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(A,G);default:try{return this.consumeFQDN(A,G)}catch{return this.consumeExtnAddr(A,G)}}}consumeIP6MulticastAddress(A,G){const Y=this.consumeHexpart(A,G);return A[Y]==="/"?this.consumeInteger(A,Y+1):Y}consumeIP4MulticastAddress(A,G){let Y=G+3;const Se=A.slice(G,Y),mt=parseInt(Se);if(mt<224||mt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Rn=0;Rn<3;Rn++){if(A[Y]!==".")throw new Error("Invalid IP4 multicast address.");Y+=1,Y=this.consumeDecimalUChar(A,Y)}return A[Y]==="/"&&(Y+=1),Y=this.consumeTTL(A,Y),A[Y]==="/"&&(Y=this.consumeInteger(A,Y)),Y}consumeInteger(A,G){if(!k(A[G]))throw new Error("Invalid integer.");for(G+=1;E(A[G]);)G+=1;return G}consumeTTL(A,G){if(A[G]==="0")return G+1;if(!k(A[G]))throw new Error("Invalid TTL.");G+=1;for(let Y=0;Y<2&&E(A[G]);Y++)G+=1;return G}consumeToken(A,G){return this.consumeOneOrMore(A,G,T)}consumeTime(A,G){let Y=G;if(A[Y]==="0")return Y+1;for(k(A[Y])&&(Y+=1);E(A[Y]);)Y++;if(Y-G<10)throw new Error("Invalid time");return Y}consumeAddress(A,G){return this.consumeTill(A,G,h)}consumeTypedTime(A,G){let Y=G;return Y=this.consumeOneOrMore(A,Y,E),I(A[Y])?Y+1:Y}consumeRepeatInterval(A,G){if(!k(A[G]))throw new Error("Invalid repeat interval");for(G+=1;E(A[G]);)G+=1;return I(A[G])&&(G+=1),G}consumePort(A,G){return this.consumeOneOrMore(A,G,E)}consume(A,G,Y){for(let Se=0;Se<Y.length;Se++){if(G+Se>=A.length)throw new Error("consume exceeding value length");if(A[G+Se]!==Y[Se])throw new Error("consume ".concat(Y," failed at ").concat(Se))}return G+Y.length}consumeTill(A,G,Y){let Se=G;for(;Se<A.length&&(typeof Y!="string"||A[Se]!==Y)&&(typeof Y!="function"||!Y(A[Se]));)Se++;return Se}}class ue extends se{constructor(){super(),Z(this,"records",[]),Z(this,"currentLine",0)}parse(A){const G=this.probeEOL(A);this.records=A.split(G).filter(fd=>!!Nr(fd).call(fd)).map(this.parseLine),this.currentLine=0;const Y=this.parseVersion(),Se=this.parseOrigin(),mt=this.parseSessionName(),Rn=this.parseInformation(),Ri=this.parseUri(),Ia=this.parseEmail(),fo=this.parsePhone(),IS=this.parseConnection(),Jp=this.parseBandWidth(),k_=this.parseTimeFields(),iC=this.parseKey(),rC=this.parseSessionAttribute(),Na=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:Y,origin:Se,sessionName:mt,information:Rn,uri:Ri,emails:Ia,phones:fo,connection:IS,bandwidths:Jp,timeFields:k_,key:iC,attributes:rC,mediaDescriptions:Na}}getCurrentRecord(){const A=this.records[this.currentLine];if(!A)throw new Error("Record doesn't exit.");return A}probeEOL(A){for(let G=0;G<A.length;G++)if(A[G]===l)return A[G-1]==="\r"?u:l;throw new Error("Invalid newline character.")}parseLine(A,G){if(A.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const Y=A[0];if(A[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:Y,value:A.slice(2),line:G,cur:0}}parseSessionAttribute(){const A=new Rt;for(;this.currentLine<this.records.length;){const G=this.getCurrentRecord();if(G.type!==f.ATTRIBUTE)break;const Y={attField:this.extractOneOrMore(G,Se=>T(Se)&&Se!==":"),_cur:0};G.value[G.cur]===":"&&(G.cur+=1,Y.attValue=this.extractOneOrMore(G,M)),A.parse(Y),this.currentLine++}return A.digest()}parseMediaAttributes(A){const G=new At(A);for(;this.currentLine<this.records.length;){const Y=this.getCurrentRecord();if(Y.type!==f.ATTRIBUTE)break;const Se={attField:this.extractOneOrMore(Y,mt=>T(mt)&&mt!==":"),_cur:0};Y.value[Y.cur]===":"&&(Y.cur+=1,Se.attValue=this.extractOneOrMore(Y,M)),G.parse(Se),this.currentLine++}return G.digest()}parseKey(){const A=this.getCurrentRecord();if(A.type===f.KEY){if(A.value==="prompt"||A.value==="clear:"||A.value==="base64:"||A.value==="uri:")return A.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const A=this.getCurrentRecord();if(A.type===f.ZONE_ADJUSTMENTS){const G=[];for(;;)try{const Y=this.extract(A,this.consumeTime);this.consumeSpaceForRecord(A);let Se=!1;A.value[A.cur]==="-"&&(Se=!0,A.cur+=1);const mt=this.extract(A,this.consumeTypedTime);G.push({time:Y,typedTime:mt,back:Se})}catch{break}if(G.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,G}return[]}parseRepeat(){const A=[];for(;;){const G=this.getCurrentRecord();if(G.type!==f.REPEAT)break;{const Y=this.extract(G,this.consumeRepeatInterval),Se=this.parseTypedTime(G);A.push({repeatInterval:Y,typedTimes:Se}),this.currentLine++}}return A}parseTypedTime(A){const G=[];for(;;)try{this.consumeSpaceForRecord(A),G.push(this.extract(A,this.consumeTypedTime))}catch{break}if(G.length===0)throw new Error("Invalid typed time.");return G}parseTime(){const A=this.getCurrentRecord(),G=this.extract(A,this.consumeTime);this.consumeSpaceForRecord(A);const Y=this.extract(A,this.consumeTime);return this.currentLine++,{startTime:G,stopTime:Y}}parseBandWidth(){const A=[];for(;this.currentLine<this.records.length;){const G=this.getCurrentRecord();if(G.type!==f.BANDWIDTH)break;{const Y=this.extractOneOrMore(G,T);if(G.value[G.cur]!==":")throw new Error("Invalid bandwidth field.");G.cur++;const Se=this.extractOneOrMore(G,E);A.push({bwtype:Y,bandwidth:Se}),this.currentLine++}}return A}parseVersion(){const A=this.getCurrentRecord();if(A.type!==f.VERSION)throw new Error("first sdp record must be version");const G=A.value.slice(0,this.consumeOneOrMore(A.value,0,E));if(G.length!==A.value.length)throw new Error('invalid proto version, "v='.concat(A.value,'"'));return this.currentLine++,G}parseOrigin(){const A=this.getCurrentRecord();if(A.type!==f.ORIGIN)throw new Error("second line of sdp must be origin");const G=this.extractOneOrMore(A,S);this.consumeSpaceForRecord(A);const Y=this.extractOneOrMore(A,E);this.consumeSpaceForRecord(A);const Se=this.extractOneOrMore(A,E);this.consumeSpaceForRecord(A);const mt=this.extractOneOrMore(A,T);this.consumeSpaceForRecord(A);const Rn=this.extractOneOrMore(A,T);this.consumeSpaceForRecord(A);const Ri=this.extract(A,this.consumeUnicastAddress);return this.currentLine++,{username:G,sessId:Y,sessVersion:Se,nettype:mt,addrtype:Rn,unicastAddress:Ri}}parseSessionName(){const A=this.getCurrentRecord();if(A.type===f.SESSION_NAME){const G=this.extract(A,this.consumeText);return this.currentLine++,G}}parseInformation(){const A=this.getCurrentRecord();if(A.type!==f.INFORMATION)return;const G=this.extract(A,this.consumeText);return this.currentLine++,G}parseUri(){const A=this.getCurrentRecord();if(A.type===f.URI)return this.currentLine++,A.value}parseEmail(){const A=[];for(;;){const G=this.getCurrentRecord();if(G.type!==f.EMAIL)break;A.push(G.value),this.currentLine++}return A}parsePhone(){const A=[];for(;;){const G=this.getCurrentRecord();if(G.type!==f.PHONE)break;A.push(G.value),this.currentLine++}return A}parseConnection(){const A=this.getCurrentRecord();if(A.type===f.CONNECTION){const G=this.extractOneOrMore(A,T);this.consumeSpaceForRecord(A);const Y=this.extractOneOrMore(A,T);this.consumeSpaceForRecord(A);const Se=this.extract(A,this.consumeAddress);return this.currentLine++,{nettype:G,addrtype:Y,address:Se}}}parseMedia(){const A=this.getCurrentRecord(),G=this.extract(A,this.consumeToken);this.consumeSpaceForRecord(A);let Y=this.extract(A,this.consumePort);A.value[A.cur]==="/"&&(A.cur+=1,Y+=this.extract(A,this.consumeInteger)),this.consumeSpaceForRecord(A);const Se=[];for(Se.push(this.extract(A,this.consumeToken));A.value[A.cur]==="/";)A.cur+=1,Se.push(this.extract(A,this.consumeToken));if(Se.length===0)throw new Error("Invalid proto");const mt=this.parseFmt(A);return this.currentLine++,{mediaType:G,port:Y,protos:Se,fmts:mt}}parseTimeFields(){const A=[];for(;this.getCurrentRecord().type===f.TIME;){const G=this.parseTime(),Y=this.parseRepeat(),Se=this.parseZone();A.push({time:G,repeats:Y,zones:Se})}return A}parseMediaDescription(){const A=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.MEDIA;){const G=this.parseMedia(),Y=this.parseInformation(),Se=this.parseConnections(),mt=this.parseBandWidth(),Rn=this.parseKey(),Ri=this.parseMediaAttributes(G);A.push({media:G,information:Y,connections:Se,bandwidths:mt,key:Rn,attributes:Ri})}return A}parseConnections(){const A=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.CONNECTION;)A.push(this.parseConnection());return A}parseFmt(A){const G=[];for(;;)try{this.consumeSpaceForRecord(A),G.push(this.extract(A,this.consumeToken))}catch{break}if(G.length===0)throw new Error("Invalid fmts");return G}extract(A,G){for(var Y=arguments.length,Se=new Array(Y>2?Y-2:0),mt=2;mt<Y;mt++)Se[mt-2]=arguments[mt];const Rn=G.call(this,A.value,A.cur,...Se),Ri=A.value.slice(A.cur,Rn);return A.cur=Rn,Ri}extractOneOrMore(A,G){const Y=this.consumeOneOrMore(A.value,A.cur,G),Se=A.value.slice(A.cur,Y);return A.cur=Y,Se}consumeSpaceForRecord(A){if(A.value[A.cur]!==h)throw new Error("Invalid space at ".concat(A.cur,"."));A.cur+=1}}class Ee extends se{constructor(){super(...arguments),Z(this,"attributes",void 0),Z(this,"digested",!1)}extractOneOrMore(A,G,Y){const Se=this.consumeOneOrMore(A.attValue,A._cur,G),mt=A.attValue.slice(A._cur,Se),[Rn,Ri]=Y||[];if(typeof Rn=="number"&&mt.length<Rn)throw new Error("error in length, should be more or equal than ".concat(Rn," characters."));if(typeof Ri=="number"&&mt.length>Ri)throw new Error("error in length, should be less or equal than ".concat(Ri," characters."));return A._cur=Se,mt}consumeAttributeSpace(A){if(A.attValue[A._cur]!==h)throw new Error("Invalid space at ".concat(A._cur,"."));A._cur+=1}extract(A,G){if(!A.attValue)throw new Error("Nothing to extract from attValue.");for(var Y=arguments.length,Se=new Array(Y>2?Y-2:0),mt=2;mt<Y;mt++)Se[mt-2]=arguments[mt];const Rn=G.call(this,A.attValue,A._cur,...Se),Ri=A.attValue.slice(A._cur,Rn);return A._cur=Rn,Ri}atEnd(A){if(!A.attValue)throw new Error;return A._cur>=A.attValue.length}peekChar(A){if(!A.attValue)throw new Error;return A.attValue[A._cur]}peek(A,G){if(!A.attValue)throw new Error;for(let Y=0;Y<G.length;Y++)if(G[Y]!==A.attValue[A._cur+Y])return!1;return!0}parseIceUfrag(A){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(A,L,[4,256])}parseIcePwd(A){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(A,L,[22,256])}parseIceOptions(A){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const G=[];for(;!this.atEnd(A);){G.push(this.extractOneOrMore(A,L));try{this.consumeAttributeSpace(A)}catch(Y){if(this.atEnd(A))break;throw Y}}this.attributes.iceOptions=G}parseFingerprint(A){const G=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const Y=this.extract(A,this.consumeTill);this.attributes.fingerprints.push({hashFunction:G,fingerprint:Y})}parseExtmap(A){const G=this.extractOneOrMore(A,E);let Y;this.peekChar(A)==="/"&&(this.extract(A,this.consume,"/"),Y=this.extract(A,this.consumeToken)),this.consumeAttributeSpace(A);const Se=this.extract(A,this.consumeTill,h),mt=H(H({entry:parseInt(G,10)},Y&&{direction:Y}),{},{extensionName:Se});this.peekChar(A)===h&&(this.consumeAttributeSpace(A),mt.extensionAttributes=this.extract(A,this.consumeTill)),this.attributes.extmaps.push(mt)}parseSetup(A){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const G=this.extract(A,this.consumeTill);if(G!=="active"&&G!=="passive"&&G!=="actpass"&&G!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=G}}class Rt extends Ee{constructor(){super(...arguments),Z(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(A){if(this.digested)throw new Error("already digested");try{switch(A.attField){case"group":this.parseGroup(A);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(A);break;case"ice-pwd":this.parseIcePwd(A);break;case"ice-options":this.parseIceOptions(A);break;case"fingerprint":this.parseFingerprint(A);break;case"setup":this.parseSetup(A);break;case"tls-id":this.parseTlsId(A);break;case"identity":this.parseIdentity(A);break;case"extmap":this.parseExtmap(A);break;case"msid-semantic":this.parseMsidSemantic(A);break;default:A.ignored=!0,this.attributes.unrecognized.push(A)}}catch(G){throw console.error("parsing session attribute ".concat(A.attField,' error, "a=').concat(A.attField,":").concat(A.attValue,'"')),G}if(!A.ignored&&A.attValue&&!this.atEnd(A))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(A){const G=this.extract(A,this.consumeToken),Y=[];for(;!this.atEnd(A)&&this.peekChar(A)===h;)this.consumeAttributeSpace(A),Y.push(this.extract(A,this.consumeToken));this.attributes.groups.push({semantic:G,identificationTag:Y})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(A){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(A,j)}parseIdentity(A){const G=this.extractOneOrMore(A,K),Y=[];for(;!this.atEnd(A)&&this.peekChar(A)===h;){this.consumeAttributeSpace(A);const Se=this.extract(A,this.consumeToken);this.extract(A,this.consume,"=");const mt=this.extractOneOrMore(A,Rn=>Rn!==h&&M(Rn));Y.push({name:Se,value:mt})}this.attributes.identities.push({assertionValue:G,extensions:Y})}parseMsidSemantic(A){this.peekChar(A)===h&&this.consumeAttributeSpace(A);const G={semantic:this.extract(A,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(A)}catch{break}if(this.peekChar(A)==="*"){this.extract(A,this.consume,"*"),G.applyForAll=!0;break}{const Y=this.extract(A,this.consumeTill,h);G.identifierList.push(Y)}}this.attributes.msidSemantic=G}}class At extends Ee{constructor(A){super(),Z(this,"attributes",void 0),A.protos.indexOf("RTP")!==-1||A.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(A){if(this.digested)throw new Error("already digested");try{switch(A.attField){case"extmap":this.parseExtmap(A);break;case"setup":this.parseSetup(A);break;case"ice-ufrag":this.parseIceUfrag(A);break;case"ice-pwd":this.parseIcePwd(A);break;case"ice-options":this.parseIceOptions(A);break;case"candidate":this.parseCandidate(A);break;case"remote-candidate":this.parseRemoteCandidate(A);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(A);break;case"rtpmap":this.parseRtpmap(A);break;case"ptime":this.parsePtime(A);break;case"maxptime":this.parseMaxPtime(A);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(A);break;case"ssrc":this.parseSSRC(A);break;case"fmtp":this.parseFmtp(A);break;case"rtcp-fb":this.parseRtcpFb(A);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(A);break;case"mid":this.parseMid(A);break;case"msid":this.parseMsid(A);break;case"imageattr":this.parseImageAttr(A);break;case"rid":this.parseRid(A);break;case"simulcast":this.parseSimulcast(A);break;case"sctp-port":this.parseSctpPort(A);break;case"max-message-size":this.parseMaxMessageSize(A);break;case"ssrc-group":this.parseSSRCGroup(A);break;default:A.ignored=!0,this.attributes.unrecognized.push(A)}}catch(G){throw console.error("parsing media attribute ".concat(A.attField,' error, "a=').concat(A.attField,":").concat(A.attValue,'"')),G}if(!A.ignored&&A.attValue&&!this.atEnd(A))throw new Error("attribute parsing error")}parseCandidate(A){const G=this.extractOneOrMore(A,L,[1,32]);this.consumeAttributeSpace(A);const Y=this.extractOneOrMore(A,E,[1,5]);this.consumeAttributeSpace(A);const Se=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const mt=this.extractOneOrMore(A,E,[1,10]);this.consumeAttributeSpace(A);const Rn=this.extract(A,this.consumeAddress);this.consumeAttributeSpace(A);const Ri=this.extract(A,this.consumePort);this.consumeAttributeSpace(A),this.extract(A,this.consume,"typ"),this.consumeAttributeSpace(A);const Ia={foundation:G,componentId:Y,transport:Se,priority:mt,connectionAddress:Rn,port:Ri,type:this.extract(A,this.consumeToken),extension:{}};for(this.peek(A," raddr")&&(this.extract(A,this.consume," raddr"),this.consumeAttributeSpace(A),Ia.relAddr=this.extract(A,this.consumeAddress)),this.peek(A," rport")&&(this.extract(A,this.consume," rport"),this.consumeAttributeSpace(A),Ia.relPort=this.extract(A,this.consumePort));this.peekChar(A)===h;){this.consumeAttributeSpace(A);const fo=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A),Ia.extension[fo]=this.extractOneOrMore(A,y)}this.attributes.candidates.push(Ia)}parseRemoteCandidate(A){const G=[];for(;;){const Y=this.extractOneOrMore(A,E,[1,5]);this.consumeAttributeSpace(A);const Se=this.extract(A,this.consumeAddress);this.consumeAttributeSpace(A);const mt=this.extract(A,this.consumePort);G.push({componentId:Y,connectionAddress:Se,port:mt});try{this.consumeAttributeSpace(A)}catch{break}}this.attributes.remoteCandidatesList.push(G)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(A){const G=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const Y=this.extract(A,this.consumeTill,"/");this.extract(A,this.consume,"/");const Se={encodingName:Y,clockRate:this.extractOneOrMore(A,E)};this.atEnd(A)||this.peekChar(A)!=="/"||(this.extract(A,this.consume,"/"),Se.encodingParameters=parseInt(this.extract(A,this.consumeTill),10));const mt=this.attributes.payloads.find(Rn=>Rn.payloadType===parseInt(G,10));mt?mt.rtpMap=Se:this.attributes.payloads.push({payloadType:parseInt(G,10),rtpMap:Se,rtcpFeedbacks:[]})}parsePtime(A){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(A,this.consumeTill)}parseMaxPtime(A){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(A,this.consumeTill)}parseDirection(A){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=A.attField}parseSSRC(A){const G=this.extractOneOrMore(A,E);this.consumeAttributeSpace(A);const Y=this.extract(A,this.consumeTill,":");let Se;this.peekChar(A)===":"&&(this.extract(A,this.consume,":"),Se=this.extract(A,this.consumeTill));const mt=this.attributes.ssrcs.find(Rn=>Rn.ssrcId===parseInt(G,10));mt?mt.attributes[Y]=Se:this.attributes.ssrcs.push({ssrcId:parseInt(G,10),attributes:{[Y]:Se}})}parseFmtp(A){const G=this.extract(A,this.consumeTill,h);this.consumeAttributeSpace(A);const Y=this.extract(A,this.consumeTill),Se={};Y.split(";").forEach(Rn=>{let[Ri,Ia]=Rn.split("=");Ri=Nr(Ri).call(Ri);const fo=typeof Ia=="string"?Nr(Ia).call(Ia):null;typeof Ri=="string"&&Ri.length>0&&(Se[Ri]=fo)});const mt=this.attributes.payloads.find(Rn=>Rn.payloadType===parseInt(G,10));mt?mt.fmtp={parameters:Se}:this.attributes.payloads.push({payloadType:parseInt(G,10),rtcpFeedbacks:[],fmtp:{parameters:Se}})}parseFmtParameters(A){const G={},Y=this.extract(A,this.consumeTill,"=");A._cur++;const Se=this.extract(A,this.consumeTill,";");for(G[Y]=Se;A.attValue[A._cur]===";";){const mt=this.extract(A,this.consumeTill,"=");A._cur++;const Rn=this.extract(A,this.consumeTill,";");G[mt]=Rn}return G}parseRtcpFb(A){let G="";G=this.peekChar(A)==="*"?this.extract(A,this.consume,"*"):this.extract(A,this.consumeTill,h),this.consumeAttributeSpace(A);const Y=this.extract(A,this.consumeTill,h);let Se;if(Y==="trr-int")Se={type:Y,interval:this.extract(A,this.consumeTill)};else{const mt={type:Y};this.peekChar(A)===h&&(this.consumeAttributeSpace(A),mt.parameter=this.extract(A,this.consumeToken),this.peekChar(A)===h&&(mt.additional=this.extract(A,this.consumeTill))),Se=mt}if(G==="*")this.attributes.rtcpFeedbackWildcards.push(Se);else{const mt=this.attributes.payloads.find(Rn=>Rn.payloadType===parseInt(G,10));mt?mt.rtcpFeedbacks.push(Se):this.attributes.payloads.push({payloadType:parseInt(G,10),rtcpFeedbacks:[Se]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(A){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const G={port:this.extract(A,this.consumePort)};this.peekChar(A)===h&&(this.consumeAttributeSpace(A),G.netType=this.extractOneOrMore(A,T),this.consumeAttributeSpace(A),G.addressType=this.extractOneOrMore(A,T),this.consumeAttributeSpace(A),G.address=this.extract(A,this.consumeAddress)),this.attributes.rtcp=G}parseMsid(A){const G={id:this.extractOneOrMore(A,T,[1,64])};this.peekChar(A)===h&&(this.consumeAttributeSpace(A),G.appdata=this.extractOneOrMore(A,T,[1,64])),this.attributes.msids.push(G)}parseImageAttr(A){this.attributes.imageattr.push(A.attValue)}parseRid(A){const G=this.extractOneOrMore(A,Se=>O(Se)||E(Se)||Se==="_"||Se==="-");this.consumeAttributeSpace(A);const Y={id:G,direction:this.extract(A,this.consumeToken),params:[]};if(this.peekChar(A)===h){if(this.consumeAttributeSpace(A),this.peek(A,"pt=")){this.extract(A,this.consume,"pt=");const Se=[];for(;;){const mt=this.extract(A,this.consumeToken);Se.push(mt);try{this.extract(A,this.consume,",")}catch{break}}Y.payloads=Se,this.peekChar(A)===h&&this.extract(A,this.consume,h)}for(;;){const Se=this.extract(A,this.consumeToken);switch(Se){case"depend":{const mt={type:Se,rids:this.extract(A,this.consume,"=").split(",")};Y.params.push(mt);break}default:{const mt={type:Se};this.peekChar(A)==="="&&(this.extract(A,this.consume,"="),mt.val=this.extract(A,this.consumeTill,";")),Y.params.push(mt)}}try{this.extract(A,this.consume,";")}catch{break}}}this.attributes.rids.push(Y)}parseSimulcast(A){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=A.attValue,this.extract(A,this.consumeTill)}parseSctpPort(A){this.attributes.sctpPort=this.extractOneOrMore(A,E,[1,5])}parseMaxMessageSize(A){this.attributes.maxMessageSize=this.extractOneOrMore(A,E,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(A){this.attributes.mid=this.extract(A,this.consumeToken)}parseSSRCGroup(A){const G=this.extract(A,this.consumeToken),Y=[];for(;;)try{this.consumeAttributeSpace(A);const Se=this.extract(A,this.consumeInteger);Y.push(parseInt(Se,10))}catch{break}this.attributes.ssrcGroups.push({semantic:G,ssrcIds:Y})}}function ot(he,A,G){return A in he?Object.defineProperty(he,A,{value:G,enumerable:!0,configurable:!0,writable:!0}):he[A]=G,he}class Kt{constructor(){ot(this,"eol",u)}print(A,G){let Y="";return G&&(this.eol=G),Y+=this.printVersion(A.version),Y+=this.printOrigin(A.origin),Y+=this.printSessionName(A.sessionName),Y+=this.printInformation(A.information),Y+=this.printUri(A.uri),Y+=this.printEmail(A.emails),Y+=this.printPhone(A.phones),Y+=this.printConnection(A.connection),Y+=this.printBandwidth(A.bandwidths),Y+=this.printTimeFields(A.timeFields),Y+=this.printKey(A.key),Y+=this.printSessionAttributes(A.attributes),Y+=this.printMediaDescription(A.mediaDescriptions),Y}printVersion(A){return"v=".concat(A).concat(this.eol)}printOrigin(A){return"o=".concat(A.username," ").concat(A.sessId," ").concat(A.sessVersion," ").concat(A.nettype," ").concat(A.addrtype," ").concat(A.unicastAddress).concat(this.eol)}printSessionName(A){return A?"s=".concat(A).concat(this.eol):""}printInformation(A){return A?"i=".concat(A).concat(this.eol):""}printUri(A){return A?"u=".concat(A).concat(this.eol):""}printEmail(A){let G="";for(const Y of A)G+="e=".concat(Y).concat(this.eol);return G}printPhone(A){let G="";for(const Y of A)G+="e=".concat(Y).concat(this.eol);return G}printConnection(A){return A?"c=".concat(A.nettype," ").concat(A.addrtype," ").concat(A.address).concat(this.eol):""}printBandwidth(A){let G="";for(const Y of A)G+="b=".concat(Y.bwtype,":").concat(Y.bandwidth).concat(this.eol);return G}printTimeFields(A){let G="";for(const Y of A){G+="t=".concat(Y.time.startTime," ").concat(Y.time.startTime).concat(this.eol);for(const Se of Y.repeats)G+="r=".concat(Se.repeatInterval," ").concat(Se.typedTimes.join(" ")).concat(this.eol);Y.zoneAdjustments&&(G+="z=",G+="z=".concat(Y.zoneAdjustments.map(Se=>"".concat(Se.time," ").concat(Se.back?"-":""," ").concat(Se.typedTime)).join(" ")).concat(this.eol),G+=this.eol)}return G}printKey(A){return A?"k=".concat(A).concat(this.eol):""}printAttributes(A){let G="";for(const Y of A)G+="a=".concat(Y.attField).concat(Y.attValue?":".concat(Y.attValue):"").concat(this.eol);return G}printMediaDescription(A){let G="";for(const Y of A)G+=this.printMedia(Y.media),G+=this.printInformation(Y.information),G+=this.printConnections(Y.connections),G+=this.printBandwidth(Y.bandwidths),G+=this.printKey(Y.key),G+=this.printMediaAttributes(Y);return G}printConnections(A){let G="";for(const Y of A)G+=this.printConnection(Y);return G}printMedia(A){return"m=".concat(A.mediaType," ").concat(A.port," ").concat(A.protos.join("/")," ").concat(A.fmts.join(" ")).concat(this.eol)}printSessionAttributes(A){return new pr(this.eol).print(A)}printMediaAttributes(A){return new le(this.eol).print(A)}}class Yt{constructor(A){ot(this,"eol",void 0),this.eol=A}printIceUfrag(A){return A===void 0?"":"a=ice-ufrag:".concat(A).concat(this.eol)}printIcePwd(A){return A===void 0?"":"a=ice-pwd:".concat(A).concat(this.eol)}printIceOptions(A){return A===void 0?"":"a=ice-options:".concat(A.join(h)).concat(this.eol)}printFingerprints(A){return A.length>0?A.map(G=>"a=fingerprint:".concat(G.hashFunction).concat(h).concat(G.fingerprint)).join(this.eol)+this.eol:""}printExtmap(A){return A.map(G=>"a=extmap:".concat(G.entry).concat(G.direction?"/".concat(G.direction):"").concat(h).concat(G.extensionName).concat(G.extensionAttributes?"".concat(h).concat(G.extensionAttributes):"").concat(this.eol)).join("")}printSetup(A){return A===void 0?"":"a=setup:".concat(A).concat(this.eol)}printUnrecognized(A){return A.map(G=>"a=".concat(G.attField).concat(G.attValue?":".concat(G.attValue):"").concat(this.eol)).join("")}}class pr extends Yt{print(A){let G="";return G+=this.printGroups(A.groups),G+=this.printMsidSemantic(A.msidSemantic),G+=this.printIceLite(A.iceLite),G+=this.printIceUfrag(A.iceUfrag),G+=this.printIcePwd(A.icePwd),G+=this.printIceOptions(A.iceOptions),G+=this.printFingerprints(A.fingerprints),G+=this.printSetup(A.setup),G+=this.printTlsId(A.tlsId),G+=this.printIdentity(A.identities),G+=this.printExtmap(A.extmaps),G+=this.printUnrecognized(A.unrecognized),G}printGroups(A){let G="";return A.length>0&&(G+=A.map(Y=>"a=group:".concat(Y.semantic).concat(Y.identificationTag.map(Se=>"".concat(h).concat(Se)).join("")).concat(this.eol)).join("")),G}printIceLite(A){return A===void 0?"":"a=ice-lite"+this.eol}printTlsId(A){return A?"a=tls-id:".concat(A).concat(this.eol):""}printIdentity(A){return A.length===0?"":A.map(G=>"a=identity:".concat(G.assertionValue).concat(G.extensions.map(Y=>"".concat(h).concat(Y.name).concat(Y.value?"=".concat(Y.value):"")))).join(this.eol)+this.eol}printMsidSemantic(A){if(!A)return"";let G="a=msid-semantic:".concat(A.semantic);return A.applyForAll?G+="".concat(h,"*"):A.identifierList.length>0&&(G+=A.identifierList.map(Y=>"".concat(h).concat(Y))),G+this.eol}}class le extends Yt{print(A){const G=A.attributes;let Y="";return Y+=this.printRTCP(G.rtcp),Y+=this.printIceUfrag(G.iceUfrag),Y+=this.printIcePwd(G.icePwd),Y+=this.printIceOptions(G.iceOptions),Y+=this.printCandidates(G.candidates),Y+=this.printRemoteCandidatesList(G.remoteCandidatesList),Y+=this.printEndOfCandidates(G.endOfCandidates),Y+=this.printFingerprints(G.fingerprints),Y+=this.printSetup(G.setup),Y+=this.printMid(G.mid),Y+=this.printExtmap(G.extmaps),Y+=this.printRTPRelated(G),Y+=this.printPtime(G.ptime),Y+=this.printMaxPtime(G.maxPtime),Y+=this.printDirection(G.direction),Y+=this.printSSRCGroups(G.ssrcGroups),Y+=this.printSSRC(G.ssrcs),Y+=this.printRTCPMux(G.rtcpMux),Y+=this.printRTCPMuxOnly(G.rtcpMuxOnly),Y+=this.printRTCPRsize(G.rtcpRsize),Y+=this.printMSId(G.msids),Y+=this.printImageattr(G.imageattr),Y+=this.printRid(G.rids),Y+=this.printSimulcast(G.simulcast),Y+=this.printSCTPPort(G.sctpPort),Y+=this.printMaxMessageSize(G.maxMessageSize),Y+=this.printUnrecognized(G.unrecognized),Y}printCandidates(A){return A.map(G=>"a=candidate:".concat(G.foundation).concat(h).concat(G.componentId).concat(h).concat(G.transport).concat(h).concat(G.priority).concat(h).concat(G.connectionAddress).concat(h).concat(G.port).concat(h,"typ").concat(h).concat(G.type).concat(G.relAddr?"".concat(h,"raddr").concat(h).concat(G.relAddr):"").concat(G.relPort?"".concat(h,"rport").concat(h).concat(G.relPort):"").concat(Object.keys(G.extension).map(Y=>"".concat(h).concat(Y).concat(h).concat(G.extension[Y])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(A){return A.map(G=>"a=remote-candidates:".concat(G.join(h)).concat(this.eol)).join("")}printEndOfCandidates(A){return A===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(A){if(!A.payloads)return"";const G=A.payloads;let Y="";Y+=A.rtcpFeedbackWildcards.map(Se=>this.printRTCPFeedback("*",Se)).join("");for(const Se of G)Y+=this.printRtpMap(Se.payloadType,Se.rtpMap),Y+=this.printFmtp(Se.payloadType,Se.fmtp),Y+=Se.rtcpFeedbacks.map(mt=>this.printRTCPFeedback(Se.payloadType,mt)).join("");return Y}printFmtp(A,G){if(!G)return"";const Y=Object.keys(G.parameters);return Y.length===1&&G.parameters[Y[0]]===null?"a=fmtp:".concat(A).concat(h).concat(Y[0]).concat(this.eol):"a=fmtp:".concat(A).concat(h).concat(Object.keys(G.parameters).map(Se=>"".concat(Se,"=").concat(G.parameters[Se])).join(";")).concat(this.eol)}printRtpMap(A,G){return G?"a=rtpmap:".concat(A).concat(h).concat(G.encodingName,"/").concat(G.clockRate).concat(G.encodingParameters?"/".concat(G.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(A,G){let Y="a=rtcp-fb:".concat(A).concat(h),Se=G;return Se.type==="trr-int"?Y+="ttr-int".concat(h).concat(Se.interval):(Y+="".concat(Se.type),Se.parameter&&(Y+="".concat(h).concat(Se.parameter),Se.additional&&(Y+="".concat(h).concat(Se.additional)))),Y+this.eol}printPtime(A){return A===void 0?"":"a=ptime:".concat(A).concat(this.eol)}printMaxPtime(A){return A===void 0?"":"a=maxptime:".concat(A).concat(this.eol)}printDirection(A){return A===void 0?"":"a=".concat(A).concat(this.eol)}printSSRC(A){return A.map(G=>Object.keys(G.attributes).map(Y=>"a=ssrc:".concat(G.ssrcId.toString(10)).concat(h).concat(Y).concat(G.attributes[Y]?":".concat(G.attributes[Y]):"").concat(this.eol)).join("")).join("")}printRTCPMux(A){return A===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(A){return A===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(A){return A===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(A){if(A===void 0)return"";let G="a=rtcp:".concat(A.port);return A.netType&&(G+="".concat(h).concat(A.netType)),A.addressType&&(G+="".concat(h).concat(A.addressType)),A.address&&(G+="".concat(h).concat(A.address)),G+this.eol}printMSId(A){return A.map(G=>"a=msid:".concat(G.id).concat(G.appdata?"".concat(h).concat(G.appdata):"").concat(this.eol)).join("")}printImageattr(A){return A.map(G=>"a=imageattr:".concat(G).concat(this.eol)).join("")}printRid(A){return A.map(G=>{let Y="a=rid:".concat(G.id).concat(h).concat(G.direction);return G.payloads&&(Y+="".concat(h,"pt=").concat(G.payloads.join(","))),G.params.length>0&&(Y+="".concat(h).concat(G.params.map(Se=>Se.type==="depend"?"depend=".concat(Se.rids.join(",")):"".concat(Se.type,"=").concat(Se.val)).join(";"))),Y+this.eol}).join("")}printSimulcast(A){return A===void 0?"":"a=simulcast:".concat(A).concat(this.eol)}printSCTPPort(A){return A===void 0?"":"a=sctp-port:".concat(A).concat(this.eol)}printMaxMessageSize(A){return A===void 0?"":"a=max-message-size:".concat(A).concat(this.eol)}printMid(A){return A===void 0?"":"a=mid:".concat(A).concat(this.eol)}printSSRCGroups(A){return A.map(G=>"a=ssrc-group:".concat(G.semantic).concat(G.ssrcIds.map(Y=>"".concat(h).concat(Y.toString(10))).join("")).concat(this.eol)).join("")}}function Te(he){return new ue().parse(he)}function Ve(he,A){return new Kt().print(he,A)}}},t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}return n.d=(i,r)=>{for(var a in r)n.o(r,a)&&!n.o(i,a)&&Object.defineProperty(i,a,{enumerable:!0,get:r[a]})},n.o=(i,r)=>Object.prototype.hasOwnProperty.call(i,r),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function os(e){return HM.parse(e)}function Lu(e,t){return HM.print(e,t)}var fW=gs("Array","keys"),mW=Ro,_W=Hi,EW=oe,gW=fW,vI=Array.prototype,yW={DOMTokenList:!0,NodeList:!0},SW=function(e){var t=e.keys;return e===vI||EW(vI,e)&&t===vI.keys||_W(yW,mW(e))?gW:t},cs=v(SW);function Jn(e,t,n){return(t=function(i){var r=function(a,l){if(typeof a!="object"||!a)return a;var u=a[Symbol.toPrimitive];if(u!==void 0){var h=u.call(a,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(i);return typeof r=="symbol"?r:r+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function WM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function yt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?WM(Object(n),!0).forEach(function(i){Jn(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WM(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const YM=new class extends Wn{constructor(){super(...arguments),Jn(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class vW{constructor(t){Jn(this,"logger",void 0),Jn(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function TI(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function zM(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const va={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},WR=Date.now(),zy=e=>{for(const t in va)if(Object.prototype.hasOwnProperty.call(va,t)&&va[t]===e)return t;return"DEFAULT"},b=new class{constructor(){Jn(this,"proxyServerURL",void 0),Jn(this,"logLevel",va.DEBUG),Jn(this,"uploadState","collecting"),Jn(this,"uploadLogWaitingList",[]),Jn(this,"uploadLogUploadingList",[]),Jn(this,"uploadErrorCount",0),Jn(this,"currentLogID",0),Jn(this,"url",void 0),Jn(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[va.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[va.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[va.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[va.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[va.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){on("UPLOAD_LOG",!0)}disableLogUpload(){on("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new vW(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-WR<100)return void setTimeout(()=>{this.log(...t)},Date.now()-WR);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=TI()+" Agora-SDK [".concat(zy(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const r=TI()+" %cAgora-SDK [".concat(zy(i),"]:");let a=[];if(!U("USE_NEW_LOG"))switch(i){case va.DEBUG:a=[r,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,a);break;case va.INFO:a=[r,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,a);break;case va.WARNING:a=[r,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,a);break;case va.ERROR:a=[r,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-WR<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-WR);const i=Math.max(0,Math.min(4,t[0]));t[0]=TI()+" Agora-SDK [".concat(zy(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!U("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=zM()+" Agora-SDK [".concat(zy(e),"]:"):n[0]=zM()+" Agora-SDK [".concat(zy(e),"]:");let r="";n.forEach(a=>{typeof a=="object"&&(a=JSON.stringify(a)),r+="".concat(a," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Sa,process_id:U("PROCESS_ID"),payload:JSON.stringify(e)};return Yo(async()=>{const n=await Zr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(U("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(U("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:e.map(r=>r.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),YM.reportLogUploadError(i),!0},{timeout:U("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:U("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,U("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),U("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),U("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),U("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var KM;function TW(e){return Ki(e.reportId,"params.reportId",0,100,!1),Ki(e.category,"params.category",0,100,!1),Ki(e.event,"params.event",0,100,!1),Ki(e.label,"params.label",0,100,!1),un(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(KM={}).FREE="free",KM.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const RW={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Oi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Mn=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let bW=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function nt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,i){const r=i.value;if(typeof r=="function"){const a=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var l,u=arguments.length,h=new Array(u),f=0;f<u;f++)h[f]=arguments[f];let E=h;if(e.argsMap)try{E=e.argsMap(this,...h)}catch(S){b.warning(S),E=[]}try{JSON.stringify(E)}catch{b.warning("arguments for method ".concat(a,".").concat(String(n)," not serializable for apiInvoke.")),E=[]}const y=(e.report||He).reportApiInvoke(this._sessionId||null,{id:this._clientId||((l=this.store)===null||l===void 0?void 0:l.clientId)||this._ID,name:"".concat(a,".").concat(String(n)),options:E,tag:Vn.TRACER,reportResult:e.reportResult},e.throttleTime);try{const S=r.apply(this,h);return S instanceof Ne?S.then(T=>(y.onSuccess(e.reportResult&&T),T)).catch(T=>{throw y.onError(T),T}):(y.onSuccess(e.reportResult&&S),S)}catch(S){throw y.onError(S),S}}}return i}}const He=new class{constructor(){Jn(this,"baseInfoMap",new Map),Jn(this,"proxyServer",void 0),Jn(this,"eventUploadTimer",void 0),Jn(this,"setSessionIdTimer",void 0),Jn(this,"url",void 0),Jn(this,"sids",new Set),Jn(this,"backupUrl",void 0),Jn(this,"_appId",void 0),Jn(this,"_aid",0),Jn(this,"keyEventUploadPendingItems",[]),Jn(this,"normalEventUploadPendingItems",[]),Jn(this,"apiInvokeUploadPendingItems",[]),Jn(this,"apiInvokeCount",0),Jn(this,"apiInvokeLoggedCount",0),Jn(this,"ltsList",[]),Jn(this,"lastSendNormalEventTime",Date.now()),Jn(this,"customReportCounterTimer",void 0),Jn(this,"customReportCount",0),Jn(this,"extApiInvoke",async e=>{for(const t of e){const n=yt(yt({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Vn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),U("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),U("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,i]=t;return n+i}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const i=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,a=!!U("SHOW_REPORT_INVOKER_LOG"),l=!!U("SHOW_REPORT_USER_INVOKER_LOG"),u=a||l&&t.id;u&&(this.apiInvokeLoggedCount+=1);const h=this.apiInvokeLoggedCount;function f(T,k){if(u){let O="[apiInvoke-".concat(h,"]");if(t.id&&(O+="[".concat(t.id,"]")),t.name&&(O+="[".concat(t.name,"]"),t.name===si.JOIN))return b.info("".concat(O," ").concat(T));b.info("".concat(O," ").concat(T),T==="start"?t.options:k||"")}}const E=()=>({tag:t.tag,invokeId:r,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null});f("start");let y=!1;qi(t.timeout).then(()=>{y||(this.sendApiInvoke(yt(yt({},E()),{},{error:x.API_INVOKE_TIMEOUT,success:!1})),f("timeout"))});const S=new re(x.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:T=>{const k=()=>{if(y)throw S;return y=!0,this.sendApiInvoke(yt(yt({},E()),{},{success:!0},t.reportResult&&{result:T})),f("onSuccess"),T};return n?wM(k,t.name+"Success",n,()=>y=!0):k()},onError:T=>{const k=()=>{if(y)throw T;y=!0,this.sendApiInvoke(yt(yt({},E()),{},{success:!1,error:T})),f("onFailure",T.toString())};return n?wM(k,t.name+"Error",n,()=>y=!0):k()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),i=this.createBaseInfo(e,n);i.cname=t.cname;const r=Object.assign({},{willUploadConsoleLog:U("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:EI?"global":"oversea",areas:U("AREAS")&&U("AREAS").join(",")},t.extend),{stringUid:a,channelProfile:l,channelMode:u,isABTestSuccess:h,lsid:f,clientRole:E}=t,y=Date.now(),S=yt(yt({},i),{},{eventType:Oi.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:yI,lts:y,elapse:y-n,extend:JSON.stringify(r),mode:t.mode,process:U("PROCESS_ID"),appType:U("APP_TYPE"),success:!0,version:Sa,stringUid:a,channelProfile:l,channelMode:u,isABTestSuccess:h,lsid:f,clientType:Re(T=window.navigator.userAgent).call(T,"AgoraWebView")?42:20,clientRole:E,serviceId:U("PROCESS_ID"),extensionID:U("PLUGIN_INFO").join(",")||""});var T;this.send({type:Mn.SESSION,data:S},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),a=yt(yt({},i),{},{role:t.role,eventType:Oi.JOIN_CHOOSE_SERVER,lts:r,eventElapse:t.elapse||r-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:r-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:Mn.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),a=yt(yt({},i),{},{eventType:Oi.REQ_USER_ACCOUNT,lts:r,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||r-n.startTime,eventElapse:r-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Mn.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const r=Date.now(),{firstSuccess:a,addr:l,isProxy:u}=t,h=r-n.startTime,f=yt(yt({},i),{},{eventType:Oi.JOIN_GATEWAY,lts:r,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:h,eventElapse:r-t.lts,firstSuccess:a,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:_I(),isABTestSuccess:t.isABTestSuccess?1:0}),E=f.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=r),a)this.send({type:Mn.JOIN_GATEWAY,data:f},!0);else{let y;if(l)if(u){const T=l.match(/h=(\d{1,3}-){3}\d{1,3}/g),k=l.match(/p=[0-9]{1,6}/g);y={isSuccess:E,gatewayIp:T&&T.length?T[0].split("=")[1].replace(/-/g,"."):"",port:k&&k.length?k[0].split("=")[1]:"",isProxy:u?1:0}}else{const T=l.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),k=l.match(/(:|p=)[0-9]{1,6}/g);y={isSuccess:E,gatewayIp:T&&T.length?T[0].split("//")[1].replace(/-/g,"."):"",port:k&&k.length?k[0].split(/:|p=/g)[1]:"",isProxy:u?1:0}}else y={isSuccess:E,gatewayIp:"",port:"",isProxy:u?1:0};delete f.success,delete f.eventType,delete f.firstSuccess,f.vid=Number(f.vid);const S=Object.assign({},f,y,{eventType:Oi.REJOIN_GATEWAY});this.send({type:Mn.RE_JOIN_GATEWAY,data:S},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=Date.now(),r=yt(yt({},n.info),{},{lts:i,timeout:t,elapse:i-n.startTime});this.send({type:Mn.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),a=yt(yt({},i),{},{eventType:Oi.PUBLISH,lts:r,eventElapse:t.eventElapse,elapse:r-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Mn.PUBLISH,data:a},!0)}subscribe(e,t,n){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),l=yt(yt({},r),{},{eventType:Oi.SUBSCRIBE,lts:a,eventElapse:t.eventElapse,elapse:a-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?l.peerSuid=t.peerid:l.peer=t.peerid,this.send({type:Mn.SUBSCRIBE,data:l},!0)}wsCompressorInit(e){var t;const n=[...cs(t=this.baseInfoMap).call(t)],i=n.length?n[0]:"UnableToGetSid",r=this.baseInfoMap.get(i);if(!r)return;const a=r.info,l=Date.now(),u=yt(yt({},a),{},{eventType:Oi.WS_COMPRESSOR_INIT,lts:l,eventElapse:e.eventElapse,elapse:l-r.startTime,status:e.status?1:2});this.send({type:Mn.WS_COMPRESSOR_INIT,data:u},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),a=t.peerPubStatusMs-(n.lastJoinSuccessTime||r),l=yt(yt({},i),{},{elapse:r-n.startTime,eventType:Oi.XLA_PEER_FIRST_VIDEO_FRAME,lts:r,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:a,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>a?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:Mn.XLA_PEER_FIRST_VIDEO_FRAME,data:l},!0)}firstRemoteVideoDecode(e,t,n,i){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,l=Date.now(),u=yt(yt(yt({},a),i),{},{elapse:l-r.startTime,eventType:t,lts:l,firstDecodeFrame:Math.max((i.firstFrame||l)-r.startTime,0),apEnd:Math.max(i.apEnd-r.startTime,0),apStart:Math.max(i.apStart-r.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-r.startTime,0),joinGwStart:Math.max(i.joinGwStart-r.startTime,0),pcEnd:Math.max(i.pcEnd-r.startTime,0),pcStart:Math.max(i.pcStart-r.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-r.startTime,0),subscriberStart:Math.max(i.subscriberStart-r.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-r.startTime,0)});this.send({type:n,data:u},!0)}firstRemoteFrame(e,t,n,i){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,l=Date.now(),u=yt(yt(yt({},a),i),{},{elapse:l-r.startTime,eventType:t,lts:l});this.send({type:n,data:u},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),a=yt(yt(yt({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:Oi.AB_TEST,lts:r});this.send({type:Mn.AB_TEST,data:a},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),a=yt(yt(yt({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:Oi.PC_STATS,lts:r,preallocation:t.preallocation?1:0});this.send({type:Mn.PC_STATS,data:a},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),a=yt(yt(yt({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:Oi.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:Mn.UPDATE_REMOTE_RTPCAPABILITIES,data:a},!0)}}onGatewayStream(e,t,n,i){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,l=Date.now(),u=yt(yt(yt({},a),i),{},{eventType:t,lts:l});this.send({type:n,data:u},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),a=yt(yt({},i),{},{eventType:Oi.STREAM_SWITCH,lts:r,isDual:t.isdual,elapse:r-n.startTime,success:t.succ});this.send({type:Mn.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),a=yt(yt({},i),{},{eventType:Oi.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-t.lts,elapse:r-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Mn.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),a=yt(yt({},i),{},{eventType:Oi.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-t.lts,elapse:r-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Mn.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(e){this.proxyServer=e,e?b.debug("reportProxyServerurl: ".concat(e)):b.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),a=yt(yt({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:r,elapse:r-n.startTime,joinChannelSuccessElapse:r-(n.lastJoinSuccessTime||r),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Mn.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now();(function(a,l,u){const h=a[l];if(!h||typeof h!="string")return[a];a[l]="";const f=Jc(JSON.stringify(a));let E=0;const y=[];let S=0;for(let T=0;T<h.length;T++)S+=h.charCodeAt(T)<=127?1:3,S<=u-f||(y[y.length]=ge(ge({},a),{},{[l]:h.substring(E,T)}),E=T,S=h.charCodeAt(T)<=127?1:3);return E!==h.length-1&&(y[y.length]=ge(ge({},a),{},{[l]:h.substring(E)})),y})(yt(yt(yt({},i),t),{},{elapse:r-n.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(a=>this.send({type:Mn.WORKER_EVENT,data:a},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),a=yt(yt(yt({},i),t),{},{elapse:r-n.startTime,lts:r});this.send({type:Mn.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),a=yt(yt(yt({},i),t),{},{elapse:r-n.startTime,lts:r,extend:t.extend||void 0});this.send({type:Mn.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),a=yt(yt(yt({},i),t),{},{elapse:r-n.startTime,lts:r});this.send({type:Mn.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>U("CUSTOM_REPORT_LIMIT"))throw new re(x.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=t.map(r=>({type:Mn.USER_ANALYTICS,data:yt(yt({sid:e},r),{},{lts:n})}));try{U("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(r){throw b.error("send custom report message failed",r.toString()),new re(x.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(e){const t=U("NOT_REPORT_EVENT");if(e.tag&&Re(t)&&Re(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:r,cid:a}=n.info;let l;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof re){const{code:h,message:f}=e.error;l=h||f||e.error.toString()}else l=e.error.toString();const u={invokeId:e.invokeId,sid:e.sid,cname:i,cid:a,uid:r,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?l:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Mn.API_INVOKE,data:u},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>U("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],i=[];for(;e.length;){const a=e.shift();n.length<20?n.push(a):i.push(a)}e.push(...i);for(const a of[...n]){var r;this.ltsList.indexOf(a.data.lts)!==-1?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),gp(r=this.ltsList).call(r,(l,u)=>l-u))}return t||(this.lastSendNormalEventTime=Date.now()),U("ENABLE_EVENT_REPORT")&&n.length&&(U("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((a=>l=>{U("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(a):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(a),this.normalEventUploadPendingItems.length>U("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-U("NORMAL_EVENT_QUEUE_CAPACITY")),b.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){hi.networkState===ks.OFFLINE&&await Ne.race([hi.onlineWaiter,qi(2*_i.maxRetryTimeout)]);const t=r=>{let a=new Uint8Array;return r.forEach(l=>{const u=rI(JSON.stringify(l.data)),h=new ArrayBuffer(5),f=(y=>{let S=0;return Object.entries(Mn).forEach(T=>{let[k,O]=T;O===y.type&&(S=bW[k])}),S})(l),E=new DataView(h);E.setUint16(0,u.byteLength,!0),E.setUint8(2,255&f),E.setUint8(3,f>>>8&255),E.setUint8(4,f>>>16&255),a=EM(a,new Uint8Array(h)),a=EM(a,u)}),a},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(U("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let r=0;r<2;r+=1){r===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(U("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await uI(i,{timeout:1e4,data:t(e),headers:yt(yt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(a){if(r===1)throw a;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(u=>{const h=u&&u.data.sid&&this.baseInfoMap.get(u.data.sid);return h&&h.info.vid&&+h.info.vid||0})(e[0]),i=n?void 0:this._aid,r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(u=>JSON.stringify(u)),vid:n,aid:i};hi.networkState===ks.OFFLINE&&await Ne.race([hi.onlineWaiter,qi(2*_i.maxRetryTimeout)]);const a=t?"/events/proto-raws":"/events/messages";let l=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("EVENT_REPORT_DOMAIN"),"&p=").concat(U("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat(U("EVENT_REPORT_DOMAIN"),":").concat(U("STATS_COLLECTOR_PORT")).concat(a));for(let u=0;u<2;u+=1){u===1&&(l=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(U("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat(U("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(U("STATS_COLLECTOR_PORT")).concat(a)));try{t?await lW(l,{timeout:1e4,data:r}):await uI(l,{timeout:1e4,data:r})}catch(h){if(u===1)throw h;continue}return}}createBaseInfo(e,t){const n=Object.assign({},RW);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),i=n[n.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:Vn.TRACER}).onSuccess()}};YM.on("REPORT_LOG_UPLOAD",e=>{e.networkState=hi.networkState,He.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Vn.TRACER}).onSuccess("logUploadError")});class te extends re{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Jn(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,b)}throw(){super.throw(b)}}const Xi={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Bt(){return Xi}function qM(){return"setSinkId"in HTMLAudioElement.prototype&&(!U("RESTRICTION_SET_PLAYBACK_DEVICE")||(id()||sM())&&!tI())}function YR(){return!Xi.supportUnifiedPlan||U("CHROME_FORCE_PLAN_B")&&rd()}function RI(e){return!(qn()||aM(87)||YR()||!U("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||U("FORCE_DISABLE_AUTO_SUB")))}function XM(e){return!!U("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||U("FORCE_DISABLE_AUTO_SUB"))}let Ji=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function t_(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Gt(e,t,n,i,r){return{width:e,height:t,frameRate:n,bitrateMin:i,bitrateMax:r}}function no(e,t,n,i,r){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:i,bitrateMax:r}}function bI(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const CW={"90p":Gt(160,90),"90p_1":Gt(160,90),"120p":Gt(160,120,15,30,65),"120p_1":Gt(160,120,15,30,65),"120p_3":Gt(120,120,15,30,50),"120p_4":Gt(212,120),"180p":Gt(320,180,15,30,140),"180p_1":Gt(320,180,15,30,140),"180p_3":Gt(180,180,15,30,100),"180p_4":Gt(240,180,15,30,120),"240p":Gt(320,240,15,40,200),"240p_1":Gt(320,240,15,40,200),"240p_3":Gt(240,240,15,40,140),"240p_4":Gt(424,240,15,40,220),"360p":Gt(640,360,15,80,400),"360p_1":Gt(640,360,15,80,400),"360p_3":Gt(360,360,15,80,260),"360p_4":Gt(640,360,30,80,600),"360p_6":Gt(360,360,30,80,400),"360p_7":Gt(480,360,15,80,320),"360p_8":Gt(480,360,30,80,490),"360p_9":Gt(640,360,15,80,800),"360p_10":Gt(640,360,24,80,800),"360p_11":Gt(640,360,24,80,1e3),"480p":Gt(640,480,15,100,500),"480p_1":Gt(640,480,15,100,500),"480p_2":Gt(640,480,30,100,1e3),"480p_3":Gt(480,480,15,100,400),"480p_4":Gt(640,480,30,100,750),"480p_6":Gt(480,480,30,100,600),"480p_8":Gt(848,480,15,100,610),"480p_9":Gt(848,480,30,100,930),"480p_10":Gt(640,480,10,100,400),"720p":Gt(1280,720,15,120,1130),"720p_auto":Gt(1280,720,30,900,3e3),"720p_1":Gt(1280,720,15,120,1130),"720p_2":Gt(1280,720,30,120,2e3),"720p_3":Gt(1280,720,30,120,1710),"720p_5":Gt(960,720,15,120,910),"720p_6":Gt(960,720,30,120,1380),"1080p":Gt(1920,1080,15,120,2080),"1080p_1":Gt(1920,1080,15,120,2080),"1080p_2":Gt(1920,1080,30,120,3e3),"1080p_3":Gt(1920,1080,30,120,3150),"1080p_5":Gt(1920,1080,60,120,4780),"1440p":Gt(2560,1440,30,120,4850),"1440p_1":Gt(2560,1440,30,120,4850),"1440p_2":Gt(2560,1440,60,120,7350),"4k":Gt(3840,2160,30,120,8910),"4k_1":Gt(3840,2160,30,120,8910),"4k_3":Gt(3840,2160,60,120,13500)},wW={"480p":no(640,480,5),"480p_1":no(640,480,5),"480p_2":no(640,480,30),"480p_3":no(640,480,15),"720p":no(1280,720,5),"720p_auto":Gt(1280,720,30,900,3e3),"720p_1":no(1280,720,5),"720p_2":no(1280,720,30),"720p_3":no(1280,720,15),"1080p":no(1920,1080,5),"1080p_1":no(1920,1080,5),"1080p_2":no(1920,1080,30),"1080p_3":no(1920,1080,15)},AW={"1SL1TL":bI(1,1),"3SL3TL":bI(3,3),"2SL3TL":bI(2,3)};function io(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},CW[e]):e}function CI(e){return typeof e=="string"?Object.assign({},wW[e]):e}function zR(e){return typeof e=="string"?Object.assign({},AW[e]):e}const OW={speech_low_quality:t_(16e3,!1),speech_standard:t_(32e3,!1,18),music_standard:t_(48e3,!1),standard_stereo:t_(48e3,!0,56),high_quality:t_(48e3,!1,128),high_quality_stereo:t_(48e3,!0,192)};function KR(e){return typeof e=="string"?Object.assign({},OW[e]):e}const n_=[];function JM(e){return Ai(e,"mediaSource",["screen","window","application"]),!0}let je=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),hn=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),i_=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),IW=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),NW=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),Dp=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),r_=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Ta=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),s_=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Qs=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const wI={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},AI={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},ZM={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},DW={uplinkNetworkQuality:0,downlinkNetworkQuality:0},QM={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Vr=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),$s=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Ky=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),kp=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),lr=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Qc=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const OI={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let qR=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Mt(e,t,n,i,r){var a,l,u={};return Object.keys(i).forEach(function(h){u[h]=i[h]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=gr(a=Tc(l=n.slice()).call(l)).call(a,function(h,f){return f(e,t,h)||h},u),r&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(r):void 0,u.initializer=void 0),u.initializer===void 0?(Object.defineProperty(e,t,u),null):u}function $(e,t,n){return(t=function(i){var r=function(a,l){if(typeof a!="object"||!a)return a;var u=a[Symbol.toPrimitive];if(u!==void 0){var h=u.call(a,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(i);return typeof r=="symbol"?r:r+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Cn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$M(Object(n),!0).forEach(function(i){$(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$M(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class ex extends Wn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Dp.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),$(this,"trackMediaType",void 0),$(this,"_ID",void 0),$(this,"_rtpTransceiver",void 0),$(this,"_lowRtpTransceiver",void 0),$(this,"_hints",[]),$(this,"_isClosed",!1),$(this,"_originMediaStreamTrack",void 0),$(this,"mediaStreamTrack",void 0),$(this,"_external",{}),this._ID=n||yn(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(i){Re(n_).call(n_,i)||n_.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||ku(()=>{var n;He.reportApiInvoke(null,{name:si.GET_MEDIA_STREAM_TRACK,options:[],tag:Vn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===i_.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=n_.indexOf(t);n!==-1&&n_.splice(n,1)}(this),this.emit(r_.CLOSED),this.removeAllListeners(Dp.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===i_.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Dp.TRANSCEIVER_UPDATED,t,n)}}class a_ extends ex{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),$(this,"_enabled",!0),$(this,"_muted",!1),$(this,"_isExternalTrack",!1),$(this,"_isClosed",!1),$(this,"_enabledMutex",void 0),$(this,"processor",void 0),$(this,"_processorContext",void 0),$(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new cr("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,b.debug("[".concat(this.getTrackId(),"] close")),this.emit(je.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await gn(this,je.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){b.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(r_.TRACK_ENDED)}stateCheck(t,n){if(b.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),Wo(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new re(x.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",b);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new re(x.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",b)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Ne.resolve([])}}const tx=window.AudioContext||window.webkitAudioContext;let ea=null;const cn=new class extends Wn{constructor(){super(...arguments),$(this,"prevState",void 0),$(this,"curState",void 0),$(this,"currentTime",void 0),$(this,"currentTimeStuckAt",void 0),$(this,"interruptDetectorTrack",void 0),$(this,"onLocalAudioTrackMute",()=>{b.info("ios15-interruption-start"),this.emit(Ji.IOS_15_16_INTERRUPTION_START)}),$(this,"onLocalAudioTrackUnmute",async()=>{b.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?b.info("ios15-interruption-end-canceled"):(ea&&await ea.suspend(),this.emit(Ji.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){b.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){b.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function o_(){if(!ea){if(function(){if(!tx)return void b.error("your browser is not support web audio");b.info("create audio context");const e=Cn({},U("WEBAUDIO_INIT_OPTIONS"));b.debug("audio context init option:",JSON.stringify(e)),ea=new tx(e),cn.curState=ea.state,ea.onstatechange=()=>{cn.prevState=cn.curState,cn.curState=ea?ea.state:void 0;const{prevState:t,curState:n}=cn,i=n==="running",r=n==="interrupted",a=t==="running",l=t==="suspended",u=t==="interrupted",h=xt().osVersion;(vr()||eo())&&a&&r&&(b.info("ios".concat(h,"-interruption-start")),cn.emit(Ji.IOS_INTERRUPTION_START)),(vr()||eo())&&(l||u)&&i&&(b.info("ios".concat(h,"-interruption-end")),cn.emit(Ji.IOS_INTERRUPTION_END)),t!==n&&cn.emit(Ji.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=ea)===null||t===void 0?void 0:t.currentTime;cn.currentTime!==n?(cn.currentTimeStuckAt&&(b.debug("AudioContext current time resume at ".concat(n)),cn.currentTimeStuckAt=void 0),cn.currentTime=n):(n!==cn.currentTimeStuckAt&&(He.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Vn.TRACER}).onSuccess(),b.warning("AudioContext current time stuck at ".concat(n))),cn.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,r=!1,a=!1,l=!1;function u(O){t.state==="running"?h(!1):vr()||eo()?t.state==="suspended"&&(h(!0),O&&t.resume().then(f,f)):t.state!=="closed"&&(h(!0),O&&t.resume().then(f,f))}function h(O){if(r!==O){r=O;for(let I=0,M=n;I<M.length;I+=1){const L=M[I];O?window.addEventListener(L,E,{capture:!0,passive:!0}):window.removeEventListener(L,E,{capture:!0,passive:!0})}}}function f(){u(!1)}function E(){u(!0)}function y(O){if(!l)if(i.paused)if(O){let I;S(!1),l=!0;try{I=i.play(),I?I.then(T,T):(i.addEventListener("playing",T),i.addEventListener("abort",T),i.addEventListener("error",T))}catch{T()}}else S(!0);else S(!1)}function S(O){if(a!==O){a=O;for(let I=0,M=n;I<M.length;I++){const L=M[I];O?window.addEventListener(L,k,{capture:!0,passive:!0}):window.removeEventListener(L,k,{capture:!0,passive:!0})}}}function T(){i.removeEventListener("playing",T),i.removeEventListener("abort",T),i.removeEventListener("error",T),l=!1,y(!1)}function k(){y(!0)}if(vr()){const O=t.createMediaStreamDestination(),I=document.createElement("div");I.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=I.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=O.stream,y(!0)}cn.on(Ji.STATE_CHANGE,function(){u(!0)}),u(!1)}(ea)}(),!ea)throw new re(x.NOT_SUPPORTED,"can not create audio context");return ea}return ea}function Pp(e){if(function(){if(II!==null)return II;const i=o_(),r=i.createBufferSource(),a=i.createGain(),l=i.createGain();r.connect(a),r.connect(l),r.disconnect(a);let u=!1;try{r.disconnect(a)}catch{u=!0}return r.disconnect(),II=u,u}())return;const t=e.connect,n=e.disconnect;e.connect=(i,r,a)=>{var l;return e._inputNodes||(e._inputNodes=[]),Re(l=e._inputNodes).call(l,i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,r,a)):t.call(e,i,r)),e},e.disconnect=(i,r,a)=>{n.call(e),i?UR(e._inputNodes,i):e._inputNodes=[];for(const l of e._inputNodes)t.call(e,l)}}let II=null;function NI(e,t){let n=!1;const i=1/t;if(U("DISABLE_WEBAUDIO")){const r=window.setInterval(()=>{n?window.clearInterval(r):e(performance.now()/1e3)},1e3*i)}else{const r=o_();let a=r.createGain();a.gain.value=0,a.connect(r.destination);const l=()=>{if(n)return void(a=null);const u=r.createOscillator();u.onended=l,u.connect(a),u.start(0),u.stop(r.currentTime+i),e(r.currentTime)};l()}return()=>{n=!0}}class nx{constructor(){$(this,"context",void 0),$(this,"analyserNode",void 0),$(this,"sourceNode",void 0),this.context=o_(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||vr()||eo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let r=0;r<t.length;++r)t[r]=i[r]/128-1}const n=gr(t).call(t,(i,r)=>i+r*r,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{b.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class ix extends Wn{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),$(this,"outputNode",void 0),$(this,"outputTrack",void 0),$(this,"isPlayed",!1),$(this,"sourceNode",void 0),$(this,"context",void 0),$(this,"audioBufferNode",void 0),$(this,"destNode",void 0),$(this,"audioOutputLevel",0),$(this,"volumeLevelAnalyser",void 0),$(this,"_processedNode",void 0),$(this,"playNode",void 0),$(this,"isDestroyed",!1),$(this,"onNoAudioInput",void 0),$(this,"isNoAudioInput",!1),$(this,"_noAudioInputCount",0),this.context=o_(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Pp(this.outputNode),this.volumeLevelAnalyser=new nx}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Qs.ON_AUDIO_BUFFER,function(i){for(let r=0;r<i.outputBuffer.numberOfChannels;r+=1){const a=i.outputBuffer.getChannelData(r);for(let l=0;l<a.length;l+=1)a[l]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Bt().webAudioMediaStreamDest)throw new re(x.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&VR(()=>{cn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;vr()||eo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let r=!1;for(let a=0;a<i.length;a++)i[a]!==0&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await qi(200),await this.checkHasAudioInput(t?t+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class rx extends ix{get isFreeze(){return!1}constructor(t,n,i){var r;if(super(),$(this,"sourceNode",void 0),$(this,"track",void 0),$(this,"clonedTrack",void 0),$(this,"audioElement",void 0),$(this,"isCurrentTrackCloned",!1),$(this,"isRemoteTrack",!1),$(this,"originVolumeLevelAnalyser",void 0),$(this,"rebuildWebAudio",async()=>{if(b.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void b.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>b.info("resume success")),b.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const u=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?u.stop():this.isCurrentTrackCloned=!0;const h=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(h),Pp(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const f=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(f,this.context.currentTime),Pp(this.outputNode),this.emit(Qs.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=h,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new re(x.UNEXPECTED_ERROR);this.track=t;const a=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(a),Pp(this.sourceNode),i){const u=i.clone();u.enabled=!0,this.clonedTrack=u,b.debug("create an unmuted track ".concat(u.id," from the original track ").concat(i.id," to get the volume"));const h=this.context.createMediaStreamSource(new MediaStream([u]));Pp(h),this.originVolumeLevelAnalyser=new nx,this.originVolumeLevelAnalyser.updateSource(h)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=a;const l=xt();n&&l.os===Di.IOS&&Number((r=l.osVersion)===null||r===void 0?void 0:r.split(".")[0])<15&&(cn.on(Ji.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(u=>{u||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Pp(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Qs.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),cn.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),b.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));Pp(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function sx(e,t,n){const i=(a,l)=>a?typeof a!="number"?a.max||a.exact||a.ideal||a.min||l:a:l,r={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(r.video.mandatory.maxFrameRate=t.frameRate.max,r.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(r.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function kW(e,t){const n=await ax(e.mediaSource),{sourceId:i,audio:r}=await function(a){let l=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Ne((u,h)=>{const f=document.createElement("div");f.innerText="share screen",f.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const y=document.createElement("div");y.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",y.setAttribute("style","height: 12%;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const T=document.createElement("div");T.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const k=document.createElement("button");k.innerHTML="cancel",k.setAttribute("style","width: 85px;"),k.onclick=()=>{document.body.removeChild(M);const L=new Error("NotAllowedError");L.name="NotAllowedError",h(L)};let O=l;const I=document.createElement("div");if(l){const L=document.createElement("input");L.setAttribute("type","checkbox");const j=document.createElement("span");L.setAttribute("style","margin-right: 6px;"),j.innerText="Share audio",L.checked=O,L.onchange=()=>{O=L.checked},I.appendChild(L),I.appendChild(j)}T.appendChild(I),T.appendChild(k),E.appendChild(y),E.appendChild(S),E.appendChild(T);const M=document.createElement("div");M.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),M.appendChild(f),M.appendChild(E),document.body.appendChild(M),a.map(L=>{if(L.id){const j=document.createElement("div");j.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let K=L.thumbnail;try{const{width:z}=K.getSize();z>1920&&(K=K.resize({width:1920}))}catch(z){throw z&&z.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),z}j.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+K.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+L.name.replace(/[\u00A0-\u9999<>\&]/g,function(z){return"&#"+z.charCodeAt(0)+";"})+"</span>",j.onclick=()=>{document.body.removeChild(M),u({sourceId:L.id,audio:O})},S.appendChild(j)}})})}(n,t);return await sx(i,e,r)}async function ax(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=gM();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new re(x.ELECTRON_IS_NULL);let i=null;try{var r;i=((r=n.desktopCapturer)===null||r===void 0?void 0:r.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new Ne((a,l)=>{n.desktopCapturer.getSources({types:t},(u,h)=>{u?l(u):a(h)})}));try{return await i}catch(a){throw new re(x.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,a.toString())}}const DI=new cr("safari");let ox=!1,cx=!1;async function ta(e,t){let n=0,i=null;for(;n<2;)try{i=await PW(e,t,n>0);break}catch(r){if(r instanceof re)throw b.error("[".concat(t,"] ").concat(r.toString())),r;const a=XR(r.name||r.code||r,r.message);if(a.code===x.MEDIA_OPTION_INVALID){b.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await qi(500);continue}throw b.error("[".concat(t,"] ").concat(a.toString())),a}if(!i)throw new re(x.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function PW(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new re(x.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=Bt(),r=new MediaStream;if(e.audioSource&&r.addTrack(e.audioSource),e.videoSource&&r.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return b.debug("Using Video Source/ Audio Source"),r;if(e.screen)if(gM())e.screen.sourceId?c_(r,await sx(e.screen.sourceId,e.screen,!!e.screenAudio)):c_(r,await kW(e.screen,!!e.screenAudio));else if(id()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new re(x.NOT_SUPPORTED,"This browser does not support screen sharing");b.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const S=await(l=e.screen.extensionId,u=t,new Ne((T,k)=>{try{chrome.runtime.sendMessage(l,{getStream:!0},O=>{if(!O||!O.streamId)return b.error("[".concat(u,"] No response from Chrome Plugin. Plugin not installed properly"),O),void k(new re(x.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(O.streamId)})}catch(O){b.error("[".concat(u,"] AgoraRTC screensharing plugin is not accessible(").concat(l,")"),O.toString()),k(new re(x.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=S,c_(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var a;e.screen.mediaSource&&JM(e.screen.mediaSource);const S={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(a=e.screen.displaySurface)!==null&&a!==void 0?a:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:T,surfaceSwitching:k,systemAudio:O,preferCurrentTab:I}=e.screen,M={selfBrowserSurface:T,surfaceSwitching:k,systemAudio:O,preferCurrentTab:I};!T&&delete M.selfBrowserSurface,!k&&delete M.surfaceSwitching,!O&&delete M.systemAudio,!I&&delete M.preferCurrentTab,b.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:S,audio:e.screenAudio,controls:M})),c_(r,await navigator.mediaDevices.getDisplayMedia(Cn({video:S,audio:e.screenAudio},M)))}else{if(!qn())throw b.error("[".concat(t,"] This browser does not support screenSharing")),new re(x.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&JM(e.screen.mediaSource);const S={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};b.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(S))),c_(r,await navigator.mediaDevices.getUserMedia(S))}}var l,u;if(!e.video&&!e.audio)return r;let h={video:e.video,audio:e.audio},f=U("MEDIA_DEVICE_CONSTRAINTS");if(f)try{typeof f=="string"&&(f=JSON.parse(f)),h=oI(h,f)}catch{}b.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(h)),xt();let E,y=null;(er()||vr()||MR())&&(y=await DI.lock());try{E=await navigator.mediaDevices.getUserMedia(h)}catch(S){throw y&&y(),S}return h.audio&&(ox=!0),h.video&&(cx=!0),c_(r,E),y&&y(),r}function XR(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new re(x.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new re(x.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new re(x.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new re(x.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new re(x.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new re(x.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return b.error("getUserMedia unexpected error",e),new re(x.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function c_(e,t){const n=e.getVideoTracks()[0],i=e.getAudioTracks()[0],r=t.getVideoTracks()[0],a=t.getAudioTracks()[0];a&&(i&&e.removeTrack(i),e.addTrack(a)),r&&(n&&e.removeTrack(n),e.addTrack(r))}const na=new class extends Wn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(kp.STATE_CHANGE,e),this._state=e)}constructor(){super(),$(this,"_state",Ky.IDLE),$(this,"isAccessMicrophonePermission",!1),$(this,"isAccessCameraPermission",!1),$(this,"lastAccessMicrophonePermission",!1),$(this,"lastAccessCameraPermission",!1),$(this,"checkdeviceMatched",!1),$(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(U("ENUMERATE_DEVICES_INTERVAL")||(xR()||LR()===Di.HARMONY_OS)&&rd())&&this.updateDevicesInfo()},U("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>b.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new re(x.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(i);let a=!this.isAccessMicrophonePermission&&e,l=!this.isAccessCameraPermission&&t;r.audio&&(a=!1),r.video&&(l=!1);let u=null,h=null,f=null;if(!n&&(a||l)){if(DI.isLocked&&(b.debug("[device manager] wait GUM lock"),(await DI.lock())(),b.debug("[device manager] GUM unlock")),ox&&(a=!1,this.isAccessMicrophonePermission=!0),cx&&(l=!1,this.isAccessCameraPermission=!0),b.debug("[device manager] check media device permissions",e,t,a,l),a&&l){try{f=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(E){const y=XR(E.name||E.code||E,E.message);if(y.code===x.PERMISSION_DENIED)throw y;b.warning("getUserMedia failed in getDevices",y)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(a){try{u=await navigator.mediaDevices.getUserMedia({audio:e})}catch(E){const y=XR(E.name||E.code||E,E.message);if(y.code===x.PERMISSION_DENIED)throw y;b.warning("getUserMedia failed in getDevices",y)}this.isAccessMicrophonePermission=!0}else if(l){try{h=await navigator.mediaDevices.getUserMedia({video:t})}catch(E){const y=XR(E.name||E.code||E,E.message);if(y.code===x.PERMISSION_DENIED)throw y;b.warning("getUserMedia failed in getDevices",y)}this.isAccessCameraPermission=!0}b.debug("[device manager] mic permission",e,"cam permission",t)}try{const E=await navigator.mediaDevices.enumerateDevices();return u&&u.getTracks().forEach(y=>y.stop()),h&&h.getTracks().forEach(y=>y.stop()),f&&f.getTracks().forEach(y=>y.stop()),u=null,h=null,f=null,E}catch(E){return u&&u.getTracks().forEach(y=>y.stop()),h&&h.getTracks().forEach(y=>y.stop()),f&&f.getTracks().forEach(y=>y.stop()),u=null,h=null,f=null,new re(x.ENUMERATE_DEVICES_FAILED,E.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new re(x.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Ky.INITING;try{await this.updateDevicesInfo(),this.state=Ky.INITEND}catch(e){throw b.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Ky.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new re(x.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const r=e.find(l=>l.kind==="audioinput"&&l.deviceId==="default"),a=e.find(l=>l.kind==="audiooutput"&&l.deviceId==="default");r&&a?a.groupId===r.groupId?b.debug("[device-check] default input ".concat(r.label," and output ").concat(a.label," is the same group")):b.debug("[device-check] default input ".concat(r.label," and output ").concat(a.label," is not the same group")):b.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(r=>{if(!r.deviceId)return;const a=this.deviceInfoMap.get("".concat(r.kind,"_").concat(r.deviceId));if((a?a.state:"INACTIVE")!=="ACTIVE"){const l={initAt:t,updateAt:t,device:r,state:"ACTIVE"};this.deviceInfoMap.set("".concat(r.kind,"_").concat(r.deviceId),l),n.push(l)}a&&(a.updateAt=t)}),this.deviceInfoMap.forEach((r,a)=>{r.state==="ACTIVE"&&r.updateAt!==t&&(r.state="INACTIVE",n.push(r))}),this.state!==Ky.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(r=>{switch(r.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(kp.RECORDING_DEVICE_CHANGED,r);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(kp.CAMERA_DEVICE_CHANGED,r);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(kp.PLAYOUT_DEVICE_CHANGED,r)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(r=>r.kind==="audioinput"),n=e.filter(r=>r.kind==="videoinput"),i={audio:!1,video:!1};for(const r of t)if(r.label&&r.deviceId){i.audio=!0;break}for(const r of n)if(r.label&&r.deviceId){i.video=!0;break}return i}};let kI=!1;const ia=new class extends Wn{constructor(){super(...arguments),$(this,"onAutoplayFailed",void 0),$(this,"onAudioAutoplayFailed",void 0)}};function lx(){if(xt(),!kI){const e=t=>{t.preventDefault(),kI=!1,Uy()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};kI=!0,Uy()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),b.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ia.onAutoplayFailed?ia.onAutoplayFailed():ia.onAudioAutoplayFailed?b.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):b.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ia.emit("autoplay-failed")}}function dx(e,t,n,i){if(!e)return;const r=He.getBaseInfoBySessionId(e);if(!r)return;const a=r.info,l=Date.now(),u=Cn(Cn({},a),{},{vid:a.vid===void 0?0:Number(a.vid),lts:l,elapse:l-r.startTime,cbRegistered:ia.onAutoplayFailed||ia.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:i,extend:void 0});He.send({type:Mn.AUTOPLAY_FAILED,data:u},!0)}const LW=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Qr=new class{constructor(){$(this,"onAutoplayFailed",void 0),$(this,"elementMap",new Map),$(this,"elementStateMap",new Map),$(this,"elementsNeedToResume",[]),$(this,"sinkIdMap",new Map),$(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,i]=t;const r=this.elementStateMap.get(n),a=i.srcObject.getAudioTracks()[0],l=a&&a.readyState;if(b.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(l," ").concat(e)),l==="live"){if(e)return i.pause(),void i.play();if(cn.curState==="running")return qm()?(i.pause(),void i.play()):void(r&&r==="paused"&&i.play())}})}),$(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(b.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),cn.on(Ji.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),cn.on(Ji.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),cn.on(Ji.STATE_CHANGE,()=>{vr()&&cn.prevState==="suspended"&&cn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(i){throw new re(x.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,n,i){if(this.elementMap.has(t))return;const r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,r),this.elementMap.set(t,r),this.elementStateMap.set(t,lr.INIT),this.setVolume(t,n);const a=this.sinkIdMap.get(t);if(a)try{r.setSinkId(a).catch(u=>{b.warning("[".concat(t,"] set sink id failed"),u.toString())})}catch(u){b.warning("[".concat(t,"] set sink id failed"),u.toString())}const l=r.play();l&&l.then&&l.catch(u=>{i&&dx(i,"audio",u.message,t),b.warning("audio element play warning",u.toString()),this.elementMap.has(t)&&u.name==="NotAllowedError"&&(b.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),VR(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),lx()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){LW.forEach(n=>{t.addEventListener(n,i=>{const r=this.elementStateMap.get(e),a=i.type==="pause"?"paused":i.type;if(b.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(a)),i.type==="error"){const l=t==null?void 0:t.error;l&&b.error("[".concat(e,"] media error, code: ").concat(l.code,", message: ").concat(l.message))}this.elementStateMap.set(e,a)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{b.debug("Auto resume audio element success")}).catch(n=>{b.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new Ne(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Uy()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function ti(){return function(e,t,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new re(x.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",b);for(var r=arguments.length,a=new Array(r),l=0;l<r;l++)a[l]=arguments[l];const u=i.apply(this,a);return u instanceof Ne?new Ne((h,f)=>{u.then(h).catch(f)}):u}),n}}class ux extends Wn{constructor(t){super(),$(this,"name","VideoProcessorDestination"),$(this,"ID","0"),$(this,"_source",void 0),$(this,"videoContext",void 0),$(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new re(x.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new re(x.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Vr.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Vr.ON_TRACK,void 0)}}class hx extends Wn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),$(this,"constraintsMap",new Map),$(this,"statsRegistry",[]),$(this,"usageRegistry",[]),$(this,"trackId",void 0),$(this,"direction",void 0),$(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await nr(this,$s.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var i;return b.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),gn(this,$s.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ir(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return b.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),gn(this,$s.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ir(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:r,cb:a}of this.statsRegistry)try{const l=a();t.push({processorID:n,processorName:i,type:r,stats:l})}catch(l){b.error(new re(x.UNEXPECTED_ERROR,l.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof Ne&&(i=await i),t.push(Cn(Cn({},i),{},{direction:this.direction}))}catch(i){b.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class px extends Wn{constructor(t){super(),$(this,"name","AudioProcessorDestination"),$(this,"ID","0"),$(this,"inputTrack",void 0),$(this,"inputNode",void 0),$(this,"audioProcessorContext",void 0),$(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new re(x.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new re(x.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Vr.ON_TRACK,void 0),this.emit(Vr.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Vr.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Vr.ON_NODE,this.inputNode))}}class fx extends Wn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,i){super(),$(this,"constraintsMap",new Map),$(this,"statsRegistry",[]),$(this,"audioContext",void 0),$(this,"trackId",void 0),$(this,"direction",void 0),$(this,"usageRegistry",[]),$(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=i}async getConstraints(){return nr(this,$s.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var i;return b.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),gn(this,$s.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ir(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),gn(this,$s.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ir(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:r,cb:a}of this.statsRegistry)try{const l=a();t.push({processorID:n,processorName:i,type:r,stats:l})}catch(l){b.error(new re(x.UNEXPECTED_ERROR,l.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof Ne&&(i=await i),t.push(Cn(Cn({},i),{},{direction:this.direction}))}catch(i){b.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class PI extends Wn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),$(this,"context",void 0),$(this,"processSourceNode",void 0),$(this,"outputTrack",void 0),$(this,"processedNode",void 0),$(this,"clonedTrack",void 0),$(this,"outputNode",void 0),this.outputNode=new MW}setVolume(){}createOutputTrack(){throw new re(x.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class MW{disconnect(){}connect(){}}function mx(e){return new Ne((t,n)=>{let i=!1;const r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);const a=vr()?"canplay":"playing";r.addEventListener(a,()=>{const l=r.videoWidth,u=r.videoHeight;!l&&qn()||(i=!0,r.srcObject=null,r.remove(),t([l,u]))}),r.srcObject=new MediaStream([e]),r.play().catch(jR),setTimeout(()=>{i||(r.srcObject=null,r.remove(),t([r.videoWidth,r.videoHeight]))},4e3)})}function JR(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=io(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!pM()&&n.frameRate&&(t.frameRate=n.frameRate),sM()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),qn()&&(t.frameRate={ideal:30,max:30}),t}function _x(e){const t={};return pM()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,id()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function Ex(e){const t=_x(e);if(e.encoderConfig){const n=KR(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),xR()&&(t.sampleRate=void 0),t}const xW=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:i,height:r}=e.getMediaStreamTrackSettings();let{frameRate:a=n,width:l=i,height:u=r}=t;if(!a||!l||!u)return;l=Zm(l),u=Zm(u),a=Zm(a);const{max:h,min:f}=function(T,k,O){const I=200*Math.pow(O/15,.6)*Math.pow(T*k/640/360,.75);return{min:Math.floor(I),max:Math.floor(4*I)}}(l,u,a),{bitrateMax:E,bitrateMin:y}=t||{};E||b.debug("calculate bitrate: [w: ".concat(l,", h: ").concat(u,", fps: ").concat(a,"] => [brMax: ").concat(E,", brMin: ").concat(y,"]"));const{maxFramerate:S}=U("ENCODER_CONFIG_LIMIT");return S&&typeof S=="number"&&(a=Math.min(a,S)),{frameRate:a,bitrateMax:E||h,bitrateMin:y||f,scaleResolutionDownBy:1,scale:0}},gx=async(e,t,n)=>await(async(i,r,a)=>{const l=function(f){const E=[];for(let y=0;y<f.length;y+=2)E.push(parseInt(f.slice(y,y+2),16));return Uint8Array.from(E)}(IM(""+r+a)).slice(0,16),u=l.slice(0,12),h=await window.crypto.subtle.importKey("raw",l,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:u},h,i))})(e.buffer,t,n),LI=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Ne((n,i)=>{t.toBlob(async r=>{if(t.remove(),r){const a=await yx(r);n({buffer:a,width:t.width,height:t.height})}else i(new re(x.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},yx=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var Sx,vx,Tx,Rx,bx,Cx,wx,Ax,Ox,Ix,Nx,Dx,kx,Px,Lx,Mx,xx,Ux,Yn,Vx,jx,Fx,Bx,Gx,Hx,$c,Wx,Yx,zx,Kx,qx,Xx,Jx,Zx,Qx,$x,eU,tU,nU,rr;let ni=(Sx=nt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),vx=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),Tx=ti(),Rx=Qm("LocalAudioTrack","_enabledMutex"),bx=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),Cx=ti(),wx=Qm("LocalAudioTrack","_enabledMutex"),Ax=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),Ox=ti(),Ix=ti(),Nx=ti(),Dx=nt({argsMap:e=>[e.getTrackId()]}),kx=ti(),Px=nt({argsMap:e=>[e.getTrackId()]}),Lx=ti(),Mx=nt({argsMap:e=>[e.getTrackId()]}),xx=nt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Ux=nt({argsMap:e=>[e.getTrackId()]}),Mt((Yn=class extends a_{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Qr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,i){super(e,n),$(this,"trackMediaType",s_.AUDIO),$(this,"_encoderConfig",void 0),$(this,"_trackSource",void 0),$(this,"metadata",[]),$(this,"_enabled",!0),$(this,"_volume",100),$(this,"_useAudioElement",!0),$(this,"_bypassWebAudio",!1),$(this,"processor",void 0),$(this,"_processorContext",void 0),$(this,"_processorDestination",void 0),$(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new PI,U("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),U("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),er()&&!ea?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){un(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Qr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void b.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,gn(this,je.NEED_REPLACE_TRACK,this).then(()=>{b.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{b.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!qM())throw new re(x.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Qr.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await gn(this,je.NEED_ENABLE_TRACK,this),b.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw n||(this._enabled=!1),b.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await gn(this,je.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),b.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,b.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await gn(this,je.NEED_MUTE_TRACK,this):await gn(this,je.NEED_UNMUTE_TRACK,this))}getStats(){return ku(()=>{b.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Js(this,je.GET_STATS)||Cn({},wI)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Qs.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Qs.ON_AUDIO_BUFFER),this._source.on(Qs.ON_AUDIO_BUFFER,n=>e(n))}play(){b.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(b.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Qr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){b.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Qr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];b.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Qr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await gn(this,je.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Ne.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new re(x.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new re(x.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Vr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await gn(this,je.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await gn(this,je.NEED_REPLACE_TRACK,this))}),e.on(Vr.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Vr.ON_TRACK),e.removeAllListeners(Vr.ON_NODE)}bindProcessorContextEvents(e){e.on($s.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners($s.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof PI&&(this._trackSource=new rx(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new fx(this._source.context,this.getTrackId(),"local"),t=new px(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Qs.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Qr.stop(this.getTrackId()),this._source.play()),gn(this,je.NEED_REPLACE_MIXING_TRACK,this).then(()=>{b.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{b.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[Sx],Object.getOwnPropertyDescriptor(Yn.prototype,"setVolume"),Yn.prototype),Mt(Yn.prototype,"setPlaybackDevice",[vx,Tx],Object.getOwnPropertyDescriptor(Yn.prototype,"setPlaybackDevice"),Yn.prototype),Mt(Yn.prototype,"setEnabled",[Rx,bx,Cx],Object.getOwnPropertyDescriptor(Yn.prototype,"setEnabled"),Yn.prototype),Mt(Yn.prototype,"setMuted",[wx,Ax,Ox],Object.getOwnPropertyDescriptor(Yn.prototype,"setMuted"),Yn.prototype),Mt(Yn.prototype,"getStats",[Ix],Object.getOwnPropertyDescriptor(Yn.prototype,"getStats"),Yn.prototype),Mt(Yn.prototype,"setAudioFrameCallback",[Nx],Object.getOwnPropertyDescriptor(Yn.prototype,"setAudioFrameCallback"),Yn.prototype),Mt(Yn.prototype,"play",[Dx,kx],Object.getOwnPropertyDescriptor(Yn.prototype,"play"),Yn.prototype),Mt(Yn.prototype,"stop",[Px,Lx],Object.getOwnPropertyDescriptor(Yn.prototype,"stop"),Yn.prototype),Mt(Yn.prototype,"close",[Mx],Object.getOwnPropertyDescriptor(Yn.prototype,"close"),Yn.prototype),Mt(Yn.prototype,"pipe",[xx],Object.getOwnPropertyDescriptor(Yn.prototype,"pipe"),Yn.prototype),Mt(Yn.prototype,"unpipe",[Ux],Object.getOwnPropertyDescriptor(Yn.prototype,"unpipe"),Yn.prototype),Yn),qy=(Vx=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),jx=ti(),Fx=Qm("MicrophoneAudioTrack","_enabledMutex"),Bx=nt({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),Gx=ti(),Hx=nt({argsMap:e=>[e.getTrackId()]}),Mt(($c=class extends ni{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,i){super(e,t.encoderConfig?KR(t.encoderConfig):{},i,U("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),$(this,"_config",void 0),$(this,"_deviceName","default"),$(this,"_constraints",void 0),$(this,"_originalConstraints",void 0),$(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(qm()||eI())&&cn.bindInterruptDetectorTrack(this)}async setDevice(e){if(b.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await na.getDeviceById(e),n={};n.audio=Cn({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await ta(n,this.getTrackId())}catch(r){throw b.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),i=await ta({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await na.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}b.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return b.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),e),U("AUTO_RESET_AUDIO_ROUTE")&&(vr()||eo())){const l=navigator.audioSession;l&&(e||(l.type="playback"),l.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await gn(this,je.NEED_DISABLE_TRACK,this)}catch(l){throw b.error("[".concat(this.getTrackId(),"] setEnabled false failed"),l.toString()),l}return}const r=Cn({},this._constraints),a=na.searchDeviceIdByName(this._deviceName);a&&!r.deviceId&&(r.deviceId=a);try{n||(this._enabled=!0);const l=await ta({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),await gn(this,je.NEED_ENABLE_TRACK,this)}catch(l){throw n||(this._enabled=!1),b.error("[".concat(this.getTrackId(),"] setEnabled true failed"),l.toString()),l}b.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(qm()||eI())&&cn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((vr()||eo())&&this._enabled&&!this._isClosed&&cn.duringInterruption){const e=async()=>{cn.off(Ji.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(b.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};cn.on(Ji.IOS_INTERRUPTION_END,e)}else b.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(r_.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=na.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const i=await ta({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on($s.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners($s.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Vx,jx],Object.getOwnPropertyDescriptor($c.prototype,"setDevice"),$c.prototype),Mt($c.prototype,"setEnabled",[Fx,Bx,Gx],Object.getOwnPropertyDescriptor($c.prototype,"setEnabled"),$c.prototype),Mt($c.prototype,"close",[Hx],Object.getOwnPropertyDescriptor($c.prototype,"close"),$c.prototype),$c),UW=(Wx=nt({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),Yx=ti(),zx=nt({argsMap:e=>[e.getTrackId()]}),Kx=ti(),qx=nt({argsMap:e=>[e.getTrackId()]}),Xx=ti(),Jx=nt({argsMap:e=>[e.getTrackId()]}),Zx=ti(),Qx=nt({argsMap:e=>[e.getTrackId()]}),$x=ti(),eU=nt({argsMap:e=>[e.getTrackId()]}),tU=nt({argsMap:e=>[e.getTrackId()]}),nU=ti(),Mt((rr=class extends ni{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,i){super(t.createOutputTrack(),n,i),$(this,"source",void 0),$(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Qs.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(r_.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){un(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Wx,Yx],Object.getOwnPropertyDescriptor(rr.prototype,"startProcessAudioBuffer"),rr.prototype),Mt(rr.prototype,"pauseProcessAudioBuffer",[zx,Kx],Object.getOwnPropertyDescriptor(rr.prototype,"pauseProcessAudioBuffer"),rr.prototype),Mt(rr.prototype,"seekAudioBuffer",[qx,Xx],Object.getOwnPropertyDescriptor(rr.prototype,"seekAudioBuffer"),rr.prototype),Mt(rr.prototype,"resumeProcessAudioBuffer",[Jx,Zx],Object.getOwnPropertyDescriptor(rr.prototype,"resumeProcessAudioBuffer"),rr.prototype),Mt(rr.prototype,"stopProcessAudioBuffer",[Qx,$x],Object.getOwnPropertyDescriptor(rr.prototype,"stopProcessAudioBuffer"),rr.prototype),Mt(rr.prototype,"close",[eU],Object.getOwnPropertyDescriptor(rr.prototype,"close"),rr.prototype),Mt(rr.prototype,"setAudioBufferPlaybackSpeed",[tU,nU],Object.getOwnPropertyDescriptor(rr.prototype,"setAudioBufferPlaybackSpeed"),rr.prototype),rr);class vi extends ni{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=o_().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,yn(8,"track-mix-")),$(this,"trackList",void 0),$(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(b.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):b.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){b.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}UR(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof vi?n.emit(Dp.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class VW extends ix{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Qs.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),$(this,"audioBuffer",void 0),$(this,"sourceNode",void 0),$(this,"startPlayTime",0),$(this,"startPlayOffset",0),$(this,"pausePlayTime",0),$(this,"options",void 0),$(this,"currentLoopCount",0),$(this,"currentPlaybackSpeed",100),$(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):b.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const iU=new Map;function rU(e,t){if(e.length===0||t.length===0)return 1/0;const n=cI(e),i=cI(t);return Math.floor(i/n)}class MI{get rendFrameRate(){const t=Math.max(1,rU(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:lr.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(b.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){$(this,"trackId",void 0),$(this,"config",void 0),$(this,"onFirstVideoFrameDecoded",void 0),$(this,"onFirstVideoFrameRender",void 0),$(this,"onVideoStateChanged",void 0),$(this,"freezeTimeCounterList",[]),$(this,"renderFreezeAccTime",0),$(this,"renderFreezeAccTime2",0),$(this,"isKeepLastFrame",!1),$(this,"isDestroyed",!1),$(this,"timeUpdatedCount",0),$(this,"freezeTime",0),$(this,"playbackTime",0),$(this,"lastTimeUpdatedTime",0),$(this,"autoplayFailed",!1),$(this,"videoTrack",void 0),$(this,"videoElement",void 0),$(this,"cacheVideoElement",void 0),$(this,"internal",!1),$(this,"_render_interframe_delays",[]),$(this,"_render_interframe_delays_sizes",[]),$(this,"_videoState",Qc.VideoStateStopped),$(this,"videoElementCheckInterval",void 0),$(this,"videoElementFreezeTimeout",void 0),$(this,"_videoElementStatus",lr.NONE),$(this,"_isInPage",!0),$(this,"isGettingVideoDimensions",!1),$(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return b.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),$(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&cn.curState==="running"&&(b.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(iM())),uM()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),$(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&b.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=lr.PLAYING;break;case"loadeddata":if(this.videoState=Qc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=lr.CANPLAY;break;case"stalled":this.videoElementStatus=lr.STALLED;break;case"suspend":this.videoElementStatus=lr.SUSPEND;break;case"pause":this.videoElementStatus=lr.PAUSED,vr()||eo()||er()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(b.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=lr.WAITING;break;case"abort":this.videoElementStatus=lr.ABORT;break;case"ended":this.videoElementStatus=lr.ENDED;break;case"emptied":this.videoElementStatus=lr.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=lr.ERROR,b.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const r=i-this.lastTimeUpdatedTime,a=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,el.lastVisibleTime<el.lastHiddenTime||a<el.lastHiddenTime||a<el.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(r>U("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;const l=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(l),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),$(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(b.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(iM())),uM()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),cn.on(Ji.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),cn.on(Ji.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(r=>{t&&dx(t,"video",r.message,this.trackId),r.name==="NotAllowedError"?(b.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):b.warning("[".concat(this.trackId,"] play warning: "),r)});const i=xt();if((i.name==="Safari"&&Number(i.version)===15||qm())&&n&&n.then){const r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(r).catch(r)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return b.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,i.width,i.height),new Ne((a,l)=>{i.toBlob(async u=>{if(i.remove(),u){const h=await yx(u);a({buffer:h,width:i.width,height:i.height})}else l(new re(x.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await LI(t)}destroy(){this.isDestroyed=!0,cn.off(Ji.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),cn.off(Ji.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Qc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=lr.INIT,!this.videoElementCheckInterval&&(sU.forEach(a=>{this.videoElement.addEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(a){return a!==document.body&&document.body.contains(a)}(this.videoElement)},1e3),U("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let a;const l=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",l),this.videoElementFreezeTimeout=window.setTimeout(u,U("VIDEO_FREEZE_DURATION")))},u=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Qc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Qc.VideoStateFrozen:document.addEventListener("visibilitychange",l))},h=(f,E)=>{if(this.videoElementStatus===lr.PLAYING){if(a){const T=E.presentationTime-a.presentationTime,k=E.presentedFrames-a.presentedFrames;this._render_interframe_delays_sizes.push(k),this._render_interframe_delays.push(T);const O=cI(this._render_interframe_delays_sizes),I=O-this._render_interframe_delays_sizes[0];if(O>30&&I>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Qc.VideoStateStarting&&(this.videoState=Qc.VideoStateDecoding),this.videoState===Qc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(u,U("VIDEO_FREEZE_DURATION"))),T<U("VIDEO_FREEZE_DURATION")&&this.videoState===Qc.VideoStateFrozen&&(this.videoState=Qc.VideoStateDecoding),T>U("VIDEO_FREEZE_DURATION")&&el.lastVisibleTime>=el.lastHiddenTime&&a.timestamp>el.lastVisibleTime&&a.timestamp>el.lastHiddenTime){const M=Math.min(66,rU(this._render_interframe_delays_sizes,this._render_interframe_delays)),L=Math.max(0,T-(k-1)*M);this.renderFreezeAccTime2+=L>M?L:0,this.renderFreezeAccTime+=T}}a=Cn(Cn({},E),{},{timestamp:f})}else this.isSkipCalcRenderFreezeTime()&&(a=Cn(Cn({},E),{},{timestamp:f}));var y,S;U("ENABLE_VIDEO_FRAME_CALLBACK")&&((y=(S=this.videoElement).requestVideoFrameCallback)===null||y===void 0||y.call(S,h))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),xR()&&!U("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=xt();i.name==="Safari"&&Number(i.version)===15||qm()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,qn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,qn()&&this.videoElement.load());const r=this.videoElement.play();r!==void 0&&r.catch(a=>{b.debug("[".concat(this.trackId,"] playback interrupted"),a.toString())})}resetVideoElement(){sU.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=lr.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===lr.DESTROYED||this.internal}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{b.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{b.error(i)}),this.autoplayFailed=!1,Uy()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Uy()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),lx()}}const sU=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class xI extends MI{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),$(this,"container",void 0),$(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;var i;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(i=this.slot)===null||i===void 0||i.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await LI(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",U("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var aU,oU,cU,lU,dU,uU,hU,pU,fU,mU,_U,EU,gU,yU,SU,vU,TU,RU,bU,CU,wU,AU,OU,IU,NU,DU,kU,PU,Ot,LU,MU,xU,UU,VU,jU,FU,BU,ra;let In=(aU=nt({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),oU=ti(),cU=nt({argsMap:e=>[e.getTrackId()]}),lU=Qm("LocalVideoTrack","_enabledMutex"),dU=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),uU=ti(),hU=Qm("LocalVideoTrack","_enabledMutex"),pU=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),fU=ti(),mU=nt({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),_U=ti(),EU=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),gU=ti(),yU=ti(),SU=nt({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),vU=ti(),TU=ti(),RU=ti(),bU=nt({argsMap:e=>[e.getTrackId()]}),CU=ti(),wU=ti(),AU=ti(),OU=ti(),IU=ti(),NU=nt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),DU=nt({argsMap:e=>[e.getTrackId()]}),kU=nt({argsMap:e=>[e.getTrackId()]}),PU=nt({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),Ot=class _6 extends a_{get videoHeight(){if(er()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(er()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==lr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,i,r,a,l){if(super(t,a),$(this,"trackMediaType",s_.VIDEO),$(this,"_player",void 0),$(this,"isUseScaleResolutionDownBy",!1),$(this,"_videoVisibleTimer",null),$(this,"_previousVideoVisibleStatus",void 0),$(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),$(this,"_encoderConfig",void 0),$(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),$(this,"_optimizationMode",void 0),$(this,"_saveEncodeBitrateRatio",1),$(this,"_videoHeight",void 0),$(this,"_videoWidth",void 0),$(this,"_forceBitrateLimit",void 0),$(this,"_enabled",!0),$(this,"_processorDestination",void 0),$(this,"_processorContext",void 0),er()){const{width:u,height:h}=t.getSettings();this._videoWidth=u,this._videoHeight=h}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=i,this._optimizationMode=r,this._hints=l||[],n&&this._hints.indexOf(hn.CUSTOM_TRACK)!==-1?this._encoderConfig=jn(n):this._encoderConfig=n,this._hints.indexOf(hn.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(XO(Wt.CHROME,115)&&LR().indexOf("Windows")!==-1){const u=function(h,f){if("VideoFrame"in window&&"TransformStream"in window&&Bt().supportWebRTCInsertableStream){const E=new MediaStreamTrackProcessor(h),y=new MediaStreamTrackGenerator({kind:"video"});let S,T,k=Date.now();const O=()=>{I&&(clearInterval(I),I=void 0),S&&(S.close(),S=void 0),h.stop(),T=void 0,y.removeEventListener("ended",O)};let I=window.setInterval(()=>{if(T&&S&&Date.now()-k>1e3)try{y.readyState==="live"?T.enqueue(S.clone()):O()}catch{O()}},1e3);const M=new TransformStream({transform:(L,j)=>{y.readyState==="live"?(T=j,k=Date.now(),S===void 0?(S=L,j.enqueue(L.clone())):(j.enqueue(S),S=L)):L.close()}});return y.addEventListener("ended",O),E.readable.pipeThrough(M).pipeTo(y.writable),y}}(t);u&&(b.info("local screen video track begin to inject frame"),this._mediaStreamTrack=u)}n&&this._hints.indexOf(hn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new hx(this.getTrackId(),"local"),this._processorDestination=new ux(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const r=document.getElementById(t);r?t=r:(b.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}b.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=Cn(Cn(Cn({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new MI(i):this._player=new xI(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(r_.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},U("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,b.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await gn(this,je.NEED_DISABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void b.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await gn(this,je.NEED_ENABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}b.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,b.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await gn(this,je.NEED_MUTE_TRACK,this):await gn(this,je.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),b.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await gn(this,je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(b)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new re(x.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=io(t),U("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=JR({encoderConfig:t});(er()||vr()||eo())&&(i.deviceId=void 0),b.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(r){const a=new re(x.UNEXPECTED_ERROR,r.toString());throw b.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}}this._encoderConfig=t,this._hints.indexOf(hn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await gn(this,je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(b)}}getStats(){return ku(()=>{b.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Js(this,je.GET_STATS)||Cn({},AI)}async setBeautyEffect(t){b.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await LI(t)}async findClosestProfile(){const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings(),{width:r,height:a,frameRate:l}=this._encoderConfig||{},u=Zm(this._videoWidth||t||r||0),h=Zm(this._videoHeight||n||a||0),f=function(E,y,S){if(!Array.isArray(U("VIDEO_ENCODER_CONFIG_LIST"))||U("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const T=Math.min(E,y);return!(T>=480)&&Cn(Cn({},U("VIDEO_ENCODER_CONFIG_LIST").find(k=>k.height>T)),{},{frameRate:S})}(u,h,Zm(i||l||15));if(f)return b.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(u,"x").concat(h," => ").concat(JSON.stringify(f))),this.setEncoderConfiguration(f)}async setBitrateLimit(t){b.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void b.error(x.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await gn(this,je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,b.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}b.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return b.error(x.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,b.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){mx(this._originMediaStreamTrack).then(t=>{let[n,i]=t;this._videoHeight=i,this._videoWidth=n}).catch(jR)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new re(x.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");b.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=io(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(hn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await gn(this,je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(b)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!n||!i)return;const{bitrateMax:r,bitrateMin:a}=this._encoderConfig;if(a==null||r==null){const{max:l,min:u}=function(h,f,E,y,S){const T=U("BITRATE_ADAPTER_TYPE");if(T==="DEFAULT_BITRATE")return{min:y,max:S};if(S===void 0){const k=Math.floor(200*Math.pow(E/15,.6)*Math.pow(h*f/640/360,.75));S=T==="STANDARD_BITRATE"?4*k:2*k,y=y??k}else y=y??Math.floor(S/10);return{min:y,max:S}}(t,n,i,a,r);if(this._encoderConfig.bitrateMin=u,this._encoderConfig.bitrateMax=l,U("VIDEO_STANDARD_BITRATE_VERSION")&&a==null&&r==null){const[h,f]=function(E,y,S){const T=4*Math.floor(2e5*Math.pow(S/15,.6)*Math.pow(E*y/230400,.75)),k=E*y,O=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),I=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let M=Ir(O).call(O).next().value,L=1;if(O.has(k))M=O.get(k);else{var j;const Ee=gp(j=Array.from(O.entries())).call(j,(At,ot)=>{let[Kt]=At,[Yt]=ot;return Kt-Yt}),Rt=Ee.find(At=>{let[ot]=At;return ot>k});if(Rt){const At=Ee.indexOf(Rt);if(At>0){const ot=Ee[At-1],Kt=(k-ot[0])/(Rt[0]-ot[0]);M=ot[1]+Kt*(Rt[1]-ot[1])}else M=Rt[1]}else M=Ee[Ee.length-1][1]}if(I.has(k))L=I.get(k);else{var K;const Ee=gp(K=Array.from(I.entries())).call(K,(At,ot)=>{let[Kt]=At,[Yt]=ot;return Kt-Yt}),Rt=Ee.find(At=>{let[ot]=At;return ot>k});if(Rt){const At=Ee.indexOf(Rt);if(At>0){const ot=Ee[At-1],Kt=(k-ot[0])/(Rt[0]-ot[0]);L=ot[1]+Kt*(Rt[1]-ot[1])}else L=Rt[1]}else L=Ee[Ee.length-1][1]}const z=U("VIDEO_NEW_BITRATE_RATIO");z&&z>0&&(M=z/100);const H=Math.floor(T*M),Z=Math.floor(65e4*Math.pow(E*y/230400,.5)*Math.pow(S/15,.69));let se=H;const ue=U("VIDEO_STANDARD_BITRATE_VERSION");return ue&&ue>0&&(ue===1?se=T:ue===2?se=H:ue===3&&(se=Z)),[Math.floor(se/1e3),L]}(t,n,i);this._encoderConfig.bitrateMax=h,this._encoderConfig.bitrateMin=u?Math.min(u,h):h,this._saveEncodeBitrateRatio=f,b.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else b.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(l,", brMin: ").concat(u,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),r={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:a,slot:l}=r;if(this.isPlaying&&a instanceof HTMLVideoElement&&l instanceof HTMLElement){const u=_M.checkOneElementVisible(a),h=Object.assign({},u);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const f=He.reportApiInvoke(null,{tag:Vn.TRACER,name:si.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(i){throw new re(x.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new re(x.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Cn(Cn({},i),io(t))),i=Ap(i);const r=yn(8,"track-video-cloned-"),a=new _6(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Ap(this._scalabilityMode),this._optimizationMode,r,Ap(this._hints));return t&&i&&a.setEncoderConfiguration(i),b.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),a}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new re(x.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new re(x.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(ku(()=>{He.reportApiInvoke(null,{name:si.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Vn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!U("ENABLE_VIDEO_SEI")||!U("ENABLE_ENCODED_TRANSFORM"))return void b.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new re(x.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void b.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const r=i.codecs[0].mimeType.toLocaleLowerCase();r==="video/h264"||r==="video/h265"?this.safeEmit("sei-to-send",t):b.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(Vr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await gn(this,je.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await gn(this,je.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Vr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners($s.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners($s.REQUEST_CONSTRAINTS)}},Mt(Ot.prototype,"play",[aU,oU],Object.getOwnPropertyDescriptor(Ot.prototype,"play"),Ot.prototype),Mt(Ot.prototype,"stop",[cU],Object.getOwnPropertyDescriptor(Ot.prototype,"stop"),Ot.prototype),Mt(Ot.prototype,"setEnabled",[lU,dU,uU],Object.getOwnPropertyDescriptor(Ot.prototype,"setEnabled"),Ot.prototype),Mt(Ot.prototype,"setMuted",[hU,pU,fU],Object.getOwnPropertyDescriptor(Ot.prototype,"setMuted"),Ot.prototype),Mt(Ot.prototype,"setSaveEncodeBitrateRatio",[mU,_U],Object.getOwnPropertyDescriptor(Ot.prototype,"setSaveEncodeBitrateRatio"),Ot.prototype),Mt(Ot.prototype,"setEncoderConfiguration",[EU,gU],Object.getOwnPropertyDescriptor(Ot.prototype,"setEncoderConfiguration"),Ot.prototype),Mt(Ot.prototype,"getStats",[yU],Object.getOwnPropertyDescriptor(Ot.prototype,"getStats"),Ot.prototype),Mt(Ot.prototype,"setBeautyEffect",[SU,vU],Object.getOwnPropertyDescriptor(Ot.prototype,"setBeautyEffect"),Ot.prototype),Mt(Ot.prototype,"getCurrentFrameData",[TU],Object.getOwnPropertyDescriptor(Ot.prototype,"getCurrentFrameData"),Ot.prototype),Mt(Ot.prototype,"getCurrentFrameImage",[RU],Object.getOwnPropertyDescriptor(Ot.prototype,"getCurrentFrameImage"),Ot.prototype),Mt(Ot.prototype,"findClosestProfile",[bU,CU],Object.getOwnPropertyDescriptor(Ot.prototype,"findClosestProfile"),Ot.prototype),Mt(Ot.prototype,"setBitrateLimit",[wU],Object.getOwnPropertyDescriptor(Ot.prototype,"setBitrateLimit"),Ot.prototype),Mt(Ot.prototype,"setOptimizationMode",[AU],Object.getOwnPropertyDescriptor(Ot.prototype,"setOptimizationMode"),Ot.prototype),Mt(Ot.prototype,"setScalabiltyMode",[OU],Object.getOwnPropertyDescriptor(Ot.prototype,"setScalabiltyMode"),Ot.prototype),Mt(Ot.prototype,"updateMediaStreamTrackResolution",[IU],Object.getOwnPropertyDescriptor(Ot.prototype,"updateMediaStreamTrackResolution"),Ot.prototype),Mt(Ot.prototype,"pipe",[NU],Object.getOwnPropertyDescriptor(Ot.prototype,"pipe"),Ot.prototype),Mt(Ot.prototype,"unpipe",[DU],Object.getOwnPropertyDescriptor(Ot.prototype,"unpipe"),Ot.prototype),Mt(Ot.prototype,"close",[kU],Object.getOwnPropertyDescriptor(Ot.prototype,"close"),Ot.prototype),Mt(Ot.prototype,"replaceTrack",[PU],Object.getOwnPropertyDescriptor(Ot.prototype,"replaceTrack"),Ot.prototype),Ot),ZR=(LU=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),MU=ti(),xU=Qm("CameraVideoTrack","_enabledMutex"),UU=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),VU=ti(),jU=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),FU=ti(),BU=nt({argsMap:e=>[e.getTrackId()]}),ra=class E6 extends In{get __className__(){return"CameraVideoTrack"}constructor(t,n,i,r,a,l){super(t,io(n.encoderConfig),r,a,l),$(this,"_config",void 0),$(this,"_originalConstraints",void 0),$(this,"_constraints",void 0),$(this,"_enabled",!0),$(this,"_deviceName","default"),$(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(qm()||eI())&&!function(){const u=xt();if(u.os!==Di.IOS||!u.osVersion)return!1;const h=u.osVersion.split(".");return Number(h[0])===15&&Number(h[1])>=2}()&&hM()&&this._enabled&&!this._isClosed&&(b.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=io(this._config.encoderConfig),cn.on(Ji.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),cn.on(Ji.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(b.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await na.getDeviceById(t),i={};i.video=Cn({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await ta(i,this.getTrackId())}catch(a){throw b.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),r=await ta({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await na.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}b.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){b.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:Cn(Cn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await ta(n,this.getTrackId())}catch(r){throw b.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),r.toString()),i=await ta({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Cn({},n.video),b.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await ta({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await gn(this,je.NEED_ENABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),b.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await gn(this,je.NEED_DISABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}b.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new re(x.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=io(t),U("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const i=jn(this._config);i.encoderConfig=t;const r=JR(i);(er()||vr()||eo())&&(r.deviceId=void 0),b.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(a){const l=new re(x.UNEXPECTED_ERROR,a.toString());throw b.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}this._config=i,this._constraints=r,this._originalConstraints=r,this._encoderConfig=t,this._hints.indexOf(hn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await gn(this,je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(b)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((vr()||eo())&&this._enabled&&!this._isClosed&&cn.duringInterruption){const t=async()=>{cn.off(Ji.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(b.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};cn.on(Ji.IOS_INTERRUPTION_END,t)}else b.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(r_.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,i=na.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const r=await ta({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),cn.off(Ji.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),cn.off(Ji.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Cn(Cn({},i),io(t))),i=Ap(i);const r=yn(8,"track-cam-cloned-"),a=new E6(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Ap(Cn(Cn({},this._config),{},{encoderConfig:i})),Ap(this._constraints),Ap(this._scalabilityMode),this._optimizationMode,r);return t&&i&&a.setEncoderConfiguration(i),b.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),a}bindProcessorContextEvents(){this.processorContext.on($s.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}}),this.processorContext.on($s.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Mt(ra.prototype,"setDevice",[LU,MU],Object.getOwnPropertyDescriptor(ra.prototype,"setDevice"),ra.prototype),Mt(ra.prototype,"setEnabled",[xU,UU,VU],Object.getOwnPropertyDescriptor(ra.prototype,"setEnabled"),ra.prototype),Mt(ra.prototype,"setEncoderConfiguration",[jU,FU],Object.getOwnPropertyDescriptor(ra.prototype,"setEncoderConfiguration"),ra.prototype),Mt(ra.prototype,"close",[BU],Object.getOwnPropertyDescriptor(ra.prototype,"close"),ra.prototype),ra);function UI(e,t,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=Cn(Cn({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?b.debug("[".concat(e,"] set content hint to"),n.optimizationMode):b.debug("[".concat(e,"] set content hint failed")))):b.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var GU,HU,WU,YU,Ra,zU,KU,qU,XU,JU,ZU,Dr;class QU extends ex{getUserId(){return this._userId}constructor(t,n,i,r){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(r.clientId,"_").concat(yn(5,""))),$(this,"_userId",void 0),$(this,"_uintId",void 0),$(this,"_isDestroyed",!1),$(this,"store",void 0),$(this,"processor",void 0),$(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=r}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,b.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let l_=(GU=nt({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),HU=nt({argsMap:e=>[e.getTrackId()]}),WU=nt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),YU=nt({argsMap:e=>[e.getTrackId()]}),Mt((Ra=class extends QU{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==lr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,i,r){super(e,t,n,i),$(this,"_videoVisibleTimer",null),$(this,"_previousVideoVisibleStatus",void 0),$(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),$(this,"trackMediaType",s_.VIDEO),$(this,"_videoWidth",void 0),$(this,"_videoHeight",void 0),$(this,"_player",void 0),$(this,"_prePlayer",void 0),$(this,"processorDestination",void 0),$(this,"processorContext",void 0),this._prePlayer=r,this.updateMediaStreamTrackResolution(),this.processorContext=new hx(this.getTrackId(),"remote"),this.processorDestination=new ux(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return ku(()=>{b.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Js(this,je.GET_STATS)||Cn({},QM)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Ta.PLAY_START),typeof e=="string"){const i=document.getElementById(e);i?e=i:(b.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}b.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=Cn(Cn({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let i=!1,r=!1;e instanceof HTMLVideoElement?(this._player=new MI(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,r=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,i=this._player.videoState>0,this._player.updateConfig(n)):this._player=new xI(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Ta.FIRST_FRAME_DECODED),r&&this.safeEmit(Ta.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=a=>{this.safeEmit(Ta.VIDEO_STATE_CHANGED,a)},i&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Ta.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},U("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Ta.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,b.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){mx(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(jR)}_updatePlayerSource(){b.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:r,slot:a}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&a instanceof HTMLElement){const l=_M.checkOneElementVisible(r),u=Object.assign({},l);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;const h=He.reportApiInvoke(null,{tag:Vn.TRACER,name:si.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(n){throw new re(x.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new re(x.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Vr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Vr.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Dp.SEI_RECEIVED,e)}}).prototype,"play",[GU],Object.getOwnPropertyDescriptor(Ra.prototype,"play"),Ra.prototype),Mt(Ra.prototype,"stop",[HU],Object.getOwnPropertyDescriptor(Ra.prototype,"stop"),Ra.prototype),Mt(Ra.prototype,"pipe",[WU],Object.getOwnPropertyDescriptor(Ra.prototype,"pipe"),Ra.prototype),Mt(Ra.prototype,"unpipe",[YU],Object.getOwnPropertyDescriptor(Ra.prototype,"unpipe"),Ra.prototype),Ra),d_=(zU=nt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),KU=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),qU=nt({argsMap:e=>[e.getTrackId()]}),XU=nt({argsMap:e=>[e.getTrackId()]}),JU=nt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),ZU=nt({argsMap:e=>[e.getTrackId()]}),Mt((Dr=class extends QU{get isPlaying(){return this._useAudioElement?Qr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,i){super(e,t,n,i),$(this,"trackMediaType",s_.AUDIO),$(this,"_source",void 0),$(this,"_useAudioElement",!0),$(this,"_volume",100),$(this,"processorContext",void 0),$(this,"processorDestination",void 0),$(this,"_played",!1),$(this,"_bypassWebAudio",!1),U("DISABLE_WEBAUDIO")?(this._source=new PI,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new rx(e,!0),U("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Qs.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Ta.FIRST_FRAME_DECODED)}),this.processorContext=new fx(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new px(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Qs.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Qs.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Qs.ON_AUDIO_BUFFER),this._source.on(Qs.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?Qr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!qM())throw new re(x.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Qr.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return ku(()=>{b.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Js(this,je.GET_STATS)||Cn({},ZM)}play(){b.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(b.debug("[".concat(this.getTrackId(),"] use audio element to play")),Qr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){b.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Qr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];b.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Qr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new re(x.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new re(x.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new re(x.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Vr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Vr.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Vr.ON_TRACK),this.processorDestination.removeAllListeners(Vr.ON_NODE)}}).prototype,"setVolume",[zU],Object.getOwnPropertyDescriptor(Dr.prototype,"setVolume"),Dr.prototype),Mt(Dr.prototype,"setPlaybackDevice",[KU],Object.getOwnPropertyDescriptor(Dr.prototype,"setPlaybackDevice"),Dr.prototype),Mt(Dr.prototype,"play",[qU],Object.getOwnPropertyDescriptor(Dr.prototype,"play"),Dr.prototype),Mt(Dr.prototype,"stop",[XU],Object.getOwnPropertyDescriptor(Dr.prototype,"stop"),Dr.prototype),Mt(Dr.prototype,"pipe",[JU],Object.getOwnPropertyDescriptor(Dr.prototype,"pipe"),Dr.prototype),Mt(Dr.prototype,"unpipe",[ZU],Object.getOwnPropertyDescriptor(Dr.prototype,"unpipe"),Dr.prototype),Dr);const el=new class extends Wn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),$(this,"_lastHiddenTime",0),$(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),b.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class $U extends Wn{constructor(t,n){super(),$(this,"trackMediaType",s_.DATA),$(this,"_version",1),$(this,"_type",3),$(this,"_config",void 0),$(this,"_originDataChannel",void 0),$(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),$(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),$(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return U("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Ne((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const i=setTimeout(()=>{var r;n(new re(x.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((r=this._originDataChannel)===null||r===void 0?void 0:r.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new re(x.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new re(x.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[qR.OPEN,qR.CLOSE,qR.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),t.addEventListener(n,i)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,r]=n;t.removeEventListener(i,r)}),this._datachannelEventMap.clear()}}class jW extends $U{constructor(t){super(t),$(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(i).getUint8(3);if(r!==this.id)return void(U("SHOW_DATASTREAM2_LOG")&&b.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let a=n.data.slice(this._dataStreamPacketHeader.byteLength);a=this._dataStreamPacketHandler.deserialize(a),this.emit(qR.MESSAGE,a)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class FW extends $U{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function QR(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>ZT.revokeObjectURL(e),0),new Worker(ZT.createObjectURL(e))}const eV=71,VI=1,jI=2,FI=1,tV=2;var Mu=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Mu||{});function BI(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==eV)return;const i=e.getUint16(1),r=VI+jI+i,a=new Uint8Array(e.byteLength-r);a.set(new Uint8Array(e.buffer,r,e.byteLength-r));const l={m:n,tlvLen:i,tlv:[],frame:a};let u=VI+jI;for(;u<r;){const h=e.getUint8(u),f=e.getUint16(u+FI),E=FI+tV;if(h===Mu.AUDIO_LEVEL){let y=e.getUint8(u+E);for(let S=1;S<f;S++)y=y<<8|e.getUint8(u+E+S);l.tlv.push({tag:h,length:f,value:t?127^y>>1:127&y})}else if(h===Mu.METADATA||h===Mu.AUDIO_64_BIT_PTS){const y=new Uint8Array(f);for(let S=0;S<f;S++)y[S]=e.getUint8(u+E+S);l.tlv.push({tag:h,length:f,value:y})}u+=E+f}return l}const $R=new Map,eb=127,Lp=1e-10,GI=139/13,tb=new Map;function HI(e,t,n){const i="".concat(e,"-").concat(t,"-").concat(n);let r=0;return tb.has(i)?r=tb.get(i):(r=Math.log(function(l,u){const h=l-u;u<h&&(u=h);let f=1;for(let E=l,y=1;E>u;E--,y++)f=f*E/y;return f}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,tb.set(i,r)),r<Lp&&(r=Lp),r}function nV(e,t,n){const i=t.length,r=e.length/i;let a=!1;for(let l=0,u=0;l<i;l++){let h=0;for(let f=u+r;u<f;u++)e[u]>n&&h++;t[l]!==h&&(t[l]=h,a=!0)}return a}window.cache=tb;let BW=0;class iV{constructor(t){$(this,"id",void 0),$(this,"immediates",[]),$(this,"lastNonSilence",-1),$(this,"immediateSpeechActivityScore",Lp),$(this,"lastLevelChangedTime",Date.now()),$(this,"levels",[]),$(this,"longs",[]),$(this,"longSpeechActivityScore",Lp),$(this,"mediums",[]),$(this,"mediumSpeechActivityScore",Lp),$(this,"minLevel",0),$(this,"nextMinLevel",0),$(this,"nextMinLevelWindowLength",0),$(this,"energyScore",0),this.id=t||"".concat(BW++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,i=this.minLevel+GI;let r=!1;for(let a=0;a<t.length;++a){let l=n[a];l<i&&(l=0);const u=Math.floor(l/GI);t[a]!==u&&(t[a]=u,r=!0)}return r}computeLongs(){return nV(this.mediums,this.longs,4)}computeMediums(){return nV(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=HI(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=HI(this.longs[0],10,47),this.longSpeechActivityScore>Lp&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=HI(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(Tc(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=t;return t<0&&(i=0),t>eb&&(i=eb),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+GI?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>eb&&(n=eb),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class GW{constructor(t){$(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class WI{constructor(t,n,i){$(this,"isDominant",void 0),$(this,"energyRanking",void 0),$(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=i}}class HW extends Wn{constructor(t){super(),$(this,"dominantId",null),$(this,"lastDecisionTime",0),$(this,"lastLevelChangedTime",0),$(this,"lastLevelIdleTime",0),$(this,"relativeSpeechActivities",[]),$(this,"speakers",new Map),$(this,"enableSilence",!1),$(this,"timeoutToSilenceInterval",0),$(this,"decisionMaker",null),$(this,"loudest",[]),$(this,"numLoudestToTrack",3),$(this,"energyExpireTimeMs",250),$(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const i=Date.now(),r=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const a=r.levelChanged(n,i);return this.updateLoudestList(r,a,i)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new iV(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,i){const r=t.id===this.dominantId;if(n<0){let h=0;for(;h<this.loudest.length&&this.loudest[h]!==t;)++h;return new WI(r,h,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new WI(r,0,t.energyScore);const a=i-this.energyExpireTimeMs;let l=0;for(;l<this.loudest.length;){const h=this.loudest[l];if(h.getLastLevelChangedTime()<a&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(l,1);else if(h.id!==t.id)++l;else if(this.loudest.splice(l,1),this.loudest.length<this.numLoudestToTrack)break}let u=0;for(;u<this.loudest.length&&!(this.loudest[u].energyScore<t.energyScore);)++u;return u<this.numLoudestToTrack&&(this.loudest.splice(u,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new WI(r,u,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new GW(this),this.decisionMaker.execute())}makeDecision(t){let n=null,i=null;const r=this.speakers.size;let a=null;if(r===0)a=null;else if(r===1){var l;const u=Ir(l=this.speakers).call(l).next().value;this.enableSilence&&u&&(a=u.id,u.evaluateSpeechActivityScores(t),t-u.lastNonSilence>this.timeoutToSilenceInterval&&(a=null))}else{let u=this.dominantId==null?null:this.speakers.get(this.dominantId);if(u==null){const E=this.speakers.entries().next();E.value&&(a=E.value[0],u=E.value[1])}else a=u.id;u!=null&&u.evaluateSpeechActivityScores(t);const h=this.relativeSpeechActivities;let f=2;for(const E of this.speakers.entries()){const[y,S]=E;if(S===u)continue;S.evaluateSpeechActivityScores(t);for(let I=0;I<h.length;++I){const M=u==null?Lp:u.getSpeechActivityScore(I);h[I]=Math.log(S.getSpeechActivityScore(I)/M)}const T=h[0],k=h[1],O=h[2];T>3&&k>2&&O>0&&k>f&&(f=k,a=y)}this.enableSilence&&u!=null&&a===u.id&&t-u.lastNonSilence>this.timeoutToSilenceInterval&&(a=null)}a==null&&!this.enableSilence||a===this.dominantId||(n=this.dominantId,this.dominantId=a,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):i=n;let r=300-(t-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=t,this.makeDecision(t),r=300-(Date.now()-t)),r>0&&i>r&&(i=r),i}timeoutIdleLevels(t){const n=[];for(const r of Ir(i=this.speakers).call(i)){var i;const a=t-r.getLastLevelChangedTime();36e5<a&&(this.dominantId==null||r.id!==this.dominantId)?n.push(r.id):300<a&&r.levelTimedOut()}n.forEach(r=>this.speakers.delete(r))}}const u_=new Map;let Ko=null,nb=null;const rV=3;let Mp=[];const qo=new Map,ib=new Map;class WW{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){$(this,"id",void 0),$(this,"track",void 0),$(this,"score",0),$(this,"active",!0),$(this,"muted",!1),$(this,"timer",0),$(this,"actives",0),$(this,"inactives",0),this.id=t,this.track=n,this.setActive(qo.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const r=[],a=[];return Array.from(Ir(qo).call(qo)).forEach(l=>{l.active?r.push(l):a.push(l)}),{actives:r,inactives:a}}();if(n.length>3){let r;n.forEach(a=>{(!r||r.score>a.score)&&(r=a)}),r&&r.setActive(!1)}if(n.length<3&&i.length>0){let r;i.forEach(a=>{(!r||r.score<a.score)&&a.id!==this.id&&(r=a)}),r&&t&&!this.active&&(r.samples>40&&r.activeRate-this.activeRate>.4?r.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let i;return Array.from(Ir(qo).call(qo)).forEach(r=>{!r.active||r.id===n||r.samples<40||(!i||r.score<i.score)&&(i=r)}),i}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let i;return Array.from(Ir(qo).call(qo)).forEach(r=>{r.active||r.id===n||r.samples<40||(!i||r.score>i.score)&&(i=r)}),i}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let rb;function sV(e){const t=qo.get(e);t&&(qo.delete(e),t.clearTimer())}const sb=new Map,YW=new Map,YI="video/h264",zI="video/h265";function aV(e,t,n){let i=new Uint8Array(e,t,n),r=[],a=0;for(;r.length<n;)a+3<n&&i[a]===0&&i[a+1]===0&&i[a+2]===3&&(i[a+3]===0||i[a+3]===1||i[a+3]===2||i[a+3]===3)?(r.push(i[a],i[a+1],i[a+3]),a+=4):(r.push(i[a]),a++);return new Uint8Array(r)}function oV(e){const t=e.length;let n=[],i=0;for(;i<t;)i+2<t&&e[i]===0&&e[i+1]===0&&(e[i+2]===0||e[i+2]===1||e[i+2]===2||e[i+2]===3)?(n.push(e[i],e[i+1],3,e[i+2]),i+=3):(n.push(e[i]),i++);return new Uint8Array(n)}function cV(e){if(e.length<5)return"";let t=-1;for(let r=0;r<e.length-3;r++){if(e[r]===0&&e[r+1]===0&&e[r+2]===1){t=r;break}if(r<e.length-4&&e[r]===0&&e[r+1]===0&&e[r+2]===0&&e[r+3]===1){t=r;break}}if(t===-1)return"";const n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";const i=e[n];return 128&i?"":(i>>1&63)>=32||n+1<e.length&&(248&e[n+1])==0?zI:(31&i)<=31?YI:""}const ab=new Map,Xy=new Map;(function(){const e=xt();Xi.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Xi.getStreamFromExtension=e.name===Wt.CHROME&&Number(e.version)>34,Xi.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),Xi.supportMinBitrate=e.name===Wt.CHROME||e.name===Wt.EDGE,Xi.supportSetRtpSenderParameters=function(){const t=xt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!rd()||!(!er()&&!MR())||t.name===Wt.FIREFOX&&Number(t.version)>=64)}(),e.name===Wt.SAFARI&&(Number(e.version)>=14?Xi.supportDualStream=!0:Xi.supportDualStream=!1),Xi.webAudioMediaStreamDest=function(){const t=xt();return!(t.name===Wt.SAFARI&&Number(t.version)<12)}(),Xi.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Xi.supportWebGL=typeof WebGLRenderingContext<"u",Xi.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,rd()||(Xi.webAudioWithAEC=!0),Xi.supportShareAudio=function(){const t=xt();return(t.os===Di.WIN_10||t.os===Di.WIN_81||t.os===Di.WIN_7||t.os===Di.LINUX||t.os===Di.MAC_OS||t.os===Di.CHROMIUM_OS)&&t.name===Wt.CHROME&&Number(t.version)>=74}(),Xi.supportDataChannel=!!(Km(76)||ZO(68)||oM(14)),Xi.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!qn()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Xi.supportWebRTCEncodedTransform=Km(87)||rM()||ZO(117),Xi.supportWebRTCInsertableStream=function(){const t=xt();return(t.name===Wt.CHROME||t.name===Wt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Xi.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Xi.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,VR(()=>{Xi.supportDualStreamEncoding=function(){const t=xt();return!!U("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&U("CHROME_DUAL_STREAM_USE_ENCODING"))}(),b.debug("browser ua: ",navigator.userAgent),b.info("browser info: ",e),b.info("browser compatibility: ",Xi)})})();const zW=["CHINA","GLOBAL"],lV=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],xp=[],h_=[];function Up(e,t){return!!t&&xp.some(n=>n.uid===e&&n.channelName===t)}function KI(){return h_.length>0}var KW=RL.forEach,dV=Nl("forEach")?[].forEach:function(e){return KW(this,e,arguments.length>1?arguments[1]:void 0)};Jt({target:"Array",proto:!0,forced:[].forEach!==dV},{forEach:dV});var qW=gs("Array","forEach"),XW=Ro,JW=Hi,ZW=oe,QW=qW,qI=Array.prototype,$W={DOMTokenList:!0,NodeList:!0},eY=function(e){var t=e.forEach;return e===qI||ZW(qI,e)&&t===qI.forEach||JW($W,XW(e))?QW:t},tY=v(eY),nY=Yr,uV=Ch;Jt({target:"Object",stat:!0,forced:w(function(){uV(1)})},{keys:function(e){return uV(nY(e))}});var iY=v(Ci.Object.keys),rY=v(vs),sY=v(Pf),aY=Jt,hV=Ts,oY=Hh,cY=Un,pV=wf,lY=gc,dY=Ht,uY=kA,hY=ei,pY=qr,fY=pL("slice"),mY=hY("species"),XI=Array,_Y=Math.max;aY({target:"Array",proto:!0,forced:!fY},{slice:function(e,t){var n,i,r,a=dY(this),l=lY(a),u=pV(e,l),h=pV(t===void 0?l:t,l);if(hV(a)&&(n=a.constructor,(oY(n)&&(n===XI||hV(n.prototype))||cY(n)&&(n=n[mY])===null)&&(n=void 0),n===XI||n===void 0))return pY(a,u,h);for(i=new(n===void 0?XI:n)(_Y(h-u,0)),r=0;u<h;u++,r++)u in a&&uY(i,r,a[u]);return i.length=r,i}});var EY=gs("Array","slice"),gY=oe,yY=EY,JI=Array.prototype,SY=function(e){var t=e.slice;return e===JI||gY(JI,e)&&t===JI.slice?yY:t},vY=v(SY);function Be(e,t,n,i,r){var a,l,u,h={};return tY(a=iY(i)).call(a,function(f){h[f]=i[f]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=rY(l=sY(u=vY(n).call(n)).call(u)).call(l,function(f,E){return E(e,t,f)||f},h),r&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(r):void 0,h.initializer=void 0),h.initializer===void 0?(lL(e,t,h),null):h}let ob=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),ZI=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),ro=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),jr=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),et=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),wn=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),lt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),st=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),Jy=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Pt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Fr=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),_t=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function cb(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw b.error("Invalid Channel Name ".concat(e)),new te(x.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function lb(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||mM(e,1,255)))throw new te(x.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&b.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let ad=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const TY={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},QI={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function $I(e,t){Ki(e.url,"".concat(t,".url"),1,1e3,!1),Xn(e.x)||un(e.x,"".concat(t,".x"),0,1e4),Xn(e.y)||un(e.y,"".concat(t,".y"),0,1e4),Xn(e.width)||un(e.width,"".concat(t,".width"),0,1e4),Xn(e.height)||un(e.height,"".concat(t,".height"),0,1e4),Xn(e.zOrder)||un(e.zOrder,"".concat(t,".zOrder"),0,255),Xn(e.alpha)||un(e.alpha,"".concat(t,".alpha"),0,1,!1)}const RY={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let xu=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),eN=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Ti=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function fV(e){if(!e.channelName)throw new te(x.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new te(x.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Ki(e.token,"info.token",1,2047),lb(e.uid),cb(e.channelName),!0}let Br=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),od=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),ls=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),p_=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),tn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Vi=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),db=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),ki=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),zt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const mV=[zt.AFRICA,zt.ASIA,zt.CHINA,zt.EUROPE,zt.GLOBAL,zt.INDIA,zt.JAPAN,zt.NORTH_AMERICA,zt.OCEANIA,zt.OVERSEA,zt.SOUTH_AMERICA];let dr=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const ub={CHINA:{},ASIA:{CODE:dr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:dr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:dr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:dr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:dr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:dr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:dr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:dr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:dr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:dr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:dr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:dr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:dr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};EI&&(ub.CHINA={CODE:dr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Zy=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function _V(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class EV extends Wn{constructor(t,n){super(),P(this,"onICEConnectionStateChange",void 0),P(this,"onConnectionStateChange",void 0),P(this,"onDTLSTransportStateChange",void 0),P(this,"onDTLSTransportError",void 0),P(this,"onICETransportStateChange",void 0),P(this,"onFirstAudioReceived",void 0),P(this,"onFirstVideoReceived",void 0),P(this,"onFirstAudioDecoded",void 0),P(this,"onFirstVideoDecoded",void 0),P(this,"onFirstVideoRender",void 0),P(this,"onFirstVideoDecodedTimeout",void 0),P(this,"onSelectedLocalCandidateChanged",void 0),P(this,"onSelectedRemoteCandidateChanged",void 0),P(this,"onICECandidateError",void 0),P(this,"getLocalVideoStats",void 0)}}class gV extends EV{constructor(t,n){super(t,n),P(this,"establishPromise",void 0)}}let xe=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),ur=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),cd=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const yV=["disconnected","failed"];let me=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),$t=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Xe=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),so=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),ao=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ji=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),SV=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),tl=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),ba=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Xo=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),f_=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ci=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),m_=function(e){return e.ABORT="abort",e}({}),Uu=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),bY=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const CY={[ob.ACCESS_POINT]:{[jr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[jr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[jr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[jr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[jr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[jr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[ob.UNILBS]:{[ro.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ro.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ro.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ro.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ro.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ro.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ro.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ro.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ro.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ro.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ro.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ro.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[ob.STRING_UID_ALLOCATOR]:{[ZI.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[ZI.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[ZI.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function __(e){const t=CY[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===ob.ACCESS_POINT){const i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const wY={[et.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[et.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[et.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[et.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[et.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[et.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[et.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[et.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[et.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[et.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[et.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[et.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[et.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[et.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[et.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[et.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[et.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[et.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[et.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[et.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[et.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[et.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[et.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[et.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[et.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[et.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[et.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[et.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[et.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[et.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[et.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[et.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[et.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[et.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[et.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[et.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[et.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[et.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[et.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[et.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[et.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[et.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[et.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[et.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[et.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[et.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[et.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[et.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[et.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[et.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[et.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[et.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[et.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[et.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[et.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[et.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[et.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[et.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[et.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[et.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[et.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[et.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[et.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[et.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Qy(e){return wY[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function vV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function tN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?vV(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function nN(e,t){if(typeof e=="string")return e;const{proxy:n,host:i,port:r}=e;if(t){const a=U("JOIN_GATEWAY_FALLBACK_PORT")||443;return a===443?"wss://".concat(i,"/ws/?p=").concat(Number(r)+150):"wss://".concat(i,":").concat(a,"/ws/?p=").concat(Number(r)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(r):"wss://".concat(i,":").concat(r)}const AY=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,OY=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,IY=/wss:\/\/(.+):([0-9]+)\/?/,NY=/wss:\/\/(.[^\/]+)\/?/;let DY=0;class kY{constructor(t,n){P(this,"id",0),P(this,"store",void 0),P(this,"recordIndex",void 0),P(this,"websockets",[]),P(this,"try443PortDuration",2e3),P(this,"forceCloseWSDuration",5e3),P(this,"try443PortTimeout",null),P(this,"forceCloseTimeout",null),P(this,"isTry443PortFailed",!1),P(this,"isNormalPortFailed",!1),P(this,"useDoubleDomain",!1),P(this,"useProxy",!1),P(this,"startTime",Date.now()),this.id=++DY,this.try443PortDuration=U("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];b.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...r)}createWebSocket(t,n,i){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:i});const r=U("GATEWAY_DOMAINS"),a=Date.now(),l=[],u=r.find(S=>{var T;return Re(T=t.host).call(T,S)});u||(this.useDoubleDomain=!1);const h=[];if(this.useDoubleDomain)r.forEach(S=>{h.push(nN(tN(tN({},t),{},{host:t.host.replace(u,S)}),n))});else{const S=tN({},t);if(n&&u){const T=r.find(k=>k!==u);T&&(S.host=S.host.replace(u,T))}h.push(nN(S,n))}try{h.forEach(S=>{const T=new WebSocket(S);T.binaryType="arraybuffer",l.push(T),this.logger("ws is connecting:",T.url)})}catch(S){if(this.logger("ws create failed"),l.forEach(T=>T.close()),l.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,i);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,i);throw new te(x.WS_ERR,"init websocket failed! Error: ".concat(S.toString()))}const f=xy();this.store&&this.store.recordJoinChannelService({urls:l.map(S=>S.url),service:"gateway"},this.recordIndex),l.forEach(S=>{S.onopen=()=>{this.logger("onopen: ws ".concat(S.url," open cost ").concat(Date.now()-a,"ms")),this.websockets.forEach(T=>{T!==S&&(T.onopen=null,T.onclose=null,T.onmessage=null,T.close(),this.logger("close backup websocket: ".concat(T.url)))}),this.websockets.length=0,f.resolve(S)},S.onclose=T=>{this.logger("onclose: ws ".concat(S.url," closed cost ").concat(Date.now()-a,"ms state: ").concat(S.readyState));const k=l.every(O=>O.readyState===WebSocket.CLOSED||O.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(k)),k&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(T.reason)),f.reject({code:T.code,reason:db.A_ROUND_WS_FAILED})):!n&&k&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),y()),n?this.isTry443PortFailed=k:this.isNormalPortFailed=k},S.onmessage=T=>this.logger("".concat(S.url," onmessage: ").concat(T.data))}),this.websockets.push(...l);const E=()=>{this.websockets.forEach(S=>S.readyState!==WebSocket.OPEN&&S.close())},y=()=>{if(f.isResolved)return E();xt().os===Di.MAC_OS&&qn()&&E(),this.createWebSocket(t,!0,!0).then(S=>{f.resolve(S)}).catch(S=>{this.isNormalPortFailed&&f.reject(S),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",f.isResolved),this.forceCloseTimeout=null,E()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,E()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",f.isResolved),this.try443PortTimeout=null,y()},this.try443PortDuration)})(),f.promise}chooseBestWebsocket(t,n,i,r){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(a){let l,u,h;return[,l,u,h]=a.match(AY)||[],l||([,u,h]=a.match(OY)||[]),u&&h||([,u,h]=a.match(IY)||[]),u&&h||([,u]=a.match(NY)||[]),u||b.warning("un-destructible url: ",a),{proxy:l,host:u,port:h||"443"}}(t)),this.recordIndex=r,this.useProxy=!!t.proxy,i&&this.useProxy&&(b.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally(()=>this.clearTimeout())}}function TV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}class RV extends Wn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;Re(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(_t.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(_t.CONNECTED):this._state==="closed"?this.emit(_t.CLOSED):this._state==="failed"&&this.emit(_t.FAILED))}resetReconnectCount(t){b.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],a=arguments.length>4&&arguments[4]!==void 0&&arguments[4],l=arguments.length>5?arguments[5]:void 0;super(),P(this,"_websocketUrl",null),P(this,"connectionID",0),P(this,"currentURLIndex",0),P(this,"urls",[]),P(this,"_reconnectMode","tryNext"),P(this,"reconnectReason",void 0),P(this,"_initMutex",void 0),P(this,"name",void 0),P(this,"_state","closed"),P(this,"reconnectInterrupter",void 0),P(this,"websocket",void 0),P(this,"retryConfig",void 0),P(this,"reconnectCount",0),P(this,"forceCloseTimeout",5e3),P(this,"onlineReconnectListener",void 0),P(this,"useCompress",void 0),P(this,"tryDoubleDomain",!1),P(this,"use443PortOnly",!1),P(this,"wsInflateLength",0),P(this,"wsDeflateLength",0),P(this,"closeEstablishingWs",()=>{}),P(this,"store",void 0),P(this,"joinGatewayRecordIndex",void 0),this.store=l,this.name=t,this.retryConfig=function(y){for(var S=1;S<arguments.length;S++){var T=arguments[S]!=null?arguments[S]:{};S%2?TV(Object(T),!0).forEach(function(k){P(y,k,T[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(T)):TV(Object(T)).forEach(function(k){Object.defineProperty(y,k,Object.getOwnPropertyDescriptor(T,k))})}return y}({},n),this.useCompress=i,this.tryDoubleDomain=r,this.use443PortOnly=a,this._initMutex=new cr("websocket",l?l.clientId:void 0);const{timeout:u,timeoutFactor:h}=n,f=Math.max(300,Math.floor(3*u/5)),E=Math.max(1.2,Math.floor(8*h)/10);ks.ONLINE&&(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=E),hi.on(Xm.NETWORK_STATE_CHANGE,(y,S)=>{y!==S&&(this.resetReconnectCount("network state change: ".concat(S," -> ").concat(y)),y===ks.ONLINE?(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=E):(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=h))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var r;const a=xy(),l=this.urls[this.currentURLIndex];(r=this.store)===null||r===void 0||r.beforeConnect(),function(u){return!(YR()||U("USE_NEW_TOKEN")||!U("ENABLE_PREALLOC_PC")&&(u==null||!u.autoSubscribe||U("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(SV.PRE_CONNECT_PC),this.createWebSocketConnection(l).then(a.resolve).catch(a.reject),this.once(_t.CLOSED,()=>{a.reject(new re(x.WS_DISCONNECT))}),this.once(_t.CONNECTED,a.resolve),await a.promise}catch{}finally{i()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void b.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),b.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new re(x.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new re(x.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const i=xy();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=E=>{var y;(y=this.store)===null||y===void 0||y.signalChannelOpen(),b.debug("[".concat(this.name,"] websocket opened:"),E),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},a=async E=>{var y;if(b.debug("[".concat(this.name,"] websocket close ").concat((y=this.websocket)===null||y===void 0?void 0:y.url,", code: ").concat(E.code,", reason: ").concat(E.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new re(x.WS_DISCONNECT,"websocket close: ".concat(E.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=E.reason,this.state="reconnecting");const S=Js(this,_t.WILL_RECONNECT,this.reconnectMode,E.reason)||this.reconnectMode,T=await this.reconnectWithAction(S);if(this.state==="closed")return void b.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!T)return i.reject(new re(x.WS_DISCONNECT,"websocket reconnect failed: ".concat(E.code))),this.close(!0);i.resolve()}},l=E=>{this.emit(_t.ON_MESSAGE,E)},u=E=>{b.warn("[".concat(this.connectionID,"] ws open error ").concat(E))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),U("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=U("GATEWAY_WSS_ADDRESS")),b.debug("[".concat(this.name,"] start connect, url:"),t);const h=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var f;this._websocketUrl=nN(t);const E=await this.chooseBestWebsocketConnection(t);this.websocket=E,r&&r(this.websocket.url),this.websocket.onclose=a,this.websocket.onmessage=l,this.websocket.onerror=u,(f=this.store)===null||f===void 0||f.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this.joinGatewayRecordIndex=h}catch(E){const y=this.state==="closed",S=E instanceof re,T=S&&E.code===x.WS_ABORT,k=S&&E.code===x.WS_ERR,O=S?E.message:E&&(E.reason||E.toString());b.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(O)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:T?"aborted":"error",errors:[E]},h),y||k?(i.reject(y?new re(x.WS_DISCONNECT,"websocket is closed: ".concat(O)):new re(x.WS_ERR,"init websocket failed: ".concat(O))),k&&b.error("[".concat(this.name,"] init websocket failed: ").concat(O))):a&&a(E)}return i.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;b.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||hi.isOnline||!hi.onlineWaiter||(this.onlineReconnectListener=hi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const l=lI(this.reconnectCount,this.retryConfig);b.debug("[".concat(this.name,"] wait ").concat(l,"ms to reconnect websocket, mode: ").concat(t)),await Ne.race([qi(l),this.onlineReconnectListener||new Ne(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const r=async(l,u)=>{this.emit(_t.RECONNECT_CREATE_CONNECTION,u),await this.createWebSocketConnection(l)};try{if(t==="retry")await r(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);b.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],t)}else t==="recover"&&(b.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await nr(this,_t.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],t))}catch(l){var a;b.error("[".concat(this.name,"] reconnect failed ").concat(l&&l.toString()));const u=l==null||(a=l.data)===null||a===void 0?void 0:a.desc;return Array.isArray(u)&&Re(u).call(u,"dynamic key expired")?(this.emit(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class iN extends RV{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const i=xy(),r=function(l,u){return new kY(l,u)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{b.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),i.reject(new re(x.WS_ABORT,"choose best websocket aborted"))};const a=U("GATEWAY_DOMAINS");return b.debug("[choose-best-ws] currentDomain: ",t,", domains: ",a,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class $y extends RV{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new Ne((i,r)=>{let a=!1;const l=[];this.closeEstablishingWs=()=>{b.debug("[choose-best-ws] close establishing websockets"),l.forEach(k=>{k.onclose=null,k.onopen=null,k.onmessage=null,k.close()}),r(new re(x.WS_ABORT,"choose best websocket aborted"))};const u=U("GATEWAY_DOMAINS");let h;const f=t.indexOf("?h="),E=u.find(k=>f!==-1?Re(t).call(t,k,f):Re(t).call(t,k));b.debug("[choose-best-ws] currentDomain: ",E,", domains: ",u);let y=!this.tryDoubleDomain||!E;if(!y&&E){var S;const k=Date.now();try{u.forEach(O=>{const I=f===-1?t.replace(E,O):t.substr(0,f)+t.substr(f).replace(E,O),M=new WebSocket(I);M.binaryType="arraybuffer",l.push(M),b.debug("[choose-best-ws] ws is connecting:",M.url)})}catch{for(b.debug("[choose-best-ws] ws create failed, fallback to single url"),l.forEach(I=>I.close());l.length;)l.pop();y=!0}(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:l.map(O=>O.url),service:"gateway"},n),l.forEach(O=>{O.onopen=()=>{if(a)return;const I=Date.now()-k;b.debug("[choose-best-ws] ws open cost ".concat(I,"ms")),l.filter(M=>M!==O).forEach(M=>{b.debug("[choose-best-ws]close backup websocket: ".concat(M.url)),M.close()}),a=!0,i(O)},O.onclose=I=>{h=I,!a&&(l.find(M=>!(M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING))||(b.debug("[choose-best-ws] all websocket is closed"),a=!0,r(h)))},O.onmessage=I=>{b.debug("[choose-best-ws]".concat(O.url," onmessage: ").concat(I.data))}}),qi(this.forceCloseTimeout).then(()=>{l.forEach(O=>{O.readyState!==WebSocket.OPEN&&O.close()})})}if(y){var T;let k;b.debug("[choose-best-ws] use single url: ",t),(T=this.store)===null||T===void 0||T.recordJoinChannelService({urls:[t],service:"gateway"},n);try{k=new WebSocket(t),l.push(k),k.binaryType="arraybuffer"}catch(O){const I=new re(x.WS_ERR,"init websocket failed! Error: ".concat(O.toString()));return b.error("[".concat(this.name,"]").concat(I)),void r(I)}k.onopen=()=>{i(k)},k.onclose=O=>{r(O)},k.onmessage=O=>{b.debug("[choose-best-ws]".concat(k.url," onmessage: ").concat(O.data))},qi(this.forceCloseTimeout).then(()=>{k&&k.readyState!==WebSocket.OPEN&&k.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class PY extends Wn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===wn.CONNECTED?this.emit(lt.WS_CONNECTED):t===wn.RECONNECTING?this.emit(lt.WS_RECONNECTING,this._websocketReconnectReason):t===wn.CLOSED&&this.emit(lt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),P(this,"_disconnectedReason",void 0),P(this,"_websocketReconnectReason",void 0),P(this,"_connectionState",wn.CLOSED),P(this,"reconnectToken",void 0),P(this,"websocket",void 0),P(this,"openConnectionTime",void 0),P(this,"clientId",void 0),P(this,"lastMsgTime",Date.now()),P(this,"uploadCache",[]),P(this,"uploadCacheInterval",void 0),P(this,"rttRolling",new DM(5)),P(this,"pingpongTimer",void 0),P(this,"wsInflateDataTimer",void 0),P(this,"pingpongTimeoutCount",0),P(this,"ortc",void 0),P(this,"joinResponse",void 0),P(this,"multiIpOption",void 0),P(this,"initError",void 0),P(this,"spec",void 0),P(this,"store",void 0),P(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(lt.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const a="res-@".concat(r._id);this.emit(a,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===Pt.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Pt.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Qt.UID_BANNED);break;case 15:this.close(Qt.IP_BANNED);break;case 16:this.close(Qt.CHANNEL_BANNED)}if(r._type===Pt.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case et.ERR_LICENSE_MISSING:this.close(Qt.LICENSE_MISSING);break;case et.ERR_LICENSE_EXPIRED:this.close(Qt.LICENSE_EXPIRED);break;case et.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Qt.LICENSE_MINUTES_EXCEEDED);break;case et.ERR_LICENSE_PERIOD_INVALID:this.close(Qt.LICENSE_PERIOD_INVALID);break;case et.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Qt.LICENSE_MULTIPLE_SDK_SERVICE);break;case et.ERR_LICENSE_ILLEGAL:this.close(Qt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new iN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,U("JOIN_GATEWAY_USE_DUAL_DOMAIN"),U("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===wn.CONNECTED&&this.reconnect("retry",tr.OFFLINE)})}async request(t,n,i,r){const a=yn(6,""),l={_id:a,_type:t,_message:n},u=this.websocket.connectionID,h=()=>new Ne((k,O)=>{if(this.connectionState===wn.CONNECTED)return k();const I=()=>{this.off(lt.WS_CLOSED,M),k()},M=()=>{this.off(lt.WS_CONNECTED,I),O(new te(x.WS_ABORT))};this.once(lt.WS_CONNECTED,I),this.once(lt.WS_CLOSED,M),t!==st.PUBLISH&&t!==st.PUBLISH_DATASTREAM&&t!==st.SUBSCRIBE&&t!==st.SUBSCRIBE_DATASTREAM&&t!==st.UNSUBSCRIBE&&t!==st.UNSUBSCRIBE_DATASTREAM&&t!==st.UNPUBLISH&&t!==st.UNPUBLISH_DATASTREAM&&t!==st.CONTROL&&t!==st.RESTART_ICE||this.once(lt.DISCONNECT_P2P,()=>{O(new te(x.DISCONNECT_P2P))}),t!==st.PUBLISH&&t!==st.RESTART_ICE||this.once(lt.ABORT_P2P_EXECUTION,()=>{O(new te(x.DISCONNECT_P2P))})});if(this.connectionState!==wn.CONNECTING&&this.connectionState!==wn.RECONNECTING||t===st.JOIN||t===st.REJOIN||await h(),this.websocket.sendMessage(l,!0),r)return;const f=new Ne((k,O)=>{let I=!1;const M=(j,K)=>{I=!0,k({isSuccess:j==="success",message:K||{}}),this.off(lt.WS_CLOSED,L),this.off(lt.WS_RECONNECTING,L),this.emit(lt.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),M);const L=()=>{O(new te(x.WS_ABORT,"type: ".concat(t))),this.off(lt.WS_CLOSED,L),this.off(lt.WS_RECONNECTING,L),this.off("res-@".concat(a),M)};this.once(lt.WS_CLOSED,L),this.once(lt.WS_RECONNECTING,L),qi(U("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||I||(b.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(lt.REQUEST_TIMEOUT,t,n))})});let E=null;try{E=await f}catch(k){if(this.connectionState===wn.CLOSED||t===st.LEAVE)throw new te(x.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?k.throw():t===st.JOIN||t===st.REJOIN?null:(await h(),await this.request(t,n))}if(E.isSuccess)return E.message;const y=Number(E.message.error_code||E.message.code),S=Qy(y),T=new te(x.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(E.message.error_str),{code:y,data:E.message,desc:S.desc});return S.action==="success"?E.message:(b.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(y,", message: ").concat(S.desc,", action: ").concat(S.action)),y===et.ERR_TOO_MANY_BROADCASTERS?((t===st.JOIN||t===st.REJOIN)&&(this.initError=T,this.close()),T.throw()):S.action==="failed"?T.throw():S.action==="quit"?(this.initError=T,this.close(),T.throw()):(y===et.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,b.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",tr.MULTI_IP)):this.reconnect(S.action,tr.SERVER_ERROR),t===st.JOIN||t===st.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Ne(i=>{const r=a=>{(!n||n(a))&&(this.off(t,r),i(a))};this.on(t,r)})}uploadWRTCStats(t){if(!this.store.sessionId)return void b.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Jy.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const a=U("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==wn.CONNECTED)return;const l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},U("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ne((n,i)=>{this.once(lt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(lt.WS_CLOSED,r=>i(this.initError||new te(x.WS_ABORT,r))),this.connectionState=wn.CONNECTING,this.websocket.init(t).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Qt.LEAVE,this.connectionState=wn.CLOSED,b.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(lt.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await nr(this,lt.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(st.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!n)return this.emit(lt.REPORT_JOIN_GATEWAY,db.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(lt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=wn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new te(x.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=By(this,lt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(st.REJOIN,t);return!!n&&(this.connectionState=wn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(Pt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Pt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Pt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Pt.MUTE_AUDIO,{uid:i.uid}):this.emit(Pt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Pt.MUTE_VIDEO,{uid:i.uid}):this.emit(Pt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Pt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Pt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Pt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Pt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Pt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(st.DOWNGRADE_CODEC,n)}handleNotification(t){b.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Qy(t.code);if(t.code===28&&"detail"in t&&(b.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(lt.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Qt.UID_BANNED),void this.close()):void this.reconnect(n.action,tr.SERVER_ERROR);b.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=U("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(b.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>U("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",tr.TIMEOUT):this.request(st.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),U("REPORT_STATS")&&this.send(st.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Jy.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(_t.RECONNECT_CREATE_CONNECTION,t=>{this.emit(lt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(_t.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(_t.CLOSED,()=>{this.connectionState=wn.CLOSED}),this.websocket.on(_t.FAILED,()=>{this._disconnectedReason=Qt.NETWORK_ERROR,this.connectionState=wn.CLOSED}),this.websocket.on(_t.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===wn.CONNECTED?this.connectionState=wn.RECONNECTING:this.connectionState=wn.CONNECTING}),this.websocket.on(_t.WILL_RECONNECT,(t,n,i)=>{const r=By(this,lt.IS_P2P_DISCONNECTED),a=r||t!=="retry";r&&t==="retry"&&(b.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=db.P2P_DISCONNECTED),a&&(b.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(lt.REPORT_JOIN_GATEWAY,n||db.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(lt.DISCONNECT_P2P)),i(t)}),this.websocket.on(_t.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{b.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",tr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(lt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof te){if(t.code===x.UNEXPECTED_RESPONSE&&t.data.code===et.ERR_NO_AUTHORIZED)return this.initError=new te(x.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Qt.TOKEN_EXPIRE);b.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",tr.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(_t.REQUEST_NEW_URLS,(t,n)=>{nr(this,lt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(SV.PRE_CONNECT_PC,()=>{this.emit(lt.PRE_CONNECT_PC)})}}let LY=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),pi=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function bV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function hb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bV(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Vu(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(U("TURN_DOMAIN")):(b.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function pb(e){try{const t=U("GATEWAY_DOMAINS").concat(U("TURN_DOMAIN")).find(n=>Re(e).call(e,n));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return b.debug("serverUrlToIp error, fallback to url",e),e}}function rN(e,t){e.addresses||(e.addresses=[]);const n=function(u,h){if(U("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return u.map(y=>{let{ip:S,port:T}=y;return{address:"".concat(S,":").concat(T)}});const f=U("GATEWAY_DOMAINS");let E=f[1]&&Re(h).call(h,f[1])?1:0;return u.map(y=>{let{domain_prefix:S,port:T,ip:k}=y;if(S)return{address:"".concat(S,".").concat(f[E++%f.length],":").concat(T)};const O=/^[\.\:\d]+$/.test(k),I=O?"".concat(k.replace(/[^\d]/g,"-"),".").concat(f[E++%f.length],":").concat(T):"".concat(k,":").concat(T);return O||b.debug("Cannot recognized as ip address: ".concat(k,", use as host3")),{ip:k,port:T,address:I}})}(e.addresses,t),i=Array.isArray(e.detail)&&e.detail[18];if(i&&typeof i=="string"){const u=i.split(";");for(let h=0;h<u.length;h++){var r;const f=Nr(r=u[h]).call(r);n[h]&&f&&(n[h].ip6=f)}}const a=e.detail&&e.detail.candidate;let l;if(a){const[u,h]=a.split(":");u&&h&&(l={port:Number(h),ip:u,address:"".concat(u,":").concat(h)})}return{gatewayAddrs:n,apGatewayAddress:l,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Ps(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function CV(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Ps(t.width),"x").concat(Ps(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function wV(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function eS(e,t){let n,i,r;switch(t){case pi.CHOOSE_SERVER:i=4096,r="choose server";break;case pi.CLOUD_PROXY:i=1048576,r="proxy";break;case pi.CLOUD_PROXY_5:i=4194304,r="proxy5";break;case pi.CLOUD_PROXY_FALLBACK:i=4194310,r="proxy fallback";break;default:throw new te(x.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(a=>{a.buffer&&a.buffer.flag===i&&(n={code:a.buffer.code,addresses:(a.buffer.edges_services||[]).map(l=>hb(hb({},l),{},{ticket:a.buffer.cert})),server_ts:e.enter_ts,uid:a.buffer.uid,cid:a.buffer.cid,cname:a.buffer.cname,detail:hb(hb({},a.buffer.detail),e.detail),flag:a.buffer.flag,opid:e.opid,cert:a.buffer.cert})}),!n)throw new te(x.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function AV(e,t){return await Ne.all(e.addresses.map(async n=>({address:Vu(n.ip),tcpport:n.port,udpport:n.port,username:t&&U("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():ir.username,password:t&&U("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await sI(t.toString()):ir.password})))}function sN(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||n.height,r=t.videoWidth||n.width;return i&&r?Math.max(Math.min(i,r)/Math.min(Ps(e.height),Ps(e.width)),1):(b.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function ju(e){let{candidateType:t,relayProtocol:n,type:i,address:r,port:a,protocol:l}=e;const u={candidateType:t,relayProtocol:n,protocol:l};if(i!=="local-candidate"){const h=r.split(".");h.length>=4&&(h[1]="*",h[2]="*"),u.address=h.join("."),u.port=a}return u}function Vp(e){const t=e.split(":"),n=e.split(/[-.]/),i=Re(e).call(e,"-")?"-":".";let r=e;return t.length>1?n.length>1?(n[1]="**",r=n[0]+i+"**:"+t[t.length-1]):r=t.length>2?t[0]+i+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(r=n[0]+i+"**"),r}function fb(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:U("SVC_MODE");if(U("ENABLE_SVC"))return function(t){return t in GR}(e)?e:GR.L1T3}const OV={[xe.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[xe.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function mb(e,t,n){t.forEach(i=>{var r;const a=OV[e].find(u=>{var h;let{key:f}=u;return Re(h=i.extensionName).call(h,f)});if(!a)return;const l=n.find(u=>{let{extensionName:h}=u;return Re(h).call(h,a.key)});l&&Re(r=l.extensionName).call(r,"gdpr_forbidden")&&(i.extensionName=l.extensionName)})}function E_(e,t){t.forEach(n=>{var i;const r=OV[e].find(a=>{var l;let{key:u}=a;return Re(l=n.extensionName).call(l,u)});Re(i=n.extensionName).call(i,"gdpr_forbidden")&&r&&(n.extensionName=r.extensionName)})}function IV(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Re(e).call(e,"abs-send-time")}function _b(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Re(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function NV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function DV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?NV(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function tS(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:r,filterVideoFec:a,filterAudioFec:l,filterAudioCodec:u,filterVideoCodec:h,unsupportedVideoUplinkCodec:f,unsupportedVideoDownlinkCodec:E}=t,{useXR:y}=n;let S=[],T=[],k=[],O=[],I=!1,M=!1;if(os(e).mediaDescriptions.forEach(j=>{i&&i!==j.attributes.direction||(j.media.mediaType!=="video"||I||(T=j.attributes.payloads,O=j.attributes.extmaps,I=!0),j.media.mediaType!=="audio"||M||(S=j.attributes.payloads,k=j.attributes.extmaps,M=!0))}),!O||T.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!k||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(T.forEach(j=>{var K;(K=j.rtpMap)!==null&&K!==void 0&&K.clockRate&&(j.rtpMap.clockRate=parseInt(j.rtpMap.clockRate)),y&&j.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(j=>{var K;(K=j.rtpMap)!==null&&K!==void 0&&K.clockRate&&(j.rtpMap.clockRate=parseInt(j.rtpMap.clockRate)),y&&j.rtcpFeedbacks.push({type:"rrtr"})}),r&&(S=S.filter(j=>{var K;return((K=j.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())!=="rtx"}),T=T.filter(j=>{var K;return((K=j.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())!=="rtx"})),a){const j=T.filter(H=>{var Z;return/(red)|(ulpfec)|(flexfec)/i.test(((Z=H.rtpMap)===null||Z===void 0?void 0:Z.encodingName)||"")}),K=Bu(j,T).map(H=>H.payloadType),z=[...j.map(H=>H.payloadType),...K];T=T.filter(H=>!Re(z).call(z,H.payloadType))}if(l&&(S=S.filter(j=>{var K;return!/(red)|(ulpfec)|(flexfec)/i.test(((K=j.rtpMap)===null||K===void 0?void 0:K.encodingName)||"")})),u&&(u==null?void 0:u.length)>0&&(S=S.filter(j=>{var K;return Re(u).call(u,((K=j.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())||"")})),h&&(h==null?void 0:h.length)>0){const j=T.filter(K=>{var z;return Re(h).call(h,((z=K.rtpMap)===null||z===void 0?void 0:z.encodingName.toLowerCase())||"")});T=j.concat(r?[]:Bu(j,T))}const L=U("UNSUPPORTED_VIDEO_CODEC");if(L&&L.length>0){const j=T.filter(H=>H.rtpMap&&Re(L).call(L,H.rtpMap.encodingName.toLowerCase())),K=Bu(j,T),z=j.concat(K).map(H=>H.payloadType);T=T.filter(H=>!Re(z).call(z,H.payloadType)),b.debug("unsupportedVideoCodec: ".concat(L,", toBeRemoved: ").concat(z))}if(f&&f.length>0&&i==="sendonly"){const j=T.filter(H=>H.rtpMap&&Re(f).call(f,H.rtpMap.encodingName.toLowerCase())),K=Bu(j,T),z=j.concat(K).map(H=>H.payloadType);T=T.filter(H=>!Re(z).call(z,H.payloadType)),b.debug("unsupportedVideoUplinkCodec: ".concat(f,", toBeRemoved: ").concat(z))}if(E&&E.length>0&&i==="recvonly"){const j=T.filter(H=>H.rtpMap&&Re(E).call(E,H.rtpMap.encodingName.toLowerCase())),K=Bu(j,T),z=j.concat(K).map(H=>H.payloadType);T=T.filter(H=>!Re(z).call(z,H.payloadType)),b.debug("unsupportedVideoDownlinkCodec: ".concat(E,", toBeRemoved: ").concat(z))}return{audioCodecs:S,videoCodecs:T,audioExtensions:k,videoExtensions:O}}function Fu(e){const t=os(e);let n,i;for(const r of t.mediaDescriptions){if(!n){const a=r.attributes.iceUfrag,l=r.attributes.icePwd;if(!a||!l)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:a,icePwd:l}}if(!i){const a=r.attributes.fingerprints;a.length>0&&(i={fingerprints:a})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function kV(e,t){const n=[],i=e.attributes.ssrcGroups.filter(l=>l.semantic==="FID"),r=e.attributes.ssrcGroups.find(l=>l.semantic==="SIM"),a=e.attributes.ssrcs;if(r)r.ssrcIds.forEach(l=>{var u;const h=(u=i.find(f=>f.ssrcIds[0]===l))===null||u===void 0?void 0:u.ssrcIds[1];n.push({ssrcId:l,rtx:t?h:void 0})});else if(i.length>0){const l=i[0].ssrcIds[0],u=i[0].ssrcIds[1];n.push({ssrcId:l,rtx:t?u:void 0})}else{if(a.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:a[0].ssrcId})}return n}function PV(e,t,n){const{cname:i}=e;let r=[];t&&(r=LV(t)),r.length===0&&(r=e.iceParameters.candidates.map(E=>({foundation:E.foundation,componentId:"1",transport:E.protocol,priority:E.priority.toString(),connectionAddress:E.ip,port:E.port.toString(),type:E.type,extension:{}})),b.debug("Using candidates from gateway."));const a={fingerprints:e.dtlsParameters.fingerprints.map(E=>({hashFunction:E.algorithm,fingerprint:E.fingerprint}))},l={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let u;switch(e.dtlsParameters.role){case"server":u="passive";break;case"client":u="active";break;case"auto":u="actpass"}const h=gb(e.rtpCapabilities),f=[];return Array.isArray(n)&&n.length>0&&n.forEach(E=>{f.push({kind:xe.VIDEO,ssrcMsg:[{ssrcId:E.v,rtx:E.v_rtx}],mslabel:"".concat(E.v,"_").concat(E.a)},{kind:xe.AUDIO,ssrcMsg:[{ssrcId:E.a}],mslabel:"".concat(E.v,"_").concat(E.a)})}),{dtlsParameters:a,iceParameters:l,candidates:r,rtpCapabilities:h,setup:u,cname:i,preSSRCs:f}}function LV(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],b.debug("Using remote candidate from AP ".concat(Vp(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),b.debug("Using IPV6 remote candidate from AP ".concat(Vp(e.ip6),":").concat(e.port)))),t}function nS(e,t,n){const i=[],r=[];return e.forEach(a=>{let{ssrcId:l,rtx:u}=a;const h=yn(8,"track-"),f={ssrcId:l,attributes:DV({label:h,mslabel:n=n||yn(10,""),msid:"".concat(n," ").concat(h)},t&&{cname:t})};if(i.push(f),u!==void 0){const E={ssrcId:u,attributes:DV({label:h,mslabel:n,msid:"".concat(n," ").concat(h)},t&&{cname:t})};i.push(E),r.push({semantic:"FID",ssrcIds:[l,u]})}}),e.length>1&&r.push({semantic:"SIM",ssrcIds:e.map(a=>{let{ssrcId:l}=a;return l})}),{ssrcs:i,ssrcGroups:r}}function g_(e,t){t instanceof ni&&e.attributes.payloads.forEach(n=>{var i;const r=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!r||["opus","pcmu","pcma","g722"].indexOf(r)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),r==="opus"&&typeof U("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=U("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const a=t._encoderConfig;a&&(r!=="pcmu"&&r!=="pcma"&&r!=="g722"&&(a.bitrate&&!qn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*a.bitrate))),a.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(a.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(a.sampleRate)),a.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof qy&&r==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function aN(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function oN(e,t){var n;if(!(t instanceof In&&t._encoderConfig&&t._hints.indexOf(hn.SCREEN_TRACK)===-1))return;const i=t._encoderConfig;Bt().supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach(r=>{var a,l;Re(a=["h264","h265","vp8","vp9","av1"]).call(a,((l=r.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),Bt().supportMinBitrate&&!Re(n=t._hints).call(n,hn.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach(r=>{var a,l;Re(a=["h264","h265","vp8","vp9","av1"]).call(a,((l=r.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(U("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function MV(e){if(e.media.mediaType!=="video")return;const t=xt();if(t.name!==Wt.SAFARI&&t.os!==Di.IOS)return;const n=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function Eb(e,t,n){if(!t)return;let i,r;if(e.media.mediaType==="video"?(i=n.videoExtensions,r=n.videoCodecs):(i=n.audioExtensions,r=n.audioCodecs),t.twcc===!0){const a=i.find(l=>_b(l.extensionName));if(a){const l=a.extensionName;e.attributes.extmaps.find(h=>_b(h.extensionName))||e.attributes.extmaps.push({entry:a.entry,extensionName:l}),function(h,f){return f.filter(E=>!!h.find(y=>y.payloadType===E.payloadType&&!!y.rtcpFeedbacks.find(S=>S.type==="transport-cc")))}(r,e.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(f=>f.type==="transport-cc")||h.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const a=e.attributes.extmaps.findIndex(l=>_b(l.extensionName));a!==-1&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach(l=>{const u=l.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}if(t.remb===!0){const a=i.find(l=>IV(l.extensionName));if(a){const l=a.extensionName;e.attributes.extmaps.find(h=>h.extensionName===l)||e.attributes.extmaps.push({entry:a.entry,extensionName:l}),function(h,f){return f.filter(E=>!!h.find(y=>y.payloadType===E.payloadType&&!!y.rtcpFeedbacks.find(S=>S.type==="goog-remb")))}(r,e.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(f=>f.type==="goog-remb")||h.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const a=e.attributes.extmaps.findIndex(l=>IV(l.extensionName));a!==-1&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach(l=>{const u=l.rtcpFeedbacks.findIndex(h=>h.type==="goog-remb");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}}function xV(e,t,n){if(qn()||e.media.mediaType!=="video"||!(t instanceof In)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!U("SIMULCAST")||n==="vp9"&&U("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,r=e.attributes.ssrcs[0],a=e.attributes.ssrcGroups.find(u=>u.semantic==="FID"&&u.ssrcIds[0]===r.ssrcId),l={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let u=1;u<i;u++)e.attributes.ssrcs.push({ssrcId:r.ssrcId+u,attributes:jn(r.attributes)}),l.ssrcIds.push(r.ssrcId+u),a&&(e.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+u,attributes:jn(r.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+u,a.ssrcIds[1]+u]}));e.attributes.ssrcGroups.unshift(l)}async function UV(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:r,recv:a,sendrecv:l}=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;const E=tS(f,u,h,"sendonly"),y=tS(f,u,h,"recvonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(oo(E,y,"videoExtensions",S,T,k),oo(E,y,"videoCodecs",S,T,k),oo(E,y,"audioExtensions",S,T,k),oo(E,y,"audioCodecs",S,T,k),U("RAISE_H264_BASELINE_PRIORITY")){const O=[],I=[];if(k.videoCodecs.forEach((M,L)=>{var j;if(((j=M.rtpMap)===null||j===void 0?void 0:j.encodingName.toLocaleLowerCase())==="h264"){var K,z;const H=k.videoCodecs[L+1],Z=H&&GV(M,H),se=(K=M.fmtp)===null||K===void 0?void 0:K.parameters["profile-level-id"],ue=(z=M.fmtp)===null||z===void 0?void 0:z.parameters["packetization-mode"];!se||se!==U("FIRST_H264_PROFILE_LEVEL_ID")||U("FIRST_PACKETIZATION_MODE")&&ue!==U("FIRST_PACKETIZATION_MODE")?Z?I.push([M,H]):I.push([M]):Z?O.push([M,H]):O.push([M])}}),O.length>0&&I.length>0){b.debug("raising H264 baseline profile priority"),k.videoCodecs.forEach((L,j)=>{var K;if(((K=L.rtpMap)===null||K===void 0?void 0:K.encodingName.toLocaleLowerCase())==="h264"){const z=GV(L,k.videoCodecs[j+1]),H=O.shift()||I.shift()||[];H.length>0&&(z?k.videoCodecs.splice(j,2,...H):k.videoCodecs.splice(j,1,...H))}});const M=T.videoCodecs.filter(L=>{var j,K;return((j=L.rtpMap)===null||j===void 0?void 0:j.encodingName.toLocaleLowerCase())==="h264"&&((K=L.fmtp)===null||K===void 0?void 0:K.parameters["profile-level-id"])!==U("FIRST_H264_PROFILE_LEVEL_ID")});if(M.length>0){const L=Bu(M,T.videoCodecs).map(K=>K.payloadType),j=[...M.map(K=>K.payloadType),...L];T.videoCodecs=T.videoCodecs.filter(K=>!Re(j).call(j,K.payloadType))}U("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(L=>{var j,K;return!(((j=L.rtpMap)===null||j===void 0?void 0:j.encodingName.toLocaleLowerCase())==="h264"&&((K=L.fmtp)===null||K===void 0?void 0:K.parameters["profile-level-id"])!==U("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:S,recv:T,sendrecv:k}}return{send:S,recv:T,sendrecv:k}}(e,t,i);try{n.close()}catch{}return{send:r,recv:a,sendrecv:l}}function VV(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=tS(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(oo(e,t,"videoExtensions",n,i,r),oo(e,t,"videoCodecs",n,i,r),oo(e,t,"audioExtensions",n,i,r),oo(e,t,"audioCodecs",n,i,r),U("RAISE_H264_BASELINE_PRIORITY")){const a=r.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]==="42001f");if(a!==-1){const l=r.videoCodecs.findIndex(u=>u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(l<a){b.debug("raising H264 baseline profile priority");const u=r.videoCodecs[a];r.videoCodecs.splice(a,1),r.videoCodecs.splice(l,0,u)}l!==-1&&(i.videoCodecs=i.videoCodecs.filter(u=>!(u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&u.fmtp&&u.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:r}}function oo(e,t,n,i,r,a){if(n==="videoExtensions"||n==="audioExtensions"){const l=[];return e[n].forEach(u=>{t[n].some((h,f)=>{if(u.entry===h.entry&&u.extensionName===h.extensionName)return l.push(f),!0})?a[n].push(u):i[n].push(u)}),void t[n].forEach((u,h)=>{l.indexOf(h)===-1&&r[n].push(u)})}if(n==="videoCodecs"||n==="audioCodecs"){const l=[];return e[n].forEach(u=>{t[n].some((h,f)=>{if(u.payloadType===h.payloadType&&JSON.stringify(u)===JSON.stringify(h))return l.push(f),!0})?a[n].push(u):i[n].push(u)}),void t[n].forEach((u,h)=>{l.indexOf(h)===-1&&r[n].push(u)})}}function gb(e){const{send:t,recv:n,sendrecv:i}=e;if(!i){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let r,a;return t?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...t.audioCodecs,...i.audioCodecs],r.videoCodecs=[...t.videoCodecs,...i.videoCodecs],r.audioExtensions=[...t.audioExtensions,...i.audioExtensions],r.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):r=i,n?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...n.audioCodecs,...i.audioCodecs],a.videoCodecs=[...n.videoCodecs,...i.videoCodecs],a.audioExtensions=[...n.audioExtensions,...i.audioExtensions],a.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):a=i,{send:r,recv:a}}function y_(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function iS(e,t,n,i){let r=[];if(e===xe.VIDEO){if(U("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(r=t.videoCodecs.filter(a=>{var l;return Re(l=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(l,i)&&a&&a.fmtp&&a.fmtp.parameters["profile-level-id"]===U("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||r.length===0){let a=[];const l=[],u=[],h=[];if(n.videoCodecs.forEach(f=>{const E=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"";Re(E).call(E,i)?a.push(f):Re(E).call(E,"vp9")?l.push(f):Re(E).call(E,"vp8")?u.push(f):Re(E).call(E,"h264")&&h.push(f)}),a.length===0){let f="";l.length!==0?(a=l,f="vp9"):u.length!==0?(a=u,f="vp8"):h.length!==0&&(a=h,f="h264"),b.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(f))}a.length!==0&&(r=t.videoCodecs.filter(f=>a.some(E=>E.payloadType===f.payloadType)))}if(r.length===0&&(b.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),r=t.videoCodecs),U("USE_PUB_RTX")||U("USE_SUB_RTX")){const a=Bu(r,t.videoCodecs);r=[...r,...a]}}else{r=t.audioCodecs.filter(l=>{var u;return Re(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,i)});const a=t.audioCodecs.filter(l=>{var u;return Re(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,"red")});r.length===0&&(b.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),r=t.audioCodecs.filter(l=>{var u;return Re(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,"opus")})),U("ENABLE_AUDIO_RED")&&a.length!==0&&(r=[...a,...r])}return r}function Bu(e,t){const n=e.map(i=>i.payloadType.toString());return t.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&Re(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function Gu(e,t,n){const i=t.toString(),r=FV(i,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:i});const a=await e.createAnswer();if(!a.sdp)throw new Error("cannot get answer sdp");let l=a.sdp;l=jV(l,n||{}),r==null||r(l||""),await e.setLocalDescription({type:"answer",sdp:l})}function jV(e,t,n){const i=os(e),{useXR:r}=t;return i.mediaDescriptions.forEach(a=>{var l;a.attributes.mid&&(Array.isArray(n)&&!Re(n).call(n,a.attributes.mid)||(a.media.mediaType==="audio"&&y_(a),r&&Re(l=["audio","video"]).call(l,a.media.mediaType)&&a.attributes.payloads.forEach(u=>{u.rtcpFeedbacks.findIndex(h=>h.type==="rrtr")===-1&&u.rtcpFeedbacks.push({type:"rrtr"})})))}),Lu(i)}function FV(e,t,n,i){if(U("SDP_LOGGING"))return b.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(i,`
`),e),t==="offer"?r=>{FV(r,"answer",n==="local"?"remote":"local",i)}:void 0}function BV(e){const t=U("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>Re(e).call(e,n))}function GV(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function HV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function sa(e,t){return typeof U(e)===t?U(e):void 0}function MY(){try{const e=U("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?HV(Object(i),!0).forEach(function(r){P(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):HV(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}({},e)}catch(e){return b.debug("handle gateway attributes failed: ",e),{}}}const WV={};function Hu(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&b.debug("install service ".concat(e.name)),WV[e.name]=e}function ld(e){const t=WV[e];if(!t)throw new re(x.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function YV(e,t){return ld("DataStream").create(e,t)}function yb(){return ld("InterceptFrame").create()}function zV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Tr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zV(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const cN=new Map;class xY extends Wn{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Vi.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(Vi.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){b.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var i,r,a;super(),P(this,"store",void 0),P(this,"joinInfo",void 0),P(this,"key",void 0),P(this,"ntpOffset",0),P(this,"signal",void 0),P(this,"role",void 0),P(this,"isPreallocation",void 0),P(this,"isPreSub",void 0),P(this,"inChannelInfo",{joinAt:null,duration:0}),P(this,"spec",void 0),P(this,"_state","DISCONNECTED"),P(this,"_statsCollector",void 0),P(this,"_disconnectedReason",void 0),P(this,"isSignalRecover",!1),P(this,"hasChangeBGPAddress",!1),P(this,"trafficStatsInterval",void 0),P(this,"networkQualityInterval",void 0),P(this,"_joinGatewayStartTime",0),P(this,"_signalTimeout",!1),P(this,"_clientRoleOptions",void 0),P(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(i={spec:Tr(Tr({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(r=(a=ld("P2PChannel")).createSubmodule)===null||r===void 0?void 0:r.call(a,i)):new PY(Tr(Tr({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,i){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const r=Date.now();let a=cN.get(t.cname);if(a||(a=new Map,cN.set(t.cname,a)),this._isProactiveJoin=!0,a.has(t.uid)){const f=new te(x.UID_CONFLICT);throw He.joinGateway(t.sid,{lts:r,succ:!1,ec:f.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),f}a.set(t.uid,!0),this.joinInfo=t,this.key=n;let l=0;this.joinGatewayStartTime=r;const u=t.proxyServer;try{b.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(l));const f=t.gatewayAddrs.map(E=>{let{address:y}=E;const[S,T]=y.split(":"),k={host:S,port:T};return t.proxyServer&&(k.proxy=t.proxyServer),k});l=(await this.signal.init(f)).uid,b.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(l," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(f){var h;throw b.error("[".concat(this.store.clientId,"] User join failed"),f.toString()),He.joinGateway(t.sid,{lts:r,succ:!1,ec:((h=f.data)===null||h===void 0?void 0:h.desc)||f.code,errorMsg:f.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!u,signalChannel:"0",preload:t.preload}),a.delete(t.uid),this.signal.close(),f}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),b.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(f=>{b.warning("[".concat(this.store.clientId,"] get traffic stats error"),f.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Vi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Vi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Vi.NETWORK_QUALITY,{uplinkNetworkQuality:wV(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:wV(this._statsCollector.trafficStats.B_dnq)}):this.emit(Vi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),l}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Qt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==wn.CONNECTED||await function(i,r){return r===1/0?i:Ne.race([i,oW(r)])}(this.signal.request(st.LEAVE,void 0,!0),3e3)}catch(i){b.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==Qt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:U("PUB_EXTEND"),twcc:!!U("PUBLISH_TWCC"),rtx:!!U("USE_PUB_RTX")};try{return(await this.signal.request(st.PUBLISH,r,!0))._message}catch(a){if(i&&a.data&&a.data.code===et.ERR_PUBLISH_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),a.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw a}}async publishDataChannel(t,n,i){var r;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const a={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(r=n.maxRetransmits)!==null&&r!==void 0?r:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(st.PUBLISH_DATASTREAM,a,!0)}catch(l){if(i&&l.data&&l.data.code===et.ERR_PUBLISH_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),l.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw l}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(st.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(i){b.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ne.all(t.map(n=>this.signal.request(st.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){b.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!U("SUBSCRIBE_TWCC"),rtx:!!U("USE_SUB_RTX")||void 0,extend:U("SUB_EXTEND"),svc:Array.isArray(U("SVC"))&&U("SVC").length!==0?U("SVC"):void 0};try{return await this.signal.request(st.PRE_SUBSCRIBE,r,!0)}catch(a){if(i&&a.data&&a.data.code===et.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),a.toString()),this.presubscribe(t,n,!1);throw a}}async subscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!U("SUBSCRIBE_TWCC"),rtx:!!U("USE_SUB_RTX"),extend:U("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(U("SVC"))&&U("SVC").length!==0?U("SVC"):void 0};try{return(await this.signal.request(st.SUBSCRIBE,r,!0))._message}catch(a){if(i&&a.data&&a.data.code===et.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),a.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw a}}async subscribeDataChannel(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(st.SUBSCRIBE_DATASTREAM,r,!0)}catch(a){if(i&&a.data&&a.data.code===et.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),a.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw a}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!U("USE_SUB_RTX"),twcc:!!U("SUBSCRIBE_TWCC"),svc:Array.isArray(U("SVC"))&&U("SVC").length!==0?U("SVC"):void 0};try{return await this.signal.request(st.SUBSCRIBE_STREAMS,i,!0)}catch(r){if(n&&r.data&&r.data.code===et.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw r}}async setVideoProfile(t){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let r=i.frameRate,a=i.width,l=i.height,u=!0;return typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(u=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(u=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,r||(u=!1)),u?{stream_type:0,width:a,height:l,fps:r,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(n)return this.signal.request(st.SET_VIDEO_PROFILE,n);b.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(st.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(i){b.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ne.all(t.map(i=>this.signal.request(st.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){b.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(st.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){b.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}=t;return{gatewayEstablishParams:await this.signal.request(st.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(st.GATEWAY_INFO)}async renewToken(t){await this.signal.request(st.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),U("CLIENT_ROLE_OPTIONS")&&(b.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(U("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},U("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),U("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},U("CLIENT_ROLE_OPTIONS")),b.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(U("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let i,r=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0;const a=Object.assign({},n);delete a.delay,delete a.level,await this.signal.request(st.SET_CLIENT_ROLE,Tr(Tr({role:t,level:r,delay:i},a),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(st.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(st.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(st.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(st.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(st.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Tr({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(st.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=cN.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:ir.username,password:ir.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Tr(Tr({},ir),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(st.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(r=>r.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&VR(()=>{this.emit(Vi.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,i;if(!this.joinInfo||!this.key)throw new te(x.UNEXPECTED_ERROR,"can not generate join message, no join info");const r=Object.assign({},this.joinInfo.apResponse);let a=U("REPORT_APP_SCENARIO");if(typeof a!="string")try{a=JSON.stringify(a)}catch{a=void 0}var l;a&&a.length>128&&(a=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Vi.UPDATE_GATEWAY_CONFIG),l=this.store.clientId,Re(h_).call(h_,l)||h_.push(l);const u=RI(this.store),h=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),f=XM(this.store),E=MY(),y=Km(87)||rM()||ZO(117),S=(function(){const k=xt();if(k.name!==Wt.SAFARI||!k.browserVersion)return!1;const O=k.browserVersion.split(".");return Number(O[0])>18||Number(O[0])===18&&Number(O[1])>=4}()||cM(18,4,!1))&&QO(18,6,!0)&&this.spec.codec==="h264"&&U("ENABLE_ABSSENDTIME_AS_SENTTS"),T=Tr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Sa,browser:navigator.userAgent,process_id:U("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:U("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:Tr(Tr({enableEncodedTransform:(!!U("ENABLE_AUDIO_METADATA")||!!U("ENABLE_AUDIO_PTS"))&&y||!!U("ENABLE_AUDIO_TOPN")&&XO(Wt.CHROME,87,116)||void 0,enableAudioMetadata:!!U("ENABLE_AUDIO_METADATA")&&y,enableAudioPts:!!U("ENABLE_AUDIO_PTS")&&y,topnSmoothLevel:U("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:U("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:U("TOPN_SWITCH_HOLD_MS"),topnAudioGain:U("TOPN_AUDIO_GAIN"),enablePublishedUserList:U("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:U("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:sa("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:sa("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:sa("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:U("USE_PUB_RTX")===!0||U("USE_SUB_RTX")===!0||void 0,disableFEC:U("DISABLE_FEC"),enableNTPReport:!!U("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:f,enableFulllinkAvSync:!!U("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:sa("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!U("FORCE_ENABLE_AUT_CC")||!YR()&&(!!U("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!U("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:sa("USE_XR","boolean"),enableLossbasedBwe:sa("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!U("FORCE_ENABLE_AUT_CC")||!YR()&&(!!U("ENABLE_AUT_CC")||void 0),enableCCFallback:sa("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?sa("PRE_SUB_NUM","number"):void 0,enablePubTWCC:sa("PUBLISH_TWCC","boolean"),enableSubTWCC:sa("SUBSCRIBE_TWCC","boolean"),enablePubRTX:sa("USE_PUB_RTX","boolean"),enableSubRTX:sa("USE_SUB_RTX","boolean"),enableSubSVC:U("ENABLE_SVC")?U("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(U("SVC"))&&U("SVC").length!==0?U("SVC"):void 0,enableSvcExtended:U("ENABLE_SVC")&&Array.isArray(U("SVC_EXTENDED"))&&U("SVC_EXTENDED").length!==0?U("SVC_EXTENDED"):void 0},E),{},{audioDuplicate:sa("ENABLE_AUDIO_RED","boolean")?(i=sa("AUDIO_DUPLICATE_NUM","number"))!==null&&i!==void 0?i:2:void 0,senttsUsesAbsSendTime:!!S||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(T.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(T.aes_mode=this.joinInfo.aesmode,U("ENCRYPT_AES")?(T.aes_secret=this.joinInfo.aespassword,T.aes_encrypt=!0):T.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(T.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(T.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),this.joinInfo.defaultVideoStream!==void 0&&(T.default_video_stream=this.joinInfo.defaultVideoStream),T}getRejoinMessage(){if(!this.joinInfo)throw new te(x.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(lt.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(lt.WS_RECONNECTING,t=>{this.joinInfo&&He.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||tr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",He.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(lt.WS_CLOSED,t=>{let n;switch(t){case Qt.LEAVE:n=tr.LEAVE;break;case Qt.UID_BANNED:case Qt.IP_BANNED:case Qt.CHANNEL_BANNED:case Qt.SERVER_ERROR:n=tr.SERVER_ERROR;break;case Qt.FALLBACK:n=tr.FALLBACK;break;case Qt.LICENSE_MISSING:case Qt.LICENSE_EXPIRED:case Qt.LICENSE_MINUTES_EXCEEDED:case Qt.LICENSE_PERIOD_INVALID:case Qt.LICENSE_MULTIPLE_SDK_SERVICE:case Qt.LICENSE_ILLEGAL:case Qt.TOKEN_EXPIRE:n=t;break;default:n=tr.NETWORK_ERROR}b.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+tr.NETWORK_ERROR)),this.joinInfo&&He.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Qt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Qt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(lt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=U("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(b.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(He.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void b.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));on("EVENT_REPORT_DOMAIN",t[1]),on("EVENT_REPORT_BACKUP_DOMAIN",t[1]),on("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(Pt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(lt.REQUEST_RECOVER,(t,n,i)=>{if(!this.joinInfo)return i(new te(x.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,nr(this,Vi.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(lt.REQUEST_JOIN_INFO,async(t,n,i)=>{var r,a,l;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const u=jn((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(U("NEW_TURN_MODE")&&u&&((a=this.joinInfo)===null||a===void 0?void 0:a.cloudProxyServer)==="disabled"){var h;let S=u.servers.map(O=>"turnServerURL"in O&&U("USE_TURN_IP")?Tr(Tr({},O),{},{turnServerURL:pb(O.turnServerURL)}):O),T=(h=u.serversFromGateway)===null||h===void 0?void 0:h.map(O=>U("USE_TURN_IP")?Tr(Tr({},O),{},{turnServerURL:pb(O.turnServerURL)}):O);const k=this.signal.currentURLIndex;S.length>0&&(S=[S[k%S.length]],u.servers=S),Array.isArray(T)&&T.length>0&&(T=[T[0]],u.serversFromGateway=T),b.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(k))}const{iceParameters:f,dtlsParameters:E,rtpCapabilities:y}=await nr(this,Vi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u,cloudProxyServer:(l=this.joinInfo)===null||l===void 0?void 0:l.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:f,dtlsParameters:E,rtpCapabilities:y,version:"2"}}))}catch(S){n(S)}}),this.signal.on(lt.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(lt.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let i,r="";var a;t instanceof te?(i=((a=t.data)===null||a===void 0?void 0:a.desc)||t.code,r=t.message):i=t,He.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:r,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(lt.IS_P2P_DISCONNECTED,t=>{t(By(this,Vi.IS_P2P_DISCONNECTED))}),this.signal.on(lt.DISCONNECT_P2P,()=>{this.emit(Vi.DISCONNECT_P2P)}),this.signal.on(lt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(lt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(lt.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(Vi.JOIN_RESPONSE,t,n)}),this.signal.on(lt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var t,n;this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),a=jn((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(U("NEW_TURN_MODE")&&a&&((n=this.joinInfo)===null||n===void 0?void 0:n.cloudProxyServer)==="disabled"){var i;let u=a.servers.map(E=>"turnServerURL"in E&&U("USE_TURN_IP")?Tr(Tr({},E),{},{turnServerURL:pb(E.turnServerURL)}):E),h=(i=a.serversFromGateway)===null||i===void 0?void 0:i.map(E=>U("USE_TURN_IP")?Tr(Tr({},E),{},{turnServerURL:pb(E.turnServerURL)}):E);const f=this.signal.currentURLIndex;u.length>0&&(u=[u[f%u.length]],a.servers=u),Array.isArray(h)&&h.length>0&&(h=[h[0]],a.serversFromGateway=h),b.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(f,",in pre pc"))}const l=U("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&l){const u=LV(r);this.emit(Vi.PRE_CONNECT_PC,{candidates:u,fingerprint:l,turnServer:a})}}}),this.signal.on(lt.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof U("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(U("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(st.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(st.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw b.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(st.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(st.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw b.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(t){const n={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(st.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,n){const i={action:t.find(r=>r.stream_type===tn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(st.CONTROL,i,!0,!0)}catch(r){throw b.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(t,n){const i={action:t.find(r=>r.stream_type===tn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(st.CONTROL,i,!0,!0)}catch(r){throw b.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(t,n){const i={action:t===xe.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(st.CONTROL,i,!0,!0)}catch(r){throw b.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(t,n){const i={action:t===xe.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(st.CONTROL,i,!0,!0)}catch(r){throw b.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(st.RESTART_ICE,n,!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||tr.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!U("GATEWAY_WSS_ADDRESS"))return U("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(b.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(st.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let Sb=0,lN=0;function Jo(e,t,n,i){return new Ne((r,a)=>{t.timeout=t.timeout||U("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Sb+=Jc(t.data)):n&&(t.data.size?Sb+=t.data.size:t.data instanceof FormData?Sb+=bM(t.data):Sb+=Jc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Zr.request(t).then(l=>{typeof l.data=="string"?lN+=Jc(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?lN+=l.data.byteLength:lN+=Jc(JSON.stringify(l.data)),i&&r({data:l.data,headers:l.headers}),r(l.data)}).catch(l=>{Zr.isCancel(l)?a(new te(x.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?a(new te(x.NETWORK_TIMEOUT,l.message)):l.response?a(new te(x.NETWORK_RESPONSE_ERROR,l.response.status)):a(new te(x.NETWORK_ERROR,l.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(le){var Te=0;return function(){return Te<le.length?{done:!1,value:le[Te++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(le,Te,Ve){return le==Array.prototype||le==Object.prototype||(le[Te]=Ve.value),le},i,r=function(le){le=[typeof globalThis=="object"&&globalThis,le,typeof window=="object"&&window,typeof self=="object"&&self,typeof _=="object"&&_];for(var Te=0;Te<le.length;++Te){var Ve=le[Te];if(Ve&&Ve.Math==Math)return Ve}throw Error("Cannot find global object")}(this);function a(le,Te){if(Te)e:{var Ve=r;le=le.split(".");for(var he=0;he<le.length-1;he++){var A=le[he];if(!(A in Ve))break e;Ve=Ve[A]}(Te=Te(he=Ve[le=le[le.length-1]]))!=he&&Te!=null&&n(Ve,le,{configurable:!0,writable:!0,value:Te})}}function l(le){return(le={next:le})[Symbol.iterator]=function(){return this},le}function u(le){var Te=typeof Symbol<"u"&&Symbol.iterator&&le[Symbol.iterator];return Te?Te.call(le):{next:t(le)}}if(a("Symbol",function(le){function Te(A,G){this.A=A,n(this,"description",{configurable:!0,writable:!0,value:G})}if(le)return le;Te.prototype.toString=function(){return this.A};var Ve="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",he=0;return function A(G){if(this instanceof A)throw new TypeError("Symbol is not a constructor");return new Te(Ve+(G||"")+"_"+he++,G)}}),a("Symbol.iterator",function(le){if(le)return le;le=Symbol("Symbol.iterator");for(var Te="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ve=0;Ve<Te.length;Ve++){var he=r[Te[Ve]];typeof he=="function"&&typeof he.prototype[le]!="function"&&n(he.prototype,le,{configurable:!0,writable:!0,value:function(){return l(t(this))}})}return le}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var h;e:{var f={};try{f.__proto__={a:!0},h=f.a;break e}catch{}h=!1}i=h?function(le,Te){if(le.__proto__=Te,le.__proto__!==Te)throw new TypeError(le+" is not extensible");return le}:null}var E=i;function y(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function S(le){if(le.m)throw new TypeError("Generator is already running");le.m=!0}function T(le,Te){return le.h=3,{value:Te}}function k(le){this.g=new y,this.G=le}function O(le,Te,Ve,he){try{var A=Te.call(le.g.j,Ve);if(!(A instanceof Object))throw new TypeError("Iterator result "+A+" is not an object");if(!A.done)return le.g.m=!1,A;var G=A.value}catch(Y){return le.g.j=null,le.g.s(Y),I(le)}return le.g.j=null,he.call(le.g,G),I(le)}function I(le){for(;le.g.h;)try{var Te=le.G(le.g);if(Te)return le.g.m=!1,{value:Te.value,done:!1}}catch(Ve){le.g.v=void 0,le.g.s(Ve)}if(le.g.m=!1,le.g.l){if(Te=le.g.l,le.g.l=null,Te.F)throw Te.D;return{value:Te.return,done:!0}}return{value:void 0,done:!0}}function M(le){this.next=function(Te){return le.o(Te)},this.throw=function(Te){return le.s(Te)},this.return=function(Te){return function(Ve,he){S(Ve.g);var A=Ve.g.j;return A?O(Ve,"return"in A?A.return:function(G){return{value:G,done:!0}},he,Ve.g.return):(Ve.g.return(he),I(Ve))}(le,Te)},this[Symbol.iterator]=function(){return this}}function L(le,Te){return Te=new M(new k(Te)),E&&le.prototype&&E(Te,le.prototype),Te}if(y.prototype.o=function(le){this.v=le},y.prototype.s=function(le){this.l={D:le,F:!0},this.h=this.C||this.u},y.prototype.return=function(le){this.l={return:le},this.h=this.u},k.prototype.o=function(le){return S(this.g),this.g.j?O(this,this.g.j.next,le,this.g.o):(this.g.o(le),I(this))},k.prototype.s=function(le){return S(this.g),this.g.j?O(this,this.g.j.throw,le,this.g.o):(this.g.s(le),I(this))},a("Array.prototype.entries",function(le){return le||function(){return function(Te,Ve){Te instanceof String&&(Te+="");var he=0,A=!1,G={next:function(){if(!A&&he<Te.length){var Y=he++;return{value:Ve(Y,Te[Y]),done:!1}}return A=!0,{done:!0,value:void 0}}};return G[Symbol.iterator]=function(){return G},G}(this,function(Te,Ve){return[Te,Ve]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var j=function(le,Te){for(var Ve=0;Ve<le.length;Ve++)Te(le[Ve])},K=function(le){return le.replace(/\r?\n|\r/g,`\r
`)},z=function(le,Te,Ve){return Te instanceof Blob?(Ve=Ve!==void 0?Ve+"":typeof Te.name=="string"?Te.name:"blob",Te.name===Ve&&Object.prototype.toString.call(Te)!=="[object Blob]"||(Te=new File([Te],Ve)),[String(le),Te]):[String(le),String(Te)]},H=function(le,Te){if(le.length<Te)throw new TypeError(Te+" argument required, but only "+le.length+" present.")},Z=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,se=Z.FormData,ue=Z.XMLHttpRequest&&Z.XMLHttpRequest.prototype.send,Ee=Z.Request&&Z.fetch,Rt=Z.navigator&&Z.navigator.sendBeacon,At=Z.Element&&Z.Element.prototype,ot=Z.Symbol&&Symbol.toStringTag;ot&&(Blob.prototype[ot]||(Blob.prototype[ot]="Blob"),"File"in Z&&!File.prototype[ot]&&(File.prototype[ot]="File"));try{new File([],"")}catch{Z.File=function(Te,Ve,he){return Te=new Blob(Te,he||{}),Object.defineProperties(Te,{name:{value:Ve},lastModified:{value:+(he&&he.lastModified!==void 0?new Date(he.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ot&&Object.defineProperty(Te,ot,{value:"File"}),Te}}var Kt=function(le){return le.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Yt=function(le){this.i=[];var Te=this;le&&j(le.elements,function(Ve){if(Ve.name&&!Ve.disabled&&Ve.type!=="submit"&&Ve.type!=="button"&&!Ve.matches("form fieldset[disabled] *"))if(Ve.type==="file"){var he=Ve.files&&Ve.files.length?Ve.files:[new File([],"",{type:"application/octet-stream"})];j(he,function(A){Te.append(Ve.name,A)})}else Ve.type==="select-multiple"||Ve.type==="select-one"?j(Ve.options,function(A){!A.disabled&&A.selected&&Te.append(Ve.name,A.value)}):Ve.type==="checkbox"||Ve.type==="radio"?Ve.checked&&Te.append(Ve.name,Ve.value):(he=Ve.type==="textarea"?K(Ve.value):Ve.value,Te.append(Ve.name,he))})};if((e=Yt.prototype).append=function(le,Te,Ve){H(arguments,2),this.i.push(z(le,Te,Ve))},e.delete=function(le){H(arguments,1);var Te=[];le=String(le),j(this.i,function(Ve){Ve[0]!==le&&Te.push(Ve)}),this.i=Te},e.entries=function le(){var Te,Ve=this;return L(le,function(he){if(he.h==1&&(Te=0),he.h!=3)return Te<Ve.i.length?he=T(he,Ve.i[Te]):(he.h=0,he=void 0),he;Te++,he.h=2})},e.forEach=function(le,Te){H(arguments,1);for(var Ve=u(this),he=Ve.next();!he.done;he=Ve.next()){var A=u(he.value);he=A.next().value,A=A.next().value,le.call(Te,A,he,this)}},e.get=function(le){H(arguments,1);var Te=this.i;le=String(le);for(var Ve=0;Ve<Te.length;Ve++)if(Te[Ve][0]===le)return Te[Ve][1];return null},e.getAll=function(le){H(arguments,1);var Te=[];return le=String(le),j(this.i,function(Ve){Ve[0]===le&&Te.push(Ve[1])}),Te},e.has=function(le){H(arguments,1),le=String(le);for(var Te=0;Te<this.i.length;Te++)if(this.i[Te][0]===le)return!0;return!1},e.keys=function le(){var Te,Ve,he,A,G=this;return L(le,function(Y){if(Y.h==1&&(Te=u(G),Ve=Te.next()),Y.h!=3)return Ve.done?void(Y.h=0):(he=Ve.value,A=u(he),T(Y,A.next().value));Ve=Te.next(),Y.h=2})},e.set=function(le,Te,Ve){H(arguments,2),le=String(le);var he=[],A=z(le,Te,Ve),G=!0;j(this.i,function(Y){Y[0]===le?G&&(G=!he.push(A)):he.push(Y)}),G&&he.push(A),this.i=he},e.values=function le(){var Te,Ve,he,A,G=this;return L(le,function(Y){if(Y.h==1&&(Te=u(G),Ve=Te.next()),Y.h!=3)return Ve.done?void(Y.h=0):(he=Ve.value,(A=u(he)).next(),T(Y,A.next().value));Ve=Te.next(),Y.h=2})},Yt.prototype._asNative=function(){for(var le=new se,Te=u(this),Ve=Te.next();!Ve.done;Ve=Te.next()){var he=u(Ve.value);Ve=he.next().value,he=he.next().value,le.append(Ve,he)}return le},Yt.prototype._blob=function(){var le="----formdata-polyfill-"+Math.random(),Te=[],Ve="--"+le+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(he,A){return typeof he=="string"?Te.push(Ve+Kt(K(A))+`"\r
\r
`+K(he)+`\r
`):Te.push(Ve+Kt(K(A))+'"; filename="'+Kt(he.name)+`"\r
Content-Type: `+(he.type||"application/octet-stream")+`\r
\r
`,he,`\r
`)}),Te.push("--"+le+"--"),new Blob(Te,{type:"multipart/form-data; boundary="+le})},Yt.prototype[Symbol.iterator]=function(){return this.entries()},Yt.prototype.toString=function(){return"[object FormData]"},At&&!At.matches&&(At.matches=At.matchesSelector||At.mozMatchesSelector||At.msMatchesSelector||At.oMatchesSelector||At.webkitMatchesSelector||function(le){for(var Te=(le=(this.document||this.ownerDocument).querySelectorAll(le)).length;0<=--Te&&le.item(Te)!==this;);return-1<Te}),ot&&(Yt.prototype[ot]="FormData"),ue){var pr=Z.XMLHttpRequest.prototype.setRequestHeader;Z.XMLHttpRequest.prototype.setRequestHeader=function(le,Te){pr.call(this,le,Te),le.toLowerCase()==="content-type"&&(this.B=!0)},Z.XMLHttpRequest.prototype.send=function(le){le instanceof Yt?(le=le._blob(),this.B||this.setRequestHeader("Content-Type",le.type),ue.call(this,le)):ue.call(this,le)}}Ee&&(Z.fetch=function(le,Te){return Te&&Te.body&&Te.body instanceof Yt&&(Te.body=Te.body._blob()),Ee.call(this,le,Te)}),Rt&&(Z.navigator.sendBeacon=function(le,Te){return Te instanceof Yt&&(Te=Te._asNative()),Rt.call(this,le,Te)}),Z.FormData=Yt}})();const rS=()=>{const e=U("AREAS");return e.length===0&&e.push(zt.GLOBAL),gr(e).call(e,(t,n,i)=>{const r=KV(n);return r?i===0?r:"".concat(t,",").concat(r):t},"")},KV=e=>e===zt.OVERSEA?"".concat(dr.ASIA,",").concat(dr.EUROPE,",").concat(dr.AFRICA,",").concat(dr.NORTH_AMERICA,",").concat(dr.SOUTH_AMERICA,",").concat(dr.OCEANIA):dr[e],UY=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const i=ub[n],r=Object.keys(i);r&&r.map(a=>{a!=="CODE"&&(t[a]=t[a].concat(i[a]))})}),t},vb={GLOBAL:{ASIA:[zt.CHINA,zt.JAPAN,zt.INDIA,zt.KOREA,zt.HKMC],EUROPE:[],NORTH_AMERICA:[zt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Tb=Object.keys(vb[zt.GLOBAL]),dN=[zt.CHINA,zt.NORTH_AMERICA,zt.EUROPE,zt.ASIA,zt.JAPAN,zt.INDIA,zt.OCEANIA,zt.SOUTH_AMERICA,zt.AFRICA,zt.KOREA,zt.HKMC,zt.US],VY=function(e,t){let n=[];if(Re(e).call(e,zt.GLOBAL)){const a=[zt.GLOBAL,zt.OVERSEA],l=Object.keys(ub);if(t===zt.GLOBAL)throw new te(x.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===zt.CHINA)n=[zt.OVERSEA];else if(r=t,Re(Tb).call(Tb,r)){const u=(i=t,vb[zt.GLOBAL][i]||[]),h=[...a,t,...u];n=l.filter(f=>!Re(h).call(h,f))}else if(function(u){let h=!1;return Tb.forEach(f=>{var E;Re(E=vb[zt.GLOBAL][f]).call(E,u)&&(h=!0)}),h}(t)){const u=function(f){let E;return Tb.forEach(y=>{var S;Re(S=vb[zt.GLOBAL][y]).call(S,f)&&(E=y)}),E}(t),h=[...a,u,t];n=l.filter(f=>!Re(h).call(h,f))}else n=e;n=function(u){const h=[];return dN.forEach(f=>{Re(u).call(u,f)&&h.push(f)}),h.concat(u.filter(f=>!Re(dN).call(dN,f)))}(n)}else n=e;var i,r;return n};function qV(e){var t,n;if(!e&&Re(t=U("AREAS")).call(t,zt.EXTENSIONS))return b.debug("update area from ap : reset"),void uN(zW,!0);if(!Re(n=U("AREAS")).call(n,zt.GLOBAL)||!e)return;let i=ub.EXTENSIONS;i&&(i={CODE:KV(zt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},b.debug("update area from ap success: ".concat(e,",config is "),i),on("AREAS",[zt.EXTENSIONS],!0),Object.keys(i).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?on(r,i[r][0]):on(r,i[r])}))}function uN(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=He.reportApiInvoke(null,{name:si.SET_AREA,options:e,tag:Vn.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach(a=>{if(!Re(mV).call(mV,a))throw new te(x.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:a,excludedArea:l}=e;if(!a)throw new te(x.INVALID_PARAMS,"area code is needed");let u=a;typeof a=="string"&&(u=[a]),i=l?VY(u,l):u}if(!t){if(zo.AREAS){const a=new te(x.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(a),void b.warning("setArea is prohibited because of config-distribute")}if(Re(i).call(i,zt.GLOBAL)&&U("AREAS")===zt.EXTENSIONS){const a=new te(x.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(a),void b.warning("setArea is prohibited because of ap extensions")}}on("AREAS",i,t);const r=UY(i);Object.keys(r).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?on(a,r[a][0]):on(a,r[a])}),b.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function XV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function nl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?XV(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let hN=1;function jY(e,t,n,i,r){hN+=1;const a={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:hN,requestId:hN,version:Sa,cname:n.cname},l={service_name:t,json_body:JSON.stringify(a)};let u,h,f=e[0];return Yo(async()=>{u=Date.now();const E=await Jo(f,{data:l,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(h=Date.now()-u,E.code!==0){const T=new te(x.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:h});throw b.error(T.toString()),T}const y=JSON.parse(E.json_body);if(y.code!==200){const T=new te(x.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(y.code,", reason: ").concat(y.reason),{code:y.code,responseTime:h});throw b.error(T.toString()),T}if(!y.servers||y.servers.length===0){const T=new te(x.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:y.code,responseTime:h});throw b.error(T.toString()),T}const S=function(T,k){return{addressList:T.servers.map(O=>"wss://".concat(O.address.replace(/\./g,"-"),".").concat(U("WORKER_DOMAIN"),":").concat(O.wss,"?serviceName=").concat(encodeURIComponent(k))),workerToken:T.workerToken,vid:T.vid}}(y,t);return U("LIVE_STREAMING_ADDRESS")&&(S.addressList=U("LIVE_STREAMING_ADDRESS")instanceof Array?U("LIVE_STREAMING_ADDRESS"):[U("LIVE_STREAMING_ADDRESS")]),nl(nl({},S),{},{responseTime:h})},(E,y)=>(He.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(E.addressList),firstSuccess:y===0,responseTime:h,serverIp:e[y%e.length]}),!1),(E,y)=>(He.apworkerEvent(n.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:t,responseTime:h,serverIp:e[y%e.length]}),!!(E.code!==x.OPERATION_ABORTED&&E.code!==x.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(f=e[(y+1)%e.length],!0)),r)}let pN=1;function JV(e,t,n,i){let{url:r,areaCode:a}=e;const{clientId:l,sid:u}=t,h=Date.now();let f;const E=t.role,[y,S]=mN(t,a,[pi.CHOOSE_SERVER]);let T=hi.networkState;return Yo(async()=>{T&&hi.networkState===ks.OFFLINE&&hi.onlineWaiter&&await Ne.race([hi.onlineWaiter,qi(i&&i.maxRetryTimeout||_i.maxRetryTimeout)]),T=hi.networkState;const{data:k,headers:O}=await Jo(r,{data:y,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f=O.http3==="1"?1:-1,He.reportResourceTiming(r,u),QV(k,r,t,h,[pi.CHOOSE_SERVER],f);const I=eS(k,pi.CHOOSE_SERVER);return fN(I),rN(I,r)},k=>(k&&He.joinChooseServer(u,{role:E,lts:h,succ:!0,csAddr:r,opid:S,serverList:k.gatewayAddrs.map(O=>O.address),ec:null,cid:k.cid.toString(),uid:k.uid.toString(),csIp:k.csIp,unilbsServerIds:[pi.CHOOSE_SERVER].toString(),isHttp3:f,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:k.res.detail&&k.res.detail[38]}),!1),k=>k.code!==x.OPERATION_ABORTED&&(k.code===x.CAN_NOT_GET_GATEWAY_SERVER?k.data.retry:(He.joinChooseServer(u,{role:E,lts:h,succ:!1,csAddr:r,serverList:null,opid:S,ec:k.code,csIp:k.data&&k.data.csIp,unilbsServerIds:[pi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:T}),isHttp3:f,corssRegionTagReq:t.apRequestDetail}),b.warning("[".concat(l||"sid-".concat(u.slice(0,6)),"] Choose server network error, retry"),k),!0)),i)}function ZV(e,t,n,i){let r,{url:a,areaCode:l,serviceIds:u}=e;const h=Date.now(),f=t.role,[E,y]=mN(t,l,u);let S;return Yo(async()=>{S&&hi.networkState===ks.OFFLINE&&hi.onlineWaiter&&await Ne.race([hi.onlineWaiter,qi(i&&i.maxRetryTimeout||_i.maxRetryTimeout)]),S=hi.networkState;const{data:T,headers:k}=await Jo(a,{data:E,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r=k.http3==="1"?1:-1,He.reportResourceTiming(a,t.sid),QV(T,a,t,h,u,r);const O=eS(T,pi.CHOOSE_SERVER),I=eS(T,t.cloudProxyServer==="proxy5"?pi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?pi.CLOUD_PROXY:pi.CLOUD_PROXY_FALLBACK),M=performance.getEntriesByName(a),L=M[M.length-1];let j;return L&&(j={name:L.name,protocol:"nextHopProtocol"in L?L.nextHopProtocol:"",dnscost:"domainLookupEnd"in L&&"domainLookupStart"in L&&typeof L.domainLookupEnd=="number"&&typeof L.domainLookupStart=="number"?L.domainLookupEnd-L.domainLookupStart:-1,tcpTlsCost:"connectEnd"in L&&"connectStart"in L&&typeof L.connectEnd=="number"&&typeof L.connectStart=="number"?L.connectEnd-L.connectStart:-1,reqCost:"requestStart"in L&&typeof L.requestStart=="number"&&"responseEnd"in L&&typeof L.responseEnd=="number"?L.responseEnd-L.requestStart:-1,handleCost:"leave_ts"in T&&"enter_ts"in T&&typeof T.leave_ts=="number"&&typeof T.enter_ts=="number"?T.leave_ts-T.enter_ts:-1}),fN(O),{gatewayInfo:rN(O,a),proxyInfo:I,url:a,resourceTimingInfo:j}},T=>(T.gatewayInfo&&He.joinChooseServer(t.sid,{role:f,lts:h,succ:!0,csAddr:a,serverList:T.gatewayInfo.gatewayAddrs.map(k=>k.address),ec:null,opid:y,cid:T.gatewayInfo.cid.toString(),uid:T.gatewayInfo.uid.toString(),csIp:T.gatewayInfo.csIp,unilbsServerIds:u.toString(),isHttp3:r,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:T.gatewayInfo.res.detail&&T.gatewayInfo.res.detail[38],resourceTimingInfo:T.resourceTimingInfo?JSON.stringify(T.resourceTimingInfo):void 0}),T.proxyInfo&&He.joinWebProxyAP(t.sid,{lts:h,sucess:1,apServerAddr:a,turnServerAddrList:T.proxyInfo.addresses.map(k=>k.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:u.toString()}),!1),T=>T.code!==x.OPERATION_ABORTED&&(T.code===x.CAN_NOT_GET_GATEWAY_SERVER?T.data.retry:(He.joinWebProxyAP(t.sid,{lts:h,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:T.code,eventType:t.cloudProxyServer,unilbsServerIds:u.toString(),extend:JSON.stringify({networkState:S})}),b.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),T),!0)),i)}const QV=(e,t,n,i,r,a)=>{const{sid:l,clientId:u,cloudProxyServer:h}=n,f=[],E=y=>{y.flag===4096?He.joinChooseServer(l,{role:n.role,lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:y.error.message,csIp:y.error.data&&y.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:a,corssRegionTagReq:n.apRequestDetail}):y.flag!==1048576&&y.flag!==4194304&&y.flag!==4194310||He.joinWebProxyAP(l,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:y.error.code,eventType:h,unilbsServerIds:r.toString()})};if(e.response_body.forEach(y=>{const S=y.buffer.code;if(y.uri===23&&S===0&&!y.buffer.edges_services)if(y.buffer.flag===4194310)b.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),y.buffer.edges_services=[];else{const T={error:new te(x.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:y.buffer.flag};f.push(T),E(T)}if(S!==0){const T=__(S),k={error:new te(x.CAN_NOT_GET_GATEWAY_SERVER,T.desc,{desc:T.desc,retry:T.retry,csIp:e.detail[502]}),flag:y.buffer.flag};y.buffer.flag===4194310?b.warning(k.error.toString()):f.push(k),E(k)}}),f.length)throw b.warning("[".concat(u||"sid-".concat(l.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(f.map(y=>"flag: ".concat(y.flag,", message: ").concat(y.error.message,", retry: ").concat(y.error.data.retry)).join(" | "))),new te(x.CAN_NOT_GET_GATEWAY_SERVER,f.map(y=>"flag: ".concat(y.flag,", message: ").concat(y.error.message)).join(" | "),{retry:!!f.find(y=>y.error.data.retry),csIp:e.detail[502],desc:[...new Set(f.map(y=>{var S;return y==null||(S=y.error)===null||S===void 0||(S=S.data)===null||S===void 0?void 0:S.desc}).filter(y=>!!y))]})},fN=e=>{var t,n,i,r;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new te(x.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(U("AP_AREA")&&((i=e.detail)!==null&&i!==void 0&&i[23]&&typeof((r=e.detail)===null||r===void 0?void 0:r[23])=="string"?qV(e.detail[23].toLowerCase()):qV()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const l=e.detail[19],u=l==null?void 0:l.split(";");for(let h=0;h<u.length;h++){var a;const f=Nr(a=u[h]).call(a);e.addresses[h]&&u&&(e.addresses[h].fingerprint=f)}}if(U("GATEWAY_ADDRESS")&&U("GATEWAY_ADDRESS").length>0){b.debug("assign gateway address to",U("GATEWAY_ADDRESS"));const l=U("GATEWAY_ADDRESS").map(u=>{var h,f;const E=(h=(f=e.addresses.find(y=>y.ip===u.ip&&y.port===u.port))===null||f===void 0?void 0:f.fingerprint)!==null&&h!==void 0?h:"";return{ip:u.ip,port:u.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:E}});e.addresses=l}},FY=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const i=__(n.buffer.code);throw new te(x.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw b.debug("update ticket request received ap response without response body:",t),new te(x.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},mN=(e,t,n)=>{const i=Math.floor(Math.random()*1e12),r=e.role==="host"?"1":e.role==="audience"?"2":void 0,a={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:nl(nl(nl({6:e.stringUid,11:t,12:U("USE_NEW_TOKEN")?"1":void 0},r?{17:r}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};a.request_bodies.forEach(u=>{e.multiIP&&e.multiIP.gateway_ip&&(u.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const l=new FormData;return l.append("request",JSON.stringify(a)),[l,i]},BY=(e,t)=>{const n=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(a=>({ip:a.ip,port:a.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(i)),[r,n]};let S_=0;function v_(e){return Ne.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const sS=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:i,allFailedhandler:r,promisesCollector:a}=e,l=0;const u=t;let h,f=0;const E=async()=>{const y=(()=>{const S=l*u,T=S+u;return n.slice(S,T).map(i)})();a&&a.push(...y);try{h=await v_(y)}catch(S){if(f+=u,l++,!(f>=n.length))return void await E();r(S)}y.forEach(S=>S.cancel())};return await E(),h},$V=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:i}=e;const r=t.length;let a=0;const l=async()=>{const u=n(t.shift());try{return await u}catch(h){if(a++,a>=r||i!=null&&i(h))throw h;return l()}};return l()};async function GY(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],r=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],a=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],l=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new Ne((h,f)=>{let E;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:S=>{S.close(),clearTimeout(E),h(!0)},error:S=>{clearTimeout(E),h(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const y=[t,n,i,r,a,l];for(let S=0;S<y.length;S++){const T=new EncodedVideoChunk({type:S==0?"key":"delta",timestamp:33333*S,duration:33333,data:new Uint8Array(y[S])});try{await e.decode(T)}catch{return void h(!1)}}})(),E=setTimeout(()=>{h(!1)},5e3)})}async function _N(e,t,n,i){return{gatewayInfo:await async function(a,l,u,h){let f=null;const E=[],y=async()=>{const T=U("WEBCS_DOMAIN").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(I=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:rS()})),k=h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(I=>I.url)}),O=await sS({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:I=>(b.debug("[".concat(a.clientId,"] Connect to choose_server:"),I.url),JV(I,a,l,u)),allFailedhandler:I=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},k),I[0]},promisesCollector:E});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},k),O},S=async()=>{if(await qi(1e3),f!==null)return f;const T=U("WEBCS_DOMAIN_BACKUP_LIST").map(I=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:rS()})),k=h.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(I=>I.url)}),O=await sS({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:I=>(b.debug("[".concat(a.clientId,"] Connect to backup choose_server:"),I.url),JV(I,a,l,u)),allFailedhandler:I=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},k),I[0]},promisesCollector:E});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},k),O};try{return f=await v_([y(),S()]),E.length&&E.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),f}catch(T){throw T[0]}}(e,t,n,i)}}async function e3(e,t,n,i,r){const a=e.cloudProxyServer;if(a==="disabled"){if(e.useLocalAccessPoint)return await _N(e,t,n,r);if(U("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:S,proxyInfo:T}=await i3(e,t,n,r);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:S};const k=T.map(O=>({turnServerURL:O.address,tcpport:O.tcpport||ir.tcpport,udpport:O.udpport||ir.udpport,username:O.username||ir.username,password:O.password||ir.password,forceturn:!1,security:!0}));if(r.useP2P){var l;const O=(l=e.uid)!==null&&l!==void 0?l:S.uid,I="glb:".concat(O.toString()),M=await sI(I),L=T.map(j=>({turnServerURL:j.address,tcpport:j.tcpport||ir.tcpport,udpport:j.udpport||ir.udpport,username:I,password:M,forceturn:!1,security:!0}));k.push(...L)}return e.turnServer={mode:"manual",servers:k},{gatewayInfo:S}}return await _N(e,t,n,r)}const{proxyInfo:u,gatewayInfo:h}=await i3(e,t,n,r),f={gatewayInfo:h},E=u.map(S=>({turnServerURL:S.address,tcpport:a==="proxy3"?void 0:S.tcpport?S.tcpport:ir.tcpport,udpport:a==="proxy4"?void 0:S.udpport?S.udpport:ir.udpport,username:S.username||ir.username,password:S.password||ir.password,forceturn:a!=="proxy4",security:a==="proxy5"}));if(r.useP2P){var y;const S=(y=e.uid)!==null&&y!==void 0?y:h.uid,T="glb:".concat(S.toString()),k=await sI(T),O=u.map(I=>({turnServerURL:I.address,tcpport:a==="proxy3"?void 0:I.tcpport||ir.tcpport,udpport:a==="proxy4"?void 0:I.udpport||ir.udpport,username:T,password:k,forceturn:a!=="proxy4",security:a==="proxy5"}));E.push(...O)}return e.turnServer={mode:"manual",servers:E},b.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(a)),f}async function t3(e,t,n,i,r){const a=U("ACCOUNT_REGISTER").slice(0,U("AJAX_REQUEST_CONCURRENT"));let l=[];l=t.proxyServer?a.map(h=>"https://".concat(t.proxyServer,"/ap/?url=").concat(h+"/api/v1")):a.map(h=>"https://".concat(h,"/api/v1"));const u=r==null?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:l});try{const h=await async function(f,E,y,S,T){const k=Date.now(),O={sid:y.sid,opid:10,appid:y.appId,string_uid:E};let I=f[0];const M=await Yo(()=>Jo(I+"".concat(I.indexOf("?")===-1?"?":"&","action=stringuid"),{data:O,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(L,j)=>{if(L.code===0){if(L.uid<=0||L.uid>=Math.pow(2,32))throw b.error("Invalid Uint Uid ".concat(E," => ").concat(L.uid),L),He.reqUserAccount(O.sid,{lts:k,success:!1,serverAddr:I,stringUid:O.string_uid,uid:L.uid,errorCode:x.INVALID_UINT_UID_FROM_STRING_UID,extend:O}),new te(x.INVALID_UINT_UID_FROM_STRING_UID);return He.reqUserAccount(O.sid,{lts:k,success:!0,serverAddr:I,stringUid:O.string_uid,uid:L.uid,errorCode:null,extend:O}),!1}const K=__(L.code);return K.retry&&(I=f[(j+1)%f.length]),He.reqUserAccount(O.sid,{lts:k,success:!1,serverAddr:I,stringUid:O.string_uid,uid:L.uid,errorCode:K.desc,extend:O}),K.retry},(L,j)=>L.code!==x.OPERATION_ABORTED&&(He.reqUserAccount(O.sid,{lts:k,success:!1,serverAddr:I,stringUid:O.string_uid,uid:null,errorCode:L.code,extend:O}),I=f[(j+1)%f.length],!0),T);if(M.code!==0){const L=__(M.code);throw new te(x.UNEXPECTED_RESPONSE,L.desc)}return M}(l,e,t,n,i);return r==null||r.recordJoinChannelService({status:"success",endTs:Date.now()},u),h.uid}catch(h){throw r==null||r.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[h]},u),h}}async function HY(e,t,n){const i=U("ACCOUNT_REGISTER");let r=[];r=t.proxyServer?i.map(a=>"https://".concat(t.proxyServer,"/ap/?url=").concat(a+"/api/v1")):i.map(a=>"https://".concat(a,"/api/v1"));try{return await $V({referenceList:r,asyncMapHandler:l=>async function(u,h,f,E){const y=Date.now(),S={sid:f.sid,opid:10,appid:f.appId,string_uid:h};try{const T=await Jo(u+"".concat(u.indexOf("?")===-1?"?":"&","action=stringuid"),{data:S,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(T.code!==0){const k=__(T.code);throw new te(x.UNEXPECTED_RESPONSE,"preload sua error:".concat(k.desc),k)}if(T.uid<=0||T.uid>=Math.pow(2,32))throw new te(x.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:y,url:u,req:S,uid:T.uid,elapse:Date.now()-y}}catch(T){throw T}}(l,e,t,n),closeFn:l=>l.code===x.OPERATION_ABORTED||l.code===x.UNEXPECTED_RESPONSE&&!l.data.retry})}catch(a){throw a}}async function WY(e,t,n){const i=U("CDS_AP").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v1"):"https://".concat(h,"/api/v1?action=config")),r=i.map(h=>function(f,E,y,S){const T=xt(),k={flag:64,cipher_method:0,features:nl(nl(nl(nl(nl({install_id:_I(),device:T.name,system:T.os,system_general:navigator.userAgent,vendor:E.appId,version:Sa,cname:E.cname,session_id:E.sid,proxyServer:E.proxyServer,sdk_type:LY.WEB_RTC,browser_name:T.name,browser_version:T.version,user_agent:navigator.userAgent,channel_name:E.cname},E.stringUid&&{string_uid:E.stringUid}),E.uid&&{uid:E.uid+""}),T.os&&{os_name:T.os}),T.osVersion&&{os_version:T.osVersion}),{},{detail:""})};return Yo(()=>Jo(f,{data:k,timeout:1e3,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,O=>O.code!==x.OPERATION_ABORTED,S)}(h,e,t,n));let a=null,l=null,u={};try{a=await v_(r)}catch(h){if(h.code===x.OPERATION_ABORTED)throw h;l=h}if(r.forEach(h=>h.cancel()),He.reportApiInvoke(e.sid,{name:si.REQUEST_CONFIG_DISTRIBUTE,options:{error:l,res:a}}).onSuccess(),a&&a.test_tags)try{u=function(h){if(!h.test_tags)return{};const f=h.test_tags,E=Object.keys(f),y={};return E.forEach(S=>{var T;const k=Nr(T=S.slice(4)).call(T),O=JSON.parse(f[S]),I=O[1];y[k]={tag:O[0]||"",value:I}}),y}(a)}catch{}return u}async function n3(e,t){const n=U("WEBCS_DOMAIN").concat(U("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:rS(),serviceIds:[pi.CHOOSE_SERVER,pi.CLOUD_PROXY_FALLBACK]}));try{return await $V({referenceList:n,asyncMapHandler:r=>async function(a,l,u){let h,{url:f,areaCode:E,serviceIds:y}=a;const S=Date.now(),[T,k]=mN(l,E,y);let O=hi.networkState;try{O&&hi.networkState===ks.OFFLINE&&hi.onlineWaiter&&await Ne.race([hi.onlineWaiter,qi(_i.maxRetryTimeout)]),O=hi.networkState;const{data:I,headers:M}=await Jo(f,{data:T,cancelToken:u,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=M.http3==="1"?1:-1,(z=>{const H=[];if(z.response_body.forEach(Z=>{const se=Z.buffer.code;if(Z.uri===23&&se===0&&!Z.buffer.edges_services)if(Z.buffer.flag===4194310)Z.buffer.edges_services=[];else{const ue={error:new te(x.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:z.detail[502]}),flag:Z.buffer.flag};H.push(ue)}if(se!==0){const ue=__(se),Ee={error:new te(x.CAN_NOT_GET_GATEWAY_SERVER,ue.desc,{desc:ue.desc,retry:ue.retry,csIp:z.detail[502]}),flag:Z.buffer.flag};Z.buffer.flag===4194310?b.warning(Ee.error.toString()):H.push(Ee)}}),H.length)throw new te(x.CAN_NOT_GET_GATEWAY_SERVER,H.map(Z=>"flag: ".concat(Z.flag,", message: ").concat(Z.error.message)).join(" | "),{retry:!!H.find(Z=>Z.error.data.retry),csIp:z.detail[502],desc:[...new Set(H.map(Z=>{var se;return Z==null||(se=Z.error)===null||se===void 0||(se=se.data)===null||se===void 0?void 0:se.desc}).filter(Z=>!!Z))]})})(I);const j=eS(I,pi.CHOOSE_SERVER),K=eS(I,pi.CLOUD_PROXY_FALLBACK);return fN(j),{gatewayInfo:rN(j,f),proxyInfo:K,opid:k,requestTime:S,url:f,isHttp3:h,elapse:Date.now()-S}}catch(I){throw I}}(r,e,t),closeFn:r=>r.code===x.OPERATION_ABORTED||r.code===x.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(i){throw i}}async function i3(e,t,n,i){const r=U("PROXY_SERVER_TYPE3"),a=(T,k,O)=>{let I=O||r;return Array.isArray(I)&&(I=k%2==0&&r[1]||r[0]),"https://".concat(I,"/ap/?url=").concat(T)};let l=null;const u=[],h=async()=>{const T=U("WEBCS_DOMAIN").slice(0,U("AJAX_REQUEST_CONCURRENT")).map((I,M)=>{let L;return L=e.cloudProxyServer==="disabled"&&e.proxyServer?a("".concat(I,"/api/v2/transpond/webrtc?v=2"),M,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(I,"/api/v2/transpond/webrtc?v=2"):a("".concat(I,"/api/v2/transpond/webrtc?v=2"),M),{url:L,areaCode:rS(),serviceIds:[pi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?pi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?pi.CLOUD_PROXY:pi.CLOUD_PROXY_FALLBACK]}}),k=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(I=>I.url)}),O=await sS({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:I=>(b.debug("[".concat(e.clientId,"] Connect to choose_server:"),I.url),ZV(I,e,t,n)),allFailedhandler:I=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},k),I[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},k),O},f=async()=>{if(await qi(1e3),l!==null)return l;const T=U("WEBCS_DOMAIN_BACKUP_LIST").map((I,M)=>{let L;return L=e.cloudProxyServer==="disabled"&&e.proxyServer?a("".concat(I,"/api/v2/transpond/webrtc?v=2"),M,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(I,"/api/v2/transpond/webrtc?v=2"):a("".concat(I,"/api/v2/transpond/webrtc?v=2"),M),{url:L,areaCode:rS(),serviceIds:[pi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?pi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?pi.CLOUD_PROXY:pi.CLOUD_PROXY_FALLBACK]}}),k=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(I=>I.url)}),O=await sS({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:I=>(b.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),I.url),ZV(I,e,t,n)),allFailedhandler:I=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},k),I[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},k),O};let E,y,S;try{({gatewayInfo:E,proxyInfo:y,url:S}=await v_([h(),f()]))}catch(T){throw T[0]}if(u.length&&u.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),!E||!y)throw new te(x.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=S,e.cloudProxyServer!=="disabled"&&Array.isArray(r)&&S){const T=/^https?:\/\/(.+?)(\/.*)?$/.exec(S)[1];Re(r).call(r,T)&&(e.proxyServer=T,b.setProxyServer(T),He.setProxyServer(T))}return l={gatewayInfo:E,proxyInfo:await AV(y,E.uid)},l}async function YY(e,t,n){const i=U("UAP_AP").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(a=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap")),r=i.map(a=>function(l,u,h,f){const E={command:"convergeAllocateEdge",sid:u.sid,appId:u.appId,token:u.token,ts:Date.now(),version:Sa,cname:u.cname,uid:u.uid.toString(),requestId:pN,seq:pN};pN+=1;const y={service_name:"tele_channel",json_body:JSON.stringify(E)};return Yo(async()=>{const S=await Jo(l,{data:y,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(S.code!==0){const k=new te(x.UNEXPECTED_RESPONSE,"cross channel ap error, code"+S.code,{retry:!0});throw b.error(k.toString()),k}const T=JSON.parse(S.json_body);if(T.code!==200){const k=new te(x.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(T.code,", reason: ").concat(T.reason));throw b.error(k.toString()),k}if(!T.servers||T.servers.length===0){const k=new te(x.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw b.error(k.toString()),k}return{vid:T.vid,workerToken:T.workerToken,addressList:(U("CHANNEL_MEDIA_RELAY_SERVERS")||T.servers).map(k=>"wss://".concat(k.address.replace(/\./g,"-"),".").concat(U("WORKER_DOMAIN"),":").concat(k.wss))}},void 0,S=>!!(S.code!==x.OPERATION_ABORTED&&S.code!==x.UNEXPECTED_RESPONSE||S.data&&S.data.retry),f)}(a,e,t,n));try{const a=await v_(r);return r.forEach(l=>l.cancel()),a}catch(a){throw a[0]}}async function zY(e,t,n){let i=null;const r=[],a=async l=>{const u=U(l?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v2/transpond/webrtc?v=2"):"https://".concat(h,"/api/v2/transpond/webrtc?v=2"));return l&&(await qi(1e3),i!==null)?i:await sS({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:u,asyncMapHandler:h=>(b.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(l?"backup":""," choose_server:"),h),function(f,E,y,S){const[T]=BY(E,[pi.CHOOSE_SERVER]);let k=hi.networkState;return Yo(async()=>{k&&hi.networkState===ks.OFFLINE&&hi.onlineWaiter&&await Ne.race([hi.onlineWaiter,qi(S&&S.maxRetryTimeout||_i.maxRetryTimeout)]),k=hi.networkState;const O=await Jo(f,{data:T,cancelToken:y,headers:{"Content-Type":"multipart/form-data;"}},!0);return FY(O,f)},()=>!1,O=>O.code!==x.OPERATION_ABORTED&&(O.code===x.UPDATE_TICKET_FAILED?O.data.retry:(b.warning("[".concat(E.clientId,"] update ticket network error, retry"),O),!0)),S)}(h,e,t,n)),allFailedhandler:h=>{throw h[0]},promisesCollector:r})};try{return i=await v_([a(!1),a(!0)]),r.length&&r.forEach(l=>l.cancel&&typeof l.cancel=="function"&&l.cancel()),i}catch(l){throw l[0]}}function r3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function EN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?r3(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class KY extends Wn{get isSuccess(){return!!this.configs}constructor(t,n){super(),P(this,"configs",void 0),P(this,"store",void 0),P(this,"joinInfo",void 0),P(this,"cancelToken",void 0),P(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),P(this,"interval",void 0),P(this,"mutex",void 0),P(this,"mutableParamsRead",!1),P(this,"configCache",{}),P(this,"limit_bitrate",void 0),this.mutex=new cr("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),U("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},U("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,He.reportApiInvoke(null,{options:void 0,name:si.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Vn.TRACER}).onSuccess(JSON.stringify(zo))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void b.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await WY(this.joinInfo,this.cancelToken,this.retryConfig),b.debug("[config-distribute] get config distribute",JSON.stringify(t));const i=function(r){var a;const l=gp(a=Object.keys(r).filter(f=>/^webrtc_ng_global_parameter/.test(f))).call(a);for(let f=0;f<l.length;f++)for(let E=l.length-1;E>f;E--){const y=l[E],S=r[y].value;if(typeof S.__priority=="number"){const T=S.__priority,k=l[E-1],O=r[k].value;if(typeof O.__priority=="number"){if(!(T>O.__priority))continue;{const I=y;l[E]=l[E-1],l[E-1]=I}}else{const I=y;l[E]=l[E-1],l[E-1]=I}}}const u=Date.now();let h={};return l.forEach(f=>{const E=r[f].value.__expires;E&&E<=u||(h[f]=r[f])}),h}(t);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const r=new te(x.NETWORK_RESPONSE_ERROR,i);b.warning("[config-distribute] ".concat(r.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){_V(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Zy.UPDATE_BITRATE_LIMIT,t):this.emit(Zy.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&EN({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},i=Object.keys(t),r=[];i.forEach(a=>{const l=t[a].value;n[a]=l;const u=l.__id;if(u&&this.configCache[a]&&this.configCache[a].__id===u)return;const h=l.__type,f=t[a].value,E=t[a].tag;let y=0;h?h===FM.REALTIME&&(y=1):Object.keys(f).some(S=>Object.prototype.hasOwnProperty.call(SI,S)||!KI()&&Object.prototype.hasOwnProperty.call(HR,S)?(y=1,!0):void 0),r.push({tag:E,isApplied:y,feature:a,params:JSON.stringify(l)})}),r.forEach(a=>{let{tag:l,feature:u,params:h,isApplied:f}=a;this.store.sessionId&&He.abTest(this.store.sessionId,{intSucc:1,isApplied:f,tag:l,feature:u,params:h,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){b.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(r){const a={};return Object.keys(r).forEach(l=>{const u=r[l].value,h=u.__expires,f=u.__type;Object.keys(u).forEach(E=>{E==="__id"||E==="__type"||E==="__priority"||E==="__expires"||Object.prototype.hasOwnProperty.call(a,E)||(a[E]=EN(EN({value:u[E]},h&&{expires:h}),f&&{type:f}))})}),a}(t);try{var i;const r=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,r&&_V(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(u){try{const h=Date.now();Object.keys(u).forEach(f=>{const{value:E,type:y,expires:S}=u[f];S&&S<=h||((y===FM.REALTIME||Object.prototype.hasOwnProperty.call(SI,f))&&(zo[f]=E,Ln[f]=E,b.debug("Update realtime parameters from config distribute",f,E)),y||KI()||!Object.prototype.hasOwnProperty.call(HR,f)||(zo[f]=E,Ln[f]=E,b.debug("Update gateway parameters from config distribute",f,E)))})}catch(h){b.error("Error update config immediately: ".concat(u),h.message)}}(n);const a=JSON.stringify(n),l=window.btoa(a);window.localStorage.setItem("websdk_ng_global_parameter",l),b.debug("Caching global parameters ".concat(a))}catch(r){b.error("Error caching global parameters:",r.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Ln,i)){const{value:r,expires:a}=t[i];if(a&&a<=n)return;(function(l,u){try{return typeof l=="object"&&typeof u=="object"&&JSON.stringify(l)===JSON.stringify(u)}catch{return!1}})(Ln[i],r)||(zo[i]=r,Ln[i]=r,this.emit(Zy.UPDATE_CLIENT_ROLE_OPTIONS,r),b.debug("Updating client role options: ".concat(JSON.stringify(r))))}})}catch(n){b.error("Error handling global parameter config:",n.message)}}}class qY extends Wn{constructor(){super(...arguments),P(this,"resultStorage",new Map)}setLocalAudioStats(t,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(t,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(i))}setRemoteAudioStats(t,n){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(t,n,i){if(U("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(t);if(!r)return;r.result.push(i);const a=t==="VIDEO_ENCODE_FAILED"?U("ENCODE_EXCEPTION_TIMES"):5;if(r.result.length>=a){var l;const u=Re(l=r.result).call(l,!0);r.isPrevNormal&&!u&&this.emit("exception",gN[t],t,n),!r.isPrevNormal&&u&&this.emit("exception",gN[t]+2e3,t+"_RECOVER",n),r.isPrevNormal=u,r.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof vi&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=Ps(n._encoderConfig.frameRate));const r=t.captureFrameRate;return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||Re(n=U("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof vi&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const gN={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},hr=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function s3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function jp(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?s3(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class aS{constructor(t){P(this,"store",void 0),P(this,"onStatsException",void 0),P(this,"onUploadPublishDuration",void 0),P(this,"onStatsChanged",void 0),P(this,"onVideoCodecChanged",void 0),P(this,"localStats",new Map),P(this,"remoteStats",new Map),P(this,"updateStatsInterval",void 0),P(this,"trafficStats",void 0),P(this,"trafficStatsPeerList",[]),P(this,"uplinkStats",void 0),P(this,"exceptionMonitor",void 0),P(this,"p2pChannel",void 0),P(this,"scalabilityMode",GR.L1T1),P(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new qY,this.exceptionMonitor.on("exception",(n,i,r)=>{this.onStatsException&&this.onStatsException(n,i,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(me.LocalAudioTrack)||jp({},wI)}getLocalVideoTrackStats(){return this.localStats.get(me.LocalVideoTrack)||jp({},AI)}getRemoteAudioTrackStats(t){const n=(a,l)=>{if(!this.trafficStats)return l;const u=this.trafficStats.peer_delay.find(h=>h.peer_uid===a);return u&&(l.publishDuration=u.B_ppad+(Date.now()-this.trafficStats.timestamp)),l},i={};if(t){var r;const a=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.audioStats;a&&(i[t]=n(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[l,{audioStats:u}]=a;u&&(i[l]=n(l,u))});return i}getRemoteNetworkQualityStats(t){const n={};if(t){var i;const r=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;r&&(n[t]=r)}else Array.from(this.remoteStats.entries()).forEach(r=>{let[a,{networkStats:l}]=r;l&&(n[a]=l)});return n}getRemoteVideoTrackStats(t){const n=(a,l)=>{if(!this.trafficStats)return l;const u=this.trafficStats.peer_delay.find(h=>h.peer_uid===a);return u&&(l.publishDuration=u.B_ppvd+(Date.now()-this.trafficStats.timestamp)),l},i={};if(t){var r;const a=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.videoStats;a&&(i[t]=n(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[l,{videoStats:u}]=a;u&&(i[l]=n(l,u))});return i}getRTCStats(){let t=0,n=0,i=0,r=0;const a=this.localStats.get(me.LocalAudioTrack);a&&(t+=a.sendBytes,n+=a.sendBitrate);const l=this.localStats.get(me.LocalVideoTrack);l&&(t+=l.sendBytes,n+=l.sendBitrate);const u=this.localStats.get(me.LocalVideoLowTrack);u&&(t+=u.sendBytes,n+=u.sendBitrate),this.remoteStats.forEach(f=>{let{audioStats:E,videoStats:y}=f;E&&(i+=E.receiveBytes,r+=E.receiveBitrate),y&&(i+=y.receiveBytes,r+=y.receiveBitrate)});let h=1;return this.trafficStats&&(h+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:h,SendBitrate:n,SendBytes:t,RecvBytes:i,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const r=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),a=r!=null&&r.videoSSRC?hr.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,l=r!=null&&r.audioSSRC?hr.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,a>l?a:l),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&b.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,i){if(!t)return!1;const r=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,a=!i||n.framesDecodeCount>i.framesDecodeCount;return r||!a}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[i,r]=n;switch(i){case me.LocalVideoTrack:case me.LocalVideoLowTrack:{const u=r,h=jp({},AI),f=t.getStats(),E=t.getLocalMedia(i);if(f){const y=f.videoSend.find(S=>S.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(y){const S=t.getLocalVideoSize(),T=t.getEncoderConfig(me.LocalVideoTrack);var a;(y.codec==="H264"||y.codec==="H265"||y.codec==="VP8"||y.codec==="VP9"||y.codec==="AV1X"||y.codec==="AV1")&&(h.codecType=y.codec,(u==null?void 0:u.codecType)!==y.codec&&((a=this.onVideoCodecChanged)===null||a===void 0||a.call(this,y.codec.toLocaleLowerCase()))),h.sendBytes=y.bytes,h.sendBitrate=u?8*Math.max(0,h.sendBytes-u.sendBytes):0,y.inputFrame?(h.captureFrameRate=y.inputFrame.frameRate,h.captureResolutionHeight=y.inputFrame.height,h.captureResolutionWidth=y.inputFrame.width):S&&(h.captureResolutionWidth=S.width,h.captureResolutionHeight=S.height),y.sentFrame?(h.sendFrameRate=y.sentFrame.frameRate,h.sendResolutionHeight=y.sentFrame.height,h.sendResolutionWidth=y.sentFrame.width):S&&(h.sendResolutionWidth=S.width,h.sendResolutionHeight=S.height),y.avgEncodeMs&&(h.encodeDelay=y.avgEncodeMs),T&&T.bitrateMax?h.targetSendBitrate=1e3*T.bitrateMax:y.targetBitrate&&(h.targetSendBitrate=y.targetBitrate),h.sendPackets=y.packets,h.sendPacketsLost=y.packetsLost,h.sendJitterMs=y.jitterMs,h.sendRttMs=y.rttMs,h.totalDuration=u?u.totalDuration+1:1,h.totalFreezeTime=u?u.totalFreezeTime:0,this.isLocalVideoFreeze(y)&&(h.totalFreezeTime+=1),y.scalabilityMode&&this.scalabilityMode!==y.scalabilityMode&&(b.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(y.scalabilityMode)),this.scalabilityMode=y.scalabilityMode)}this.trafficStats&&(h.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var l;this.localStats.set(i,h),((u==null?void 0:u.sendResolutionWidth)!==h.sendResolutionWidth||(u==null?void 0:u.sendResolutionHeight)!==h.sendResolutionHeight)&&((l=this.onStatsChanged)===null||l===void 0||l.call(this,"resolution",{width:h.sendResolutionWidth,height:h.sendResolutionHeight})),h&&E&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,E.track,h);break}case me.LocalAudioTrack:{const u=r,h=jp({},wI),f=t.getStats(),E=t.getLocalMedia(i);if(f){const y=f.audioSend.find(S=>S.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(y){if(y.codec!=="opus"&&y.codec!=="aac"&&y.codec!=="PCMU"&&y.codec!=="PCMA"&&y.codec!=="G722"||(h.codecType=y.codec),y.inputLevel)h.sendVolumeLevel=Math.round(32767*y.inputLevel);else{const S=t.getLocalAudioVolume();S&&(h.sendVolumeLevel=Math.round(32767*S))}h.sendBytes=y.bytes,h.sendPackets=y.packets,h.sendPacketsLost=y.packetsLost,h.sendJitterMs=y.jitterMs,h.sendRttMs=y.rttMs,h.sendBitrate=u?8*Math.max(0,h.sendBytes-u.sendBytes):0}}this.trafficStats&&(h.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(me.LocalAudioTrack,h),h&&E&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,E.track,h);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var i,r;let[a,{videoStats:l,audioStats:u,videoPcStats:h}]=n;const f=u,E=l,y=h,S=jp({},ZM),T=jp({},QM),k=jp({},DW),{audioTrack:O,videoTrack:I,audioSSRC:M,videoSSRC:L}=t.getRemoteMedia(a);let j;j=this.store.useP2P?t.getStats(!0):t.getStats();const K=(i=j)===null||i===void 0?void 0:i.audioRecv.find(se=>se.ssrc===M),z=(r=j)===null||r===void 0?void 0:r.videoRecv.find(se=>se.ssrc===L),H=this.trafficStats&&this.trafficStats.peer_delay.find(se=>se.peer_uid===a);if(K&&(K.codec!=="opus"&&K.codec!=="aac"&&K.codec!=="PCMU"&&K.codec!=="PCMA"&&K.codec!=="G722"||(S.codecType=K.codec),K.outputLevel?S.receiveLevel=Math.round(32767*K.outputLevel):O&&(S.receiveLevel=Math.round(32767*O.getVolumeLevel())),S.receiveBytes=K.bytes,S.receivePackets=K.packets,S.receivePacketsLost=K.packetsLost,S.receivePacketsDiscarded=K.packetsDiscarded,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost),S.receiveBitrate=f?8*Math.max(0,S.receiveBytes-f.receiveBytes):0,S.totalDuration=f?f.totalDuration+1:1,S.totalFreezeTime=f?f.totalFreezeTime:0,S.freezeRate=S.totalFreezeTime/S.totalDuration,S.receiveDelay=K.jitterBufferMs,S.totalDuration>10&&aS.isRemoteAudioFreeze(O)&&(S.totalFreezeTime+=1)),z){var Z;z.codec!=="H264"&&z.codec!=="H265"&&z.codec!=="VP8"&&z.codec!=="VP9"&&z.codec!=="AV1X"&&z.codec!=="AV1"||(T.codecType=z.codec),T.receiveBytes=z.bytes,T.receiveBitrate=E?8*Math.max(0,T.receiveBytes-E.receiveBytes):0,T.decodeFrameRate=z.decodeFrameRate<0?0:z.decodeFrameRate,T.renderFrameRate=z.decodeFrameRate<0?0:z.decodeFrameRate,z.outputFrame&&(T.renderFrameRate=z.outputFrame.frameRate),z.receivedFrame?(T.receiveFrameRate=z.receivedFrame.frameRate,T.receiveResolutionHeight=z.receivedFrame.height,T.receiveResolutionWidth=z.receivedFrame.width):I&&(T.receiveResolutionHeight=I._videoHeight||0,T.receiveResolutionWidth=I._videoWidth||0),z.framesRateFirefox!==void 0&&(T.receiveFrameRate=Math.round(z.framesRateFirefox)),T.receivePackets=z.packets,T.receivePacketsLost=z.packetsLost,T.packetLossRate=T.receivePacketsLost/(T.receivePackets+T.receivePacketsLost);const se=E?E.totalFreezeTime:0,ue=E?E.totalDuration:0;T.totalDuration=E?E.totalDuration+1:1,T.totalFreezeTime=(Z=z.totalFreezesDuration)!==null&&Z!==void 0?Z:se||0,T.receiveDelay=z.jitterBufferMs||0;const Ee=!!L&&t.getRemoteVideoIsReady(L);z.totalFreezesDuration===void 0&&I&&Ee&&aS.isRemoteVideoFreeze(I,z,y)&&(T.totalFreezeTime+=1),T.freezeRate=Math.max(0,Math.min((T.totalFreezeTime-se)/(T.totalDuration-ue),1))}H&&(S.end2EndDelay=H.B_ad,T.end2EndDelay=H.B_vd,S.transportDelay=H.B_ed,T.transportDelay=H.B_ed,S.currentPacketLossRate=H.B_ealr4/100,T.currentPacketLossRate=H.B_evlr4/100,k.uplinkNetworkQuality=H.B_punq?H.B_punq:0,k.downlinkNetworkQuality=H.B_pdnq?H.B_pdnq:0),this.remoteStats.set(a,{audioStats:S,videoStats:T,videoPcStats:z,networkStats:k}),O&&this.exceptionMonitor.setRemoteAudioStats(O,S),I&&this.exceptionMonitor.setRemoteVideoStats(I,T)})}}class a3{constructor(){P(this,"destChannelMediaInfos",new Map),P(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){fV(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){fV(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){cb(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function o3(e){if(!(e instanceof a3))return new te(x.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new te(x.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new te(x.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Wu{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){P(this,"uid",void 0),P(this,"_uintid",void 0),P(this,"_trust_in_room_",!0),P(this,"_trust_audio_enabled_state_",!0),P(this,"_trust_video_enabled_state_",!0),P(this,"_trust_audio_mute_state_",!0),P(this,"_trust_video_mute_state_",!0),P(this,"_audio_muted_",!1),P(this,"_video_muted_",!1),P(this,"_audio_enabled_",!0),P(this,"_video_enabled_",!0),P(this,"_audio_added_",!1),P(this,"_video_added_",!1),P(this,"_is_pre_created",!1),P(this,"_video_pre_subscribed",!1),P(this,"_audio_pre_subscribed",!1),P(this,"_trust_video_stream_added_state_",!0),P(this,"_trust_audio_stream_added_state_",!0),P(this,"_audioTrack",void 0),P(this,"_videoTrack",void 0),P(this,"_dataChannels",[]),P(this,"_audioSSRC",void 0),P(this,"_videoSSRC",void 0),P(this,"_audioOrtc",void 0),P(this,"_videoOrtc",void 0),P(this,"_cname",void 0),P(this,"_rtxSsrcId",void 0),P(this,"_videoMid",void 0),P(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function c3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function yN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?c3(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Rb="9",SN=2e4,bb=4e4;function l3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function dd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?l3(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var T_=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(T_||{});const Cb=new Map;function d3(e,t,n,i){let{scale:r}=e;if(r===0&&i===T_.UP||r>=t.length-1&&i===T_.DOWN)return e;let a=dd(dd({},e),{},{scale:i===T_.DOWN?++r:--r});switch(n){case"maintain-framerate":a=dd(dd({},a),t[r].motion);break;case"maintain-resolution":a=dd(dd({},a),t[r].detail);break;case"balanced":a=dd(dd({},a),t[r].balanced)}return a}function u3(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:h3(t)};Cb.set(e,n)}else Cb.delete(e)}function h3(e){const t=dd({},e),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:r,bitrateMin:a}=t,{MIN_FRAME_RATE:l,MAX_THRESHOLD_FRAMERATE:u,MAX_SCALE:h,BITRATE_MIN_THRESHOLD:f,BITRATE_MAX_THRESHOLD:E,BWE_SCALE_UP_THRESHOLD:y,BWE_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_DOWN_THRESHOLD:T,PERF_SCALE_UP_THRESHOLD:k,BALANCE_BITRATE_FACTOR:O,BALANCE_FRAMERATE_FACTOR:I,BALANCE_RESOLUTION_FACTOR:M,MOTION_RESOLUTION_FACTOR:L,MOTION_BITRATE_FACTOR:j,DETAIL_FRAMERATE_FACTOR:K,DETAIL_BITRATE_FACTOR:z}=gI,H=Math.min(t.frameRate,u),Z=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(S,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(T,1)*H),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:a},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:a},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:a}}];for(let se=1;se<=h;se++){const ue={bwe_up:Math.round(Math.pow(y,se)*n),bwe_down:Math.round(Math.pow(S,se+1)*n),fps_up:Math.round(Math.pow(k,se)*H),fps_down:Math.round(Math.pow(T,se+1)*H)},Ee={scaleResolutionDownBy:r/Math.pow(M,se),frameRate:Math.max(Math.round(Math.pow(I,se)*i),l),bitrateMax:Math.max(Math.round(Math.pow(O,se)*n),E),bitrateMin:Math.max(Math.round(Math.pow(O,se)*a),f)},Rt={scaleResolutionDownBy:r/Math.pow(L,se),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(j,se)*n),E),bitrateMin:Math.max(Math.round(Math.pow(j,se)*a),f)},At={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(K,se)*i),l),bitrateMax:Math.max(Math.round(Math.pow(z,se)*n),E),bitrateMin:Math.max(Math.round(Math.pow(z,se)*a),f)};Z.push({scale:se,threshold:ue,balanced:Ee,motion:Rt,detail:At})}return Z}function XY(e,t,n,i,r,a){const l=Cb.get(e)||{overUse:0,underUse:0,adaptationList:h3(r)},{adaptationList:u}=l;Cb.set(e,l);const{OVERUSE_TIMES_THRESHOLD:h,UNDERUSE_TIMES_THRESHOLD:f}=gI,{scale:E}=i;let y,S;return typeof t=="number"&&t>0&&function(T,k,O,I){if(k>=O.length)return!1;let{threshold:{fps_down:M}}=O[k];return U("FORCE_AG_HIGH_FRAMERATE")&&I==="maintain-framerate"&&(M=O[0].threshold.fps_down),T<M}(t,E,u,a)&&(l.overUse++,S=Hy.CPU,l.overUse>h)||typeof n=="number"&&n>0&&function(T,k,O){if(k>=O.length)return!1;const{threshold:{bwe_down:I}}=O[k];return T<I}(n,E,u)&&(l.overUse++,S=Hy.BANDWIDTH,l.overUse>h)?(l.overUse=0,l.underUse=0,y=d3(i,u,a,T_.DOWN),[y,S]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(T,k,O,I){if(k===0)return;let{threshold:{fps_up:M}}=O[k];return U("FORCE_AG_HIGH_FRAMERATE")&&I==="maintain-framerate"&&(M=O[1].threshold.fps_up),T>M}(t,E,u,a)&&function(T,k,O){if(k===0)return;const{threshold:{bwe_up:I}}=O[k];return T>I}(n,E,u)&&(l.underUse++,l.underUse>f&&(l.overUse=0,l.underUse=0,y=d3(i,u,a,T_.UP),y.scale===0&&(S=Hy.NONE))),[y,S])}function p3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function vN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?p3(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const wb=new Map;function Ab(e,t){const n=wb.get(e);if(n){const{timer:i}=n;window.clearTimeout(i),wb.delete(e)}t.qualityLimitationReason=Hy.NONE,u3(e)}function JY(e,t){var n;let i;switch(t){case me.LocalAudioTrack:i=tn.Audio;break;case me.LocalVideoTrack:i=Re(n=e._hints).call(n,hn.SCREEN_TRACK)?tn.Screen:tn.High;break;case me.LocalVideoLowTrack:i=tn.Low}return i}function TN(e){const t=Bt();if(e.some(n=>n._bypassWebAudio))throw new re(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new re(x.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function RN(e,t){TN(e);const n=new vi;return e.forEach(i=>n.addAudioTrack(i)),n}const ZY=!Bt().supportUnifiedPlan||U("CHROME_FORCE_PLAN_B")&&rd();function Ob(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return ZY?(n={spec:t,store:e},ld("PlanBConnection").create(n)):new Ca(t,e)}function bN(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function f3(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Fy(e.turnServer.servers))return!1;if(U("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var Ut;function m3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Zo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?m3(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Ca=(Ut=class $p extends gV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Re(n=Object.keys(Yy)).call(n,t)}))]}constructor(t,n){super(t,n),P(this,"id",yn(5,"connection-")),P(this,"store",void 0),P(this,"peerConnection",void 0),P(this,"forceTurn",!1),P(this,"remoteSDP",void 0),P(this,"initialOffer",void 0),P(this,"transportEventReceiver",void 0),P(this,"statsFilter",void 0),P(this,"extension",{useXR:U("USE_XR")}),P(this,"localCapabilities",void 0),P(this,"remoteCodecs",void 0),P(this,"localCandidateCount",0),P(this,"allCandidatesReceived",!1),P(this,"isPreallocation",!1),P(this,"preMediaMap",new Map),P(this,"dataStreamChannelMap",new Map),P(this,"establishPromise",void 0),P(this,"recoveredDataChannelIds",[]),P(this,"currentDataChannelId",1),P(this,"supportAV1RtpSpec",!1),P(this,"mutex",void 0),P(this,"qualityLimitationReason",Hy.NONE),P(this,"isFirstConnected",!1),this.store=n,this.forceTurn=f3(t),this.mutex=new cr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection($p.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=mI(this.peerConnection,U("STATS_UPDATE_INTERVAL"),void 0,qn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void b.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const a=this.remoteSDP.toString();r==null||r(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}else b.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Fu(i.sdp),a=await UV({filterRTX:!U("USE_PUB_RTX")&&!U("USE_SUB_RTX"),filterVideoFec:U("FILTER_VIDEO_FEC"),filterAudioFec:U("FILTER_AUDIO_FEC"),filterVideoCodec:U("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:U("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:U("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=gb(a),this.initialOffer=i,U("ENABLE_SVC")&&this.store.codec=="av1"){const u=await async function(){try{const h=new RTCPeerConnection;h.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:GR.L1T3}]});const f=await h.createOffer();if(!f.sdp)return void h.close();const E=os(f.sdp).mediaDescriptions[0];if(!E)return;const y=E.attributes.extmaps.find(S=>S.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return h.close(),y}catch{return}}();var t;u&&(this.supportAV1RtpSpec=!0,(t=a.send)===null||t===void 0||t.videoExtensions.push(u))}let l;return i.sdp&&BV(i.sdp)&&(l=jn(a),(n=l).send&&(E_(xe.VIDEO,n.send.videoExtensions),E_(xe.AUDIO,n.send.audioExtensions)),n.recv&&(E_(xe.VIDEO,n.recv.videoExtensions),E_(xe.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(E_(xe.VIDEO,n.sendrecv.videoExtensions),E_(xe.AUDIO,n.sendrecv.audioExtensions))),Zo(Zo({},r),{},{rtpCapabilities:l||a,offerSDP:i.sdp})}catch(i){throw new re(x.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var n}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&BV(this.initialOffer.sdp)&&(n=t.rtpCapabilities,i=this.localCapabilities,n.send&&(mb(xe.VIDEO,n.send.videoExtensions,i.send.videoExtensions),mb(xe.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(mb(xe.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),mb(xe.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return jn(this._localCapabilities)}get rtpCapabilities(){return jn(this._rtpCapabilities)}get candidates(){return jn(this._candidates)}get iceParameters(){return jn(this._iceParameters)}get dtlsParameters(){return jn(this._dtlsParameters)}constructor(h){let f=arguments.length>1&&arguments[1]!==void 0&&arguments[1],E=arguments.length>2&&arguments[2]!==void 0&&arguments[2];P(this,"sessionDesc",void 0),P(this,"_localCapabilities",void 0),P(this,"_rtpCapabilities",void 0),P(this,"_candidates",void 0),P(this,"_originCandidates",void 0),P(this,"_iceParameters",void 0),P(this,"_isUseExtmapAllowMixed",void 0),P(this,"_isUseLocalCodecs",void 0),P(this,"_dtlsParameters",void 0),P(this,"setup",void 0),P(this,"currentMidIndex",void 0),P(this,"cname",void 0),P(this,"useLocalCodecsMids",[]),P(this,"preloadSsrcs",[]),P(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=f,this._isUseLocalCodecs=E,h=jn(h);const{iceParameters:y,dtlsParameters:S,candidates:T,rtpCapabilities:k,setup:O,localCapabilities:I,cname:M}=h;this._rtpCapabilities=k,this._candidates=T,this._originCandidates=jn(T),this._iceParameters=y,this._dtlsParameters=S,this._localCapabilities=I,this.setup=O,this.cname=M,[this.sessionDesc]=this.updateRemoteRTPCapabilities(k),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(h){return h.length===this.preloadSsrcs.length&&h.every(f=>{var E;return Re(E=this.preloadSsrcs).call(E,f)})}preloadRemoteMedia(h){let f=0;const E=[],y=[];for(;h>0;){const S=[yN({ssrcId:bb+f},U("USE_SUB_RTX")?{rtx:bb+f+1}:{})],T="".concat(bb+f,"_").concat(SN+f),{ssrcs:k,ssrcGroups:O}=nS(S,this.cname,U("SYNC_GROUP")?T:void 0),I=this.preCreateOrRecycleSendMedia("video",k,O,void 0),M=[{ssrcId:SN+f}],L="".concat(bb+f,"_").concat(SN+f),{ssrcs:j,ssrcGroups:K}=nS(M,this.cname,U("SYNC_GROUP")?L:void 0),z=this.preCreateOrRecycleSendMedia("audio",j,K,void 0);h--,f+=2,E.push(I,z),y.push(k[0].ssrcId,j[0].ssrcId)}return this.useLocalCodecsMids.push(...E),this.preloadSsrcs=y,{mids:E,preSSRCs:y,isAvailable:!0}}preCreateOrRecycleSendMedia(h,f,E,y){const S=this.rtpCapabilities.send.videoCodecs,T=this._isUseLocalCodecs||S.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;b.debug("create or recycle send media without remote rtp capabilities, ssrcs ",f[0].ssrcId);const k=h===xe.VIDEO?T.videoCodecs:T.audioCodecs,O=h===xe.VIDEO?T.videoExtensions:T.audioExtensions;this.currentMidIndex+=1;const I="".concat(this.currentMidIndex);let M={media:{mediaType:h,port:Rb,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.map(L=>L.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:O,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:k,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(I)}};return M=this.mungSendMediaDesc(M,y),this.sessionDesc.mediaDescriptions.push(M),this.updateBundleMids(),I}toString(){return Lu(this.sessionDesc)}send(h,f,E,y){const{ssrcs:S,ssrcGroups:T}=nS(f,this.cname,U("SYNC_GROUP")?E:void 0),k=this.findPreloadMediaDesc(S);if(k){if(qn()&&this.firefoxSsrcMidMap.set(S[0].ssrcId,k.attributes.mid),y&&(y.twcc||y.remb)){const O=this.sessionDesc.mediaDescriptions.indexOf(k);return this.sessionDesc.mediaDescriptions[O]=this.mungSendMediaDesc(k,y),{mid:k.attributes.mid,needExchangeSDP:!0}}return{mid:k.attributes.mid,needExchangeSDP:!1}}{const O=this.findAvailableMediaIndex(h,S);let I;return O===-1||O===1&&(er()||function(){const M=xt();return!(M.name!==Wt.CHROME||!M.osVersion)&&Number(M.version)<=90}()||U("ENABLE_ENCODED_TRANSFORM")&&id())||O===0&&!function(M){const L=xt();return!(L.name!==Wt.FIREFOX||!L.osVersion)&&Number(L.version)===M}(138)&&U("USE_SUB_RTX")||dM()?(I=this.createOrRecycleSendMedia(h,S,T,"sendonly",y),this.updateBundleMids()):(I=jn(this.sessionDesc.mediaDescriptions[O]),I.attributes.direction="sendonly",I.attributes.ssrcs=S,I.attributes.ssrcGroups=T,this.sessionDesc.mediaDescriptions[O]=this.mungSendMediaDesc(I,y)),qn()&&this.firefoxSsrcMidMap.set(S[0].ssrcId,I.attributes.mid),{mid:I.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:h,needExchangeSDP:f}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:h.attributes.mid,needExchangeSDP:f}}batchSend(h){const f=h.map(S=>{let{kind:T,ssrcMsg:k,mslabel:O}=S;return this.send(T,k,O)}),E=[];let y=!1;return f.forEach(S=>{let{mid:T,needExchangeSDP:k}=S;k&&(y=!0),E.push(T)}),{mids:E,needExchangeSDP:y}}stopSending(h){const f=this.sessionDesc.mediaDescriptions.filter(E=>E.attributes.mid&&h.indexOf(E.attributes.mid)!==-1);if(f.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");f.forEach(E=>{E.attributes.mid==="0"||qn()||dM()?E.attributes.ssrcs=[]:(E.attributes.ssrcs=[],E.attributes.direction="inactive",E.media.port="0")}),this.updateBundleMids()}mute(h){const f=this.sessionDesc.mediaDescriptions.find(E=>E.attributes.mid===h);if(!f)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.mute."));f.attributes.direction="inactive"}unmute(h){const f=this.sessionDesc.mediaDescriptions.find(E=>E.attributes.mid===h);if(!f)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.unmute."));f.attributes.direction="sendonly"}muteRemote(h){const f=this.sessionDesc.mediaDescriptions.filter(E=>Re(h).call(h,E.attributes.mid||""));if(f.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");f.forEach(E=>{E.attributes.direction="inactive"})}unmuteRemote(h){const f=this.sessionDesc.mediaDescriptions.filter(E=>Re(h).call(h,E.attributes.mid||""));if(f.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");f.forEach(E=>{E.attributes.direction="recvonly"})}receive(h,f,E,y){h.forEach((S,T)=>{this.createOrRecycleRecvMedia(S,[],"recvonly",f,E,y[T])}),this.updateBundleMids()}stopReceiving(h){const f=this.sessionDesc.mediaDescriptions.filter(E=>h.indexOf(E.attributes.mid)!==-1);if(f.length!==h.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");f.forEach(E=>{E.media.port="0",E.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(h){const f=this.sessionDesc||os((E=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(E?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var E;this._rtpCapabilities=h;let y=!1;const S=this.rtpCapabilities.send,T=this.localCapabilities.send,k=this.localCapabilities.recv,O=k.videoCodecs,I=k.audioCodecs,M=k.videoExtensions,L=k.audioExtensions;for(const H of f.mediaDescriptions){var j;if(H.attributes.direction!=="sendonly"||typeof H.attributes.mid!="string"||!Re(j=this.useLocalCodecsMids).call(j,H.attributes.mid)){if(y=!0,H.attributes.iceUfrag=this._iceParameters.iceUfrag,H.attributes.icePwd=this._iceParameters.icePwd,H.attributes.fingerprints=this._dtlsParameters.fingerprints,H.attributes.candidates=this._candidates,H.attributes.setup=this.setup,H.media.mediaType==="application"&&(H.attributes.sctpPort="5000"),H.media.mediaType==="video")if(this._isUseLocalCodecs&&H.attributes.direction==="sendonly"){var K;H.media.fmts=O.map(se=>se.payloadType.toString(10)),H.attributes.payloads=O,H.attributes.extmaps=M;const Z=H.attributes.mid;typeof Z!="string"||Re(K=this.useLocalCodecsMids).call(K,Z)||this.useLocalCodecsMids.push(Z)}else if(S.videoCodecs.length===0){const Z=T.videoCodecs.filter(se=>{var ue,Ee;return(ue=se.rtpMap)===null||ue===void 0?void 0:Re(Ee=ue.encodingName.toLowerCase()).call(Ee,"vp8")})||[T.videoCodecs[0]];H.media.fmts=Z.map(se=>se.payloadType.toString(10)),H.attributes.payloads=Z,H.attributes.extmaps=[]}else H.media.fmts=S.videoCodecs.map(Z=>Z.payloadType.toString(10)),H.attributes.payloads=S.videoCodecs,H.attributes.extmaps=S.videoExtensions;if(H.media.mediaType==="audio")if(this._isUseLocalCodecs&&H.attributes.direction==="sendonly"){var z;H.media.fmts=I.map(se=>se.payloadType.toString(10)),H.attributes.payloads=I,H.attributes.extmaps=L;const Z=H.attributes.mid;typeof Z!="string"||Re(z=this.useLocalCodecsMids).call(z,Z)||this.useLocalCodecsMids.push(Z)}else if(S.audioCodecs.length===0){const Z=T.audioCodecs.filter(se=>{var ue,Ee;return(ue=se.rtpMap)===null||ue===void 0?void 0:Re(Ee=ue.encodingName.toLowerCase()).call(Ee,"opus")})||[T.audioCodecs[0]];H.media.fmts=Z.map(se=>se.payloadType.toString(10)),H.attributes.payloads=Z,H.attributes.extmaps=[]}else H.media.fmts=S.audioCodecs.map(Z=>Z.payloadType.toString(10)),H.attributes.payloads=S.audioCodecs,H.attributes.extmaps=S.audioExtensions,y_(H)}}return this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1,[this.sessionDesc,y]}updateCandidates(h){const f=this._originCandidates.filter(y=>y.transport==="udp"),E=[];if(f.forEach(y=>{E.push(yN(yN({},y),{},{foundation:"tcpcandidate",priority:Number(y.priority)-1+"",transport:"tcp",port:Number(y.port)+90+""}))}),f.length!==0){switch(h){case ur.TCP_RELAY:this._candidates=E;break;case ur.UDP_TCP_RELAY:case ur.RELAY:this._candidates=[...f,...E];break;default:this._candidates=f}for(const y of this.sessionDesc.mediaDescriptions)y.attributes.candidates=this.candidates}}restartICE(h){h=jn(h),this._iceParameters=h,this.sessionDesc.mediaDescriptions.forEach(f=>{f.attributes.iceUfrag=h.iceUfrag,f.attributes.icePwd=h.icePwd})}predictReceivingMids(h){const f=[];for(let E=0;E<h;E++)f.push((this.currentMidIndex+E+1).toString(10));return f}findAvailableMediaIndex(h,f){return this.sessionDesc.mediaDescriptions.findIndex(E=>{const y=E.media.mediaType===h&&E.media.port!=="0"&&(E.attributes.direction==="sendonly"||E.attributes.direction==="sendrecv")&&E.attributes.ssrcs.length===0;if(qn()){if(y){const S=this.firefoxSsrcMidMap.get(f[0].ssrcId);return!(S||E.attributes.mid!=="0"&&E.attributes.mid!=="1")||!(!S||S!==E.attributes.mid)}return!1}return y})}createOrRecycleDataChannel(){for(const E of this.sessionDesc.mediaDescriptions)if(E.media.mediaType==="application")return{mediaDesc:E,needExchangeSDP:!1};this.currentMidIndex+=1;const h="".concat(this.currentMidIndex),f={media:{mediaType:"application",port:Rb,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(h),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(f),{mediaDesc:f,needExchangeSDP:!0}}createOrRecycleRecvMedia(h,f,E,y,S,T){const k=h._mediaStreamTrack.kind,O=this.rtpCapabilities.recv,I=iS(k,O,this.localCapabilities.send,k===xe.VIDEO?y:S),M=k===xe.VIDEO?O.videoExtensions:O.audioExtensions;this.currentMidIndex+=1;const L="".concat(this.currentMidIndex);let j={media:{mediaType:k,port:Rb,protos:["UDP","TLS","RTP","SAVPF"],fmts:I.map(z=>z.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:M,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:I,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:E,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(L)}};j=this.mungRecvMediaDsec(j,h,T);const K=this.findFirstClosedMedia(k);if(K){const z=this.sessionDesc.mediaDescriptions.indexOf(K);this.sessionDesc.mediaDescriptions[z]=j}else this.sessionDesc.mediaDescriptions.push(j);return j}updateRemoteDtlsParameters(h){const f=new Set(this._dtlsParameters.fingerprints.map(S=>S.fingerprint)),E=new Set(h.map(S=>S.fingerprint));let y=!1;f.size!==E.size&&(y=!0);for(const S of f)E.has(S)||(y=!0);return y}updateRemoteCodec(h,f,E){const y=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(j=>j.rtpMap&&j.rtpMap.encodingName.toLowerCase()||"").filter(j=>{var K;return Re(K=Object.keys(Yy)).call(K,j)}))],S=new Set(f);if(y.every(j=>S.has(j)))return b.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(f)),!1;const T=this._rtpCapabilities.recv.videoCodecs.filter(j=>f.some(K=>{var z;return Re(z=j.rtpMap&&j.rtpMap.encodingName.toLowerCase()||"").call(z,K)}));if(T.length===0)return b.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(y," codecs: ").concat(f)),!1;const k=[...new Set(T.map(j=>j.rtpMap&&j.rtpMap.encodingName.toLowerCase()||""))];let O;if(b.debug("updateRemoteCodec, from ".concat(y," to ").concat(k)),h.length===0)O=this.sessionDesc.mediaDescriptions.filter(j=>j.media.mediaType==="video"&&j.attributes.direction==="recvonly");else if(O=this.sessionDesc.mediaDescriptions.filter(j=>j.attributes.mid&&j.media.mediaType==="video"&&Re(h).call(h,j.attributes.mid)&&j.attributes.direction==="recvonly"),O.length!==h.length)return b.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(h,", codecs: ").concat(f)),!1;if(U("USE_PUB_RTX")||U("USE_SUB_RTX")){const j=Bu(T,this.rtpCapabilities.recv.videoCodecs);T.push(...j)}this._rtpCapabilities.recv.videoCodecs=T;const I=this.localCapabilities.send,M=this.rtpCapabilities.recv,L=iS(xe.VIDEO,M,I,E);return O.forEach(j=>{const K=L.map(z=>z.payloadType.toString(10));b.debug("updateRemoteCodec mid: ".concat(j.attributes.mid,", from"),j.attributes.payloads,"to",L),j.attributes.payloads=L,j.media.fmts=K}),!0}createOrRecycleSendMedia(h,f,E,y,S){const T=this.rtpCapabilities.send.videoCodecs,k=this._isUseLocalCodecs||T.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,O=h===xe.VIDEO?k.videoCodecs:k.audioCodecs,I=h===xe.VIDEO?k.videoExtensions:k.audioExtensions;this.currentMidIndex+=1;const M="".concat(this.currentMidIndex);let L={media:{mediaType:h,port:Rb,protos:["UDP","TLS","RTP","SAVPF"],fmts:O.map(K=>K.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:I,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:O,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:y,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(M)}};L=this.mungSendMediaDesc(L,S);const j=this.findFirstClosedMedia(h);if(j){const K=this.sessionDesc.mediaDescriptions.indexOf(j);this.sessionDesc.mediaDescriptions[K]=L}else this.sessionDesc.mediaDescriptions.push(L);return L}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(h=>h.media.port!=="0").map(h=>h.attributes.mid)}mungRecvMediaDsec(h,f,E){const y=jn(h);return aN(y),g_(y,f),oN(y,f),MV(y),Eb(y,E,this.localCapabilities.send),y}mungSendMediaDesc(h,f){const E=jn(h);return Eb(E,f,this.localCapabilities.recv),y_(E),E}updateRecvMedia(h,f){const E=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===h);if(E!==-1){const y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[E],f);this.sessionDesc.mediaDescriptions[E]=y}}bumpMid(h){this.currentMidIndex+=h}findFirstClosedMedia(h){return this.sessionDesc.mediaDescriptions.find(f=>qn()?f.media.port==="0"&&f.media.mediaType===h:f.media.port==="0")}findPreloadMediaDesc(h){return this.sessionDesc.mediaDescriptions.find(f=>{var E;return((E=f.attributes)===null||E===void 0||(E=E.ssrcs[0])===null||E===void 0?void 0:E.ssrcId)===h[0].ssrcId})}getSSRC(h){var f;return(f=this.sessionDesc.mediaDescriptions.find(E=>E.attributes.mid===h))===null||f===void 0?void 0:f.attributes.ssrcs}}(Zo(Zo({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!U("ENABLE_PRE_SUB_WITH_PRE_PC")||!U("PRE_USE_LOCAL_CODECS"))&&RI(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),a=jV(this.initialOffer.sdp,this.extension),l=this.logSDPExchange(a||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),l==null||l(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const u=this.peerConnection.getTransceivers()[0];if(u!=null&&u.receiver&&this.tryBindTransportEvents(u.receiver),RI(this.store))if(t.preallocation&&U("ENABLE_PRE_SUB_WITH_PRE_PC")){const h=U("PRE_SUB_NUM"),{mids:f,preSSRCs:E}=this.remoteSDP.preloadRemoteMedia(h);await Gu(this.peerConnection,this.remoteSDP,this.extension),b.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(E)),this.presetMedia(f,E)}else{const{preSSRCs:h=[]}=t,f=h.map(y=>y.ssrcMsg[0].ssrcId);if(h.length===0)return;const{mids:E}=this.remoteSDP.batchSend(h.map(y=>Object.assign({},y)));await Gu(this.peerConnection,this.remoteSDP,this.extension),b.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(f)),this.presetMedia(E,f)}}catch(r){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}var n,i}presetMedia(t,n){t.forEach((i,r)=>{this.peerConnection.getTransceivers().forEach(a=>{if(a.mid!=null&&i===a.mid&&a.receiver.track){const l=a.receiver.track;let u;l.kind==="video"&&U("ENABLE_PRE_RENDER")&&(u=new xI({trackId:"track-".concat(l.kind,"-unknown-").concat(this.store.clientId,"_").concat(yn(5,""))},!0),u.updateVideoTrack(l),u.onFirstVideoFrameRender=()=>{var h;const f=this.preMediaMap.get(n[r]);f&&(f.firstVideoRender=Date.now()),(h=this.onFirstVideoRender)===null||h===void 0||h.call(this,n[r])},u.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[r],{mid:i,track:l,player:u,transceiver:a})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:i}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const l=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||l}const{preSSRCs:r=[]}=t,a=r.map(l=>l.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(a)){const l=[],u=[];if(Array.from(this.preMediaMap.entries()).every(h=>{let[f,{mid:E,player:y,track:S}]=h;return l.push(E),u.push(f),this.preMediaMap.delete(f),y&&y.destroy(),!0}),l.length>0&&(this.remoteSDP.stopSending(l),await Gu(this.peerConnection,this.remoteSDP,this.extension),b.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(u)),He.reportApiInvoke(this.store.sessionId,{name:si.PRELOAD_MEDIA_FAILED,options:[r,u],tag:Vn.TRACER}).onSuccess()),r.length>0){const{mids:h}=this.remoteSDP.batchSend(r.map(f=>Object.assign({},f)));await Gu(this.peerConnection,this.remoteSDP,this.extension),b.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(a)),this.presetMedia(h,a)}}n?(await Gu(this.peerConnection,this.remoteSDP,this.extension),b.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):b.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,i){var r=this;return ya(function*(){const a=yield Ft(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=[],u=fb();t.forEach(I=>{const M=r.peerConnection.addTransceiver(I._mediaStreamTrack,Zo({direction:"sendonly"},I.trackMediaType==="video"&&r.supportAV1RtpSpec&&u?{sendEncodings:[{scalabilityMode:u}]}:{}));l.push(M),I._updateRtpTransceiver(M)}),qn()&&U("SIMULCAST")===!0&&(yield Ft(r.applySimulcastForFirefox(l,t)));const h=yield Ft(r.peerConnection.createOffer()),f=r.remoteSDP.predictReceivingMids(t.length),E=r.mungSendOfferSDP(h.sdp,t,f),y=os(E),S=f.map(I=>{const M=y.mediaDescriptions.find(L=>L.attributes.mid===I);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return kV(M,U("USE_PUB_RTX"))});let T;try{T=yield S}catch(I){T=[],r.remoteSDP.receive(t,n,i,T);const M=r.remoteSDP.toString();throw yield Ft(r.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ft(r.peerConnection.setRemoteDescription({type:"answer",sdp:M})),yield Ft(r.stopSending(f,!0)),I}r.remoteSDP.receive(t,n,i,T);const k=r.remoteSDP.toString(),O=r.logSDPExchange(E,"offer","local","send");return yield Ft(r.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ft(r.applySimulcastEncodings(l,t)),yield Ft(r.applySendEncodings(l,t)),O==null||O(k),yield Ft(r.peerConnection.setRemoteDescription({type:"answer",sdp:k})),l.map((I,M)=>{const L=f[M];return{localSSRC:S[M],id:L,transceiver:I}})}catch(l){throw l instanceof re?l:new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{a()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")b.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const a=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof a!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:a,negotiated:!0,ordered:!1,maxRetransmits:U("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}n.forEach(a=>{a._updateOriginDataChannel(i)});const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(l),b.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else b.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof re?i:new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof re?n:new re(x.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(h=>{var f;Ab(this.id+h.mid,this),h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});const a=await this.peerConnection.createOffer(),l=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();l==null||l(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(t,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:l}=this.remoteSDP.send(t,n,i,r);l&&(await Gu(this.peerConnection,this.remoteSDP,this.extension),b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const u=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:a,transceiver:u}}catch(a){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await Gu(this.peerConnection,this.remoteSDP,this.extension),b.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(r=>{const a=this.peerConnection.getTransceivers().find(l=>l.mid===r);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:r,transceiver:a}})}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(a=>{Array.from(this.preMediaMap.entries()).some(l=>{let[u,{mid:h,player:f}]=l;if(h===a)return this.preMediaMap.delete(u),f&&f.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(l=>{l.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();r==null||r(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(l,u)=>{l.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const a=this.remoteSDP.toString();r==null||r(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return ya(function*(){const i=yield Ft(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=Bt().supportPCSetConfiguration,a=U("FORCE_TURN_TCP")||n.forceTurn;if(t===ur.RELAY&&!r)return;if(r&&!a){const y=t===ur.RELAY?"relay":"all",S=n.peerConnection.getConfiguration();S.iceTransportPolicy!==y&&(b.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(y,"]")),S.iceTransportPolicy=y,n.peerConnection.setConfiguration(S))}n.remoteSDP.updateCandidates(t);const l=yield Ft(n.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=Fu(l.sdp),{remoteIceParameters:h}=yield u.iceParameters;n.remoteSDP.restartICE(h);const f=n.remoteSDP.toString(),E=n.logSDPExchange(l.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Ft(n.peerConnection.setLocalDescription(l)),E==null||E(f),yield Ft(n.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(r){b.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(ur.TCP_RELAY),await Gu(this.peerConnection,this.remoteSDP,this.extension)}catch(n){b.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{Ab(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:i}=n;i&&i.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Zo(Zo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),l=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),l==null||l(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new re(x.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===t);i.length===1&&(this.isVP8Simulcast(n)?qn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:Zo(Zo({},Zc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Zo(Zo({},Zc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const i="code: ".concat(t.errorCode,", message: ").concat(t.errorText),r=t.port?"local: ".concat(t.port):"",a=Vp(t.url||"");b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(a||"",", host_candidate:").concat(r)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},U("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},i=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Fy(t.turnServer.servers)?n.iceServers=t.turnServer.servers:U("NEW_TURN_MODE")&&n.iceServers&&i==="disabled"?(U("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...$p.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...$p.newTurnServerConfigToIceServers(t.turnServer.servers)),U("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...$p.turnServerConfigToIceServers(t.turnServer.servers)),U("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...$p.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),U("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),U("ENABLE_ENCODED_TRANSFORM")&&Bt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Vu(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!U("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{const r=U("NEW_TURN_MODE");r===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):r===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):r===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Vu(i.turnServerURL),":443?transport=tcp")}):r===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Vu(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var r;n!=null&&n.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,n.state))},n.onerror=r=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in r?r.error:r)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const r=n==null?void 0:n.iceTransport.state;var a;r&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:r,remote:a}=i.getSelectedCandidatePair()||{};if(r&&a){const l=r.address+":"+r.port,u=a.address+":"+a.port;b.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Vp(l)),", remote ").concat(JSON.stringify(Vp(u))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i,r;if(n||(n=this.peerConnection.getSenders().find(I=>I.track===t._mediaStreamTrack)),!n)return b.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return b.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Bt().supportSetRtpSenderParameters)return b.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const a={},l={};switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;case"balanced":a.degradationPreference="balanced"}const u=function(O,I){return O.getTransceivers().find(M=>M.sender.track===I||M.receiver.track===I)}(this.peerConnection,t._mediaStreamTrack),h=xW(t);if(function(O){var I;return!(!U("ENABLE_AG_ADAPTATION")||!(O instanceof ZR||Re(I=O._hints).call(I,hn.CUSTOM_TRACK))||!U("FORCE_SUPPORT_AG_ADAPTATION")&&!(cM(14,0,!1)&&lM(17,4)||oM(14)&&QO(17,4,!0)))}(t)&&u&&n&&h&&this.getLocalVideoStats&&Re(i=["vp8","vp9"]).call(i,this.store.codec)){var f;const O=a.degradationPreference||(Re(f=t._hints).call(f,hn.CUSTOM_TRACK)?U("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(I,M,L,j,K,z){if(Ab(I,L),K(M),j!=="balanced"&&j!=="maintain-framerate"&&j!=="maintain-resolution")return;let H=-1;u3(I,M);const Z=window.setInterval(()=>{const ue=wb.get(I);if(!U("ENABLE_AG_ADAPTATION")||!ue)return Ab(I,L),void K(M);const Ee=z();if(Ee.sendPackets>0&&Ee.OutgoingAvailableBandwidth>0){if(H===-1)return void(H=Date.now());if(Date.now()-H<1e3)return;const Rt=Ee.sendFrameRate,At=Ee.OutgoingAvailableBandwidth,[ot,Kt]=XY(I,Rt,At,ue.adaptationConfig,M,j);Kt&&(L.qualityLimitationReason=Kt),ot&&ue.adaptationConfig.scale!==ot.scale&&(b.debug("[".concat(I,"] applyAdaptation: ").concat(L.qualityLimitationReason,`
           sendFps `).concat(Rt,", bwe ").concat(At,", switch from ").concat(ue.adaptationConfig.scale," to ").concat(ot.scale," ")),ue.adaptationConfig=vN(vN({},ue.adaptationConfig),ot),K(ot))}},U("CHECK_LOCAL_STATS_INTERVAL")),se=vN({},M);wb.set(I,{timer:Z,adaptationConfig:se,originConfig:M,adaptationFunc:K}),b.debug("[".concat(I,"] start adaptation, originConfig: ").concat(JSON.stringify(M),", degradationPreference: ").concat(j))})(this.id+u.mid,h,this,O,I=>{n&&this.updateAdaptation(n,I)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var E;const{bitrateMax:O,frameRate:I,scaleResolutionDownBy:M}=t._encoderConfig;O&&(l.maxBitrate=1e3*O),(Re(E=t._hints).call(E,hn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(I&&(l.maxFramerate=Ps(I)),M&&M>=1&&(l.scaleResolutionDownBy=M))}const{maxFramerate:y}=U("ENCODER_CONFIG_LIMIT");if(y&&typeof y=="number"&&(l.maxFramerate=l.maxFramerate?Math.min(l.maxFramerate,y):y),U("DSCP_TYPE")&&rd()){var S;const O=U("DSCP_TYPE");Re(S=["very-low","low","medium","high"]).call(S,O)&&(l.networkPriority=O)}const T=n.getParameters(),k=(r=T.encodings)===null||r===void 0?void 0:r[0];qn()&&!k&&(a.encodings=[l]),k&&Object.assign(k,l),Object.assign(T,a),b.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(T.encodings))),await n.setParameters(T),await async function(O,I,M){try{var L;if(!Bt().supportSetRtpSenderParameters||!function(Z){return Z==="vp9"||Z==="av1"}(O)||!U("ENABLE_SVC"))return;const j={},K={},z=I.getParameters(),H=(L=z.encodings)===null||L===void 0?void 0:L[0];K.scalabilityMode=fb(M),H&&Object.assign(H,K),Object.assign(z,j),await I.setParameters(z),b.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(z.encodings)))}catch(j){b.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",j)}}(this.store.codec,n,U("SVC_MODE"))}async updateAdaptation(t,n){var i,r;if(!t)return b.debug("[updateAdaptation] no rtpSender found");if(!Bt().supportSetRtpSenderParameters)return b.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const a={},{bitrateMax:l,frameRate:u,scaleResolutionDownBy:h}=n;l&&(a.maxBitrate=1e3*l),u&&(a.maxFramerate=Ps(u)),h&&h>=1&&Re(i=["vp8","vp9"]).call(i,this.store.codec)&&(a.scaleResolutionDownBy=h);const f=t.getParameters(),E=(r=f.encodings)===null||r===void 0?void 0:r[0];E&&Object.assign(E,a),Object.assign(f,{});try{await t.setParameters(f),b.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(f.encodings)))}catch(y){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?b.debug("[updateAdaptation] peerConnection not connected}"):b.debug("[updateAdaptation] updateRtpSenderEncodings failed",y):b.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!Bt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const r=t[i],a=n[i];a instanceof In&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,r.sender)}}catch{b.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const r=os(t);return n.forEach((a,l)=>{const u=i[l],h=r.mediaDescriptions.find(f=>f.attributes.mid===u);h&&(g_(h,a),xV(h,a,this.store.codec))}),Lu(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let h=0;h<t.length;h++){var i,r,a,l,u;const f=t[h],E=n[h];if(E instanceof In&&!Re(i=E._hints).call(i,hn.LOW_STREAM)&&(r=E._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((a=E._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(l=E._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=E._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const y={},S={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};y.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const T=f.sender.getParameters();await f.sender.setParameters(Object.assign(T,y))}}}async applySimulcastEncodings(t,n){if(!qn()&&t.length===n.length)for(let i=0;i<t.length;i++){const r=n[i];if(r instanceof In&&this.isVP8Simulcast(r)){const a=t[i],l={},u={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,l))}}}isVP8Simulcast(t){var n,i,r,a,l;return!!(t instanceof In&&U("SIMULCAST")&&this.store.codec==="vp8"&&!Re(n=t._hints).call(n,hn.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=t._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(a=t._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((l=t._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(t,n,i,r){if(U("SDP_LOGGING"))return b.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",r)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(Bt().supportPCSetConfiguration){const n=$p.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},Be(Ut.prototype,"updateRemoteRTPCapabilities",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"updateRemoteRTPCapabilities"),Ut.prototype),Be(Ut.prototype,"connect",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"connect"),Ut.prototype),Be(Ut.prototype,"updateRemoteConnect",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"updateRemoteConnect"),Ut.prototype),Be(Ut.prototype,"createDataChannels",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"createDataChannels"),Ut.prototype),Be(Ut.prototype,"receive",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"receive"),Ut.prototype),Be(Ut.prototype,"batchReceive",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"batchReceive"),Ut.prototype),Be(Ut.prototype,"stopReceiving",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"stopReceiving"),Ut.prototype),Be(Ut.prototype,"muteRemote",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"muteRemote"),Ut.prototype),Be(Ut.prototype,"unmuteRemote",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"unmuteRemote"),Ut.prototype),Be(Ut.prototype,"muteLocal",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"muteLocal"),Ut.prototype),Be(Ut.prototype,"unmuteLocal",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"unmuteLocal"),Ut.prototype),Be(Ut.prototype,"close",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"close"),Ut.prototype),Be(Ut.prototype,"updateEncoderConfig",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"updateEncoderConfig"),Ut.prototype),Be(Ut.prototype,"updateSendParameters",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"updateSendParameters"),Ut.prototype),Be(Ut.prototype,"replaceTrack",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"replaceTrack"),Ut.prototype),Be(Ut.prototype,"updateAdaptation",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"updateAdaptation"),Ut.prototype),Be(Ut.prototype,"getRemoteSSRC",[$r],Object.getOwnPropertyDescriptor(Ut.prototype,"getRemoteSSRC"),Ut.prototype),Ut);function $r(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,a=await r.lock("From P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},n}function CN(e,t){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=Ps(t.width),i.height=Ps(t.height);const r=Ps(t.framerate||15);document.body.append(n),document.body.append(i);let a=e._mediaStreamTrack;n.srcObject=new MediaStream([a]),n.play();const l=i.getContext("2d");if(!l)throw new te(x.UNEXPECTED_ERROR,"can not get canvas context");const u=Bt(),h=i.captureStream(u.supportRequestFrame?0:r).getVideoTracks()[0];h.canvas||(h.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const E=n.videoWidth,y=n.videoHeight/E,S=i.width*y;Math.abs(S-i.height)>=2&&(b.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(S)),i.height=S)}l.drawImage(n,0,0,i.width,i.height),h.requestFrame&&h.requestFrame(),a!==e._mediaStreamTrack&&(a=e._mediaStreamTrack,n.srcObject=new MediaStream([a]))},i.stopCapture=NI(()=>i.startCapture&&i.startCapture(),r);const f=h.stop;return h.stop=()=>{f.call(h),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),b.debug("clean low stream renderer")},h}var _3=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(_3||{}),Qo=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(Qo||{}),ht=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(ht||{}),Zi=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(Zi||{}),es=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(es||{}),Ib=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(Ib||{});const Fp=1e3,Nb=6,oS=3,QY=Math.max(Nb,oS,60);function tt(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function E3(e){const t={[es.CONN_TYPE]:0,[es.RTT]:e.rtt,[es.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[es.CONN_TYPE]=1),n==="tcp"&&(t[es.CONN_TYPE]=3),n==="tls"&&(t[es.CONN_TYPE]=4);break}case"srflx":t[es.CONN_TYPE]=2;break;case"unknown":t[es.CONN_TYPE]=5;break;default:t[es.CONN_TYPE]=0}return t}function g3(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class y3 extends Wn{constructor(t){super(),P(this,"store",void 0),P(this,"uploadWRTCStatsTimer",void 0),P(this,"uploadOutboundDenoiserStatsTimer",void 0),P(this,"uploadExtStatsTimer",void 0),P(this,"uploadExtUsageStatsTimer",void 0),P(this,"uploadInboundExtStatsTimer",void 0),P(this,"requestStats",void 0),P(this,"requestTransportStats",void 0),P(this,"requestLocalMedia",void 0),P(this,"requestRemoteMedia",void 0),P(this,"requestAllTracks",void 0),P(this,"requestVideoIsReady",void 0),P(this,"requestUploadStats",void 0),P(this,"requestUpload",void 0),P(this,"uploadOutboundStarted",!1),P(this,"uploadInboundStarted",!1),P(this,"uploadTransportStarted",!1),P(this,"uploadBaseStatsStarted",!1),P(this,"uploadExtensionUsageStarted",!1),P(this,"lastRecvStats",void 0),P(this,"lastSendStats",void 0),P(this,"lastRefRecvStats",void 0),P(this,"lastRefSendStats",void 0),P(this,"lastNormalRecvStats",void 0),P(this,"lastNormalSendStats",void 0),P(this,"lastExtendStats",{}),P(this,"needUploadStats",{}),P(this,"needUploadRenderFreezeTime",!0),P(this,"lastUploadCompensateTime",-1),P(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%oS==0,i=t%Nb==0,r=t%60==0;let a,l;if(this.uploadTransportStarted&&(a=this.requestStats(),this.store.useP2P&&(l=this.requestStats(!0))),!a&&this.uploadOutboundStarted&&(a=this.requestStats()),!l&&this.uploadInboundStarted&&(l=this.requestStats(!0)),a||l){var u;const h={};if(this.uploadTransportStarted&&a){const E=this.getTransportStats(a,l,n);E&&(h.misc=[E])}if(this.uploadOutboundStarted&&a){const E=this.getOutboundStats(a,i?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,r);E&&(h.outbound=[E])}if(this.uploadInboundStarted&&l){this.uploadCompensateStats(t);const E=this.getInboundStats(l,i?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);E&&(h.inbound=E)}const f=(u=this.requestTransportStats)===null||u===void 0?void 0:u.call(this).connectState;f&&(Array.isArray(h.misc)?h.misc[0]&&h.misc[0].addition&&(h.misc[0].addition[Ib.RTC_PEER_CONNECTION_STATE]=fI[f]):h.misc=[{addition:{[Ib.RTC_PEER_CONNECTION_STATE]:fI[f]}}]),this.needUploadStats.sendType&&(Array.isArray(h.outbound)&&h.outbound[0]&&h.outbound[0].high&&(h.outbound[0].high[_3.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(h)}this.lastRecvStats=l,this.lastSendStats=a,i&&(this.lastNormalRecvStats=l,this.lastNormalSendStats=a),n&&(this.lastRefRecvStats=l,this.lastRefSendStats=a)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const r=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(r&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[Ib.RTC_PEER_CONNECTION_STATE]:fI[r.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===QY+1&&(t=1)},Fp)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%oS==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const i=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=i,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const r=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*r;const a=this.requestStats(!0);new Array(r).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const l={};if(this.uploadInboundStarted&&a){const u=this.requestRemoteMedia()||[],h=[];u.forEach(f=>{let[E,y]=f;const S={peer:E.uid};if(E._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(E._videoSSRC)&&y.has(xe.VIDEO)&&E.videoTrack){const T=function(k,O,I){if(!O.videoRecv.find(L=>L.ssrc===k))return;const M={};if(I&&I._player){const L=I._player,{renderFreezeAccTime2:j,videoElementStatus:K}=L;if(el.visibility==="visible"&&K===lr.PLAYING&&Bt().supportRequestVideoFrameCallback){const z=Math.min(6e3,j);L.renderFreezeAccTime2=Math.max(0,j-z),tt(M,Qo.Video_Render_Freeze_Time_Render2,z),U("USE_NEW_RENDER_FREEZE_TIME")&&tt(M,Qo.Video_Render_Freeze_Time_Render,z)}}return M}(E._videoSSRC,a,E.videoTrack);T&&(S.video=T)}S.video&&h.push(S)}),h.length>0&&(l.inbound=h,this.requestUploadStats(l))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,i){if(!this.requestStats)return;if(!i)return t.rtt==null?void 0:{addition:{[es.RTT]:t.rtt,[es.CONN_TYPE]:void 0,[es.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const r=E3(t);if(this.store.useP2P){if(n){const a=E3(n);r[es.CONN_TYPE]+=a[es.CONN_TYPE]<<3}r[es.CONN_TYPE]+=110}else r[es.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(t,n,i,r,a){if(!this.requestUploadStats||!this.requestLocalMedia)return;const l=this.requestLocalMedia();if(!l||l.length===0)return;let u,h,f;return l.forEach(E=>{let[y,{track:S,ssrcs:T}]=E;switch(y){case me.LocalVideoLowTrack:case me.LocalVideoTrack:if(y===me.LocalVideoTrack){var k;const O=function(j,K,z,H,Z,se){const ue=K.videoSend.find(ot=>ot.ssrc===j);if(!ue)return;const Ee={},{sentFrame:Rt,inputFrame:At}=ue;if(H&&(tt(Ee,Qo.Video_Send_Qp_Sum,ue.qpSumPerFrame),At&&Rt)){const ot=At.frameRate,Kt=Rt.frameRate;Ee[Qo.Video_Send_Freeze]=function(Yt,pr){let le=!0;return le=!(Yt<=5)&&(Yt<=10?pr<3:Yt<=20?pr<4:pr<5),le}(ot,Kt)?1:0}if(Z){switch(Rt&&(tt(Ee,ht.Video_Send_Height,Rt.height),tt(Ee,ht.Video_Send_Width,Rt.width),tt(Ee,ht.Video_Send_Frame_Rate,Rt.frameRate)),Ee[ht.Video_Send_Disabled]=z._originMediaStreamTrack&&!z._originMediaStreamTrack.enabled||z._mediaStreamTrack&&!z._mediaStreamTrack.enabled?1:0,ue.adaptionChangeReason){case"none":Ee[ht.Video_Send_Adaptation]=0;break;case"cpu":Ee[ht.Video_Send_Adaptation]=1;break;case"bandwidth":Ee[ht.Video_Send_Adaptation]=2;break;case"other":Ee[ht.Video_Send_Adaptation]=3}let ot=0;ue.adaptionChangeReason&&(ot+=g3(ue.adaptionChangeReason)),K.qualityLimitationReason&&(ot+=g3(K.qualityLimitationReason)<<3),Ee[ht.Video_Send_Adaptation]=ot,Ee[ht.Video_Send_Player_Status]=OI[z._player?z._player.videoElementStatus:"uninit"],tt(Ee,ht.Video_Send_Nacks,ue.nacksCount),tt(Ee,ht.Video_Send_Plis,ue.plisCount),tt(Ee,ht.Video_Send_Firs,ue.firsCount),tt(Ee,ht.Video_Send_Avg_Encode,ue.avgEncodeMs),tt(Ee,ht.Video_Send_Huge_Frame_Sent,ue.hugeFramesSent),tt(Ee,ht.Video_Send_Bytes_Retransmit,ue.retransmittedBytesSent),tt(Ee,ht.Video_Send_Packages_Retransmit,ue.retransmittedPacketsSent),tt(Ee,ht.Video_Send_Key_Frames_Encoded,ue.keyFramesEncoded);const Kt=Z.videoSend.find(Yt=>Yt.ssrc===j);if(Kt){let Yt=Fp*oS;Kt.timestamp&&ue.timestamp&&(Yt=ue.timestamp-Kt.timestamp),Kt.packets!=null&&ue.packets!=null&&tt(Ee,ht.Video_Send_Package_Rate,1e3*(ue.packets-Kt.packets)/Yt),ue.packetsLost!=null&&Kt.packetsLost!=null&&tt(Ee,ht.Video_Send_Package_Lost,ue.packetsLost-Kt.packetsLost),Kt.bytes!=null&&ue.bytes!=null&&tt(Ee,ht.Video_Send_Bitrate,8*(ue.bytes-Kt.bytes)/Yt)}}return Ee}(T[0].ssrcId,t,S,n,i),I=S.__className__==="CameraVideoTrack"?3:Re(k=S._hints).call(k,hn.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==I||a)&&(this.needUploadStats={sendType:I},this.lastExtendStats.sendType=I);const M=S&&function(j,K,z,H){const Z=K.videoSend.find(ue=>ue.ssrc===j);if(!Z)return null;const se={};if(H){const ue=Z.inputFrame,Ee=ue&&ue.height||z.videoHeight||0,Rt=ue&&ue.width||z.videoWidth||0,At=ue&&ue.frameRate||0;tt(se,ht.Video_Capture_Height,Ee),tt(se,ht.Video_Capture_Width,Rt),tt(se,ht.Video_Capture_Frame_Rate,At)}return se}(T[0].ssrcId,t,S,!!i),L=function(j,K){const z={};return K&&(tt(z,ht.Video_Send_Retransmit,j.bitrate.retransmit),tt(z,ht.Video_Send_Target_Encoded,j.bitrate.targetEncoded),tt(z,ht.Video_Send_Actual_Encoded,j.bitrate.actualEncoded),tt(z,ht.Video_Send_Transmit,j.bitrate.transmit),tt(z,ht.Video_Send_Bandwidth,j.sendBandwidth)),z}(t,!!i);h=Object.assign({},O,M,L)}else f=function(O,I,M,L,j){const K=I.videoSend.find(H=>H.ssrc===O);if(!K)return;const z={};if(L){const H=K.sentFrame;H&&(tt(z,ht.Video_Send_Low_Height,H.height),tt(z,ht.Video_Send_Low_Width,H.width),tt(z,ht.Video_Send_Low_Frame_Rate,H.frameRate));const Z=L.videoSend.find(se=>se.ssrc===O);if(Z){let se=Fp*Nb;Z.timestamp&&K.timestamp&&(se=K.timestamp-Z.timestamp),Z.packets!=null&&K.packets!=null&&tt(z,ht.Video_Send_Low_Package_Rate,1e3*(K.packets-Z.packets)/se),K.packetsLost!=null&&Z.packetsLost!=null&&tt(z,ht.Video_Send_Low_Package_Lost,K.packetsLost-Z.packetsLost),Z.bytes!=null&&K.bytes!=null&&tt(z,ht.Video_Send_Low_Bitrate,8*(K.bytes-Z.bytes)/se)}}return z}(T[0].ssrcId,t,0,i);break;case me.LocalAudioTrack:u=S&&function(O,I,M,L,j,K){const z=I.audioSend.find(Z=>Z.ssrc===O);if(!z)return;const H={};if(j){H[ht.Audio_Send_Disabled]=M._originMediaStreamTrack&&!M._originMediaStreamTrack.enabled||M._mediaStreamTrack&&!M._mediaStreamTrack.enabled?1:0;const Z=100*M._source.getAccurateVolumeLevel(),se=z.inputLevel;if(se!=null){const Ee=Math.ceil(50*Math.log10(100*se+1));tt(H,ht.Audio_Send_Level,Ee)}tt(H,ht.Audio_Capture_PCM_Level,Z),tt(H,ht.Audio_Send_AEC_Return_Loss,z.aecReturnLoss),tt(H,ht.Audio_Send_AEC_Return_Loss_Enhancement,z.aecReturnLossEnhancement),tt(H,ht.Audio_Send_Bytes_Retransmit,z.retransmittedBytesSent),tt(H,ht.Audio_Send_Packages_Retransmit,z.retransmittedPacketsSent),H[ht.Audio_Send_Freeze]=0;const ue=j.audioSend.find(Ee=>Ee.ssrc===O);if(ue){let Ee=Fp*Nb;ue.timestamp&&z.timestamp&&(Ee=z.timestamp-ue.timestamp),ue.bytes!=null&&z.bytes!=null&&tt(H,ht.Audio_Send_Bitrate,8*(z.bytes-ue.bytes)/Ee),ue.packets!=null&&z.packets!=null&&tt(H,ht.Audio_Send_Package_Rate,1e3*(z.packets-ue.packets)/Ee)}}return H}(T[0].ssrcId,t,S,0,i)}}),{high:h,low:f,audio:u}}getInboundStats(t,n,i,r){if(!this.requestRemoteMedia)return;const a=this.requestRemoteMedia()||[],l=[];return a.forEach(u=>{let[h,f]=u;const E={peer:h.uid};if(f.has(xe.VIDEO)&&h.videoTrack){const y=h._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(h._videoSSRC)||!1,S=h.videoTrack?function(T,k,O,I,M,L,j,K){const z=k.videoRecv.find(ot=>ot.ssrc===T);if(!z)return;const H={},{receivedFrame:Z,outputFrame:se,decodeFrameRate:ue}=z;tt(H,Zi.Video_Render_Frame_Rate_Decode,ue),z.framesRateFirefox&&tt(H,Zi.Video_Recv_Frame_Rate,z.framesRateFirefox),Z&&tt(H,Zi.Video_Recv_Frame_Rate,Z.frameRate),tt(H,Zi.Video_Recv_Frame_Dropped,z.framesDroppedCount),tt(H,Zi.Video_Recv_Bytes_Retransmit,z.retransmittedBytesReceived),tt(H,Zi.Video_Recv_Packages_Retransmit,z.retransmittedPacketsReceived),tt(H,Zi.Video_Recv_Packages_Discarded,z.packetsDiscarded),tt(H,Zi.Video_Recv_Avg_Decode,z.avgDecodeMs),tt(H,Zi.Video_Recv_Avg_Processing_Delay,z.avgProcessingDelayMs),tt(H,Zi.Video_Recv_Avg_Assembly_Time,z.avgFramesAssembledFromMultiplePacketsMs),tt(H,Zi.Video_Recv_Avg_Inter_Frame_Delay,z.avgInterFrameDelayMs),tt(H,Zi.Video_Recv_Key_Frames_Decoded,z.keyFramesDecoded);const Ee=K&&K.videoRecv.find(ot=>ot.ssrc===T);if(Ee){const ot=k.timestamp-K.timestamp||Fp;z.packetsLost!=null&&Ee.packetsLost!=null&&tt(H,Zi.Video_Recv_Package_Lost,z.packetsLost-Ee.packetsLost),Ee.bytes!=null&&z.bytes!=null&&tt(H,Zi.Video_Recv_Bitrate,8*(z.bytes-Ee.bytes)/ot),Ee.packets!=null&&z.packets!=null&&tt(H,Zi.Video_Recv_Package_Rate,1e3*(z.packets-Ee.packets)/ot)}const Rt=L&&L.videoRecv.find(ot=>ot.ssrc===T);if(Rt&&(tt(H,Qo.Video_Recv_Qp_Sum,z.qpSumPerFrame),H[Qo.Video_Recv_Freeze]=I&&aS.isRemoteVideoFreeze(O,z,Rt)?1:0),j){var At;const ot=j.videoRecv.find(Yt=>Yt.ssrc===T);Z?(tt(H,ht.Video_Recv_Height,Z.height),tt(H,ht.Video_Recv_Width,Z.width)):O&&(tt(H,ht.Video_Recv_Height,O._videoHeight||0),tt(H,ht.Video_Recv_Width,O._videoWidth||0)),se&&tt(H,ht.Video_Recv_Frame_Rate_Output,se.frameRate);const Kt=(At=O._player)===null||At===void 0?void 0:At.rendFrameRate.toFixed(0);if(Kt&&tt(H,ht.Video_Render_Frame_Rate_Render,+Kt),tt(H,ht.Video_Recv_Jitter_Buffer,z.jitterBufferMs),tt(H,ht.Video_Recv_Current_Delay,z.currentDelayMs),tt(H,ht.Video_Recv_Firs,z.firsCount),tt(H,ht.Video_Recv_Nacks,z.nacksCount),tt(H,ht.Video_Recv_Plis,z.plisCount),O){H[ht.Video_Recv_Disabled]=O._originMediaStreamTrack.enabled&&O._mediaStreamTrack.enabled?0:1;const Yt=O._player;if(Yt){const{freezeTimeCounterList:pr,renderFreezeAccTime:le,renderFreezeAccTime2:Te,videoElementStatus:Ve}=Yt;if(pr&&pr.length>0&&tt(H,Qo.Video_Render_Freeze_Time,pr.splice(0,1)[0]),M&&el.visibility==="visible"&&Ve===lr.PLAYING&&Bt().supportRequestVideoFrameCallback){const he=Math.min(6e3,Te);Yt.renderFreezeAccTime2=Math.max(0,Te-he),tt(H,Qo.Video_Render_Freeze_Time_Render2,he);const A=Math.min(6e3,le);Yt.renderFreezeAccTime=Math.max(0,le-A),tt(H,Qo.Video_Render_Freeze_Time_Render,U("USE_NEW_RENDER_FREEZE_TIME")?he:A)}if(typeof z.totalFreezesDuration=="number"){const he=ot&&ot.totalFreezesDuration?z.totalFreezesDuration-ot.totalFreezesDuration:z.totalFreezesDuration;tt(H,ht.Video_Render_Freeze_Duration,1e3*he)}}}if(H[ht.Video_Recv_Player_Status]=OI[O._player?O._player.videoElementStatus:"uninit"],ot&&z.totalInterFrameDelay!==void 0&&z.totalSquaredInterFrameDelay!==void 0&&ot.totalInterFrameDelay!==void 0&&ot.totalSquaredInterFrameDelay!==void 0){const Yt=z.totalInterFrameDelay-ot.totalInterFrameDelay,pr=z.totalSquaredInterFrameDelay-ot.totalSquaredInterFrameDelay,le=z.framesDecodeCount-ot.framesDecodeCount,Te=Yt/le*1e3,Ve=Math.round(1e3*Math.sqrt((pr-Math.pow(Yt,2)/le)/le));!isNaN(Ve)&&Te+Ve>Math.max(3*Te,Te+150)&&(H[ht.Video_Recv_I_Frame_Delay]=Ve)}}return H}(h._videoSSRC,t,h.videoTrack,y===!0,this.needUploadRenderFreezeTime,n,i,r):void 0;S&&(E.video=S)}if(f.has(xe.AUDIO)&&h.audioTrack){const y=h.audioTrack?function(S,T,k,O,I,M){const L=T.audioRecv.find(H=>H.ssrc===S);if(!L)return;const j={};tt(j,Zi.Audio_Recv_Jitter,L.jitterMs),tt(j,Zi.Audio_Recv_Bytes_Retransmit,L.retransmittedBytesReceived),tt(j,Zi.Audio_Recv_Packages_Retransmit,L.retransmittedPacketsReceived),tt(j,Zi.Audio_Recv_Packages_Discarded,L.packetsDiscarded),tt(j,Zi.Audio_Recv_Avg_Processing_Delay,L.avgProcessingDelayMs);const K=M&&M.audioRecv.find(H=>H.ssrc===S);if(K){const H=Fp;L.packets!=null&&K.packets!=null&&tt(j,Zi.Audio_Recv_Package_Rate,1e3*(L.packets-K.packets)/H),L.packetsLost!=null&&K.packetsLost!=null&&tt(j,Zi.Audio_Recv_Package_Lost,L.packetsLost-K.packetsLost)}if(O){const{receivedFrames:H,droppedFrames:Z}=L;H!=null&&Z!=null&&(j[Qo.Audio_Recv_Freeze]=(z=H)===0||100*Z/z>20?1:0)}var z;if(I){const H=100*k._source.getAccurateVolumeLevel(),Z=L.outputLevel;if(Z!=null){const ue=Math.ceil(50*Math.log10(100*Z+1));tt(j,ht.Audio_Render_Level,ue)}tt(j,ht.Audio_Recv_PCM_Level,H),k&&(j[ht.Audio_Recv_Disabled]=k._originMediaStreamTrack.enabled&&k._mediaStreamTrack.enabled?0:1),tt(j,ht.Audio_Recv_Jitter_Buffer,L.jitterBufferMs),tt(j,ht.Audio_Recv_Current_Delay,L.jitterBufferMs),j[ht.Audio_Recv_Player_Status]=OI[Qr.getPlayerState(k.getTrackId())];const se=I.audioRecv.find(ue=>ue.ssrc===S);if(se){se.bytes!=null&&L.bytes!=null&&tt(j,ht.Audio_Recv_Bitrate,8*(L.bytes-se.bytes)/(Fp*oS));const ue=L.concealedSamples-se.concealedSamples;ue>0&&tt(j,ht.Audio_Recv_Concealed_Samples,ue);const Ee=L.totalSamplesReceived-se.totalSamplesReceived;Ee>0&&tt(j,ht.Audio_Recv_Total_Samples_Received,Ee);const Rt=L.freezeSamples80-se.freezeSamples80;Rt>0&&tt(j,ht.Audio_Render_Freeze_Samples_80ms,Rt);const At=L.freezeSamples200-se.freezeSamples200;At>0&&tt(j,ht.Audio_Render_Freeze_Samples_200ms,At);const ot=L.freezeMs80-se.freezeMs80;tt(j,ht.Audio_Render_Freeze_Time_80ms,ot<0?0:ot);const Kt=L.freezeMs200-se.freezeMs200;tt(j,ht.Audio_Render_Freeze_Time_200ms,Kt<0?0:Kt)}}return j}(h._audioSSRC,t,h.audioTrack,n,i,r):void 0;y&&(E.audio=y)}(E.video||E.audio)&&l.push(E)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,l}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof qy);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(Jy.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,i]=t;i.has(xe.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),i.has(xe.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:U("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let r=[];const a=this.requestAllTracks&&this.requestAllTracks()||[];for(const f of a)!f.muted&&f.enabled&&(r=r.concat(await f.getProcessorUsage()));const l=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[f,E]of l)E.has(xe.VIDEO)&&f.videoTrack&&(r=r.concat(await f.videoTrack.getProcessorUsage())),E.has(xe.AUDIO)&&f.audioTrack&&(r=r.concat(await f.audioTrack.getProcessorUsage()));if(r.length===0)return;i.details=function(f,E){const y={};for(const{id:O,value:I,level:M,direction:L}of f){var S;const j=(S=E.get(O))!==null&&S!==void 0?S:0,K=I===2?j+U("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:j;var T,k;E.set(O,K),y[O]?(I===2&&(y[O].value=I),M>y[O].level&&(y[O].level=M),L==="remote"&&(y[O].remoteUidCount+=1),y[O].totalTs=(T=E.get(O))!==null&&T!==void 0?T:0):y[O]={value:I,level:M,remoteUidCount:L==="local"?0:1,totalTs:(k=E.get(O))!==null&&k!==void 0?k:0}}return Object.keys(y).map(O=>{const{level:I,value:M,totalTs:L}=y[O];return{id:O,level:I,value:M,totalTs:L}})}(r,t);const u=Date.now(),h=u>n?u:n+1;this.requestUpload&&this.requestUpload(Jy.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:h})},U("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const $Y=U("ICE_RESTART_INTERVAL");let Db=new Map,R_=new Map,Yu=[ur.UDP_TCP_RELAY,ur.TCP_RELAY,ur.RELAY],wN=U("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Bt().supportPCSetConfiguration;function S3(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Db.get(e.id);n&&(window.clearTimeout(n),Db.delete(e.id));const i=R_.get(e.id);t&&i&&i.index===Yu.length-1&&(b.debug("[".concat(e.id,"] reset ICE restart policy")),R_.delete(e.id))}function v3(e,t,n){if(Db.size===0&&R_.size===0&&(Array.isArray(U("RESTART_SEQUENCE"))&&U("RESTART_SEQUENCE").length>0&&!function(u,h){if(u.length!==h.length)return!1;for(let f=0;f<u.length;f+=1){const E=u[f];if(u.filter(y=>y===E).length!==h.filter(y=>y===E).length)return!1}return!0}(Yu,U("RESTART_SEQUENCE"))&&(Yu=U("RESTART_SEQUENCE").filter(u=>{var h;if(Re(h=Object.values(ur)).call(h,u))return!0}),b.debug("use reconnection policy from config distribution, queues: ".concat(Yu.join(" => ")))),wN=U("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Bt().supportPCSetConfiguration),Yu.length===0)return void n();let i,{index:r=0,type:a}=R_.get(e.id)||{};if(wN&&a===ur.RELAY)return void n();let l=a&&r>=Yu.length-1;if(wN)a=ur.RELAY;else{if(l)return void n();a?(r++,a=Yu[r]):(a=Yu[0],r=0)}b.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(a,", index: ").concat(r)),t(a),R_.set(e.id,{index:r,type:a}),i=window.setTimeout(()=>v3(e,t,n),$Y),Db.set(e.id,i)}var It;function T3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function il(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?T3(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function R3(e){var t,n,i,r=2;for(typeof Symbol<"u"&&(n=BO,i=Symbol.iterator);r--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new kb(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function kb(e){function t(n){if(Object(n)!==n)return Ne.reject(new TypeError(n+" is not an object."));var i=n.done;return Ne.resolve(n.value).then(function(r){return{value:r,done:i}})}return kb=function(n){this.s=n,this.n=n.next},kb.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Ne.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Ne.reject(n):t(i.apply(this.s,arguments))}},new kb(e)}let cS=(It=class extends Wn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Xe.StateChange,t,this._state)}constructor(e,t){super(),P(this,"isPlanB",void 0),P(this,"store",void 0),P(this,"statsUploader",void 0),P(this,"connection",void 0),P(this,"localTrackMap",new Map),P(this,"remoteUserMap",new Map),P(this,"localDataChannels",[]),P(this,"remoteDataChannelMap",new Map),P(this,"pendingLocalTracks",[]),P(this,"pendingRemoteTracks",[]),P(this,"pendingLocalDataChannels",[]),P(this,"pendingRemoteDataChannels",[]),P(this,"statsCollector",void 0),P(this,"shouldForwardP2PCreation",void 0),P(this,"iceFailedCount",0),P(this,"dtlsFailedCount",0),P(this,"mutex",void 0),P(this,"_state",$t.Disconnected),P(this,"_pcStatsUploadType",U("NEW_ICE_RESTART")?cd.FIRST_CONNECTION:cd.OLD_FIRST_CONNECTION),P(this,"_isStartRestartIce",!1),P(this,"_restartTimer",void 0),P(this,"_isTryConnecting",!1),P(this,"_iceError",null),P(this,"_forceTurn",!1),P(this,"_isWaitPcToRePub",!1),P(this,"handleMuteLocalTrack",async(n,i,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==$t.Connected)return void r(new re(x.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const l=this.filterTobeMutedTracks(n);if(l.length===0)return void i();const u=l.find(f=>f[0]==="videoLowTrack");if(u){const f=u[1];this.store.enableInstantMuteRestore?(f.track._originMediaStreamTrack.enabled=!1,b.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):f.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?b.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(l.map(f=>{let[,{id:E}]=f;return E}));const h=this.createMuteMessage(l);await gn(this,Xe.RequestMuteLocal,h),i()}catch(l){r(l)}finally{a()}}),P(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==$t.Connected)return void r(new re(x.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const l=this.filterTobeUnmutedTracks(n);if(l.length===0)return void i();const u=l.find(f=>f[0]==="videoLowTrack");if(u){const f=u[1];if(this.store.enableInstantMuteRestore)f.track._originMediaStreamTrack.enabled=!0,b.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(f.track._originMediaStreamTrack.stop(),!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bt().supportDualStreamEncoding){const E=n._mediaStreamTrack.clone();f.track._mediaStreamTrack=E,f.track._originMediaStreamTrack=E}else{const E=CN(n,By(this,Xe.RequestLowStreamParameter));f.track._mediaStreamTrack=E,f.track._originMediaStreamTrack=E}await new Ne((E,y)=>{this.handleReplaceTrack(f.track,E,y,!0)})}}this.store.enableInstantMuteRestore?b.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(l.map(f=>{let[,{id:E}]=f;return E}));const h=this.createUnmuteMessage(l);await gn(this,Xe.RequestUnmuteLocal,h),i()}catch(l){r(l)}finally{a()}}),P(this,"handleUpdateVideoEncoder",async(n,i,r,a)=>{let l;a||(l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const h=this.localTrackMap.get(me.LocalVideoTrack);if(!this.connection||!h||h.track!==n||this.state!==$t.Connected)return void i();const{id:f,track:E}=h;await this.connection.updateSendParameters(f,E),await this.connection.updateEncoderConfig(f,E),this.emit(Xe.UpdateVideoEncoder,E),i()}catch(h){r(h)}finally{var u;(u=l)===null||u===void 0||u()}}),P(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const l=this.localTrackMap.get(me.LocalVideoTrack);if(!this.connection||!l||l.track!==n||this.state!==$t.Connected)return void i();const{id:u,track:h}=l;await this.connection.updateSendParameters(u,h),i()}catch(l){r(l)}finally{a()}}),P(this,"handleReplaceMixingTrack",async(n,i,r,a)=>{if(!this.connection||this.state!==$t.Connected)return void i();const l=RN([n]);let u;b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(l.getTrackId(),"]")),typeof a=="boolean"&&a||(u=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,l),i()}catch(f){r(f)}finally{var h;(h=u)===null||h===void 0||h()}}),P(this,"handleReplaceTrack",async(n,i,r,a)=>{let l;b.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof a=="boolean"&&a||(l=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var u;const f=Array.from(this.localTrackMap.entries()).find(E=>{let[,{track:y}]=E;return n===y});if(!this.connection||!f||this.state!==$t.Connected)return void i();if(await((u=this.connection)===null||u===void 0?void 0:u.replaceTrack(n,f[1].id)),this.isPlanB){const E=f[1];E.id=n._mediaStreamTrack.id,this.localTrackMap.set(f[0],E)}if(f[0]===me.LocalVideoTrack&&!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bt().supportDualStreamEncoding){const E=this.localTrackMap.get(me.LocalVideoLowTrack);if(E){const y=n._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=y,E.track._originMediaStreamTrack=y,await new Ne((S,T)=>{this.handleReplaceTrack(E.track,S,T,!0)})}}i()}catch(f){r(f)}finally{var h;(h=l)===null||h===void 0||h()}}),P(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),P(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),P(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),P(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),P(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new y3(this.store),this.bindStatsUploaderEvents(),this.mutex=new cr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Bt().supportUnifiedPlan||U("CHROME_FORCE_PLAN_B")&&rd(),this.shouldForwardP2PCreation=U("FORWARD_P2P_CREATION")&&Bt().supportPCSetConfiguration&&tI(),this.shouldForwardP2PCreation&&(this.connection=Ob(this.store),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=$t.New,this._forceTurn=f3(e),b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||i||t)&&((i||t)&&this.connection&&(b.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=Ob(this.store,e),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new re(x.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=U("NEW_ICE_RESTART")?cd.FIRST_CONNECTION:cd.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new re(x.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===$t.Connected){if(this.connection instanceof Ca&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),He.reportApiInvoke(this.store.sessionId,{name:si.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:Vn.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Xe.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=$t.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(r=>{var a;let[l]=r;return Re(a=[me.LocalVideoLowTrack,me.LocalVideoTrack]).call(a,l)}),n=t.map(r=>{let[,{id:a}]=r;return a}),i=t.map(r=>{let[a]=r;return a});if(this.connection instanceof Ca){if(He.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Re(e).call(e,this.store.codec)){const r=["vp9","vp8","h264"].find(a=>Re(e).call(e,a));r&&(this.store.codec=r,b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(r,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof Ca&&this.connection.peerConnectionState!=="closed"&&Re(e=[$t.New,$t.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==$t.Connected){if(this.state===$t.Disconnected)throw new re(x.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var i;Re(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var i=this;return ya(function*(){const r=yield Ft(i.mutex.lock("From P2PChannel.publish"));try{var a;const l=i.connection&&Re(a=["disconnected","failed"]).call(a,i.connection.peerConnectionState);if(!i.connection||i.state!==$t.Connected||l){if(i.state===$t.Disconnected)throw new re(x.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);const h=e.filter(f=>i.pendingLocalTracks.indexOf(f)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(h),void(l&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,hr.markPublishStart(i.store.clientId,i.store.pubId);const u=i.filterTobePublishedTracks(e,t,n);if(u.length===0)return void(yield Ft(i.tryToUnmuteAudio(e)));yield*bR(R3(i.doPublish(i.connection,u)))}finally{r()}})()}doPublish(e,t){var n=this;return ya(function*(){t.forEach(S=>{let{track:T,type:k}=S;const O=Date.now();n.store.publish(T.getTrackId(),k===me.LocalAudioTrack?"audio":"video",O)}),n.bindLocalTrackEvents(t);const i=t.map(S=>{let{track:T}=S;return T}),r=yield Ft(e.send(i,n.store.codec,n.store.audioCodec)),a=(yield Ft(r.next())).value,l=n.createGatewayPublishMessage(t,a);let u;try{u=yield l}catch(S){throw r.throw(S),(S==null?void 0:S.code)===x.WS_ABORT&&t.forEach(T=>{let{track:k}=T;n.pendingLocalTracks.indexOf(k)===-1&&n.pendingLocalTracks.push(k)}),n.unbindLocalTrackEvents(t),S}const h=n.mapPubResToRemoteConfig(l,u,i),f=(yield Ft(r.next(h))).value;if(n.state===$t.Disconnected)throw new re(x.UNEXPECTED_ERROR,"PeerConnection already disconnected.");U("ENABLE_VIDEO_SEI");const E=U("ENABLE_ENCODED_TRANSFORM"),y=U("ENABLE_AUDIO_METADATA");i.forEach(async S=>{const T=S.getRTCRtpTransceiver();if(!T||!E)return;const{interceptLocalVideoFrame:k,interceptLocalAudioFrame:O}=yb();S.trackMediaType===xe.VIDEO?await k(T.sender,S):S.trackMediaType===xe.AUDIO&&await O(T.sender,{metadata:y?()=>{const I=S.metadata.shift();return I&&I.value}:void 0})}),t.forEach(S=>{let{type:T}=S;n.statsCollector.addLocalStats(T)}),n.assignLocalTracks(t,f),n.statsUploader.startUploadOutboundStats(),t.forEach(S=>{let{track:T,type:k}=S;const O=Date.now();n.store.publish(T.getTrackId(),k===me.LocalAudioTrack?"audio":"video",void 0,O)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof In))return b.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,r=function(a,l){const u={};return a.height&&a.width&&(u.scaleResolutionDownBy=sN(a,l)),u.maxFramerate=a.framerate?Ps(a.framerate):void 0,u.maxBitrate=a.bitrate?1e3*a.bitrate:void 0,u}(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==me.LocalVideoLowTrack||!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bt().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const a=i._originMediaStreamTrack;if(!a.canvas)return b.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(l,u){const h=l.canvas;u.width&&(h.width=Ps(u.width)),u.height&&(h.height=Ps(u.height)),u.framerate&&(h.stopCapture&&h.stopCapture(),h.stopCapture=NI(()=>{!h.startCapture&&h.stopCapture&&h.stopCapture(),h.startCapture&&h.startCapture()},Ps(u.framerate)))})(a,e)}r.maxBitrate!=null&&(i._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=r.maxFramerate:i._encoderConfig.frameRate={max:r.maxFramerate}),b.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return ya(function*(){if(!t.connection||t.state!==$t.Connected)return;const n=yield Ft(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=t.localTrackMap.get(me.LocalVideoTrack);if(!r)throw new re(x.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(me.LocalVideoLowTrack))throw new re(x.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const a=[{track:t.getLowVideoTrack(r.track,e),type:me.LocalVideoLowTrack}];if(yield*bR(R3(t.doPublish(t.connection,a))),r.track.muted||!r.track.enabled){var i;const l=(i=t.localTrackMap.get(me.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;l!==void 0&&(yield Ft(t.connection.muteLocal([l])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(b.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await nr(this,Xe.RequestRePublish,this.pendingLocalTracks),this.emit(Xe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(b.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await nr(this,Xe.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:i}=this.pendingRemoteTracks[t];(i!==xe.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==xe.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await nr(this,Xe.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===xe.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Xe.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==$t.Connected)return void e.forEach(i=>{const r=this.pendingLocalTracks.indexOf(i);r!==-1&&this.pendingLocalTracks.splice(r,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==$t.Connected)return void e.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==$t.Connected)return;const e=this.localTrackMap.get(me.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[me.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(i=>{let[,{id:r}]=i;return r})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[r,{track:a}]=i;return{type:r,track:a}})),t.forEach(i=>{let[r]=i;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==$t.Connected)throw new re(x.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(i=>{var r;return!((r=this.remoteDataChannelMap.get(e))!==null&&r!==void 0&&r.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(i=>{var r;this.remoteDataChannelMap.has(e)?(r=this.remoteDataChannelMap.get(e))===null||r===void 0||r.set(i.id,i):this.remoteDataChannelMap.set(e,new Map([[i.id,i]]));const a=this.pendingRemoteDataChannels.findIndex(l=>{let{user:u,id:h}=l;return u.uid===e.uid&&h===i.id});a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),n.map(i=>i.id)}async subscribe(e,t,n,i,r){var a;if(!this.connection||this.state!==$t.Connected)throw new re(x.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;let l,u,h,f;const E=this.connection.getPreMedia(n);if(E)b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),h=E.transceiver,l=E.track,u=E.mid,f=E.player,E.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:E.firstVideoRender});else if(r){const T=r.find(O=>{let{stream_type:I}=O;return I===t});if(!T)throw new re(x.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const k=await this.connection.receive(t,T.ssrcs,String(e._uintid),T.attributes);this.connection instanceof Ca&&(h=k.transceiver),l=k.track,u=k.id}else{const T=await this.connection.receive(t,[{ssrcId:n,rtx:i}],String(e._uintid),void 0);this.connection instanceof Ca&&(h=T.transceiver),l=T.track,u=T.id}if(t===xe.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new d_(l,e.uid,e._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new l_(l,e.uid,e._uintid,this.store,f),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Ta.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(Ta.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),f?e._videoTrack.once(Ta.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(Ta.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack)),h&&U("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:T,interceptRemoteAudioFrame:k}=yb();t==xe.VIDEO?await T(h.receiver,{onSei:U("ENABLE_VIDEO_SEI")&&(O=>{var I;return(I=e._videoTrack)===null||I===void 0?void 0:I._onSei(O)})}):t==xe.AUDIO&&await k(h.receiver,{enableTopn:!!U("ENABLE_AUDIO_TOPN"),enableMetadata:!!U("ENABLE_AUDIO_METADATA"),enablePts:!!U("ENABLE_AUDIO_PTS"),onMetadata:O=>{this.safeEmit(Xe.AudioMetadata,O)},onPts:O=>{this.safeEmit(Xe.AudioPts,O)}})}const y=this.remoteUserMap.get(e);y?y.set(t,u):this.remoteUserMap.set(e,new Map([[t,u]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const S=this.pendingRemoteTracks.findIndex(T=>{let{user:k,kind:O}=T;return k.uid===e.uid&&t===O});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(Xe.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==$t.Connected)throw new re(x.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(r=>{var a;let{user:l,mediaType:u}=r;return!((a=this.remoteUserMap.get(l))!==null&&a!==void 0&&a.has(u))});const t=[],n=new Map;e.forEach(r=>{if(!this.connection)return;const a=this.connection.getPreMedia(r.ssrcId);if(a){const{track:l,mid:u,transceiver:h,player:f}=a;n.set(r.ssrcId,{track:l,id:u,transceiver:h,player:f})}else t.push(r)});const i=await this.connection.batchReceive(t.map(r=>{let{user:a,mediaType:l,ssrcId:u,rtxSsrcId:h}=r;return{kind:l,ssrcMsg:[{ssrcId:u,rtx:h}],mslabel:String(a._uintid)}}));t.forEach((r,a)=>{n.set(r.ssrcId,i[a])});for(const{user:r,mediaType:a,ssrcId:l}of e){const u=n.get(l);if(!u)return void b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(r.uid," subscribe data,").concat(a,", ").concat(l));const{track:h,id:f,transceiver:E,player:y}=u;if(E&&U("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:O}=yb();a==xe.VIDEO?await k(E.receiver,{onSei:U("ENABLE_VIDEO_SEI")&&(I=>{var M;return(M=r._videoTrack)===null||M===void 0?void 0:M._onSei(I)})}):a==xe.AUDIO&&await O(E.receiver,{enableTopn:!!U("ENABLE_AUDIO_TOPN"),enableMetadata:!!U("ENABLE_AUDIO_METADATA"),enablePts:!!U("ENABLE_AUDIO_PTS"),onMetadata:I=>{this.safeEmit(Xe.AudioMetadata,I)},onPts:I=>{this.safeEmit(Xe.AudioPts,I)}})}if(a===xe.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(h):(r._audioTrack=new d_(h,r.uid,r._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),E&&r._audioTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(h):(r._videoTrack=new l_(h,r.uid,r._uintid,this.store,y),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),E&&r._videoTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(r,r._videoTrack)),U("ENABLE_VIDEO_SEI")&&E){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:O}=yb();a==xe.VIDEO?await k(E.receiver,{onSei:I=>{var M;(M=r._videoTrack)===null||M===void 0||M._onSei(I)}}):a==xe.AUDIO&&await O(E.receiver)}const S=this.remoteUserMap.get(r);S?S.set(a,f):this.remoteUserMap.set(r,new Map([[a,f]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();const T=this.pendingRemoteTracks.findIndex(k=>{let{user:O,kind:I}=k;return O.uid===r.uid&&a===I});T!==-1&&(this.pendingRemoteTracks.splice(T,1),this.emit(Xe.MediaReconnectEnd,r.uid))}}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return t!==void 0?u.uid===e.uid&&t===h:u.uid===e.uid});if(i.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),this.connection&&this.state===$t.Connected||n||i.forEach(l=>{let{kind:u}=l;var h;if(u===xe.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(u===xe.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==$t.Connected)return;const r=this.filterTobeUnSubscribedTracks(e,t);if(r.length===0)return;await this.connection.stopReceiving(r.map(l=>{let[,{id:u}]=l;return u}));const a=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(l=>{let[u,{kind:h}]=l;var f,E;if(h===xe.VIDEO&&u._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===xe.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),n||((E=u._videoTrack)===null||E===void 0||E._destroy(),u._videoTrack=void 0);else if(h===xe.AUDIO){var y;this.unbindRemoteTrackEvents(u._audioTrack),!n&&((y=u._audioTrack)===null||y===void 0||y._destroy(),u._audioTrack=void 0)}}),a}async unsubscribeDataChannel(e,t){if(t.forEach(r=>{const a=this.pendingRemoteDataChannels.findIndex(l=>l.id===r.id);a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(r=>{r._close()});const i=this.remoteDataChannelMap.get(e);return n.forEach(r=>{i&&i.delete(r.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(r=>r.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:r,mediaType:a}of e){const l=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:f}=u;return a!==void 0?h.uid===r.uid&&a===f:h.uid===r.uid});l.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),t=t.concat(l)}if(!this.connection||this.state!==$t.Connected)return void t.forEach(r=>{let{user:a,kind:l}=r;var u;if(l===xe.AUDIO)(u=a._audioTrack)===null||u===void 0||u._destroy(),a._audioTrack=void 0;else if(l===xe.VIDEO){var h;(h=a._videoTrack)===null||h===void 0||h._destroy(),a._videoTrack=void 0}});const n=gr(e).call(e,(r,a)=>{let{user:l,mediaType:u}=a;const h=this.filterTobeUnSubscribedTracks(l,u);return r.concat(h)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(r=>{let[,{id:a}]=r;return a}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(r=>{let[a,{kind:l}]=r;var u,h;if(l===xe.VIDEO&&a._videoSSRC&&((u=this.connection)===null||u===void 0||u.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),l===xe.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),(h=a._videoTrack)===null||h===void 0||h._destroy(),a._videoTrack=void 0;else if(l===xe.AUDIO){var f;this.unbindRemoteTrackEvents(a._audioTrack),(f=a._audioTrack)===null||f===void 0||f._destroy(),a._audioTrack=void 0}}),i}isPreSubScribe(e){return!this.connection||this.state!==$t.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void b.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===xe.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||b.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(me.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(me.LocalAudioTrack);if((t==null?void 0:t.track)instanceof vi){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==me.LocalAudioTrack}).filter(i=>{let[r]=i;return!(e&&r===me.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===me.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,i,r){if(e){const l=this.localTrackMap.get(me.LocalAudioTrack),u=i?this.localTrackMap.get(me.LocalVideoLowTrack):this.localTrackMap.get(me.LocalVideoTrack);He.publish(this.store.sessionId,{eventElapse:hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.track.getTrackLabel(),videoName:u==null?void 0:u.track.getTrackLabel(),screenshare:(u==null?void 0:u.track._hints.indexOf(hn.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var a;n||(n=[]);const l=n.find(h=>h instanceof ni),u=i?(a=this.localTrackMap.get(me.LocalVideoTrack))===null||a===void 0?void 0:a.track:n.find(h=>h instanceof In);He.publish(this.store.sessionId,{eventElapse:hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.getTrackLabel(),videoName:u==null?void 0:u.getTrackLabel(),screenshare:(u==null?void 0:u._hints.indexOf(hn.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(e,t,n,i){const r=i===xe.VIDEO?n._videoSSRC:n._audioSSRC;r&&He.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===xe.VIDEO,audio:i===xe.AUDIO,peerid:n.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:hr.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){b.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new cr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=Ob(this.store),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(me.LocalAudioTrack);if((e==null?void 0:e.track)instanceof vi){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=$t.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(me.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(me.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof In||t&&t.track instanceof ni?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(cs(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(me.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=gp(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.connection&&(b.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=$t.Reconnecting,U("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=Ob(this.store),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case me.LocalVideoTrack:Re(t=i._hints).call(t,hn.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case me.LocalAudioTrack:i instanceof vi?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case me.LocalVideoLowTrack:}}),this.emit(Xe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(cs(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Xe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(cs(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(t,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),b.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:i,id:r}=n;if((e instanceof Wu?e.uid:e)===i.uid&&r===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((e instanceof Wu?e.uid:e)===i.uid&&t===r)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return ya(function*(){if(!t.connection||t.state!==$t.Connected)return;const n=yield Ft(t.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield Ft(t.connection.restartICE(e));const a=yield Ft(i.next());if(a.done)return;const l=a.value,u=yield l;switch(bN(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case ur.UDP_TCP_RELAY:t._pcStatsUploadType=cd.UDP_TCP_RESTART;break;case ur.TCP_RELAY:t._pcStatsUploadType=cd.TCP_RESTART;break;case ur.RELAY:t._pcStatsUploadType=cd.RELAY_RESTART;break;default:t._pcStatsUploadType=cd.OLD_RESTART}t._isTryConnecting=!0,i.next(u)}catch(a){var r;(r=i)===null||r===void 0||r.throw(a)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(me.LocalVideoTrack),n=this.localTrackMap.get(me.LocalAudioTrack),i=e.videoSend.find(T=>T.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),r=e.audioSend.find(T=>T.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!r)return 1;const a=Js(this,Xe.NeedSignalRTT),l=i?i.rttMs:void 0,u=r?r.rttMs:void 0,h=l&&u?(l+u)/2:l||u,f=(h&&a?(h+a)/2:h||a)||0,E=100*e.sendPacketLossRate*.7/50+.3*f/1500,y=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,S=t==null?void 0:t.track;if(S&&S._encoderConfig&&S._hints.indexOf(hn.SCREEN_TRACK)===-1){const T=S._encoderConfig.bitrateMax,k=e.bitrate.actualEncoded;if(T&&k){const O=(1e3*T-k)/(1e3*T);return lV[O<.15?0:O<.3?1:O<.45?2:O<.6?3:4][y]}}return y}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,a=i._videoSSRC,l=e.audioRecv.find(k=>k.ssrc===r),u=e.videoRecv.find(k=>k.ssrc===a);if(!l&&!u)return void(t+=1);const h=Js(this,Xe.NeedSignalRTT),f=e.rtt,E=(f&&h?(f+h)/2:f||h)||0,y=l?l.jitterMs:void 0,S=e.recvPacketLossRate;let T=.7*S*100/50+.3*E/1500;y&&(T=.6*S*100/50+.2*E/1500+.2*y/400),t+=T<.1?1:T<.17?2:T<.36?3:T<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ne((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(b.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==$t.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(!i)return;const r=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:r}]),this.bindLocalTrackEvents([{track:t,type:r}]),i[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,i[1].id)),this.isPlanB){const a=i[1];a.id=t._mediaStreamTrack.id,this.localTrackMap.set(r,a)}if(r===me.LocalVideoTrack&&!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bt().supportDualStreamEncoding){const a=this.localTrackMap.get(me.LocalVideoLowTrack);if(a){const l=e._mediaStreamTrack.clone();a.track._originMediaStreamTrack.stop(),a.track._mediaStreamTrack=l,a.track._originMediaStreamTrack=l,await new Ne((u,h)=>{this.handleReplaceTrack(a.track,u,h,!0)})}}}filterTobePublishedTracks(e,t,n){const i=[],r=this.getAllTracks();e=Jm(e=e.filter(h=>r.indexOf(h)===-1));let a,l=!1;const u=this.localTrackMap.get(me.LocalAudioTrack);for(const h of e){if(h instanceof In&&(this.localTrackMap.has(me.LocalVideoTrack)||l?new re(x.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:h,type:me.LocalVideoTrack}),l=!0),t)){const f=this.getLowVideoTrack(h,n);i.push({track:f,type:me.LocalVideoLowTrack})}if(h instanceof ni)if(u){const f=u.track;if(f instanceof vi)TN([h]),f.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0);else{const E=RN([f,h]);b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(E.getTrackId(),"]")),this.replaceTrack(f,E)}}else a instanceof vi?(TN([h]),a.addAudioTrack(h)):a||!h._useAudioElement&&Bt().webAudioMediaStreamDest&&!h._bypassWebAudio?a=RN(a?[h,a]:[h]):a=h}return a&&(b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(a.getTrackId(),"]")),i.push({track:a,type:me.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Jm(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof ni){const r=this.localTrackMap.get(me.LocalAudioTrack);if(!r)continue;r.track instanceof vi?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(t.push([me.LocalAudioTrack,r]),r.track.close())):t.push([me.LocalAudioTrack,r])}if(i instanceof In){const r=this.localTrackMap.get(me.LocalVideoTrack);if(!r)continue;t.push([me.LocalVideoTrack,r]);const a=this.localTrackMap.get(me.LocalVideoLowTrack);a&&t.push([me.LocalVideoLowTrack,a])}}return t}filterTobePublishedDataChannels(e){return e=(e=Jm(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Jm(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case me.LocalVideoTrack:n.addListener(je.GET_STATS,this.handleGetLocalVideoStats),n.addListener(je.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(je.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case me.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case me.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof vi?e.trackList.forEach(n=>{n.addListener(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(je.GET_STATS,this.handleGetLocalAudioStats),n.addListener(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(je.GET_STATS,this.handleGetLocalAudioStats),e.addListener(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(je.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(je.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case me.LocalVideoTrack:n.off(je.GET_STATS,this.handleGetLocalVideoStats),n.off(je.GET_RTC_STATS,this.handleGetRTCStats),n.off(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(je.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case me.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case me.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof vi?e.trackList.forEach(t=>{t.off(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(je.GET_STATS,this.handleGetLocalAudioStats),t.off(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(je.GET_STATS,this.handleGetLocalAudioStats),e.off(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(je.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(je.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof l_&&t.addListener(je.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof d_&&t.addListener(je.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(je.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(xe.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(xe.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var r;let a,l,{track:u,type:h}=n;switch(h){case me.LocalAudioTrack:a=tn.Audio,l={dtx:u instanceof qy&&u._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case me.LocalVideoTrack:a=Re(r=u._hints).call(r,hn.SCREEN_TRACK)?tn.Screen:tn.High,l=il(il({},CV(u)),{},{codec:this.store.codec,svc_mode:fb()});break;case me.LocalVideoLowTrack:a=tn.Low,l=il(il({},CV(u)),{},{codec:this.store.codec,svc_mode:fb()})}return{stream_type:a,attributes:l,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[r,{track:a,ssrcs:l,id:u}]=t;switch(r){case me.LocalVideoTrack:i=Re(n=a._hints).call(n,hn.SCREEN_TRACK)?tn.Screen:tn.High;break;case me.LocalAudioTrack:i=tn.Audio;break;case me.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:l,mid:u}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:r,type:a}=n;this.localTrackMap.set(a,{track:r,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Xe.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Ca&&!qn()&&U("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},U("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Ca&&S3(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=cd.DISCONNECTED_OR_FAILED,Js(this,Xe.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(r=>r.getTrackId()),i=this.pendingLocalDataChannels.map(r=>"dc_".concat(r.id));He.reportApiInvoke(this.store.sessionId,{name:si.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:Vn.TRACER}).onSuccess(),this.republish()}if(U("NEW_ICE_RESTART")&&e instanceof Ca&&!qn()&&!this._forceTurn){if(Re(yV).call(yV,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=r=>{bN(e)&&(b.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(r)),Js(this,Xe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Xe.RequestRestartICE,r))},i=()=>{bN(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),b.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Xe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{v3(e,n,i)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&U("ICE_RESTART")&&Js(this,Xe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Xe.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Xe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Xe.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),He.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Vn.TRACER}).onSuccess(),this.emit(Xe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(cs(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(Ta.FIRST_FRAME_DECODED),He.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_DECODE,Mn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(cs(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===t);i&&He.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_RECEIVED,Mn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{var r;const a=Array.from(cs(r=this.remoteUserMap).call(r)).find(l=>l._videoSSRC===t);a&&this.store.firstVideoFrameDecoded(a.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoRender=t=>{var n;const i=Array.from(cs(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===t);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(i))},e.onFirstVideoReceived=t=>{var n;const i=Array.from(cs(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===t);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstReceived:Date.now()}),He.firstRemoteFrame(this.store.sessionId,Oi.FIRST_VIDEO_RECEIVED,Mn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(Xe.ConnectionTypeChange,i),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ju(n))," -> ").concat(JSON.stringify(ju(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ju(n))," -> ").concat(JSON.stringify(ju(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return il(il({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Ca&&function(t){R_.delete(t.id),S3(t)}(e),e.close(),this.emit(Xe.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(me.LocalAudioTrack);if(e instanceof ni&&(n==null?void 0:n.track)instanceof vi)return n.track.isActive||t.push([me.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return e===a});if(i&&(t.push(i),i[0]===me.LocalVideoTrack)){const r=this.localTrackMap.get(me.LocalVideoLowTrack);r&&t.push([me.LocalVideoLowTrack,r])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(me.LocalAudioTrack);if(e instanceof ni&&(n==null?void 0:n.track)instanceof vi)return n.track.isActive&&t.push([me.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return e===a});if(i)if(i[0]===me.LocalVideoTrack){t.push(i);const r=this.localTrackMap.get(me.LocalVideoLowTrack);r&&t.push([me.LocalVideoLowTrack,r])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[r,{track:a,ssrcs:l,id:u}]=t;switch(r){case me.LocalAudioTrack:i=tn.Audio;break;case me.LocalVideoTrack:i=Re(n=a._hints).call(n,hn.SCREEN_TRACK)?tn.Screen:tn.High;break;case me.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:l,mid:u}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[r,{track:a,ssrcs:l,id:u}]=t;switch(r){case me.LocalAudioTrack:i=tn.Audio;break;case me.LocalVideoTrack:i=Re(n=a._hints).call(n,hn.SCREEN_TRACK)?tn.Screen:tn.High;break;case me.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:l,mid:u}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const r=i.get(t);if(!r)return n;n.push([e,{kind:t,id:r}])}else Array.from(i.entries()).forEach(r=>{let[a,l]=r;n.push([e,{kind:a,id:l}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(i=>{var r;(r=this.remoteDataChannelMap.get(e))!==null&&r!==void 0&&r.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:r,id:a}]=n;switch(r){case xe.VIDEO:return void(i._videoSSRC&&t.push({stream_type:xe.VIDEO,ssrcId:i._videoSSRC}));case xe.AUDIO:return void(i._audioSSRC&&t.push({stream_type:xe.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[i,{kind:r}]=n;if(t.has(i)){let a=t.get(i);r===xe.VIDEO?a|=ki.Video:a|=ki.Audio,t.set(i,a)}else r===xe.VIDEO?t.set(i,ki.Video):t.set(i,ki.Audio)}),{users:Array.from(t.entries()).map(n=>{let[i,r]=n;return{stream_id:i.uid,stream_type:r}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(me.LocalVideoTrack),n=this.localTrackMap.get(me.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ne((i,r)=>{this.handleUpdateVideoEncoder(t.track,i,r,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ne((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof Ca&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof Ca&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,n){return e.map((i,r)=>{var a;let{stream_type:l}=i;const u=(a=t.find(h=>{let{stream_type:f}=h;return l===f}))===null||a===void 0?void 0:a.attributes;if(u&&U("DISABLE_SCREEN_SHARE_REMB")){const h=n[r]._hints;(Re(h).call(h,hn.SCREEN_TRACK)||Re(h).call(h,hn.SCREEN_LOW_TRACK))&&(u.remb=!1,b.debug("disable remb for screen share, hints:",h))}return u})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof ni){var t;const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map(a=>{let[,{id:l}]=a;return l})));const r=this.createUnmuteMessage(i);return void await gn(this,Xe.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Xe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Xe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await qi(lI(this.dtlsFailedCount,_i)),this.emit(Xe.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await nr(this,Xe.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Xe.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(me.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof In)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof In).length>1)throw new re(x.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof ni).length>1&&(e.some(t=>t instanceof ni&&t._bypassWebAudio)||!Bt().webAudioMediaStreamDest))throw new re(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof In&&this.pendingLocalTracks.some(n=>n instanceof In))throw new re(x.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof ni&&this.pendingLocalTracks.some(n=>n instanceof ni)&&(!Bt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof ni&&n._bypassWebAudio)))throw new re(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const i=!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bt().supportDualStreamEncoding,r=il(il({},{width:160,height:120,framerate:15,bitrate:50}),t);let a;a=i?e._mediaStreamTrack.clone():CN(e,r);const l=yn(8,"track-low-"),u=new In(a,il(il({},i&&{scaleResolutionDownBy:sN(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,l);return u.on(Dp.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,i_.LOW_STREAM)}),u._hints.push(hn.LOW_STREAM),Re(n=e._hints).call(n,hn.SCREEN_TRACK)&&u._hints.push(hn.SCREEN_LOW_TRACK),e.on("sei-to-send",h=>{u.emit("sei-to-send",h)}),e.addListener(je.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ca){var r,a,l,u;const h=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:f,dtlsTransportState:E,peerConnectionState:y}=this.connection,{local:S,remote:T}=await this.connection.getSelectedCandidatePair();He.pcStats(this.store.sessionId,{startTime:h,eventElapse:e-h||0,iceconnectionsate:f,dtlsstate:E,connectionstate:y,intSucc:t?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(r=S==null?void 0:S.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(a=S.candidateType)!==null&&a!==void 0?a:"",selectedLocalCandidateAddress:"".concat(S.address,":").concat(S.port),selectedRemoteCandidateProtocol:(l=T.protocol)!==null&&l!==void 0?l:"",selectedRemoteCandidateType:(u=T.candidateType)!==null&&u!==void 0?u:"",selectedRemoteCandidateAddress:"".concat(T.address,":").concat(T.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(E=>E.userId===e.uid);if(!n)return;const{isInternalUpload:i,isExternalUpload:r}=n;if(i&&r)return;const{subscribeEnd:a,firstPreRender:l,peerPublishDuration:u,peerPubStatusMs:h}=n;let{firstRender:f=0}=n;if(a&&(f||l)&&u&&h){n.isInternalUpload=!0;const{playEnd:E}=n;E&&(n.isExternalUpload=!0);const{firstPreRender:y=0}=n;f=y||f;const S=e.videoTrack,T={peer:e._uintid,width:(S==null?void 0:S._videoWidth)||0,height:(S==null?void 0:S._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:u,peerPubStatusMs:h,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:y||0,firstRender:E?Math.max(f,E):Math.max(f,a),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:XM(this.store)};He.firstXLAPeerFirstVideoFrame(this.store.sessionId,T)}}reportVideoFirstFrameDecoded(e,t,n,i){var r;const a=Array.from(cs(r=this.remoteUserMap).call(r)).find(l=>l._videoSSRC===e);if(a){i||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const l=this.store.keyMetrics,u=l.subscribe.find(h=>h.userId===a.uid&&h.type==="video");He.firstRemoteVideoDecode(this.store.sessionId,Oi.FIRST_VIDEO_DECODE,Mn.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:l.requestAPEnd||0,apStart:l.requestAPStart||0,joinGwEnd:l.joinGatewayEnd||0,joinGwStart:l.joinGatewayStart||0,pcEnd:l.peerConnectionEnd||0,pcStart:l.peerConnectionStart||0,subscriberEnd:(u==null?void 0:u.subscribeEnd)||0,subscriberStart:(u==null?void 0:u.subscribeStart)||0,videoAddNotify:(u==null?void 0:u.streamAdded)||0,state:i?1:0,firstFrame:(u==null?void 0:u.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const r=i.get(t);if(!r)return!1;const a=await this.connection.getRemoteSSRC(r);return a!==void 0&&a!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===me.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,i_.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Be(It.prototype,"startP2PConnection",[kr],Object.getOwnPropertyDescriptor(It.prototype,"startP2PConnection"),It.prototype),Be(It.prototype,"connect",[kr],Object.getOwnPropertyDescriptor(It.prototype,"connect"),It.prototype),Be(It.prototype,"updateRemoteRTPCapabilities",[kr],Object.getOwnPropertyDescriptor(It.prototype,"updateRemoteRTPCapabilities"),It.prototype),Be(It.prototype,"publishDataChannel",[kr],Object.getOwnPropertyDescriptor(It.prototype,"publishDataChannel"),It.prototype),Be(It.prototype,"unpublish",[kr],Object.getOwnPropertyDescriptor(It.prototype,"unpublish"),It.prototype),Be(It.prototype,"unpublishDataChannel",[kr],Object.getOwnPropertyDescriptor(It.prototype,"unpublishDataChannel"),It.prototype),Be(It.prototype,"unpublishLowStream",[kr],Object.getOwnPropertyDescriptor(It.prototype,"unpublishLowStream"),It.prototype),Be(It.prototype,"subscribeDataChannel",[kr],Object.getOwnPropertyDescriptor(It.prototype,"subscribeDataChannel"),It.prototype),Be(It.prototype,"subscribe",[kr],Object.getOwnPropertyDescriptor(It.prototype,"subscribe"),It.prototype),Be(It.prototype,"massSubscribe",[kr],Object.getOwnPropertyDescriptor(It.prototype,"massSubscribe"),It.prototype),Be(It.prototype,"unsubscribe",[kr],Object.getOwnPropertyDescriptor(It.prototype,"unsubscribe"),It.prototype),Be(It.prototype,"unsubscribeDataChannel",[kr],Object.getOwnPropertyDescriptor(It.prototype,"unsubscribeDataChannel"),It.prototype),Be(It.prototype,"massUnsubscribe",[kr],Object.getOwnPropertyDescriptor(It.prototype,"massUnsubscribe"),It.prototype),Be(It.prototype,"muteRemote",[kr],Object.getOwnPropertyDescriptor(It.prototype,"muteRemote"),It.prototype),Be(It.prototype,"unmuteRemote",[kr],Object.getOwnPropertyDescriptor(It.prototype,"unmuteRemote"),It.prototype),Be(It.prototype,"hasRemoteMediaWithLock",[kr],Object.getOwnPropertyDescriptor(It.prototype,"hasRemoteMediaWithLock"),It.prototype),Be(It.prototype,"disconnectForReconnect",[kr],Object.getOwnPropertyDescriptor(It.prototype,"disconnectForReconnect"),It.prototype),Be(It.prototype,"updateBitrateLimit",[kr],Object.getOwnPropertyDescriptor(It.prototype,"updateBitrateLimit"),It.prototype),Be(It.prototype,"remoteMediaSsrcChanged",[kr],Object.getOwnPropertyDescriptor(It.prototype,"remoteMediaSsrcChanged"),It.prototype),It);function kr(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,a=await r.lock("From P2PChannel.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},n}function b3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function C3(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?b3(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const ez=Date.now(),tz=20,AN=new Map,Pb=new Map;async function w3(e){const t=AN.get(e),n=Array.isArray(t)&&t[t.length-1],i=Pb.get(e);if(!n)return void(i.isSyncing=!1);const r={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const a=n.sendTs-i.firstSendTs,l=a-(Date.now()-i.firstRecvTs);l>0&&(i.firstRecvTs=Date.now()-a);let u=n.mediaDelay+l;u<=0?(t.pop(),A3(n.context,r),u=0):u=Math.min(u,tz),setTimeout(()=>t.length&&w3(e),u)}function A3(e,t){e.safeEmit(kt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function nz(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return A3(n,{uid:e.uid,payload:e.payload});const i="".concat(n.id,"-").concat(e.uid),r=AN.get(i)||[],a=r.findIndex(f=>e.sendTs>=f.sendTs),l=C3(C3({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});a===-1?r.push(l):r.splice(a,0,l),AN.set(i,r);let u=!1;var h;Pb.has(i)?u=!((h=Pb.get(i))===null||h===void 0||!h.isSyncing):Pb.set(i,{isSyncing:u,firstRecvTs:0,firstSendTs:0}),u||w3(i)}const iz=xt().name;function O3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function I3(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?O3(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const b_="websdk_ng_cache_parameter",rz=U("MAX_PRELOAD_ASYNC_LENGTH"),sz=1e4,Bp=new Map,Gp=[];let ON=null,IN=0,NN=0;const Lb=new Map,az=function(e,t){const n=[];let i=0;const r=async()=>{const a=n.shift();a&&await a(),n.length>0&&i<t?r():i--};return async function(){for(var a=arguments.length,l=new Array(a),u=0;u<a;u++)l[u]=arguments[u];return new Ne(async(h,f)=>{n.push(async()=>{try{const E=await e(...l);h(E)}catch(E){f(E)}}),i<t&&(i++,r())})}}(N3,rz),DN=Zr.CancelToken.source();async function N3(e,t,n,i,r,a){try{if(!U("ENABLE_PRELOAD"))return;if(!Bt().supportWebCrypto)return void ku(()=>{b.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new re(x.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Ki(n,"token",1,2047),Ki(e,"appid",1,2047),cb(t),i&&lb(i);const l=Ip();b.debug("preload channel ".concat(t,", uid is ").concat(i));const u={appId:e,cname:t,token:n||e,uid:typeof i!="string"?i:null,sid:l,proxyServer:r};let h,f;typeof i=="string"?(u.stringUid=i,[f,h]=await Ne.all([HY(i,{sid:l,appId:e},DN.token),n3(I3(I3({},u),{},{token:n||e,uid:0}),DN.token)]),u.uid=f.uid,h.gatewayInfo.uid=u.uid,h.gatewayInfo.res.uid=u.uid):(a&&(u.stringUid=a),h=await n3(u,DN.token));const E={sid:l,appId:e,cname:t,token:n||e,uid:u.stringUid||i,intUid:u.uid||h.gatewayInfo.uid,stringUid:u.stringUid,ts:Date.now(),sua:f,ap:h};await async function(y){let S;try{y.uid&&k3({appId:y.appId,cname:y.cname,token:y.token,uid:y.uid,stringUid:y.stringUid});const T=x3(y),k=await async function(I,M){try{const L=await window.crypto.subtle.importKey("raw",TM(M),"AES-GCM",!1,["encrypt"]),j=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},L,Op(window.btoa(JSON.stringify(I))));return Pu(new Uint8Array(j))}catch{return}}(y,y.token||y.appId);if(!k)return;S=M3(b_);const O=S?JSON.parse(S):[];O.push({[T]:k}),O.length>U("AP_CACHE_NUM")&&O.shift(),Mb(b_,JSON.stringify(O))}catch(T){b.warn("Error caching server parameters:",T.message),Mb(b_,"")}}(E),IN++}catch(l){throw NN++,function(u){ON||(ON=window.setTimeout(()=>{let f="";Lb.forEach((E,y)=>{f+="".concat(y,": ").concat(E," ;")}),He.reportApiInvoke(null,{name:si.PRELOAD,options:{success:IN,failed:NN,err:f}}).onError(u),IN=0,NN=0,Lb.clear(),ON=null},sz));const h=Lb.get(u.code)||0;Lb.set(u.code,h+1)}(l),l}}async function D3(e){try{if(U("AP_REQUEST_DETAIL")||U("ENABLE_ROLE_SELECT_EDGE"))return;const t=k3(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(i,r){try{const a=await window.crypto.subtle.importKey("raw",TM(r),"AES-GCM",!1,["decrypt"]),l=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},a,Op(i));return JSON.parse(window.atob(Pu(new Uint8Array(l))))}catch{return}}(t,e.token||e.appId);if(!n||!function(i,r){return i.cname===r.cname&&i.appId===r.appId&&i.token===r.token?r.stringUid?i.stringUid===r.stringUid:typeof r.uid=="number"?i.uid===r.uid:i.uid==r.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<U("AP_CACHE_LIFETIME"))return n}catch(t){b.warn("Error get preloadInfo",t.message)}}function k3(e){let t;try{if(t=M3(b_),!t)return;const n=JSON.parse(t),i=x3(e),r=function(l,u){for(let h=l.length-1;h>=0;h--)if(u(l[h]))return h;return-1}(n,l=>i in l);if(r===-1)return;const a=n.splice(r,1)[0];return Mb(b_,JSON.stringify(n)),a[i]}catch(n){b.warn("Error delete preload info: ".concat(t),n.message),Mb(b_,"")}}function kN(e){if(e){let t=Bp.get(e);t&&(window.clearTimeout(t),t=null,Bp.delete(e)),Re(Gp).call(Gp,e)||e.cloudProxyServer!=="disabled"||Gp.push(e)}if(Bp.size<U("AP_CACHE_NUM")&&Gp.length>0){const t=Gp.shift();Bp.set(t,window.setTimeout(async()=>{const{appId:n,cname:i,token:r,stringUid:a,uid:l,proxyServer:u}=t;try{await az(n,i,r,l,u,a),Bp.has(t)&&kN(t)}catch(h){b.warn("update preload failed",h.message),P3(t)}},U("AP_UPDATE_INTERVAL")))}}function P3(e){const t=Gp.indexOf(e);t!==-1&&Gp.splice(t,1);let n=Bp.get(e);n&&(window.clearTimeout(n),n=null,Bp.delete(e),kN())}function L3(e,t){const n=e.sua,i=e.ap;t&&n&&He.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),He.reportResourceTiming(e.ap.url,e.sid),He.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(r=>r.ip).join(","),eventType:"disabled",unilbsServerIds:[pi.CHOOSE_SERVER,pi.CLOUD_PROXY_FALLBACK].toString()}),He.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(r=>r.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[pi.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function M3(e){return window.atob(window.localStorage.getItem(e)||"")}function Mb(e,t){window.localStorage.setItem(e,window.btoa(t))}function x3(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),IM(t)}function oz(e){let t=function(){const n=dz.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let r=n.appId;r!==void 0&&(fi(i,10),zu(i,r));let a=n.cid;a!==void 0&&(fi(i,16),fi(i,a));let l=n.cname;l!==void 0&&(fi(i,26),zu(i,l));let u=n.deviceId;u!==void 0&&(fi(i,34),zu(i,u));let h=n.elapse;h!==void 0&&(fi(i,40),Ku(i,h));let f=n.fileSize;f!==void 0&&(fi(i,48),Ku(i,C_(f)));let E=n.height;E!==void 0&&(fi(i,56),Ku(i,C_(E)));let y=n.jpg;y!==void 0&&(fi(i,66),fi(i,y.length),V3(i,y));let S=n.networkType;S!==void 0&&(fi(i,72),Ku(i,C_(S)));let T=n.osType;T!==void 0&&(fi(i,80),Ku(i,C_(T)));let k=n.requestId;k!==void 0&&(fi(i,90),zu(i,k));let O=n.sdkVersion;O!==void 0&&(fi(i,98),zu(i,O));let I=n.sequence;I!==void 0&&(fi(i,104),Ku(i,C_(I)));let M=n.sid;M!==void 0&&(fi(i,114),zu(i,M));let L=n.timestamp;L!==void 0&&(fi(i,120),Ku(i,L));let j=n.uid;j!==void 0&&(fi(i,128),fi(i,j));let K=n.vid;K!==void 0&&(fi(i,136),fi(i,K));let z=n.width;z!==void 0&&(fi(i,144),Ku(i,C_(z)));let H=n.service;H!==void 0&&(fi(i,152),fi(i,H));let Z=n.callbackData;Z!==void 0&&(fi(i,162),fi(i,Z.length),V3(i,Z));let se=n.ticket;se!==void 0&&(fi(i,170),zu(i,se));let ue=n.vendorConfigs;ue!==void 0&&(fi(i,178),zu(i,ue))}(e,t),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(t)}function cz(e){return function(n){let i={};e:for(;!uz(n);){let r=lS(n);switch(r>>>3){case 0:break e;case 1:i.code=lS(n);break;case 2:i.msg=j3(n,lS(n));break;case 3:i.requestId=j3(n,lS(n));break;case 4:i.timestamp=hz(n,!1);break;default:lz(n,7&r)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function lz(e,t){switch(t){case 0:for(;128&co(e););break;case 2:PN(e,lS(e));break;case 5:PN(e,4);break;case 1:PN(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function C_(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let dz=[];function PN(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function uz(e){return e.offset>=e.limit}function xb(e,t){let n=e.bytes,i=e.offset,r=e.limit,a=i+t;if(a>n.length){let l=new Uint8Array(2*a);l.set(n),e.bytes=l}return e.offset=a,a>r&&(e.limit=a),i}function U3(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function V3(e,t){let n=xb(e,t.length);e.bytes.set(t,n)}function j3(e,t){let n=U3(e,t),i=String.fromCharCode,r=e.bytes,a="",l="";for(let u=0;u<t;u++){let h,f,E,y,S=r[u+n];(128&S)==0?l+=i(S):(224&S)==192?u+1>=t?l+=a:(h=r[u+n+1],(192&h)!=128?l+=a:(y=(31&S)<<6|63&h,y<128?l+=a:(l+=i(y),u++))):(240&S)==224?u+2>=t?l+=a:(h=r[u+n+1],f=r[u+n+2],(49344&(h|f<<8))!=32896?l+=a:(y=(15&S)<<12|(63&h)<<6|63&f,y<2048||y>=55296&&y<=57343?l+=a:(l+=i(y),u+=2))):(248&S)==240?u+3>=t?l+=a:(h=r[u+n+1],f=r[u+n+2],E=r[u+n+3],(12632256&(h|f<<8|E<<16))!=8421504?l+=a:(y=(7&S)<<18|(63&h)<<12|(63&f)<<6|63&E,y<65536||y>1114111?l+=a:(y-=65536,l+=i(55296+(y>>10),56320+(1023&y)),u+=3))):l+=a}return l}function zu(e,t){let n=t.length,i=0;for(let l=0;l<n;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+t.charCodeAt(++l)-56613888),i+=u<128?1:u<2048?2:u<65536?3:4}fi(e,i);let r=xb(e,i),a=e.bytes;for(let l=0;l<n;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+t.charCodeAt(++l)-56613888),u<128?a[r++]=u:(u<2048?a[r++]=u>>6&31|192:(u<65536?a[r++]=u>>12&15|224:(a[r++]=u>>18&7|240,a[r++]=u>>12&63|128),a[r++]=u>>6&63|128),a[r++]=63&u|128)}}function co(e){return e.bytes[U3(e,1)]}function F3(e,t){let n=xb(e,1);e.bytes[n]=t}function lS(e){let t,n=0,i=0;do t=co(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function fi(e,t){for(t>>>=0;t>=128;)F3(e,127&t|128),t>>>=7;F3(e,t)}function hz(e,t){let n,i=0,r=0,a=0;return n=co(e),i=127&n,128&n&&(n=co(e),i|=(127&n)<<7,128&n&&(n=co(e),i|=(127&n)<<14,128&n&&(n=co(e),i|=(127&n)<<21,128&n&&(n=co(e),r=127&n,128&n&&(n=co(e),r|=(127&n)<<7,128&n&&(n=co(e),r|=(127&n)<<14,128&n&&(n=co(e),r|=(127&n)<<21,128&n&&(n=co(e),a=127&n,128&n&&(n=co(e),a|=(127&n)<<7))))))))),{low:i|r<<28,high:r>>>4|a<<24,unsigned:t}}function Ku(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,r=t.high>>>24,a=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,l=xb(e,a),u=e.bytes;switch(a){case 10:u[l+9]=r>>>7&1;case 9:u[l+8]=a!==9?128|r:127&r;case 8:u[l+7]=a!==8?i>>>21|128:i>>>21&127;case 7:u[l+6]=a!==7?i>>>14|128:i>>>14&127;case 6:u[l+5]=a!==6?i>>>7|128:i>>>7&127;case 5:u[l+4]=a!==5?128|i:127&i;case 4:u[l+3]=a!==4?n>>>21|128:n>>>21&127;case 3:u[l+2]=a!==3?n>>>14|128:n>>>14&127;case 2:u[l+1]=a!==2?n>>>7|128:n>>>7&127;case 1:u[l]=a!==1?128|n:127&n}}const B3={},G3={},Ub=4294967296,pz=Ub*Ub,fz=pz/2;W3(0,!0);const H3=W3(0),mz=dS(0,-2147483648,!1),_z=dS(-1,2147483647,!1);function W3(e,t){let n,i,r;return t?(r=0<=(e>>>=0)&&e<256)&&(i=G3[e],i)?i:(n=dS(e,0,!0),r&&(G3[e]=n),n):(r=-128<=(e|=0)&&e<128)&&(i=B3[e],i)?i:(n=dS(e,e<0?-1:0,!1),r&&(B3[e]=n),n)}function dS(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function Y3(e,t){if(isNaN(e))return H3;{if(e<=-9223372036854776e3)return mz;if(e+1>=fz)return _z}return e<0?H3:dS(e%Ub|0,e/Ub|0,t)}function z3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}class LN extends Wn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Xo.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),P(this,"name","AgoraRTCImageModeration"),P(this,"_connectionState",ba.CONNECTING),P(this,"_sequence",0),P(this,"_moderationStartTime",void 0),P(this,"_workerConnection",void 0),P(this,"_workerMessageLengthLimit",void 0),P(this,"_qualityRatio",void 0),P(this,"_connectInfo",void 0),P(this,"_cancelTokenSource",Zr.CancelToken.source()),P(this,"_retryConfig",void 0),P(this,"_moderationInterval",void 0),P(this,"_moderationTimer",null),P(this,"_moderationMode",1),P(this,"_quality",1),P(this,"_qualityTimer",null),P(this,"_ticket",void 0),P(this,"_moderationIntervalMinimum",void 0),P(this,"_uploadFailedNum",0),P(this,"_uploadNum",0),P(this,"_uploadTimer",null),P(this,"_extraInfo",void 0),P(this,"_vendor",""),P(this,"_encoder",new TextEncoder),P(this,"_moderationId",void 0),P(this,"inspectImage",()=>{if(this.connectionState!==ba.CONNECTED)throw new te(x.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ba.CONNECTED?this.requestToInspectImage():b.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=yn(5,"image-moderation-"),this._workerMessageLengthLimit=U("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=U("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=U("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new $y("worker-"+this._moderationId,_i),this.on(Xo.STATE_CHANGE,(i,r)=>{b.debug("[".concat(this._moderationId,"] Moderation operation :").concat(f_[i]," ").concat(r||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(Xo.STATE_CHANGE,f_.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new Ne((r,a)=>{this.on(Xo.CONNECTION_STATE_CHANGE,(l,u)=>{l===ba.CONNECTED&&r()}),this.requestAP(t,i,n).then(l=>{this.connectWorker(l)}).catch(l=>{a(l)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),b.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===ba.CONNECTED&&this.inspectImage()}async requestAP(t,n,i){const r=U("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),a=await function(h,f,E,y){let{appId:S,areaCode:T,cname:k,sid:O,token:I,uid:M}=f;S_++;const L="moderation_plugin",j={service_name:L,json_body:JSON.stringify({appId:S,areaCode:T,cname:k,command:"allocateEdge",requestId:S_,seq:S_,sid:O,appToken:I,ts:Date.now(),uid:M+""})};let K,z,H=h[0];return Yo(async()=>{K=Date.now();const Z=await Jo(H,{data:j,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(z=Date.now()-K,Z.code!==0){const Ee=new te(x.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Z.code,{retry:!0,responseTime:z});throw b.error(Ee.toString()),Ee}const se=JSON.parse(Z.json_body);if(se.code!==200){const Ee=new te(x.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(se.code,", reason: ").concat(se.reason),{code:se.code,responseTime:z});throw b.error(Ee.toString()),Ee}if(!se.servers||!Array.isArray(se.servers)||se.servers.length===0){const Ee=new te(x.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:se.code,responseTime:z});throw b.error(Ee.toString()),Ee}if(!se.servers.some(Ee=>!!Ee.wss)){const Ee=new te(x.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:se.code,responseTime:z});throw b.error(Ee.toString()),Ee}const ue=U("IMAGE_MODERATION_WORKER_HOST");return{addressList:se.servers.map(Ee=>{let{address:Rt,wss:At}=Ee;if(Rt&&At)return"wss://".concat(Rt.replace(/\./g,"-"),".").concat(ue,":").concat(At,"/moderation")}).filter(Ee=>!!Ee),workerToken:se.workerToken,vid:se.vid,ticket:se.appTicket,responseTime:z}},(Z,se)=>(He.apworkerEvent(O,{success:!0,sc:200,serviceName:L,responseDetail:JSON.stringify(Z.addressList),firstSuccess:se===0,responseTime:z,serverIp:h[se%h.length]}),!1),(Z,se)=>(He.apworkerEvent(O,{success:!1,sc:Z.data&&Z.data.code||200,serviceName:L,responseTime:z,serverIp:h[se%h.length]}),!!(Z.code!==x.OPERATION_ABORTED&&Z.code!==x.UNEXPECTED_RESPONSE||Z.data&&Z.data.retry)&&(H=h[(se+1)%h.length],!0)),y)}(r,t,n,i);this.emit(Xo.STATE_CHANGE,f_.AP_CONNECTED);const{addressList:l,ticket:u}=a;return this._ticket=u,l}async connectWorker(t){this.emit(Xo.STATE_CHANGE,f_.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(_t.CONNECTED,async()=>{this.emit(Xo.STATE_CHANGE,f_.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ba.CONNECTED}),this._workerConnection.on(_t.CLOSED,()=>{this.connectionState=ba.CLOSED}),this._workerConnection.on(_t.FAILED,()=>{this.connectionState=ba.CLOSED}),this._workerConnection.on(_t.RECONNECTING,()=>{this.connectionState=this.connectionState===ba.CONNECTED?ba.RECONNECTING:ba.CONNECTING}),this._workerConnection.on(_t.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=cz(new Uint8Array(t.data));U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&b.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,b.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{He.reportApiInvoke(this._connectInfo.sid||null,{name:si.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Vn.TRACER}).onError(new te(x.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},U("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else b.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(_t.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this._workerConnection.on(_t.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Js(this,Xo.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&b.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(t,n);this._workerConnection.sendMessage(i,!0,!0)}else U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&b.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:i,cname:r,cid:a,vid:l,sid:u,uid:h}=n;const f=Date.now(),E=await t.getCurrentFrameImage("image/jpeg",this.quality),y=await gx(E,i,r),S=this._sequence+"-"+a+"-"+h+"-"+f+"-"+yn(12,""),T={appId:i,cid:a,cname:r,deviceId:"",elapse:LN.intToLong(Number(f-this._moderationStartTime)),fileSize:E.buffer.byteLength,height:E.height,width:E.width,jpg:y,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.0",sequence:this._sequence,sid:u,timestamp:Y3(f),uid:h,vid:l,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete T.callbackData;const k=oz(T);if(k.byteLength<this._workerMessageLengthLimit){if(U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const O=function(I){for(var M=1;M<arguments.length;M++){var L=arguments[M]!=null?arguments[M]:{};M%2?z3(Object(L),!0).forEach(function(j){P(I,j,L[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(L)):z3(Object(L)).forEach(function(j){Object.defineProperty(I,j,Object.getOwnPropertyDescriptor(L,j))})}return I}({},T);delete O.jpg,b.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(O))}return k}{const O=this.quality*this._qualityRatio;return this.quality=O,await this.generateRequestData(t,{appId:i,cname:r,cid:a,vid:l,sid:u,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Zr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ba.CLOSED,this.emit(Xo.STATE_CHANGE,f_.CLOSED)}}function K3(e){if(un(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new te(x.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new te(x.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Ez={name:"ImageModeration",create:function(e){let{config:t}=e;return K3(t),new LN(t)}};var q3,X3,J3,Z3,Q3,$3,e4,t4,n4,i4,r4,s4,a4,o4,c4,l4,d4,u4,h4,p4,f4,m4,_4,E4,g4,y4,S4,v4,T4,R4,b4,C4,w4,A4,O4,I4,N4,D4,k4,P4,L4,Le;function M4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function lo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?M4(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M4(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}cr.setLogger(b);let gz=(q3=nt(),X3=nt({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof a_))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),J3=nt({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==s_.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),Z3=nt({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),Q3=nt({argsMap:(e,t,n)=>[t,n]}),$3=nt({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:r}=n;return[i==null?void 0:i.uid,r]})}),e4=nt({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),t4=nt({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:r}=n;return{uid:i==null?void 0:i.uid,mediaType:r}})}),n4=nt(),i4=nt(),r4=nt(),s4=nt(),a4=nt(),o4=nt(),c4=nt(),l4=nt(),d4=nt(),u4=nt(),h4=nt(),p4=nt(),f4=nt(),m4=nt(),_4=nt(),E4=nt({argsMap:(e,t)=>[t]}),g4=nt(),y4=nt(),S4=nt(),v4=nt(),T4=nt(),R4=nt(),b4=nt(),C4=nt(),w4=nt({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),A4=nt(),O4=nt(),I4=nt(),N4=nt(),D4=nt(),k4=nt(),P4=nt({reportResult:!0}),L4=nt(),Le=class extends Wn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),P(this,"store",void 0),P(this,"_uid",void 0),P(this,"_channelName",void 0),P(this,"_uintUid",void 0),P(this,"_users",[]),P(this,"_config",void 0),P(this,"_clientId",void 0),P(this,"_appId",void 0),P(this,"_sessionId",null),P(this,"_key",void 0),P(this,"_rtmConfig",{}),P(this,"_joinInfo",void 0),P(this,"_gateway",void 0),P(this,"_statsCollector",void 0),P(this,"_configDistribute",void 0),P(this,"_leaveMutex",void 0),P(this,"_publishMutex",void 0),P(this,"_renewTokenMutex",void 0),P(this,"_subscribeMutex",void 0),P(this,"_encryptionMode","none"),P(this,"_encryptionSecret",null),P(this,"_encryptionSalt",null),P(this,"_encryptDataStream",!1),P(this,"_encryptDataStreamKey",null),P(this,"_encryptDataStreamIv",null),P(this,"_proxyServer",void 0),P(this,"_turnServer",{servers:[],mode:"auto"}),P(this,"_cloudProxyServerMode","disabled"),P(this,"_isDualStreamEnabled",!1),P(this,"_defaultStreamFallbackType",void 0),P(this,"_lowStreamParameter",void 0),P(this,"_streamFallbackTypeCacheMap",new Map),P(this,"_remoteStreamTypeCacheMap",new Map),P(this,"_axiosCancelSource",Zr.CancelToken.source()),P(this,"_audioVolumeIndicationInterval",void 0),P(this,"_networkQualityInterval",void 0),P(this,"_userOfflineTimeout",void 0),P(this,"_streamRemovedTimeout",void 0),P(this,"_liveTranscodeStreamingClient",void 0),P(this,"_liveRawStreamingClient",void 0),P(this,"_channelMediaRelayClient",void 0),P(this,"_networkQualitySensitivity","normal"),P(this,"_p2pChannel",void 0),P(this,"_useLocalAccessPoint",!1),P(this,"_setLocalAPVersion",void 0),P(this,"_joinAndNotLeaveYet",!1),P(this,"_numberOfJoinCount",0),P(this,"_joinResponse",null),P(this,"_remoteDefaultVideoStreamType",void 0),P(this,"_inspect",void 0),P(this,"_moderation",void 0),P(this,"_license",void 0),P(this,"_pendingPublishedUsers",[]),P(this,"ntpAlignErrorCount",0),P(this,"remoteInboundOffset",0),P(this,"_peerConnectionState",void 0),P(this,"_handleLocalTrackEnable",(r,a,l)=>{this.publish(r,!1).then(a).catch(l)}),P(this,"_handleLocalTrackDisable",(r,a,l)=>{this.unpublish(r).then(a).catch(l)}),P(this,"_handleUserOnline",r=>{if(U("BLOCK_LOCAL_CLIENT")&&Up(r.uid,this.channelName))return void b.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&b.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const a=this._users.find(l=>l.uid===r.uid);if(a)a._trust_in_room_=!0,a._is_pre_created&&(a._is_pre_created=!1,this.safeEmit(kt.USER_JOINED,a));else{const l=new Wu(r.uid,r.uint_id||r.uid);this._users.push(l),b.debug("[".concat(this._clientId,"] user online"),r.uid),this.store.firstVideoFrameDecoded(l.uid,{userJoinNotify:Date.now()}),this.safeEmit(kt.USER_JOINED,l)}}),P(this,"_handleUserOffline",r=>{if(U("BLOCK_LOCAL_CLIENT")&&Up(r.uid,this.channelName))return;const a=this._users.find(l=>l.uid===r.uid);a&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),a._audio_pre_subscribed||a._video_pre_subscribed?a._is_pre_created=!0:UR(this._users,a),this._remoteStreamTypeCacheMap.delete(a.uid),this._streamFallbackTypeCacheMap.delete(a.uid),b.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(kt.USER_LEAVED,a,r.reason))}),P(this,"_handleAddAudioOrVideoStream",(r,a,l,u,h,f,E,y)=>{if(U("BLOCK_LOCAL_CLIENT")&&Up(a,this.channelName))return;const S=this._users.find(k=>k.uid===a);if(!S)return void b.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));b.debug("[".concat(this._clientId,"] stream added with uid ").concat(a,", type ").concat(r)),this.store.subscribe(S.uid,r,void 0,void 0,void 0,Date.now()),r==="video"&&this.store.firstVideoFrameDecoded(S.uid,{videoAddNotify:Date.now()});const T=r==="audio"?S.hasAudio:S.hasVideo;if(S._uintid||(S._uintid=f||a),r==="audio"?S._trust_audio_stream_added_state_=!0:S._trust_video_stream_added_state_=!0,r==="audio"?(S._audio_added_=!0,l!==void 0&&(S._audioSSRC=l),u!==void 0&&(S._cname=u),E&&(S._audioOrtc=E)):(S._video_added_=!0,l!==void 0&&(S._videoSSRC=l),u!==void 0&&(S._cname=u),y!==void 0&&(S._rtxSsrcId=y),E&&(S._videoOrtc=E)),(r==="audio"?S.hasAudio:S.hasVideo)&&!T&&(b.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published ").concat(r)),this.safeEmit(kt.USER_PUBLISHED,S,r)),r==="video"?He.onGatewayStream(this._sessionId,Oi.ON_ADD_VIDEO_STREAM,Mn.ON_ADD_VIDEO_STREAM,{peer:f||a,ssrc:S._videoSSRC}):He.onGatewayStream(this._sessionId,Oi.ON_ADD_AUDIO_STREAM,Mn.ON_ADD_AUDIO_STREAM,{peer:f||a,ssrc:S._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(S,r,l).then(k=>{if(k&&(b.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(S.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof cS))return this._p2pChannel.unsubscribe(S,r,!0).then(()=>this._subscribe(S,r,!0).catch(O=>{b.error("[".concat(this._clientId,"] resubscribe error"),O.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(S,r)&&(b.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(S.uid," after reconnect.")),this._subscribe(S,r,!0).catch(k=>{b.error("[".concat(this._clientId,"] resubscribe error"),k.toString())})),r==="video"&&!er()&&!vr()){const k=this._getEncodingName(h);(k==null?void 0:k.toLocaleLowerCase())==Yy.av1&&GY().then(O=>{O||this._gateway.downgradeCodec(k)})}}),P(this,"_handleRemoveStream",r=>{if(U("BLOCK_LOCAL_CLIENT")&&Up(r.uid,this.channelName))return;const a=this._users.find(u=>u.uid===r.uid);if(!a)return void b.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));b.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let l=()=>{};a.hasAudio&&a.hasVideo?l=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished audio track")),this.safeEmit(kt.USER_UNPUBLISHED,a,"audio"),b.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished video track")),this.safeEmit(kt.USER_UNPUBLISHED,a,"video")}:a.hasVideo?l=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished video track")),this.safeEmit(kt.USER_UNPUBLISHED,a,"video")}:a.hasAudio&&(l=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished audio track")),this.safeEmit(kt.USER_UNPUBLISHED,a,"audio")}),a._video_pre_subscribed||a._audio_pre_subscribed||(a._trust_audio_stream_added_state_=!0,a._trust_video_stream_added_state_=!0,a._audio_added_=!1,a._video_added_=!1,this._p2pChannel instanceof cS&&this._p2pChannel.unsubscribe(a).then(u=>{if(u)return this._gateway.unsubscribe(u,a.uid)}),a._audioSSRC=void 0,a._videoSSRC=void 0,a._audioOrtc=void 0,a._videoOrtc=void 0,a._rtxSsrcId=void 0),He.onGatewayStream(this._sessionId,Oi.ON_REMOVE_STREAM,Mn.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),l()}),P(this,"_handleSetStreamLocalEnable",(r,a,l)=>{if(U("BLOCK_LOCAL_CLIENT")&&Up(a,this.channelName))return;const u=this._users.find(E=>E.uid===a);if(!u)return void b.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));b.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(l?"enabled":"disabled"," with uid ").concat(a));const h=r==="audio"?u.hasAudio:u.hasVideo;if(r==="audio"){u._trust_audio_enabled_state_=!0;const E=u._audio_enabled_;if(u._audio_enabled_=l,u._audio_enabled_===E)return;{const y=u._audio_enabled_?"enable-local-audio":"disable-local-audio";b.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(a,", msg: ").concat(y)),this.safeEmit(kt.USER_INFO_UPDATED,a,y)}}else{u._trust_video_enabled_state_=!0;const E=u._video_enabled_;if(u._video_enabled_=l,u._video_enabled_===E)return;{const y=u._video_enabled_?"enable-local-video":"disable-local-video";b.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(y)),this.safeEmit(kt.USER_INFO_UPDATED,a,y)}}const f=r==="audio"?u.hasAudio:u.hasVideo;return h!==f?!h&&f?(b.info("[".concat(this._clientId,"] remote user ").concat(a," published ").concat(r)),void this.safeEmit(kt.USER_PUBLISHED,u,r)):(r==="video"&&u._videoTrack&&u._videoTrack._destroy(),r==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,r),b.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished ").concat(r)),void this.safeEmit(kt.USER_UNPUBLISHED,u,r)):void 0}),P(this,"_handleMuteStream",(r,a,l)=>{if(U("BLOCK_LOCAL_CLIENT")&&Up(r,this.channelName))return;b.debug("[".concat(this._clientId,"] receive mute message"),r,a,l);const u=this._users.find(E=>E.uid===r);if(!u)return void b.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));const h=a==="audio"?u.hasAudio:u.hasVideo;if(a==="audio"){u._trust_audio_mute_state_=!0;const E=u._audio_muted_;if(u._audio_muted_=l,u._audio_muted_===E)return;{const y=u._audio_muted_?"mute-audio":"unmute-audio";b.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(y)),this.safeEmit(kt.USER_INFO_UPDATED,r,y)}}else{u._trust_video_mute_state_=!0;const E=u._video_muted_;if(u._video_muted_=l,u._video_muted_===E)return;{const y=u._video_muted_?"mute-video":"unmute-video";b.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(y)),this.safeEmit(kt.USER_INFO_UPDATED,r,y)}}const f=a==="audio"?u.hasAudio:u.hasVideo;if(h!==f){if(!h&&f)return(a==="audio"?u._audioSSRC:u._videoSSRC)?(b.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(a)),void this.safeEmit(kt.USER_PUBLISHED,u,a)):void b.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(a," unmute message  before add stream message, ").concat(a," SSRC doesn't exist yet."));a==="video"&&u._videoTrack&&!u._video_pre_subscribed&&u._videoTrack._destroy(),a==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,a),b.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(a)),this.safeEmit(kt.USER_UNPUBLISHED,u,a)}}),P(this,"_handleP2PLost",async r=>{b.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():b.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),P(this,"_handleTokenWillExpire",()=>{b.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(kt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),P(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),b.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),P(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(kt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(kt.NETWORK_QUALITY,r)}),P(this,"_handleP2PAddAudioOrVideoStream",(r,a,l,u)=>{const h=this._users.find(E=>E.uid===a);if(!h)return void b.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));b.debug("[".concat(this._clientId,"] stream added with uid ").concat(a,", type ").concat(r)),this.store.subscribe(h.uid,r,void 0,void 0,void 0,Date.now());const f=r==="audio"?h.hasAudio:h.hasVideo;r==="audio"?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,r==="audio"?(h._audio_added_=!0,l!==void 0&&(h._audioSSRC=l),u!==void 0&&(h._audioMid=u)):(h._video_added_=!0,l!==void 0&&(h._videoSSRC=l),u!==void 0&&(h._videoMid=u)),(r==="audio"?h.hasAudio:h.hasVideo)&&!f&&(b.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(r)),this.safeEmit(kt.USER_PUBLISHED,h,r)),this._p2pChannel.hasPendingRemoteMedia(h,r)&&(b.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,r,!0).catch(E=>{b.error("[".concat(this._clientId,"] resubscribe error"),E.toString())}))}),this._config=e,this._clientId=t||yn(5,"client-"),this.store=new class{constructor(r,a,l,u){dt(this,"state",void 0),this.state={codec:r,audioCodec:a,mode:l,clientId:u,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Np.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(r){this.state=function(a,l){switch(l.type){case ut.SET_SESSION_ID:return ge(ge({},a),{},{sessionId:l.sessionId});case ut.SET_P2P_ID:return ge(ge({},a),{},{p2pId:l.p2pId});case ut.SET_UID:return ge(ge({},a),{},{uid:l.uid});case ut.SET_INT_UID:return ge(ge({},a),{},{intUid:l.intUid});case ut.SET_PUB_ID:return ge(ge({},a),{},{pubId:l.pubId});case ut.KEY_METRIC_CLIENT_CREATED:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{clientCreated:l.metric})});case ut.KEY_METRIC_JOIN_START:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{joinStart:l.metric})});case ut.KEY_METRIC_PRELOAD_START:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{preloadStart:l.metric})});case ut.KEY_METRIC_PRELOAD_END:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{preloadEnd:l.metric})});case ut.KEY_METRIC_JOIN_END:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{joinEnd:l.metric})});case ut.KEY_METRIC_REQUEST_AP_START:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{requestAPStart:l.metric})});case ut.KEY_METRIC_REQUEST_AP_END:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{requestAPEnd:l.metric})});case ut.KEY_METRIC_REQUEST_SUA_END:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{requestSUAEnd:l.metric})});case ut.KEY_METRIC_BEFORE_CONNECT:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{beforeConnect:l.metric})});case ut.KEY_METRIC_PEER_RECEIVER:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{peerReceiver:l.metric})});case ut.KEY_METRIC_SIGNAL_CONNECTED:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{signalConnected:l.metric})});case ut.KEY_METRIC_JOIN_REQ:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{joinReq:l.metric})});case ut.KEY_METRIC_JOIN_REP:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{joinRep:l.metric})});case ut.KEY_METRIC_JOIN_GATEWAY_START:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{joinGatewayStart:l.metric})});case ut.KEY_METRIC_JOIN_GATEWAY_END:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{joinGatewayEnd:l.metric})});case ut.KEY_METRIC_PEER_CONNECTION_START:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{peerConnectionStart:l.metric})});case ut.KEY_METRIC_PEER_CONNECTION_END:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{peerConnectionEnd:l.metric})});case ut.KEY_METRIC_DESCRIPTION_START:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{descriptionStart:l.metric})});case ut.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{signalChannelOpen:l.metric})});case ut.KEY_METRIC_ICE_CONNECTION_END:return ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{iceConnectionEnd:l.metric})});case ut.KEY_METRIC_PUBLISH:{const u=a.keyMetrics.publish,h=u.findIndex(f=>f.trackId===l.metric.trackId);return h!==-1?(u[h]=ge(ge({},u[h]),l.metric),ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{publish:[...u]})})):ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{publish:[...a.keyMetrics.publish,l.metric]})})}case ut.KEY_METRIC_SUBSCRIBE:{const u=a.keyMetrics.subscribe,h=u.findIndex(f=>f.userId===l.metric.userId&&f.type===l.metric.type);return h!==-1?(u[h]=ge(ge({},u[h]),l.metric),ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{subscribe:[...u]})})):ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{subscribe:[...a.keyMetrics.subscribe,l.metric]})})}case ut.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const u=a.keyMetrics.firstVideoFrameDecoded,h=u.findIndex(f=>f.userId===l.metric.userId);return h!==-1?(u[h]=ge(ge({},u[h]),l.metric),ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{firstVideoFrameDecoded:[...u]})})):ge(ge({},a),{},{keyMetrics:ge(ge({},a.keyMetrics),{},{firstVideoFrameDecoded:[...a.keyMetrics.firstVideoFrameDecoded,l.metric]})})}case ut.RESET_FIRST_VIDEO_FRAME_DECODED:return a.keyMetrics.firstVideoFrameDecoded=[],a;case ut.SET_CLOUD_PROXY_SERVER_MODE:return a.cloudProxyServerMode=l.mode,a;case ut.RECORD_JOIN_CHANNEL_SERVICE:return typeof l.index!="number"?a.joinChannelServiceRecords=[...a.joinChannelServiceRecords,l.record]:(a.joinChannelServiceRecords[l.index]=ge(ge({},a.joinChannelServiceRecords[l.index]),l.record),a.joinChannelServiceRecords=[...a.joinChannelServiceRecords]),a;case ut.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return a.joinChannelServiceRecords=[],a;case ut.RESET_KEY_METRICS:return a.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},a;case ut.SET_USE_P2P:return ge(ge({},a),{},{useP2P:l.val});case ut.SET_TRANSPORT_TYPE:return ge(ge({},a),{},{p2pTransport:l.val});default:return a}}(this.state,r)}set autoSubscribe(r){this.state.autoSubscribe=r}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(r){this.state.enableInstantMuteRestore=r}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(r){this.dispatch({type:ut.SET_SESSION_ID,sessionId:r})}get sessionId(){return this.state.sessionId}set cid(r){this.state.cid=r}get cid(){return this.state.cid}set codec(r){this.state.codec=r}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(r){this.dispatch({type:ut.SET_P2P_ID,p2pId:r})}get p2pId(){return this.state.p2pId}set dcId(r){this.dispatch({type:ut.SET_DC_ID,dcId:r})}get dcId(){return this.state.dcId}set uid(r){this.dispatch({type:ut.SET_UID,uid:r})}get uid(){return this.state.uid}set intUid(r){this.dispatch({type:ut.SET_INT_UID,intUid:r})}get intUid(){return this.state.intUid}set pubId(r){this.dispatch({type:ut.SET_PUB_ID,pubId:r})}get pubId(){return this.state.pubId}set cloudProxyServerMode(r){this.dispatch({type:ut.SET_CLOUD_PROXY_SERVER_MODE,mode:r})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(r){this.dispatch({type:ut.SET_USE_P2P,val:r})}get useP2P(){return this.state.useP2P}set p2pTransport(r){this.dispatch({type:ut.SET_TRANSPORT_TYPE,val:r})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(r){this.state.hasStartJoinChannel=r}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(r){this.state.isABTestSuccess=r}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ut.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ut.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:ut.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:ut.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:ut.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ut.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ut.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:ut.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:ut.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:ut.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:ut.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:ut.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:ut.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ut.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ut.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ut.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ut.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(r,a){this.dispatch({type:ut.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:ge({userId:r},a)})}descriptionStart(){this.dispatch({type:ut.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ut.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ut.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(r,a,l,u){this.dispatch({type:ut.KEY_METRIC_PUBLISH,metric:ge(ge({trackId:r,type:a},l&&{publishStart:l}),u&&{publishEnd:u})})}subscribe(r,a,l,u,h,f,E){this.dispatch({type:ut.KEY_METRIC_SUBSCRIBE,metric:ge(ge(ge(ge(ge({userId:r,type:a},l&&{subscribeStart:l}),u&&{subscribeEnd:u}),h&&{firstFrame:h}),f&&{streamAdded:f}),E&&{firstDecoded:E})})}massSubscribe(r,a,l,u){r.forEach(h=>{this.dispatch({type:ut.KEY_METRIC_SUBSCRIBE,metric:ge(ge(ge({userId:h.userId,type:h.type},a&&{subscribeStart:a}),l&&{subscribeEnd:l}),u&&{firstFrame:u})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(r,a){r.service==="gateway"&&Array.isArray(r.urls)&&(r.urls=r.urls.map(l=>l.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof a!="number"?(this.dispatch({type:ut.RECORD_JOIN_CHANNEL_SERVICE,record:ge(ge({},r),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(a<0||a>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ut.RECORD_JOIN_CHANNEL_SERVICE,record:r,index:a}),a)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ut.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ut.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:ut.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new cr("client-leave",this._clientId),this._publishMutex=new cr("client-publish",this._clientId),this._renewTokenMutex=new cr("client-renewtoken",this._clientId),this._subscribeMutex=new cr("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),b.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Sa," build: ").concat(yI,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{aI(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(r){b.warning("[".concat(this._clientId,"] ").concat(r.toString()))}var i;this._statsCollector=new aS(this.store),this._statsCollector.onStatsException=(r,a,l)=>{b.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(a,", uid: ").concat(l)),r===gN.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(u=>{u instanceof ZR&&U("ENABLE_ENCODE_EXCEPTION")&&u.findClosestProfile()}),this.safeEmit(kt.EXCEPTION,{code:r,msg:a,uid:l})},this._statsCollector.onUploadPublishDuration=(r,a,l,u)=>{const h=this._users.find(f=>f.uid===r);h&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(h._uintid,{peerPublishDuration:l,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(h)),He.peerPublishStatus(this._sessionId,{subscribeElapse:u,audioPublishDuration:a,videoPublishDuration:l,peer:h._uintid}))},this._statsCollector.onVideoCodecChanged=r=>{if(U("VIDEO_STANDARD_BITRATE_VERSION")&&(r==="av1"||r==="h265"||r==="h264")){const a=this.localTracks.find(l=>l instanceof In);a&&a._saveEncodeBitrateRatio!==1&&a.setSaveEncodeBitrateRatio(r==="h264"?U("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new xY(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||_i,httpRetryConfig:e.httpRetryConfig||_i,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new KY(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},ld("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new cS(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,i,r){let a=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],l=arguments.length>6&&arguments[6]!==void 0&&arguments[6];on("JOIN_GATEWAY_USE_443PORT_ONLY",a),on("JOIN_GATEWAY_USE_DUAL_DOMAIN",l);const u=this._gateway.signal.websocket;return u instanceof iN&&(u.use443PortOnly=a,u.tryDoubleDomain=l),async function(h,f,E){kR.get(h)||kR.set(h,[]),PR.get(h)||PR.set(h,f),Xc.get(h)||Xc.set(h,0);const y=kR.get(h),S=PR.get(h);if(!y||!S)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Xc.get(h)===S){const M=xy();y.push(M),await M.promise}Xc.set(h,Xc.get(h)+1);for(var T=arguments.length,k=new Array(T>3?T-3:0),O=3;O<T;O++)k[O-3]=arguments[O];const I=await E(...k);return Xc.set(h,Xc.get(h)-1),Xc.get(h)===S-1&&y.length>0&&(y[0].resolve(),y.shift()),Xc.get(h)===0&&(kR.set(h,[]),PR.set(h,0),Xc.set(h,0)),I}("client.join",U("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,i,r)}async join(e,t,n,i,r){const a=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const l=(FR||FR||(FR=(window.location.protocol.split(":")[0]||"").toUpperCase(),FR))==="HTTPS",u=kM()?window.isSecureContext:"Browser Not Support";(!kM()&&!l||!window.isSecureContext)&&b.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let h;He.setAppId(e);try{if(!n&&n!==null)throw new te(x.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&Ki(n,"token",1,2047),Ki(e,"appid",1,2047),cb(t),i&&lb(i),r)if(typeof r=="string")Ki(r,"optionalInfo",1,256),h=r;else{if(typeof r!="object")throw new te(x.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:I,enableInstantMuteRestore:M}=r;I&&(Wo(I,"autoSubscribe"),b.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(I)),this.store.autoSubscribe=I),M&&(Wo(M,"enableInstantMuteRestore"),b.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(M)),this.store.enableInstantMuteRestore=M)}}}catch(I){throw He.reportApiInvoke(Ip(),{name:si.JOIN,options:[e,t,n,i],states:{isHttps:l,isSecureContext:u},tag:Vn.TRACER}).onError(I),I}if(this._leaveMutex.isLocked&&(b.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),b.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const I=new te(x.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw He.reportApiInvoke(Ip(),{name:si.JOIN,options:[e,t,n,i],states:{isHttps:l,isSecureContext:u},tag:Vn.TRACER}).onError(I),I}this._gateway.state="CONNECTING",this.store.preloadStart();const f=await D3({appId:e,cname:t,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new te(x.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const E=(f==null?void 0:f.sid)||Ip();b.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(a)),this._sessionId||(this._sessionId=E,this.store.sessionId=this._sessionId);const y=He.reportApiInvoke(E,{id:this._clientId,name:si.JOIN,options:[e,t,n,i],states:{isHttps:l,isSecureContext:u},tag:Vn.TRACER}),S=lo(lo(lo({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:h,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!f},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:U("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(S.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(S.stringUid=i,this._uintUid?(S.uid=this._uintUid,this._uintUid=void 0):S.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(S.aesmode=this._encryptionMode,S.aespassword=await(async I=>{const M=function(z){const H=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Z=new Uint8Array(new ArrayBuffer(H.length));for(let se=0;se<H.length;se+=1)Z[se]=H.charCodeAt(se);return Z}(),L=await window.crypto.subtle.importKey("spki",M,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),j=rI(I),K=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},L,j);return function(z){let H="";for(let Z=0;Z<z.length;Z+=1)H+=String.fromCharCode(z[Z]);return window.btoa(H)}(new Uint8Array(K))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new te(x.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(S.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const I=new TextEncoder,M=U("USE_PURE_ENCRYPTION_MASTER_KEY")?I.encode(S.appId+this._encryptionSecret+this._encryptionSecret):I.encode(S.appId+S.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(L,j,K){const z=await window.crypto.subtle.importKey("raw",j,"PBKDF2",!1,["deriveBits","deriveKey"]),H=L==="aes-128-gcm2"?128:256,Z=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:GM,hash:"SHA-256",salt:K},z,H+hW);return new Uint8Array(Z).subarray(H/8)}(this._encryptionMode,M,Op(this._encryptionSalt)),this._encryptDataStreamKey=await async function(L,j,K){const z=await window.crypto.subtle.importKey("raw",j,"PBKDF2",!1,["deriveBits","deriveKey"]),H=L==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:GM,hash:"SHA-256",salt:K},z,{name:"AES-GCM",length:H},!0,["encrypt","decrypt"])}(this._encryptionMode,M,Op(this._encryptionSalt))}else u?b.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):b.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,b.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:S.stringUid});const T=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&T===this._sessionId&&He.joinChannelTimeout(this._sessionId,5)},5e3);try{var k;let I;const M=S.cloudProxyServer;if(Re(k=["proxy3","proxy4","proxy5"]).call(k,M)){const H=U("PROXY_SERVER_TYPE3");Array.isArray(H)?S.proxyServer=H[0]:S.proxyServer=H}if(He.setProxyServer(S.proxyServer),b.setProxyServer(S.proxyServer),this.store.requestAPStart(),f){if(b.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(S.stringUid?", ".concat(S.stringUid," => ").concat(f.intUid):""," ")),S.stringUid&&!S.uid&&(S.uid=f.intUid),I={gatewayInfo:f.ap.gatewayInfo},U("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&S.turnServer.mode==="auto")if(f.ap.proxyInfo.addresses.length===0)b.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const H=(await AV(f.ap.proxyInfo,f.ap.gatewayInfo.uid)).map(Z=>({turnServerURL:Z.address,tcpport:Z.tcpport||ir.tcpport,udpport:Z.udpport||ir.udpport,username:Z.username||ir.username,password:Z.password||ir.password,forceturn:!1,security:!0}));S.turnServer={mode:"manual",servers:H}}L3(f,S.stringUid)}else{if(S.stringUid&&!S.uid){let H;[H,I]=await Ne.all([t3(S.stringUid,S,this._axiosCancelSource.token,this._config.httpRetryConfig||_i,this.store).finally(()=>{this.store.requestSUAEnd()}),e3(S,this._axiosCancelSource.token,this._config.httpRetryConfig||_i,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),b.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(S.stringUid," => ").concat(H)),S.uid=H,I.gatewayInfo.uid=H,I.gatewayInfo.res.uid=H}else I=await e3(S,this._axiosCancelSource.token,this._config.httpRetryConfig||_i,!0,this.store);if(!this._joinAndNotLeaveYet)throw new te(x.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(S,this._axiosCancelSource.token),this._configDistribute.on(Zy.UPDATE_BITRATE_LIMIT,H=>{this._p2pChannel.updateBitrateLimit(H)}),this._configDistribute.on(Zy.UPDATE_CLIENT_ROLE_OPTIONS,H=>{this._setClientRoleOptions(H)})},0),this._key=n||e;const L=I.gatewayInfo,j=S.uid?S.uid:L.uid;this._joinInfo=lo(lo({},S),{},{cid:L.cid,uid:j,vid:L.vid,apResponse:L.res,apGatewayAddress:L.apGatewayAddress,uni_lbs_ip:L.uni_lbs_ip,gatewayAddrs:L.gatewayAddrs}),this.store.intUid=j,this.store.cid=L.cid;const K=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new te(x.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));y.onSuccess(K),this._appId=e,this._channelName=S.cname,this._uid=K,this.store.uid=K,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(er()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const z=S.stringUid?"string uid: ".concat(S.stringUid,",uid: ").concat(S.uid):"uid: ".concat(this._uid);return b.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(z)),setTimeout(()=>{b.startUpload()},5e3),this.store.joinEnd(),O=this,Re(xp).call(xp,O)||xp.push(O),this._cloudProxyServerMode==="disabled"&&Bt().supportWebCrypto&&U("ENABLE_PRELOAD")&&kN(this._joinInfo),K}catch(I){const M=Array.isArray(I)?I[0]:I;throw M&&M.code===x.OPERATION_ABORTED?b.warning("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),M):b.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),M),M.code!==x.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),y.onError(M),M}var O}_joinGateway(){if(!this._joinInfo||!this._key)throw new te(x.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!U("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){b.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(er()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=xp.indexOf(t);n!==-1&&xp.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return b.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Qt.LEAVE),b.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof a_))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new te(x.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new te(x.INVALID_OPERATION,"audience can not publish stream");for(const r of n){if(!(r instanceof a_))throw new te(x.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&t)throw new te(x.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}b.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(r=>{const a=this._configDistribute.getBitrateLimit();r instanceof In&&a&&r.setBitrateLimit(a.uplink)});try{await this._publishHighStream(n),b.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw b.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{i()}}async _publishDataChannel(e){if(e==null)throw new te(x.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));un(e.id,"id",0,65535,!0),Wo(e.ordered,"ordered"),Ki(e.metadata,"metadata",0,512),b.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===e.id)!==-1)throw new te(x.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new te(x.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&U("FORCE_TURN")&&!U("TURN_ENABLE_TCP")&&!U("TURN_ENABLE_UDP"))throw new te(x.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(r){return YV(r,!1)}(e),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw b.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new te(x.CREATE_DATACHANNEL_ERROR);try{await Ne.all(i.map(r=>this._uid&&this._gateway.publishDataChannel(this._uid,r,!0))),await n._waitTillOpen()}catch(r){if(r.code!==x.DISCONNECT_P2P)throw r}}return b.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw b.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new te(x.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof a_))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);b.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.sendExtensionMessage(ci.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.unpublish(i,this._uid),b.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(r=>"".concat(r.getTrackId()))))}}catch(i){throw b.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),b.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),b.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(i=>"".concat(i.id))))}catch(n){throw b.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Wu)){const i=this.remoteUsers.find(r=>r.uid===e);if(!i)throw new te(x.INVALID_REMOTE_USER,"user is not in the channel");e=i}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(Ai(t,"mediaType",["audio","video"]),this.store.useP2P)throw new te(x.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new te(x.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===xe.AUDIO,i=t===xe.VIDEO,r=await this._subscribeMutex.lock();try{const{ssrcId:a,ortc:l,rtxSsrcId:u,cname:h,uint_id:f}=await this._gateway.presubscribe(e,t,!0);if(a==null)throw new te(x.UNEXPECTED_RESPONSE,"no ssrc id");let E=this._users.find(S=>S.uid===e);E||(E=new Wu(e,f||e),E._is_pre_created=!0,this._users.push(E)),h&&(E._cname=h),E._uintid||(E._uintid=f||e),n&&(E._audioSSRC=a,E._audio_pre_subscribed=!0,l&&(E._audioOrtc=l)),i&&(E._videoSSRC=a,E._video_pre_subscribed=!0,l&&(E._videoOrtc=l),u!=null&&(E._rtxSsrcId=u)),b.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(a)),await this._p2pChannel.subscribe(E,t,a,u,l);const y=n?E._audioTrack:E._videoTrack;if(!y)throw new te(x.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(E._trust_audio_stream_added_state_=!0,E._audio_added_=!0),i&&(E._trust_video_stream_added_state_=!0,E._video_added_=!0),y}catch(a){throw b.error("[".concat(this._clientId,"] presub user ").concat(e," error"),a),a}finally{r()}}async _subscribeDataChannel(e,t){var n;if(un(t,"channelId",0,65535,!0),!this._joinInfo)throw new te(x.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e))throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new te(x.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new te(x.INVALID_REMOTE_USER,"user is not published");const r=(n=e._dataChannels)===null||n===void 0?void 0:n.find(u=>u.id===t);if(!r)throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new te(x.REMOTE_USER_IS_NOT_PUBLISHED);const a=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const u=await this._p2pChannel.subscribeDataChannel(e,[r]);if(u&&Re(u).call(u,r.id))try{var l;if(typeof r._originDataChannelId!="number")throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new te(x.CREATE_DATACHANNEL_ERROR);const h={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:(l=r.metadata)!==null&&l!==void 0?l:""};await this._gateway.subscribeDataChannel(e.uid,h,!0),await r._waitTillOpen()}catch(h){if((h==null?void 0:h.code)!==x.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[r]),h;await this._p2pChannel.unsubscribeDataChannel(e,[r]),this._p2pChannel.setPendingRemoteDataChannel(e,r.id)}return b.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),r}finally{a()}}async _p2pSubscribe(e,t,n){if(Ai(t,"mediaType",["audio","video"]),!this._joinInfo)throw new te(x.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===e)){const a=new te(x.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),a}if(!e.hasAudio&&!e.hasVideo){const a=new te(x.INVALID_REMOTE_USER,"user is not published");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),a}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const a=new te(x.REMOTE_USER_IS_NOT_PUBLISHED);throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),a}const r=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const l=t==="audio"?e._audioSSRC:e._videoSSRC,u=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,l,u)}catch(l){throw l}b.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(l=>{b.warning("[".concat(this._clientId,"] auto set fallback failed"),l)});const a=t==="audio"?e._audioTrack:e._videoTrack;if(!a)throw new te(x.UNEXPECTED_ERROR,"can not find remote track in user object");return a}catch(a){throw b.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),a),a}finally{r()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(Ai(t,"mediaType",["audio","video"]),!this._joinInfo)throw new te(x.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e)){const f=new te(x.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),f}if(!e.hasAudio&&!e.hasVideo){const f=new te(x.INVALID_REMOTE_USER,"user is not published");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),f}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const f=new te(x.REMOTE_USER_IS_NOT_PUBLISHED);throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),f}let r=t==="audio"?e._audioSSRC:e._videoSSRC,a=t==="audio"?e._audioOrtc:e._videoOrtc,l=t==="video"?e._rtxSsrcId:void 0,u={stream_type:t==="audio"?xe.AUDIO:xe.VIDEO,ssrcId:r};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const h=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const E=t==="audio"?e._audioSSRC:e._videoSSRC;E!==void 0&&E!==r&&(r=E,a=t==="audio"?e._audioOrtc:e._videoOrtc,l=t==="video"?e._rtxSsrcId:void 0,u={stream_type:t==="audio"?xe.AUDIO:xe.VIDEO,ssrcId:r}),hr.markSubscribeStart(this.store.clientId,r),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,r,l,a);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(e.uid,u,!0)}catch(y){if((y==null?void 0:y.code)!==x.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),y;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(E){throw this._p2pChannel.reportSubscribeEvent(!1,E==null?void 0:E.code,e,t),E}b.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(E=>{b.warning("[".concat(this._clientId,"] auto set fallback failed"),E)});const f=t==="audio"?e._audioTrack:e._videoTrack;if(!f)throw new te(x.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),f}catch(f){throw b.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),f),f}finally{h()}}async massSubscribe(e){if(sd(e,"subscribeList"),!this._joinInfo)throw new te(x.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,i=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(u=>{let{user:h,mediaType:f}=u;return"user: ".concat(h==null?void 0:h.uid,", mediaType: ").concat(f)}).join("; ")));const r=(e=[...e]).map(u=>{let{user:h,mediaType:f}=u;return{user:h,mediaType:f}}),a=await this._p2pChannel.globalLock();try{var l;for(let h=e.length-1;h>=0;h--){const f=e[h],{user:E,mediaType:y}=f;if(Ai(y,"mediaType",["audio","video"]),!E){const O=new te(x.INVALID_PARAMS,"user property does not exist in subscribeList item");throw b.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),O}if(!this._users.find(O=>O===E)){const O=new te(x.INVALID_REMOTE_USER,"user is not in the channel");b.error("[".concat(this._clientId,"] can not massSubscribe ").concat(E.uid,", this user is not in the channel")),r[h].error=O,e.splice(h,1);continue}if(y==="audio"&&(!E.hasAudio||E._audioSSRC===void 0)||y==="video"&&(!E.hasVideo||E._videoSSRC===void 0)){const O=new te(x.REMOTE_USER_IS_NOT_PUBLISHED);b.error("[".concat(this._clientId,"] can not subscribe ").concat(E.uid," with mediaType ").concat(y,", remote user is not published")),r[h].error=O,e.splice(h,1);continue}const T=ki.Video|ki.LwoVideo,k=n.get(E);if(k){if(y==="video"?k&T:k&ki.Audio){e.splice(h,1),b.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(E.uid,", mediaType:").concat(y," twice"));continue}n.set(E,k|(y==="video"?T:ki.Audio))}else n.set(E,y==="video"?T:ki.Audio)}for(let h=e.length-1;h>=0;h--){const f=e[h],{user:E,mediaType:y}=f,S=ki.Video|ki.LwoVideo;if(this._p2pChannel.hasRemoteMedia(E,y)){await this._p2pChannel.unmuteRemoteNoLock(E,y);const T=n.get(E);n.set(E,y==="video"?T^S:T^ki.Audio),e.splice(h,1)}}this.store.massSubscribe(e.map(h=>({userId:h.user.uid,type:h.mediaType})),t);let u=gr(l=Array.from(n.entries())).call(l,(h,f)=>{let[E,y]=f;if(y===0)return h;const S={stream_id:E.uid,stream_type:y};return y&ki.Audio&&(S.audio_ssrc=E._audioSSRC),y&ki.Video&&(S.video_ssrc=E._videoSSRC),h.push(S),h},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(f=>{let{user:E,mediaType:y}=f;return{user:E,mediaType:y,ssrcId:y===xe.VIDEO?E._videoSSRC:E._audioSSRC,rtxSsrcId:y===xe.VIDEO?E._rtxSsrcId:void 0}}));const h=new Map;if(u=u.filter(f=>f.video_ssrc&&!this._p2pChannel.isPreSubScribe(f.video_ssrc)||f.audio_ssrc&&!this._p2pChannel.isPreSubScribe(f.audio_ssrc)||!f.video_ssrc&&!f.audio_ssrc),u.length>0){const f=await this._gateway.subscribeAll(u,!0);((f==null?void 0:f.users)||[]).forEach(E=>{let{stream_id:y,video_error_code:S,audio_error_code:T,error_code:k}=E;(S||T||k)&&h.set(y,{video_error_code:S,audio_error_code:T,error_code:k})})}if(Array.from(h.entries()).length>0){const f=[];Array.from(h.entries()).forEach(E=>{let[y,S]=E;const T=this.remoteUsers.find(k=>k.uid===y);if(T){let k;S.error_code||S.video_error_code&&S.audio_error_code?k=void 0:S.video_error_code?k=xe.VIDEO:S.audio_error_code&&(k=xe.AUDIO),f.push({user:T,mediaType:k})}}),f.length>0&&await this._p2pChannel.massUnsubscribeNoLock(f)}for(const f of r){const E=h.get(f.user.uid);if(E){const y=E.error_code||f.mediaType==="audio"&&E.audio_error_code||f.mediaType==="video"&&E.video_error_code;if(y){const S=Qy(y);b.error("user:".concat(f.user.uid," mediaType:").concat(f.mediaType," has massSubscribe error ").concat(S.desc)),f.error=new te(x.SUBSCRIBE_FAILED,"code ".concat(y,": ").concat(S.desc))}}f.error||(f.mediaType==="video"?f.track=f.user.videoTrack:f.track=f.user.audioTrack)}return this.store.massSubscribe(r.filter(f=>!f.error).map(f=>({userId:f.user.uid,type:f.mediaType})),void 0,Date.now()),r.forEach(f=>{var E;He.subscribe(this.store.sessionId,{succ:!!f.error,ec:((E=f.error)===null||E===void 0?void 0:E.code)||null,video:f.mediaType===xe.VIDEO,audio:f.mediaType===xe.AUDIO,peerid:f.user.uid,subscribeRequestid:f.mediaType===xe.VIDEO?f.user._videoSSRC:f.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(f.user._videoSSRC)},!0)}),b.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(f=>{let{user:E,mediaType:y}=f;return"user: ".concat(E==null?void 0:E.uid,", mediaType: ").concat(y)}).join("; "))),r}catch(h){throw await this._p2pChannel.massUnsubscribeNoLock(e),h}}finally{a(),i()}}async unsubscribe(e,t,n){if(!(e instanceof Wu)){const a=this.remoteUsers.find(l=>l.uid===e);if(!a)throw new te(x.INVALID_REMOTE_USER,"user is not in the channel");e=a}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&Ai(t,"mediaType",["audio","video"]),!this._joinInfo)throw new te(x.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(a=>a===e)){const a=new te(x.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),a}b.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const r=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const a=await this._p2pChannel.unsubscribe(e,t);a&&await this._gateway.unsubscribe(a,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&UR(this._users,e),b.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(a){if(a.code===x.DISCONNECT_P2P)return void b.warning("disconnecting p2p, abort unsubscribe request.");throw b.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),a.toString()),a}finally{r()}}async _unsubscribeDataChannel(e,t){if(t&&un(t,"id",0,65535,!0),!this._joinInfo)throw new te(x.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(r=>r===e)){const r=new te(x.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),r}let i;if(typeof t=="number"){const r=e._dataChannels.find(a=>a.id===t);r&&(i=[r])}else i=e._dataChannels;if(i===void 0){const r=new te(x.REMOTE_USER_IS_NOT_PUBLISHED);throw b.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),r}b.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(r=>r.id)));try{const r=await this._p2pChannel.unsubscribeDataChannel(e,i);r&&await this._gateway.unsubscribeDataChannel(r,e.uid),b.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r))}catch(r){if(r.code===x.DISCONNECT_P2P)return void b.warning("disconnecting p2p, abort unsubscribe request.");throw b.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),r.toString()),r}}async massUnsubscribe(e){if(sd(e,"unsubscribeList"),!this._joinInfo)throw new te(x.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");b.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:i,mediaType:r}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(r,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:i,mediaType:r}=e[n];if(!i){const u=new te(x.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw b.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),u}if(Ai(r,"mediaType",["video","audio",void 0]),!this._users.find(u=>u===i)){b.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(n,1);continue}const l=ki.Video|ki.LwoVideo;if(t.has(i)){const u=t.get(i);let h;switch(r){case"video":h=u&l;break;case"audio":h=u&ki.Audio;break;default:h=u&(ki.Audio|l)}if(h){b.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(r," twice.")),e.splice(n,1);continue}r?r==="audio"?t.set(i,u|ki.Audio):r==="video"&&t.set(i,u|l):t.set(i,u|ki.Audio|l)}else r?r==="audio"?t.set(i,ki.Audio):r==="video"&&t.set(i,l):t.set(i,ki.Audio|l)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),b.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(i=>{let{user:r,mediaType:a}=i;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(a,";")}).join()))}catch(n){if(n.code===x.DISCONNECT_P2P)return void b.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw b.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new re(x.INVALID_PARAMS);Xn(n.width)||nI(n.width,"streamParameter.width"),Xn(n.height)||nI(n.height,"streamParameter.height"),Xn(n.framerate)||nI(n.framerate,"streamParameter.framerate"),Xn(n.bitrate)||un(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&b.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),b.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,me.LocalVideoLowTrack)}async enableDualStream(){if(!Bt().supportDualStream)throw He.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new te(x.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new te(x.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw He.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,He.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),b.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new te(x.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(me.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw He.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,He.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),b.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(i){Ai(i,"role",["audience","host"])}(e),t&&aI(t),this.mode==="rtc"||this.mode==="p2p")throw b.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new te(x.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new te(x.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new te(x.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&U("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",tr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),b.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&aI(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{b.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Ki(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new te(x.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new te(x.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,He.setProxyServer(this._proxyServer),b.setProxyServer(this._proxyServer),b.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new te(x.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new te(x.INVALID_OPERATION,"You have already set the proxy")}if(Fy(e))return this._turnServer={servers:e,mode:"original-manual"},void b.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>SM(n)),this._turnServer={servers:e,mode:"manual"},b.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new te(x.INVALID_OPERATION,"you should set license before join channel");if(Ki(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new te(x.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,b.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new te(x.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new te(x.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new te(x.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new te(x.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,b.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new te(x.INVALID_OPERATION,"Stop proxy server after leave channel");He.setProxyServer(),b.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",b.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new te(x.INVALID_PARAMS,"accessPoints is required.");sd(e.accessPoints.serverList,"accessPoints.serverList"),Ki(e.accessPoints.domain,"accessPoints.domain");const t=(S,T)=>{un(S,T,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new te(x.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");U("CLOSE_AFB_FOR_LOCAL_AP")&&(on("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),on("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=e.accessPoints.domain,a=e.accessPoints.serverList.map(S=>i.test(S)?"".concat(S.replace(/\./g,"-"),".").concat(r):S),l=a.map(S=>"".concat(S,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,on("WEBCS_DOMAIN",l),on("WEBCS_DOMAIN_BACKUP_LIST",l),on("GATEWAY_DOMAINS",[r]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(sd(e.report.hostname,"report.hostname"),on("EVENT_REPORT_DOMAIN",e.report.hostname[0]),on("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(on("EVENT_REPORT_DOMAIN",a[0]),on("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));let u=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),u=e.report.port),on("STATS_COLLECTOR_PORT",u),e.report?on("ENABLE_EVENT_REPORT",!0):on("ENABLE_EVENT_REPORT",!1);let h="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(sd(e.log.hostname,"log.hostname"),h=e.log.hostname[0]):h=a[0];let f=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),f=e.log.port),on("LOG_UPLOAD_SERVER","".concat(h,":").concat(f));let E=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(sd(e.cds.hostname,"cds.hostname"),E=e.cds.hostname):E=a;let y=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),y=e.cds.port),on("CDS_AP",E.map(S=>"".concat(S,":").concat(y))),e.cds?on("ENABLE_CONFIG_DISTRIBUTE",!0):on("ENABLE_CONFIG_DISTRIBUTE",!1),b.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(sd(e,"serverList"),Ki(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new te(x.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,on("WEBCS_DOMAIN",e),on("WEBCS_DOMAIN_BACKUP_LIST",e),on("GATEWAY_DOMAINS",[t]),on("EVENT_REPORT_DOMAIN",e[0]),on("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),on("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),b.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Ai(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw b.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else b.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Ai(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(i=>i.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw b.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}b.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Ai(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw b.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}b.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,i){(function(a){Ai(a,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Ki(t,"secret");const r=["aes-128-gcm2","aes-256-gcm2"];if(Re(r).call(r,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new te(x.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new te(x.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(Wo(i,"encryptDataStream"),!Re(r).call(r,e))throw new te(x.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||b.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Pu(n))}async renewToken(e){if(Ki(e,"token",1,2047),!this._key||!this._joinInfo)throw new te(x.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(U("USE_NEW_TOKEN")){b.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await zY(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||_i);b.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else b.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});b.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,b.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?b.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(kt.VOLUME_INDICATOR,e)},U("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new te(x.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new te(x.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new te(x.LIVE_STREAMING_TASK_CONFLICT);const n=t?ad.TRANSCODE:ad.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(ad.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new te(x.INVALID_PARAMS,"can not find live streaming url to stop");await Ne.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){o3(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){o3(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof cS&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new te(x.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const r=new TextEncoder;e.payload=r.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Re(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(i=!0,e.payload=await async function(r,a,l){var u;const h=gr(u=Array.from(l)).call(u,(O,I)=>O+I,0),f={serverTs:0,seq:pW++,length:l.length,checkSum:h},E=new Uint8Array(OM(h,2)),y=new ArrayBuffer(e_),S=new DataView(y);S.setUint32(0,f.serverTs),S.setUint16(4,f.seq),S.setUint16(6,f.length),S.setUint16(8,f.checkSum);const T=16-l.length%16;l=RM(l,new Uint8Array(T));const k=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:BM,additionalData:E},a,l);return RM(new Uint8Array(y),new Uint8Array(k))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new te(x.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(st.DATA_STREAM,{payload:Pu(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-ez},!n)}sendMetadata(e){if(!this._joinInfo)throw new te(x.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new te(x.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(st.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Pu(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(TW),!this._joinInfo)throw new te(x.INVALID_OPERATION,"can not send custom report, not joined");await He.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(U("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(n=>n.uid+"");Object.keys(e).forEach(n=>{Re(t).call(t,n)||delete e[n]})}return e}async pickSVCLayer(e,t){Ai(t.spatialLayer,"spatialLayer",[0,1,2,3]),Ai(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw b.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(Wo(t,"apRTM"),un(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,b.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(b.debug("[".concat(this._clientId,"] reset client")),function(e){const t=h_.indexOf(e);t!==-1&&h_.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Zr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&P3(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&He.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new cr("client-publish",this._clientId),this._subscribeMutex=new cr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const i=e||Ip();e?b.debug("[".concat(this._clientId,"] new Session ").concat(i)):b.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const r=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,He.addSid(i);const a={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:this.role==="audience"?2:1};He.sessionInit(this._sessionId,lo({cname:t.channel,appid:t.appId},a)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new te(x.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&U("FORCE_TURN")&&!U("TURN_ENABLE_TCP")&&!U("TURN_ENABLE_UDP"))throw new te(x.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");b.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(ci.PUBLISH,i,!0)}catch(r){throw n.throw(r),r}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var t;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(a){if(a.code!==x.DISCONNECT_P2P)throw n.throw(a),a}await n.next(((t=r)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const r of e)r instanceof In&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig).catch(a=>{b.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===x.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new te(x.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(x.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));b.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(a){if(a.code!==x.DISCONNECT_P2P)throw n.throw(a),a}n.next(((t=r)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===x.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new te(x.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},ld("LiveStreaming").create(i));var i;return n.onLiveStreamError=(r,a)=>{He.reportApiInvoke(this._sessionId,{name:si.ON_LIVE_STREAM_ERROR,options:[r,a],tag:Vn.TRACER}).onSuccess(),this.safeEmit(kt.LIVE_STREAMING_ERROR,r,a)},n.onLiveStreamWarning=(r,a)=>{He.reportApiInvoke(this._sessionId,{name:si.ON_LIVE_STREAM_WARNING,options:[r,a],tag:Vn.TRACER}).onSuccess(),this.safeEmit(kt.LIVE_STREAMING_WARNING,r,a)},n.on(eN.REQUEST_WORKER_MANAGER_LIST,(r,a,l)=>{if(!this._joinInfo)return l(new te(x.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(u,h,f,E){const y=U("UAP_AP").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(S=>h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(S+"/api/v1?action=uap"):"https://".concat(S,"/api/v1?action=uap"));return await jY(y,u,h,f,E)})(r,this._joinInfo,this._axiosCancelSource.token,_i).then(a).catch(l)}),n};return e===ad.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new te(x.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},ld("ChannelMediaRelay").create(e));i.on("state",r=>{r===ls.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(kt.CHANNEL_MEDIA_RELAY_STATE,r)}),i.on("event",r=>{this.safeEmit(kt.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(r,a)=>{var l;r==="resolution"&&((l=this._channelMediaRelayClient)===null||l===void 0||l.setVideoProfile(a))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:i}=e,r=[];if(t){const a=[];this._users.forEach(l=>{l._dataChannels.forEach(u=>{n.every(h=>h.uid!==l._uintid||h.stream_id!==u.id)&&a.push({uid:l._uintid,stream_id:u.id,ordered:u.ordered,max_retrans_times:u.maxRetransmits,metadata:u.metadata})})}),a.length>0&&this._handleUpdateDataChannel({added:[],deleted:a})}Array.isArray(n)&&n.length>0&&n.forEach(a=>{const{uid:l,stream_id:u,ordered:h,max_retrans_times:f,metadata:E}=a,y=this._users.find(S=>S._uintid===l);if(!y)return void b.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(b.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(l)),Re(r).call(r,y)||r.push(y),y._uintid||(y._uintid=l),y._dataChannels.findIndex(S=>S.id===a.stream_id)===-1){const S={id:u,ordered:!!h,maxRetransmits:f,metadata:E},T=function(k){return YV(k,!0)}(S);y._dataChannels.push(T),b.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published datachannel")),t||this.safeEmit(kt.USER_PUBLISHED,y,"datachannel",S)}this._p2pChannel.hasPendingRemoteDataChannel(y,a.stream_id)&&(b.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(y.uid," after reconnect.")),this._subscribeDataChannel(y,a.stream_id).catch(S=>{b.error("[".concat(this._clientId,"] resubscribe datachannel error"),S.toString())}))}),t&&(this.safeEmit(kt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(a=>{const{uid:l,stream_id:u}=a,h=this._users.find(E=>E._uintid===l);if(!h)return void b.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const f=h._dataChannels.find(E=>E.id===a.stream_id);f&&(b.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(l)),this._p2pChannel.unsubscribeDataChannel(h,[f]).then(E=>{if(h._dataChannels=h._dataChannels.filter(y=>y!==f),E)return this._gateway.unsubscribeDataChannel(E,h.uid)}),b.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished datachannel ,id:").concat(f.id)),this.safeEmit(kt.USER_UNPUBLISHED,h,"datachannel",f._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;const n=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(n)for(const r of n){var i;if(r.payloadType===e)return r==null||(i=r.rtpMap)===null||i===void 0?void 0:i.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){b.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(i=>{this.safeEmit(kt.USER_UNPUBLISHED,t,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,t.uid)}),n()}}else b.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Vi.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void b.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(i=>{const{value:r,type:a,expires:l}=t[i];l&&l<=n||a||KI()||!Object.prototype.hasOwnProperty.call(HR,i)||(zo[i]=r,Ln[i]=r,b.debug("Update gateway parameters from config distribute",i,r))})}catch(t){b.error("Error update config from local cache",t.message)}})()}),this._gateway.on(Vi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Vi.CONNECTION_STATE_CHANGE,(e,t,n)=>{var i;if(n===Qt.FALLBACK)return;const r=()=>{this.safeEmit(kt.CONNECTION_STATE_CHANGE,e,t,n)};if(He.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:si.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Vn.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),b.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void r();if(e==="RECONNECTING")this._users.forEach(l=>{l._trust_in_room_=!1,l._trust_audio_enabled_state_=!1,l._trust_video_enabled_state_=!1,l._trust_audio_mute_state_=!1,l._trust_video_mute_state_=!1,l._trust_audio_stream_added_state_=!1,l._trust_video_stream_added_state_=!1,l._is_pre_created||(l._audio_pre_subscribed||(l._audioSSRC=void 0,l._audioOrtc=void 0),l._video_pre_subscribed||(l._videoSSRC=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),l._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var a;this._streamFallbackTypeCacheMap.forEach((l,u)=>{this._gateway.setStreamFallbackOption(u,l).catch(h=>{b.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),h)})}),this._remoteStreamTypeCacheMap.forEach((l,u)=>{this._gateway.setRemoteVideoStreamType(u,l).catch(h=>{b.warning("[".concat(this._clientId,"] auto set remote stream type failed"),h)})}),this._remoteDefaultVideoStreamType!==void 0&&((a=this._joinInfo)===null||a===void 0?void 0:a.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{b.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(l=>{b.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(l))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(l=>!l._trust_in_room_).forEach(l=>{b.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(l.uid)),this._handleUserOffline({uid:l.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(l=>{l._trust_audio_mute_state_||(b.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(l.uid)),this._handleMuteStream(l.uid,xe.AUDIO,!1)),l._trust_video_mute_state_||(b.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(l.uid)),this._handleMuteStream(l.uid,xe.VIDEO,!1)),l._trust_audio_enabled_state_||(b.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(l.uid)),this._handleSetStreamLocalEnable("audio",l.uid,!0)),l._trust_video_enabled_state_||(b.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(l.uid)),this._handleSetStreamLocalEnable("video",l.uid,!0)),l._trust_video_stream_added_state_||(b.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(l.uid)),this._handleResetAddStream(l,"video")),l._trust_audio_stream_added_state_||(b.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(l.uid)),this._handleResetAddStream(l,"audio")),l._video_added_||l._audio_added_||(b.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(l.uid)),this._handleRemoveStream({uid:l.uid,uint_id:l._uintid}))}))},1e3))}r()}),this._gateway.on(Vi.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new te(x.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await D3(lo(lo({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,L3(i),this._joinInfo.preload=!0):(n=await _N(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||_i,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const r=[];n.gatewayInfo.gatewayAddrs.forEach(a=>{let{address:l}=a;const[u,h]=l.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:u,port:h}):r.push({host:u,port:h})}),e(r)}catch(n){t(n)}}),this._gateway.on(Vi.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(kt.NETWORK_QUALITY,e)}),this._gateway.on(Vi.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(kt.STREAM_TYPE_CHANGED,e,t),He.reportApiInvoke(this._sessionId,{name:si.STREAM_TYPE_CHANGE,options:[e,t],tag:Vn.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Vi.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Vi.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let i=await this._p2pChannel.getEstablishParams();i&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(i=await this._p2pChannel.startP2PConnection(e)),t(i)}catch(i){n(i)}}),this._gateway.on(Vi.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:b.debug("no attributes in joinResponse");const i=PV(e.ortc,t,n);this._p2pChannel.connect(i)}),this._gateway.on(Vi.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n,turnServer:i}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:a,cid:l}=this._joinInfo.apResponse,u="".concat(l,"_").concat(a);if(u.length<4||u.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var r;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(l,"_").concat(a),icePwd:"".concat(l,"_").concat(a)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(r=U("FINGERPRINT"))!==null&&r!==void 0?r:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(h){h.code&&h.code===x.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Pt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Pt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Pt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(Pt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Pt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Pt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Pt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Pt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Pt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,xe.AUDIO,!0)),this._gateway.signal.on(Pt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,xe.AUDIO,!1)),this._gateway.signal.on(Pt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,xe.VIDEO,!0)),this._gateway.signal.on(Pt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,xe.VIDEO,!1)),this._gateway.signal.on(Pt.RECEIVE_METADATA,e=>{const t=Op(e.metadata);this.safeEmit(kt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Pt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=Op(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Re(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<e_)throw new te(x.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(e_));n=await async function(a,l,u){const h=u.subarray(0,e_),f=h.slice(8,e_),E=(f[0]<<8)+f[1],y=(h[6]<<8)+h[7],S=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:a,tagLength:BM,additionalData:new Uint8Array(OM(E,2))},l,u.subarray(e_));return new Uint8Array(S).subarray(0,y)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(e.ordered||e.syncWithAudio){const r=this._p2pChannel.getStats(),a=this.remoteUsers.find(u=>u.uid===e.uid),l=r==null?void 0:r.audioRecv.find(u=>u.ssrc===(a==null?void 0:a._audioSSRC));i=l==null?void 0:l.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),nz(lo(lo({},e),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Pt.ON_CRYPT_ERROR,()=>{ku(()=>{b.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(kt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Pt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{b.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Qt.TOKEN_EXPIRE),this.safeEmit(kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Pt.ON_STREAM_FALLBACK_UPDATE,e=>{b.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(kt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Pt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),b.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Pt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Pt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(lt.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case st.PUBLISH:{if(!t)return;const r=t.ortc;if(r){var n,i;const a=r.some(h=>{let{stream_type:f}=h;return f===tn.Audio}),l=r.some(h=>{let{stream_type:f}=h;return f!==tn.Audio}),u=r.some(h=>{let{stream_type:f}=h;return f===tn.Screen||f===tn.ScreenLow});t.state==="offer"&&He.publish(this._joinInfo.sid,{eventElapse:hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:x.TIMEOUT,audio:a,video:l,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:u,audioName:a?(n=r.find(h=>{let{stream_type:f}=h;return f===tn.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:l?(i=r.find(h=>{let{stream_type:f}=h;return f!==tn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case st.SUBSCRIBE:t&&He.subscribe(this._joinInfo.sid,{succ:!1,ec:x.TIMEOUT,audio:t.stream_type===xe.AUDIO,video:t.stream_type===xe.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:hr.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Pt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Pt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;U("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(i=>!Up(i.string_id||i.stream_id,this.channelName)));const t=[],n=[];for(const i of e.users){let r=this._users.find(E=>E._uintid===i.stream_id);r?r._trust_in_room_=!0:(r=new Wu(i.string_id||i.stream_id,i.stream_id),this._users.push(r),this.store.firstVideoFrameDecoded(r.uid,{userJoinNotify:Date.now()}),this.getListeners(kt.PUBLISHED_USER_LIST).length===0&&(b.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(kt.USER_JOINED,r)));const a=ki.Audio&i.stream_type,l=(ki.Video|ki.LwoVideo)&i.stream_type,u=(65280&i.stream_type)!=0,h=a&&r.hasAudio,f=l&&r.hasVideo;l&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=i.video_ssrc,r._rtxSsrcId=i.video_rtx),a&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=i.audio_ssrc),a&&!h&&this.getListeners(kt.PUBLISHED_USER_LIST).length===0&&(b.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(kt.USER_PUBLISHED,r,"audio")),l&&!f&&this.getListeners(kt.PUBLISHED_USER_LIST).length===0&&(b.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(kt.USER_PUBLISHED,r,"video")),(a&&!h||l&&!f||u)&&t.push(r),l&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&n.push({user:r,mediaType:"video"}),a&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&n.push({user:r,mediaType:"audio"})}n.length>0&&(b.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{b.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(kt.PUBLISHED_USER_LIST).length>0?U("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(b.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(i=>i.uid).join(", "))),this.safeEmit(kt.PUBLISHED_USER_LIST,t)):b.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(Pt.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof cS&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var i;return Re(i=Object.keys(Yy)).call(i,n)}))})}_handleP2PEvents(){this._gateway.signal.on(Pt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(ci.PUBLISH,(e,t,n)=>{const{uid:i}=e;e.forEach(r=>{const{kind:a,ssrcs:l,mid:u,isMuted:h}=r;this._handleP2PAddAudioOrVideoStream(a,i,l[0].ssrcId,u);const f=this._users.find(E=>E.uid===i);return f&&this.store.useP2P?this._p2pChannel.mockSubscribe(f,a,l[0].ssrcId,u).then(()=>{t()}).catch(n):t(),this._handleMuteStream(i,a,!!h)})}),this._gateway.signal.on(ci.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var i;t(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},e))}catch(r){n(r)}}),this._gateway.signal.on(lt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(ci.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:r}=e,a=this._users.find(l=>l.uid===r);if(!a)return b.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void t();try{i.forEach(async l=>{let{stream_type:u}=l;const h=u===tn.Audio?xe.AUDIO:xe.VIDEO;await this._p2pChannel.unsubscribe(a,h),this._handleMuteStream(r,h,!0)}),t()}catch(l){n(l)}}}),this._gateway.signal.on(ci.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case Uu.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,xe.VIDEO,!0);break;case Uu.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,xe.AUDIO,!0);break;case Uu.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,xe.VIDEO,!1);break;case Uu.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,xe.AUDIO,!1)}}),this._gateway.signal.on(ci.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:r}=e;i!==Fr.SEND_ONLY||r?t(await this._p2pChannel.restartICE(i,r)):(this._p2pChannel.handleDisconnect(i),t())}catch(i){n(i)}}),this._gateway.signal.on(ci.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(Xe.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:i}=e;t(await this._gateway.sendExtensionMessage(ci.RESTART_ICE,e,i===Fr.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(Xe.LocalCandidate,e=>{this._gateway.sendExtensionMessage(ci.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Xe.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(ci.CONTROL,e,!0),t()}catch(i){n(i)}}),this._p2pChannel.on(Xe.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===x.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Xe.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===x.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Xe.StateChange,(e,t)=>{t===$t.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Xe.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(kt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Xe.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===x.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Xe.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===x.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Xe.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Xe.RequestRePublishDataChannel,(e,t,n)=>{Ne.all(e.map(async i=>{const r=await this._p2pChannel.publishDataChannel([i]);try{r.forEach(a=>{this._uid&&this._gateway.publishDataChannel(this._uid,a,!0)})}catch(a){if(a.code!==x.DISCONNECT_P2P)throw a}})).then(t).catch(n)}),this._p2pChannel.on(Xe.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:i,kind:r}of e)r===xe.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){n(i)}}),this._p2pChannel.on(Xe.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Xe.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Xe.MediaReconnectStart,e=>{this.safeEmit(kt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Xe.MediaReconnectEnd,e=>{this.safeEmit(kt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Xe.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Xe.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const i=n.value;let r;try{r=await this._gateway.restartICE({iceParameters:i})}catch(l){return void t.throw(l)}const{iceParameters:a}=function(l){const u=l.iceParameters;return{iceParameters:{iceUfrag:u.iceUfrag,icePwd:u.icePwd}}}(r);await t.next({remoteIceParameters:a})}),this._p2pChannel.on(Xe.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Xe.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:r,gatewayAddress:a}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:i}),l=PV(r,a);await this._p2pChannel.connect(l),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Xe.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Xe.P2PLost,()=>{this.safeEmit(kt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Xe.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Xe.ConnectionTypeChange,e=>{this.safeEmit(kt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Xe.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Xe.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Xe.AudioMetadata,e=>{this.safeEmit(kt.AUDIO_METADATA,e)}),this._p2pChannel.on(Xe.AudioPts,e=>{this.safeEmit(kt.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new te(x.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new te(x.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},ld("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:r,sid:a,token:l,uid:u,cid:h,vid:f}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:r,sid:a,token:l,uid:u,cid:h,vid:f?Number(f):0},_i)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(ji.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(kt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===so.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(kt.CONTENT_INSPECT_ERROR,new te(x.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(ji.INSPECT_RESULT,(t,n)=>{var i;if((n==null?void 0:n.code)===x.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return b.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(kt.CONTENT_INSPECT_RESULT,t,n)}),e.on(ji.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new te(x.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Wo(e,"enabled"),e){if(!t)throw new te(x.INVALID_PARAMS,"config is required");if(K3(t),!this._joinInfo)throw new te(x.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const i=(n={config:t},ld("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:r,cname:a,sid:l,token:u,uid:h,cid:f,vid:E}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:a,sid:l,token:u,uid:h,cid:f,vid:E?Number(E):0},_i)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new te(x.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(e){e.on(Xo.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(kt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===ba.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new te(x.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Xo.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){Ai(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new te(x.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,b.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return b.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Wo(e,"enabled"),on("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Be(Le.prototype,"leave",[q3],Object.getOwnPropertyDescriptor(Le.prototype,"leave"),Le.prototype),Be(Le.prototype,"publish",[X3],Object.getOwnPropertyDescriptor(Le.prototype,"publish"),Le.prototype),Be(Le.prototype,"unpublish",[J3],Object.getOwnPropertyDescriptor(Le.prototype,"unpublish"),Le.prototype),Be(Le.prototype,"subscribe",[Z3],Object.getOwnPropertyDescriptor(Le.prototype,"subscribe"),Le.prototype),Be(Le.prototype,"presubscribe",[Q3],Object.getOwnPropertyDescriptor(Le.prototype,"presubscribe"),Le.prototype),Be(Le.prototype,"massSubscribe",[$3],Object.getOwnPropertyDescriptor(Le.prototype,"massSubscribe"),Le.prototype),Be(Le.prototype,"unsubscribe",[e4],Object.getOwnPropertyDescriptor(Le.prototype,"unsubscribe"),Le.prototype),Be(Le.prototype,"massUnsubscribe",[t4],Object.getOwnPropertyDescriptor(Le.prototype,"massUnsubscribe"),Le.prototype),Be(Le.prototype,"setLowStreamParameter",[n4],Object.getOwnPropertyDescriptor(Le.prototype,"setLowStreamParameter"),Le.prototype),Be(Le.prototype,"enableDualStream",[i4],Object.getOwnPropertyDescriptor(Le.prototype,"enableDualStream"),Le.prototype),Be(Le.prototype,"disableDualStream",[r4],Object.getOwnPropertyDescriptor(Le.prototype,"disableDualStream"),Le.prototype),Be(Le.prototype,"setClientRole",[s4],Object.getOwnPropertyDescriptor(Le.prototype,"setClientRole"),Le.prototype),Be(Le.prototype,"_setClientRoleOptions",[a4],Object.getOwnPropertyDescriptor(Le.prototype,"_setClientRoleOptions"),Le.prototype),Be(Le.prototype,"setProxyServer",[o4],Object.getOwnPropertyDescriptor(Le.prototype,"setProxyServer"),Le.prototype),Be(Le.prototype,"setTurnServer",[c4],Object.getOwnPropertyDescriptor(Le.prototype,"setTurnServer"),Le.prototype),Be(Le.prototype,"setLicense",[l4],Object.getOwnPropertyDescriptor(Le.prototype,"setLicense"),Le.prototype),Be(Le.prototype,"startProxyServer",[d4],Object.getOwnPropertyDescriptor(Le.prototype,"startProxyServer"),Le.prototype),Be(Le.prototype,"stopProxyServer",[u4],Object.getOwnPropertyDescriptor(Le.prototype,"stopProxyServer"),Le.prototype),Be(Le.prototype,"setLocalAccessPointsV2",[h4],Object.getOwnPropertyDescriptor(Le.prototype,"setLocalAccessPointsV2"),Le.prototype),Be(Le.prototype,"setLocalAccessPoints",[p4],Object.getOwnPropertyDescriptor(Le.prototype,"setLocalAccessPoints"),Le.prototype),Be(Le.prototype,"setRemoteDefaultVideoStreamType",[f4],Object.getOwnPropertyDescriptor(Le.prototype,"setRemoteDefaultVideoStreamType"),Le.prototype),Be(Le.prototype,"setRemoteVideoStreamType",[m4],Object.getOwnPropertyDescriptor(Le.prototype,"setRemoteVideoStreamType"),Le.prototype),Be(Le.prototype,"setStreamFallbackOption",[_4],Object.getOwnPropertyDescriptor(Le.prototype,"setStreamFallbackOption"),Le.prototype),Be(Le.prototype,"setEncryptionConfig",[E4],Object.getOwnPropertyDescriptor(Le.prototype,"setEncryptionConfig"),Le.prototype),Be(Le.prototype,"renewToken",[g4],Object.getOwnPropertyDescriptor(Le.prototype,"renewToken"),Le.prototype),Be(Le.prototype,"enableAudioVolumeIndicator",[y4],Object.getOwnPropertyDescriptor(Le.prototype,"enableAudioVolumeIndicator"),Le.prototype),Be(Le.prototype,"startLiveStreaming",[S4],Object.getOwnPropertyDescriptor(Le.prototype,"startLiveStreaming"),Le.prototype),Be(Le.prototype,"setLiveTranscoding",[v4],Object.getOwnPropertyDescriptor(Le.prototype,"setLiveTranscoding"),Le.prototype),Be(Le.prototype,"stopLiveStreaming",[T4],Object.getOwnPropertyDescriptor(Le.prototype,"stopLiveStreaming"),Le.prototype),Be(Le.prototype,"startChannelMediaRelay",[R4],Object.getOwnPropertyDescriptor(Le.prototype,"startChannelMediaRelay"),Le.prototype),Be(Le.prototype,"updateChannelMediaRelay",[b4],Object.getOwnPropertyDescriptor(Le.prototype,"updateChannelMediaRelay"),Le.prototype),Be(Le.prototype,"stopChannelMediaRelay",[C4],Object.getOwnPropertyDescriptor(Le.prototype,"stopChannelMediaRelay"),Le.prototype),Be(Le.prototype,"sendCustomReportMessage",[w4],Object.getOwnPropertyDescriptor(Le.prototype,"sendCustomReportMessage"),Le.prototype),Be(Le.prototype,"pickSVCLayer",[A4],Object.getOwnPropertyDescriptor(Le.prototype,"pickSVCLayer"),Le.prototype),Be(Le.prototype,"setRTMConfig",[O4],Object.getOwnPropertyDescriptor(Le.prototype,"setRTMConfig"),Le.prototype),Be(Le.prototype,"enableContentInspect",[I4],Object.getOwnPropertyDescriptor(Le.prototype,"enableContentInspect"),Le.prototype),Be(Le.prototype,"disableContentInspect",[N4],Object.getOwnPropertyDescriptor(Le.prototype,"disableContentInspect"),Le.prototype),Be(Le.prototype,"setImageModeration",[D4],Object.getOwnPropertyDescriptor(Le.prototype,"setImageModeration"),Le.prototype),Be(Le.prototype,"setP2PTransport",[k4],Object.getOwnPropertyDescriptor(Le.prototype,"setP2PTransport"),Le.prototype),Be(Le.prototype,"getJoinChannelServiceRecords",[P4],Object.getOwnPropertyDescriptor(Le.prototype,"getJoinChannelServiceRecords"),Le.prototype),Be(Le.prototype,"setPublishAudioFilterEnabled",[L4],Object.getOwnPropertyDescriptor(Le.prototype,"setPublishAudioFilterEnabled"),Le.prototype),Le);class uS{constructor(t,n){P(this,"id",0),P(this,"element",void 0),P(this,"peerPair",void 0),P(this,"context",void 0),P(this,"audioPlayerElement",void 0),P(this,"audioTrack",void 0),uS.count+=1,this.id=uS.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(i,r)=>{const a=r==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(a),i.iceGatheringState==="complete"?i.localDescription:new Ne(l=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&l(i.localDescription)}})},n=async(i,r)=>await i.setRemoteDescription(r);try{const i=await t(this.peerPair[0],"offer");await n(this.peerPair[1],i);const r=await t(this.peerPair[1],"answer");await n(this.peerPair[0],r)}catch(i){throw new te(x.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(r){throw new te(x.LOCAL_AEC_ERROR,r.toString()).print()}if(!n)throw new te(x.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){b.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var x4,Vb;P(uS,"count",0);const yz=window.AudioContext||window.webkitAudioContext,Sz=new(x4=nt({report:He}),Be((Vb=class{constructor(){P(this,"units",[]),P(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return b.debug("the system does not need to process local aec"),-1;this.context||(this.context=new yz);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new uS(e,this.context),this.units.push(t)),t.startEchoCancellation(),b.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return xt().name!==Wt.SAFARI}}).prototype,"processExternalMediaAEC",[x4],Object.getOwnPropertyDescriptor(Vb.prototype,"processExternalMediaAEC"),Vb.prototype),Vb);function U4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function V4(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?U4(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U4(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const MN=window||document;function j4(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!MN)return;const n=Ei._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const i=r=>{if(!(r&&r.blockedURI&&(Ei.onSecurityPolicyViolation||Ei.getListeners(tl.SECURITY_POLICY_VIOLATION).length>0)))return;const a=r.blockedURI;U("CSP_DETECTED_HOSTNAME_LIST").some(l=>Re(a).call(a,l))&&(Ei.onSecurityPolicyViolation&&typeof Ei.onSecurityPolicyViolation=="function"&&Ei.onSecurityPolicyViolation(r),Ei.getListeners(tl.SECURITY_POLICY_VIOLATION).length>0&&Ei.safeEmit(tl.SECURITY_POLICY_VIOLATION,r))};n&&MN.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||Ei.getListeners(tl.SECURITY_POLICY_VIOLATION).length>0)&&MN.addEventListener("securitypolicyviolation",i),Ei._cspEventHandlerPointer=i}var vz=oe,Tz=v2,F4=RegExp.prototype,Rz=function(e){return e===F4||vz(F4,e)?Tz(e):e.flags},Pr=v(Rz);function w_(e){let t=e.length;for(;--t>=0;)e[t]=0}const xN=256,B4=286,hS=30,pS=15,UN=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),jb=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),bz=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),G4=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ud=new Array(576);w_(ud);const fS=new Array(60);w_(fS);const mS=new Array(512);w_(mS);const _S=new Array(256);w_(_S);const VN=new Array(29);w_(VN);const Fb=new Array(hS);function jN(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}let H4,W4,Y4;function FN(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}w_(Fb);const z4=e=>e<256?mS[e]:mS[256+(e>>>7)],ES=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},aa=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,ES(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},rl=(e,t,n)=>{aa(e,n[2*t],n[2*t+1])},K4=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},q4=(e,t,n)=>{const i=new Array(16);let r,a,l=0;for(r=1;r<=pS;r++)l=l+n[r-1]<<1,i[r]=l;for(a=0;a<=t;a++){let u=e[2*a+1];u!==0&&(e[2*a]=K4(i[u]++,u))}},X4=e=>{let t;for(t=0;t<B4;t++)e.dyn_ltree[2*t]=0;for(t=0;t<hS;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},J4=e=>{e.bi_valid>8?ES(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Z4=(e,t,n,i)=>{const r=2*t,a=2*n;return e[r]<e[a]||e[r]===e[a]&&i[t]<=i[n]},BN=(e,t,n)=>{const i=e.heap[n];let r=n<<1;for(;r<=e.heap_len&&(r<e.heap_len&&Z4(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!Z4(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i},Q4=(e,t,n)=>{let i,r,a,l,u=0;if(e.sym_next!==0)do i=255&e.pending_buf[e.sym_buf+u++],i+=(255&e.pending_buf[e.sym_buf+u++])<<8,r=e.pending_buf[e.sym_buf+u++],i===0?rl(e,r,t):(a=_S[r],rl(e,a+xN+1,t),l=UN[a],l!==0&&(r-=VN[a],aa(e,r,l)),i--,a=z4(i),rl(e,a,n),l=jb[a],l!==0&&(i-=Fb[a],aa(e,i,l)));while(u<e.sym_next);rl(e,256,t)},GN=(e,t)=>{const n=t.dyn_tree,i=t.stat_desc.static_tree,r=t.stat_desc.has_stree,a=t.stat_desc.elems;let l,u,h,f=-1;for(e.heap_len=0,e.heap_max=573,l=0;l<a;l++)n[2*l]!==0?(e.heap[++e.heap_len]=f=l,e.depth[l]=0):n[2*l+1]=0;for(;e.heap_len<2;)h=e.heap[++e.heap_len]=f<2?++f:0,n[2*h]=1,e.depth[h]=0,e.opt_len--,r&&(e.static_len-=i[2*h+1]);for(t.max_code=f,l=e.heap_len>>1;l>=1;l--)BN(e,n,l);h=a;do l=e.heap[1],e.heap[1]=e.heap[e.heap_len--],BN(e,n,1),u=e.heap[1],e.heap[--e.heap_max]=l,e.heap[--e.heap_max]=u,n[2*h]=n[2*l]+n[2*u],e.depth[h]=(e.depth[l]>=e.depth[u]?e.depth[l]:e.depth[u])+1,n[2*l+1]=n[2*u+1]=h,e.heap[1]=h++,BN(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((E,y)=>{const S=y.dyn_tree,T=y.max_code,k=y.stat_desc.static_tree,O=y.stat_desc.has_stree,I=y.stat_desc.extra_bits,M=y.stat_desc.extra_base,L=y.stat_desc.max_length;let j,K,z,H,Z,se,ue=0;for(H=0;H<=pS;H++)E.bl_count[H]=0;for(S[2*E.heap[E.heap_max]+1]=0,j=E.heap_max+1;j<573;j++)K=E.heap[j],H=S[2*S[2*K+1]+1]+1,H>L&&(H=L,ue++),S[2*K+1]=H,K>T||(E.bl_count[H]++,Z=0,K>=M&&(Z=I[K-M]),se=S[2*K],E.opt_len+=se*(H+Z),O&&(E.static_len+=se*(k[2*K+1]+Z)));if(ue!==0){do{for(H=L-1;E.bl_count[H]===0;)H--;E.bl_count[H]--,E.bl_count[H+1]+=2,E.bl_count[L]--,ue-=2}while(ue>0);for(H=L;H!==0;H--)for(K=E.bl_count[H];K!==0;)z=E.heap[--j],z>T||(S[2*z+1]!==H&&(E.opt_len+=(H-S[2*z+1])*S[2*z],S[2*z+1]=H),K--)}})(e,t),q4(n,f,e.bl_count)},$4=(e,t,n)=>{let i,r,a=-1,l=t[1],u=0,h=7,f=4;for(l===0&&(h=138,f=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=l,l=t[2*(i+1)+1],++u<h&&r===l||(u<f?e.bl_tree[2*r]+=u:r!==0?(r!==a&&e.bl_tree[2*r]++,e.bl_tree[32]++):u<=10?e.bl_tree[34]++:e.bl_tree[36]++,u=0,a=r,l===0?(h=138,f=3):r===l?(h=6,f=3):(h=7,f=4))},e5=(e,t,n)=>{let i,r,a=-1,l=t[1],u=0,h=7,f=4;for(l===0&&(h=138,f=3),i=0;i<=n;i++)if(r=l,l=t[2*(i+1)+1],!(++u<h&&r===l)){if(u<f)do rl(e,r,e.bl_tree);while(--u!=0);else r!==0?(r!==a&&(rl(e,r,e.bl_tree),u--),rl(e,16,e.bl_tree),aa(e,u-3,2)):u<=10?(rl(e,17,e.bl_tree),aa(e,u-3,3)):(rl(e,18,e.bl_tree),aa(e,u-11,7));u=0,a=r,l===0?(h=138,f=3):r===l?(h=6,f=3):(h=7,f=4)}};let t5=!1;const n5=(e,t,n,i)=>{aa(e,0+(i?1:0),3),J4(e),ES(e,n),ES(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var Cz=e=>{t5||((()=>{let t,n,i,r,a;const l=new Array(16);for(i=0,r=0;r<28;r++)for(VN[r]=i,t=0;t<1<<UN[r];t++)_S[i++]=r;for(_S[i-1]=r,a=0,r=0;r<16;r++)for(Fb[r]=a,t=0;t<1<<jb[r];t++)mS[a++]=r;for(a>>=7;r<hS;r++)for(Fb[r]=a<<7,t=0;t<1<<jb[r]-7;t++)mS[256+a++]=r;for(n=0;n<=pS;n++)l[n]=0;for(t=0;t<=143;)ud[2*t+1]=8,t++,l[8]++;for(;t<=255;)ud[2*t+1]=9,t++,l[9]++;for(;t<=279;)ud[2*t+1]=7,t++,l[7]++;for(;t<=287;)ud[2*t+1]=8,t++,l[8]++;for(q4(ud,287,l),t=0;t<hS;t++)fS[2*t+1]=5,fS[2*t]=K4(t,5);H4=new jN(ud,UN,257,B4,pS),W4=new jN(fS,jb,0,hS,pS),Y4=new jN(new Array(0),bz,0,19,7)})(),t5=!0),e.l_desc=new FN(e.dyn_ltree,H4),e.d_desc=new FN(e.dyn_dtree,W4),e.bl_desc=new FN(e.bl_tree,Y4),e.bi_buf=0,e.bi_valid=0,X4(e)},wz=(e,t,n,i)=>{let r,a,l=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(u=>{let h,f=4093624447;for(h=0;h<=31;h++,f>>>=1)if(1&f&&u.dyn_ltree[2*h]!==0)return 0;if(u.dyn_ltree[18]!==0||u.dyn_ltree[20]!==0||u.dyn_ltree[26]!==0)return 1;for(h=32;h<xN;h++)if(u.dyn_ltree[2*h]!==0)return 1;return 0})(e)),GN(e,e.l_desc),GN(e,e.d_desc),l=(u=>{let h;for($4(u,u.dyn_ltree,u.l_desc.max_code),$4(u,u.dyn_dtree,u.d_desc.max_code),GN(u,u.bl_desc),h=18;h>=3&&u.bl_tree[2*G4[h]+1]===0;h--);return u.opt_len+=3*(h+1)+5+5+4,h})(e),r=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=r&&(r=a)):r=a=n+5,n+4<=r&&t!==-1?n5(e,t,n,i):e.strategy===4||a===r?(aa(e,2+(i?1:0),3),Q4(e,ud,fS)):(aa(e,4+(i?1:0),3),((u,h,f,E)=>{let y;for(aa(u,h-257,5),aa(u,f-1,5),aa(u,E-4,4),y=0;y<E;y++)aa(u,u.bl_tree[2*G4[y]+1],3);e5(u,u.dyn_ltree,h-1),e5(u,u.dyn_dtree,f-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),Q4(e,e.dyn_ltree,e.dyn_dtree)),X4(e),i&&J4(e)},Az=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(_S[n]+xN+1)]++,e.dyn_dtree[2*z4(t)]++),e.sym_next===e.sym_end),Oz=e=>{aa(e,2,3),rl(e,256,ud),(t=>{t.bi_valid===16?(ES(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Iz={_tr_init:Cz,_tr_stored_block:n5,_tr_flush_block:wz,_tr_tally:Az,_tr_align:Oz},gS=(e,t,n,i)=>{let r=65535&e|0,a=e>>>16&65535|0,l=0;for(;n!==0;){l=n>2e3?2e3:n,n-=l;do r=r+t[i++]|0,a=a+r|0;while(--l);r%=65521,a%=65521}return r|a<<16|0};const Nz=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Gr=(e,t,n,i)=>{const r=Nz,a=i+n;e^=-1;for(let l=i;l<a;l++)e=e>>>8^r[255&(e^t[l])];return-1^e},Hp={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Bb={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Dz,_tr_stored_block:HN,_tr_flush_block:kz,_tr_tally:qu,_tr_align:Pz}=Iz,{Z_NO_FLUSH:Xu,Z_PARTIAL_FLUSH:Lz,Z_FULL_FLUSH:Mz,Z_FINISH:uo,Z_BLOCK:i5,Z_OK:ts,Z_STREAM_END:r5,Z_STREAM_ERROR:sl,Z_DATA_ERROR:xz,Z_BUF_ERROR:WN,Z_DEFAULT_COMPRESSION:Uz,Z_FILTERED:Vz,Z_HUFFMAN_ONLY:Gb,Z_RLE:jz,Z_FIXED:Fz,Z_DEFAULT_STRATEGY:Bz,Z_UNKNOWN:Gz,Z_DEFLATED:Hb}=Bb,YN=286,Hz=30,Wz=19,Yz=2*YN+1,zz=15,Wp=258,al=262,A_=42,Yp=113,yS=666,zp=(e,t)=>(e.msg=Hp[t],t),s5=e=>2*e-(e>4?9:0),Ju=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Kz=e=>{let t,n,i,r=e.w_size;t=e.hash_size,i=t;do n=e.head[--i],e.head[i]=n>=r?n-r:0;while(--t);t=r,i=t;do n=e.prev[--i],e.prev[i]=n>=r?n-r:0;while(--t)};let Zu=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const wa=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},Aa=(e,t)=>{kz(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,wa(e.strm)},ai=(e,t)=>{e.pending_buf[e.pending++]=t},SS=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},zN=(e,t,n,i)=>{let r=e.avail_in;return r>i&&(r=i),r===0?0:(e.avail_in-=r,t.set(e.input.subarray(e.next_in,e.next_in+r),n),e.state.wrap===1?e.adler=gS(e.adler,t,r,n):e.state.wrap===2&&(e.adler=Gr(e.adler,t,r,n)),e.next_in+=r,e.total_in+=r,r)},a5=(e,t)=>{let n,i,r=e.max_chain_length,a=e.strstart,l=e.prev_length,u=e.nice_match;const h=e.strstart>e.w_size-al?e.strstart-(e.w_size-al):0,f=e.window,E=e.w_mask,y=e.prev,S=e.strstart+Wp;let T=f[a+l-1],k=f[a+l];e.prev_length>=e.good_match&&(r>>=2),u>e.lookahead&&(u=e.lookahead);do if(n=t,f[n+l]===k&&f[n+l-1]===T&&f[n]===f[a]&&f[++n]===f[a+1]){a+=2,n++;do;while(f[++a]===f[++n]&&f[++a]===f[++n]&&f[++a]===f[++n]&&f[++a]===f[++n]&&f[++a]===f[++n]&&f[++a]===f[++n]&&f[++a]===f[++n]&&f[++a]===f[++n]&&a<S);if(i=Wp-(S-a),a=S-Wp,i>l){if(e.match_start=t,l=i,i>=u)break;T=f[a+l-1],k=f[a+l]}}while((t=y[t&E])>h&&--r!=0);return l<=e.lookahead?l:e.lookahead},O_=e=>{const t=e.w_size;let n,i,r;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-al)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Kz(e),i+=t),e.strm.avail_in===0)break;if(n=zN(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=Zu(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=Zu(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<al&&e.strm.avail_in!==0)},o5=(e,t)=>{let n,i,r,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,l=0,u=e.strm.avail_in;do{if(n=65535,r=e.bi_valid+42>>3,e.strm.avail_out<r||(r=e.strm.avail_out-r,i=e.strstart-e.block_start,n>i+e.strm.avail_in&&(n=i+e.strm.avail_in),n>r&&(n=r),n<a&&(n===0&&t!==uo||t===Xu||n!==i+e.strm.avail_in)))break;l=t===uo&&n===i+e.strm.avail_in?1:0,HN(e,0,0,l),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,wa(e.strm),i&&(i>n&&(i=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,n-=i),n&&(zN(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(l===0);return u-=e.strm.avail_in,u&&(u>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=u&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-u,e.strm.next_in),e.strstart),e.strstart+=u,e.insert+=u>e.w_size-e.insert?e.w_size-e.insert:u),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),l?4:t!==Xu&&t!==uo&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(r=e.window_size-e.strstart,e.strm.avail_in>r&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,r+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),r>e.strm.avail_in&&(r=e.strm.avail_in),r&&(zN(e.strm,e.window,e.strstart,r),e.strstart+=r,e.insert+=r>e.w_size-e.insert?e.w_size-e.insert:r),e.high_water<e.strstart&&(e.high_water=e.strstart),r=e.bi_valid+42>>3,r=e.pending_buf_size-r>65535?65535:e.pending_buf_size-r,a=r>e.w_size?e.w_size:r,i=e.strstart-e.block_start,(i>=a||(i||t===uo)&&t!==Xu&&e.strm.avail_in===0&&i<=r)&&(n=i>r?r:i,l=t===uo&&e.strm.avail_in===0&&n===i?1:0,HN(e,e.block_start,n,l),e.block_start+=n,wa(e.strm)),l?3:1)},KN=(e,t)=>{let n,i;for(;;){if(e.lookahead<al){if(O_(e),e.lookahead<al&&t===Xu)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Zu(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-al&&(e.match_length=a5(e,n)),e.match_length>=3)if(i=qu(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Zu(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Zu(e,e.ins_h,e.window[e.strstart+1]);else i=qu(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Aa(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===uo?(Aa(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Aa(e,!1),e.strm.avail_out===0)?1:2},I_=(e,t)=>{let n,i,r;for(;;){if(e.lookahead<al){if(O_(e),e.lookahead<al&&t===Xu)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Zu(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-al&&(e.match_length=a5(e,n),e.match_length<=5&&(e.strategy===Vz||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,i=qu(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=r&&(e.ins_h=Zu(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Aa(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(i=qu(e,0,e.window[e.strstart-1]),i&&Aa(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=qu(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===uo?(Aa(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Aa(e,!1),e.strm.avail_out===0)?1:2};function ol(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}const vS=[new ol(0,0,0,0,o5),new ol(4,4,8,4,KN),new ol(4,5,16,8,KN),new ol(4,6,32,32,KN),new ol(4,4,16,16,I_),new ol(8,16,32,32,I_),new ol(8,16,128,128,I_),new ol(8,32,128,256,I_),new ol(32,128,258,1024,I_),new ol(32,258,258,4096,I_)];function qz(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Hb,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Yz),this.dyn_dtree=new Uint16Array(2*(2*Hz+1)),this.bl_tree=new Uint16Array(2*(2*Wz+1)),Ju(this.dyn_ltree),Ju(this.dyn_dtree),Ju(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(zz+1),this.heap=new Uint16Array(2*YN+1),Ju(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*YN+1),Ju(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const TS=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==A_&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Yp&&t.status!==yS?1:0},c5=e=>{if(TS(e))return zp(e,sl);e.total_in=e.total_out=0,e.data_type=Gz;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?A_:Yp,e.adler=t.wrap===2?0:1,t.last_flush=-2,Dz(t),ts},l5=e=>{const t=c5(e);return t===ts&&(n=>{n.window_size=2*n.w_size,Ju(n.head),n.max_lazy_match=vS[n.level].max_lazy,n.good_match=vS[n.level].good_length,n.nice_match=vS[n.level].nice_length,n.max_chain_length=vS[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},d5=(e,t,n,i,r,a)=>{if(!e)return sl;let l=1;if(t===Uz&&(t=6),i<0?(l=0,i=-i):i>15&&(l=2,i-=16),r<1||r>9||n!==Hb||i<8||i>15||t<0||t>9||a<0||a>Fz||i===8&&l!==1)return zp(e,sl);i===8&&(i=9);const u=new qz;return e.state=u,u.strm=e,u.status=A_,u.wrap=l,u.gzhead=null,u.w_bits=i,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=r+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new Uint8Array(2*u.w_size),u.head=new Uint16Array(u.hash_size),u.prev=new Uint16Array(u.w_size),u.lit_bufsize=1<<r+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new Uint8Array(u.pending_buf_size),u.sym_buf=u.lit_bufsize,u.sym_end=3*(u.lit_bufsize-1),u.level=t,u.strategy=a,u.method=n,l5(e)};var Xz=(e,t)=>{if(TS(e)||t>i5||t<0)return e?zp(e,sl):sl;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===yS&&t!==uo)return zp(e,e.avail_out===0?WN:sl);const i=n.last_flush;if(n.last_flush=t,n.pending!==0){if(wa(e),e.avail_out===0)return n.last_flush=-1,ts}else if(e.avail_in===0&&s5(t)<=s5(i)&&t!==uo)return zp(e,WN);if(n.status===yS&&e.avail_in!==0)return zp(e,WN);if(n.status===A_&&n.wrap===0&&(n.status=Yp),n.status===A_){let r=Hb+(n.w_bits-8<<4)<<8,a=-1;if(a=n.strategy>=Gb||n.level<2?0:n.level<6?1:n.level===6?2:3,r|=a<<6,n.strstart!==0&&(r|=32),r+=31-r%31,SS(n,r),n.strstart!==0&&(SS(n,e.adler>>>16),SS(n,65535&e.adler)),e.adler=1,n.status=Yp,wa(e),n.pending!==0)return n.last_flush=-1,ts}if(n.status===57){if(e.adler=0,ai(n,31),ai(n,139),ai(n,8),n.gzhead)ai(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),ai(n,255&n.gzhead.time),ai(n,n.gzhead.time>>8&255),ai(n,n.gzhead.time>>16&255),ai(n,n.gzhead.time>>24&255),ai(n,n.level===9?2:n.strategy>=Gb||n.level<2?4:0),ai(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(ai(n,255&n.gzhead.extra.length),ai(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Gr(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(ai(n,0),ai(n,0),ai(n,0),ai(n,0),ai(n,0),ai(n,n.level===9?2:n.strategy>=Gb||n.level<2?4:0),ai(n,3),n.status=Yp,wa(e),n.pending!==0)return n.last_flush=-1,ts}if(n.status===69){if(n.gzhead.extra){let r=n.pending,a=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+a>n.pending_buf_size;){let u=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+u),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>r&&(e.adler=Gr(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex+=u,wa(e),n.pending!==0)return n.last_flush=-1,ts;r=0,a-=u}let l=new Uint8Array(n.gzhead.extra);n.pending_buf.set(l.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending+=a,n.gzhead.hcrc&&n.pending>r&&(e.adler=Gr(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let r,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(e.adler=Gr(e.adler,n.pending_buf,n.pending-a,a)),wa(e),n.pending!==0)return n.last_flush=-1,ts;a=0}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,ai(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>a&&(e.adler=Gr(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let r,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(e.adler=Gr(e.adler,n.pending_buf,n.pending-a,a)),wa(e),n.pending!==0)return n.last_flush=-1,ts;a=0}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,ai(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>a&&(e.adler=Gr(e.adler,n.pending_buf,n.pending-a,a))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(wa(e),n.pending!==0))return n.last_flush=-1,ts;ai(n,255&e.adler),ai(n,e.adler>>8&255),e.adler=0}if(n.status=Yp,wa(e),n.pending!==0)return n.last_flush=-1,ts}if(e.avail_in!==0||n.lookahead!==0||t!==Xu&&n.status!==yS){let r=n.level===0?o5(n,t):n.strategy===Gb?((a,l)=>{let u;for(;;){if(a.lookahead===0&&(O_(a),a.lookahead===0)){if(l===Xu)return 1;break}if(a.match_length=0,u=qu(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,u&&(Aa(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,l===uo?(Aa(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(Aa(a,!1),a.strm.avail_out===0)?1:2})(n,t):n.strategy===jz?((a,l)=>{let u,h,f,E;const y=a.window;for(;;){if(a.lookahead<=Wp){if(O_(a),a.lookahead<=Wp&&l===Xu)return 1;if(a.lookahead===0)break}if(a.match_length=0,a.lookahead>=3&&a.strstart>0&&(f=a.strstart-1,h=y[f],h===y[++f]&&h===y[++f]&&h===y[++f])){E=a.strstart+Wp;do;while(h===y[++f]&&h===y[++f]&&h===y[++f]&&h===y[++f]&&h===y[++f]&&h===y[++f]&&h===y[++f]&&h===y[++f]&&f<E);a.match_length=Wp-(E-f),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=3?(u=qu(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(u=qu(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),u&&(Aa(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,l===uo?(Aa(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(Aa(a,!1),a.strm.avail_out===0)?1:2})(n,t):vS[n.level].func(n,t);if(r!==3&&r!==4||(n.status=yS),r===1||r===3)return e.avail_out===0&&(n.last_flush=-1),ts;if(r===2&&(t===Lz?Pz(n):t!==i5&&(HN(n,0,0,!1),t===Mz&&(Ju(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),wa(e),e.avail_out===0))return n.last_flush=-1,ts}return t!==uo?ts:n.wrap<=0?r5:(n.wrap===2?(ai(n,255&e.adler),ai(n,e.adler>>8&255),ai(n,e.adler>>16&255),ai(n,e.adler>>24&255),ai(n,255&e.total_in),ai(n,e.total_in>>8&255),ai(n,e.total_in>>16&255),ai(n,e.total_in>>24&255)):(SS(n,e.adler>>>16),SS(n,65535&e.adler)),wa(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?ts:r5)},Jz=(e,t)=>{let n=t.length;if(TS(e))return sl;const i=e.state,r=i.wrap;if(r===2||r===1&&i.status!==A_||i.lookahead)return sl;if(r===1&&(e.adler=gS(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){r===0&&(Ju(i.head),i.strstart=0,i.block_start=0,i.insert=0);let h=new Uint8Array(i.w_size);h.set(t.subarray(n-i.w_size,n),0),t=h,n=i.w_size}const a=e.avail_in,l=e.next_in,u=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,O_(i);i.lookahead>=3;){let h=i.strstart,f=i.lookahead-2;do i.ins_h=Zu(i,i.ins_h,i.window[h+3-1]),i.prev[h&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=h,h++;while(--f);i.strstart=h,i.lookahead=2,O_(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=l,e.input=u,e.avail_in=a,i.wrap=r,ts},RS={deflateInit:(e,t)=>d5(e,t,Hb,15,8,Bz),deflateInit2:d5,deflateReset:l5,deflateResetKeep:c5,deflateSetHeader:(e,t)=>TS(e)||e.state.wrap!==2?sl:(e.state.gzhead=t,ts),deflate:Xz,deflateEnd:e=>{if(TS(e))return sl;const t=e.state.status;return e.state=null,t===Yp?zp(e,xz):ts},deflateSetDictionary:Jz,deflateInfo:"pako deflate (from Nodeca project)"};const Zz=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Wb={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)Zz(n,i)&&(e[i]=n[i])}}return e},flattenChunks:e=>{let t=0;for(let i=0,r=e.length;i<r;i++)t+=e[i].length;const n=new Uint8Array(t);for(let i=0,r=0,a=e.length;i<a;i++){let l=e[i];n.set(l,r),r+=l.length}return n}};let u5=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{u5=!1}const bS=new Uint8Array(256);for(let e=0;e<256;e++)bS[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;bS[254]=bS[254]=1;var CS={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,i,r,a,l=e.length,u=0;for(r=0;r<l;r++)n=e.charCodeAt(r),(64512&n)==55296&&r+1<l&&(i=e.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),u+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(u),a=0,r=0;a<u;r++)n=e.charCodeAt(r),(64512&n)==55296&&r+1<l&&(i=e.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let i,r;const a=new Array(2*n);for(r=0,i=0;i<n;){let l=e[i++];if(l<128){a[r++]=l;continue}let u=bS[l];if(u>4)a[r++]=65533,i+=u-1;else{for(l&=u===2?31:u===3?15:7;u>1&&i<n;)l=l<<6|63&e[i++],u--;u>1?a[r++]=65533:l<65536?a[r++]=l:(l-=65536,a[r++]=55296|l>>10&1023,a[r++]=56320|1023&l)}}return((l,u)=>{if(u<65534&&l.subarray&&u5)return String.fromCharCode.apply(null,l.length===u?l:l.subarray(0,u));let h="";for(let f=0;f<u;f++)h+=String.fromCharCode(l[f]);return h})(a,r)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+bS[e[n]]>t?n:t}},h5=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const p5=Object.prototype.toString,{Z_NO_FLUSH:Qz,Z_SYNC_FLUSH:$z,Z_FULL_FLUSH:eK,Z_FINISH:tK,Z_OK:Yb,Z_STREAM_END:nK,Z_DEFAULT_COMPRESSION:iK,Z_DEFAULT_STRATEGY:rK,Z_DEFLATED:sK}=Bb;function zb(e){this.options=Wb.assign({level:iK,method:sK,chunkSize:16384,windowBits:15,memLevel:8,strategy:rK},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h5,this.strm.avail_out=0;let n=RS.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Yb)throw new Error(Hp[n]);if(t.header&&RS.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?CS.string2buf(t.dictionary):p5.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=RS.deflateSetDictionary(this.strm,i),n!==Yb)throw new Error(Hp[n]);this._dict_set=!0}}function aK(e,t){const n=new zb(t);if(n.push(e,!0),n.err)throw n.msg||Hp[n.err];return n.result}zb.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize;let r,a;if(this.ended)return!1;for(a=t===~~t?t:t===!0?tK:Qz,typeof e=="string"?n.input=CS.string2buf(e):p5.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(a===$z||a===eK)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=RS.deflate(n,a),r===nK)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=RS.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Yb;if(n.avail_out!==0){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},zb.prototype.onData=function(e){this.chunks.push(e)},zb.prototype.onEnd=function(e){e===Yb&&(this.result=Wb.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var oK={deflate:aK};const Kb=16209;var cK=function(e,t){let n,i,r,a,l,u,h,f,E,y,S,T,k,O,I,M,L,j,K,z,H,Z,se,ue;const Ee=e.state;n=e.next_in,se=e.input,i=n+(e.avail_in-5),r=e.next_out,ue=e.output,a=r-(t-e.avail_out),l=r+(e.avail_out-257),u=Ee.dmax,h=Ee.wsize,f=Ee.whave,E=Ee.wnext,y=Ee.window,S=Ee.hold,T=Ee.bits,k=Ee.lencode,O=Ee.distcode,I=(1<<Ee.lenbits)-1,M=(1<<Ee.distbits)-1;e:do{T<15&&(S+=se[n++]<<T,T+=8,S+=se[n++]<<T,T+=8),L=k[S&I];t:for(;;){if(j=L>>>24,S>>>=j,T-=j,j=L>>>16&255,j===0)ue[r++]=65535&L;else{if(!(16&j)){if((64&j)==0){L=k[(65535&L)+(S&(1<<j)-1)];continue t}if(32&j){Ee.mode=16191;break e}e.msg="invalid literal/length code",Ee.mode=Kb;break e}K=65535&L,j&=15,j&&(T<j&&(S+=se[n++]<<T,T+=8),K+=S&(1<<j)-1,S>>>=j,T-=j),T<15&&(S+=se[n++]<<T,T+=8,S+=se[n++]<<T,T+=8),L=O[S&M];n:for(;;){if(j=L>>>24,S>>>=j,T-=j,j=L>>>16&255,!(16&j)){if((64&j)==0){L=O[(65535&L)+(S&(1<<j)-1)];continue n}e.msg="invalid distance code",Ee.mode=Kb;break e}if(z=65535&L,j&=15,T<j&&(S+=se[n++]<<T,T+=8,T<j&&(S+=se[n++]<<T,T+=8)),z+=S&(1<<j)-1,z>u){e.msg="invalid distance too far back",Ee.mode=Kb;break e}if(S>>>=j,T-=j,j=r-a,z>j){if(j=z-j,j>f&&Ee.sane){e.msg="invalid distance too far back",Ee.mode=Kb;break e}if(H=0,Z=y,E===0){if(H+=h-j,j<K){K-=j;do ue[r++]=y[H++];while(--j);H=r-z,Z=ue}}else if(E<j){if(H+=h+E-j,j-=E,j<K){K-=j;do ue[r++]=y[H++];while(--j);if(H=0,E<K){j=E,K-=j;do ue[r++]=y[H++];while(--j);H=r-z,Z=ue}}}else if(H+=E-j,j<K){K-=j;do ue[r++]=y[H++];while(--j);H=r-z,Z=ue}for(;K>2;)ue[r++]=Z[H++],ue[r++]=Z[H++],ue[r++]=Z[H++],K-=3;K&&(ue[r++]=Z[H++],K>1&&(ue[r++]=Z[H++]))}else{H=r-z;do ue[r++]=ue[H++],ue[r++]=ue[H++],ue[r++]=ue[H++],K-=3;while(K>2);K&&(ue[r++]=ue[H++],K>1&&(ue[r++]=ue[H++]))}break}}break}}while(n<i&&r<l);K=T>>3,n-=K,T-=K<<3,S&=(1<<T)-1,e.next_in=n,e.next_out=r,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=r<l?l-r+257:257-(r-l),Ee.hold=S,Ee.bits=T};const qb=15,lK=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),dK=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),uK=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),hK=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var wS=(e,t,n,i,r,a,l,u)=>{const h=u.bits;let f,E,y,S,T,k,O=0,I=0,M=0,L=0,j=0,K=0,z=0,H=0,Z=0,se=0,ue=null;const Ee=new Uint16Array(16),Rt=new Uint16Array(16);let At,ot,Kt,Yt=null;for(O=0;O<=qb;O++)Ee[O]=0;for(I=0;I<i;I++)Ee[t[n+I]]++;for(j=h,L=qb;L>=1&&Ee[L]===0;L--);if(j>L&&(j=L),L===0)return r[a++]=20971520,r[a++]=20971520,u.bits=1,0;for(M=1;M<L&&Ee[M]===0;M++);for(j<M&&(j=M),H=1,O=1;O<=qb;O++)if(H<<=1,H-=Ee[O],H<0)return-1;if(H>0&&(e===0||L!==1))return-1;for(Rt[1]=0,O=1;O<qb;O++)Rt[O+1]=Rt[O]+Ee[O];for(I=0;I<i;I++)t[n+I]!==0&&(l[Rt[t[n+I]]++]=I);if(e===0?(ue=Yt=l,k=20):e===1?(ue=lK,Yt=dK,k=257):(ue=uK,Yt=hK,k=0),se=0,I=0,O=M,T=a,K=j,z=0,y=-1,Z=1<<j,S=Z-1,e===1&&Z>852||e===2&&Z>592)return 1;for(;;){At=O-z,l[I]+1<k?(ot=0,Kt=l[I]):l[I]>=k?(ot=Yt[l[I]-k],Kt=ue[l[I]-k]):(ot=96,Kt=0),f=1<<O-z,E=1<<K,M=E;do E-=f,r[T+(se>>z)+E]=At<<24|ot<<16|Kt|0;while(E!==0);for(f=1<<O-1;se&f;)f>>=1;if(f!==0?(se&=f-1,se+=f):se=0,I++,--Ee[O]==0){if(O===L)break;O=t[n+l[I]]}if(O>j&&(se&S)!==y){for(z===0&&(z=j),T+=M,K=O-z,H=1<<K;K+z<L&&(H-=Ee[K+z],!(H<=0));)K++,H<<=1;if(Z+=1<<K,e===1&&Z>852||e===2&&Z>592)return 1;y=se&S,r[y]=j<<24|K<<16|T-a|0}}return se!==0&&(r[T+se]=O-z<<24|64<<16|0),u.bits=j,0};const{Z_FINISH:f5,Z_BLOCK:pK,Z_TREES:Xb,Z_OK:Kp,Z_STREAM_END:fK,Z_NEED_DICT:mK,Z_STREAM_ERROR:ho,Z_DATA_ERROR:m5,Z_MEM_ERROR:_5,Z_BUF_ERROR:_K,Z_DEFLATED:E5}=Bb,Jb=16180,Zb=16190,hd=16191,qN=16192,XN=16194,Qb=16199,$b=16200,JN=16206,Fi=16209,g5=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function EK(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const qp=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Jb||t.mode>16211?1:0},y5=e=>{if(qp(e))return ho;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Jb,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Kp},S5=e=>{if(qp(e))return ho;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,y5(e)},v5=(e,t)=>{let n;if(qp(e))return ho;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ho:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,S5(e))},T5=(e,t)=>{if(!e)return ho;const n=new EK;e.state=n,n.strm=e,n.window=null,n.mode=Jb;const i=v5(e,t);return i!==Kp&&(e.state=null),i};let ZN,QN,R5=!0;const gK=e=>{if(R5){ZN=new Int32Array(512),QN=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(wS(1,e.lens,0,288,ZN,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;wS(2,e.lens,0,32,QN,0,e.work,{bits:5}),R5=!1}e.lencode=ZN,e.lenbits=9,e.distcode=QN,e.distbits=5},b5=(e,t,n,i)=>{let r;const a=e.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(r=a.wsize-a.wnext,r>i&&(r=i),a.window.set(t.subarray(n-i,n-i+r),a.wnext),(i-=r)?(a.window.set(t.subarray(n-i,n),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0};var yK=(e,t)=>{let n,i,r,a,l,u,h,f,E,y,S,T,k,O,I,M,L,j,K,z,H,Z,se=0;const ue=new Uint8Array(4);let Ee,Rt;const At=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(qp(e)||!e.output||!e.input&&e.avail_in!==0)return ho;n=e.state,n.mode===hd&&(n.mode=qN),l=e.next_out,r=e.output,h=e.avail_out,a=e.next_in,i=e.input,u=e.avail_in,f=n.hold,E=n.bits,y=u,S=h,Z=Kp;e:for(;;)switch(n.mode){case Jb:if(n.wrap===0){n.mode=qN;break}for(;E<16;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}if(2&n.wrap&&f===35615){n.wbits===0&&(n.wbits=15),n.check=0,ue[0]=255&f,ue[1]=f>>>8&255,n.check=Gr(n.check,ue,2,0),f=0,E=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",n.mode=Fi;break}if((15&f)!==E5){e.msg="unknown compression method",n.mode=Fi;break}if(f>>>=4,E-=4,H=8+(15&f),n.wbits===0&&(n.wbits=H),H>15||H>n.wbits){e.msg="invalid window size",n.mode=Fi;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&f?16189:hd,f=0,E=0;break;case 16181:for(;E<16;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}if(n.flags=f,(255&Pr(n))!==E5){e.msg="unknown compression method",n.mode=Fi;break}if(57344&Pr(n)){e.msg="unknown header flags set",n.mode=Fi;break}n.head&&(n.head.text=f>>8&1),512&Pr(n)&&4&n.wrap&&(ue[0]=255&f,ue[1]=f>>>8&255,n.check=Gr(n.check,ue,2,0)),f=0,E=0,n.mode=16182;case 16182:for(;E<32;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}n.head&&(n.head.time=f),512&Pr(n)&&4&n.wrap&&(ue[0]=255&f,ue[1]=f>>>8&255,ue[2]=f>>>16&255,ue[3]=f>>>24&255,n.check=Gr(n.check,ue,4,0)),f=0,E=0,n.mode=16183;case 16183:for(;E<16;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}n.head&&(n.head.xflags=255&f,n.head.os=f>>8),512&Pr(n)&&4&n.wrap&&(ue[0]=255&f,ue[1]=f>>>8&255,n.check=Gr(n.check,ue,2,0)),f=0,E=0,n.mode=16184;case 16184:if(1024&Pr(n)){for(;E<16;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}n.length=f,n.head&&(n.head.extra_len=f),512&Pr(n)&&4&n.wrap&&(ue[0]=255&f,ue[1]=f>>>8&255,n.check=Gr(n.check,ue,2,0)),f=0,E=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&Pr(n)&&(T=n.length,T>u&&(T=u),T&&(n.head&&(H=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(a,a+T),H)),512&Pr(n)&&4&n.wrap&&(n.check=Gr(n.check,i,T,a)),u-=T,a+=T,n.length-=T),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&Pr(n)){if(u===0)break e;T=0;do H=i[a+T++],n.head&&H&&n.length<65536&&(n.head.name+=String.fromCharCode(H));while(H&&T<u);if(512&Pr(n)&&4&n.wrap&&(n.check=Gr(n.check,i,T,a)),u-=T,a+=T,H)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&Pr(n)){if(u===0)break e;T=0;do H=i[a+T++],n.head&&H&&n.length<65536&&(n.head.comment+=String.fromCharCode(H));while(H&&T<u);if(512&Pr(n)&&4&n.wrap&&(n.check=Gr(n.check,i,T,a)),u-=T,a+=T,H)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&Pr(n)){for(;E<16;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}if(4&n.wrap&&f!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Fi;break}f=0,E=0}n.head&&(n.head.hcrc=Pr(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=hd;break;case 16189:for(;E<32;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}e.adler=n.check=g5(f),f=0,E=0,n.mode=Zb;case Zb:if(n.havedict===0)return e.next_out=l,e.avail_out=h,e.next_in=a,e.avail_in=u,n.hold=f,n.bits=E,mK;e.adler=n.check=1,n.mode=hd;case hd:if(t===pK||t===Xb)break e;case qN:if(n.last){f>>>=7&E,E-=7&E,n.mode=JN;break}for(;E<3;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}switch(n.last=1&f,f>>>=1,E-=1,3&f){case 0:n.mode=16193;break;case 1:if(gK(n),n.mode=Qb,t===Xb){f>>>=2,E-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Fi}f>>>=2,E-=2;break;case 16193:for(f>>>=7&E,E-=7&E;E<32;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}if((65535&f)!=(f>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Fi;break}if(n.length=65535&f,f=0,E=0,n.mode=XN,t===Xb)break e;case XN:n.mode=16195;case 16195:if(T=n.length,T){if(T>u&&(T=u),T>h&&(T=h),T===0)break e;r.set(i.subarray(a,a+T),l),u-=T,a+=T,h-=T,l+=T,n.length-=T;break}n.mode=hd;break;case 16196:for(;E<14;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}if(n.nlen=257+(31&f),f>>>=5,E-=5,n.ndist=1+(31&f),f>>>=5,E-=5,n.ncode=4+(15&f),f>>>=4,E-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Fi;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;E<3;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}n.lens[At[n.have++]]=7&f,f>>>=3,E-=3}for(;n.have<19;)n.lens[At[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ee={bits:n.lenbits},Z=wS(0,n.lens,0,19,n.lencode,0,n.work,Ee),n.lenbits=Ee.bits,Z){e.msg="invalid code lengths set",n.mode=Fi;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;se=n.lencode[f&(1<<n.lenbits)-1],I=se>>>24,M=se>>>16&255,L=65535&se,!(I<=E);){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}if(L<16)f>>>=I,E-=I,n.lens[n.have++]=L;else{if(L===16){for(Rt=I+2;E<Rt;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}if(f>>>=I,E-=I,n.have===0){e.msg="invalid bit length repeat",n.mode=Fi;break}H=n.lens[n.have-1],T=3+(3&f),f>>>=2,E-=2}else if(L===17){for(Rt=I+3;E<Rt;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}f>>>=I,E-=I,H=0,T=3+(7&f),f>>>=3,E-=3}else{for(Rt=I+7;E<Rt;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}f>>>=I,E-=I,H=0,T=11+(127&f),f>>>=7,E-=7}if(n.have+T>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Fi;break}for(;T--;)n.lens[n.have++]=H}}if(n.mode===Fi)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=Fi;break}if(n.lenbits=9,Ee={bits:n.lenbits},Z=wS(1,n.lens,0,n.nlen,n.lencode,0,n.work,Ee),n.lenbits=Ee.bits,Z){e.msg="invalid literal/lengths set",n.mode=Fi;break}if(n.distbits=6,n.distcode=n.distdyn,Ee={bits:n.distbits},Z=wS(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ee),n.distbits=Ee.bits,Z){e.msg="invalid distances set",n.mode=Fi;break}if(n.mode=Qb,t===Xb)break e;case Qb:n.mode=$b;case $b:if(u>=6&&h>=258){e.next_out=l,e.avail_out=h,e.next_in=a,e.avail_in=u,n.hold=f,n.bits=E,cK(e,S),l=e.next_out,r=e.output,h=e.avail_out,a=e.next_in,i=e.input,u=e.avail_in,f=n.hold,E=n.bits,n.mode===hd&&(n.back=-1);break}for(n.back=0;se=n.lencode[f&(1<<n.lenbits)-1],I=se>>>24,M=se>>>16&255,L=65535&se,!(I<=E);){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}if(M&&(240&M)==0){for(j=I,K=M,z=L;se=n.lencode[z+((f&(1<<j+K)-1)>>j)],I=se>>>24,M=se>>>16&255,L=65535&se,!(j+I<=E);){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}f>>>=j,E-=j,n.back+=j}if(f>>>=I,E-=I,n.back+=I,n.length=L,M===0){n.mode=16205;break}if(32&M){n.back=-1,n.mode=hd;break}if(64&M){e.msg="invalid literal/length code",n.mode=Fi;break}n.extra=15&M,n.mode=16201;case 16201:if(n.extra){for(Rt=n.extra;E<Rt;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}n.length+=f&(1<<n.extra)-1,f>>>=n.extra,E-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;se=n.distcode[f&(1<<n.distbits)-1],I=se>>>24,M=se>>>16&255,L=65535&se,!(I<=E);){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}if((240&M)==0){for(j=I,K=M,z=L;se=n.distcode[z+((f&(1<<j+K)-1)>>j)],I=se>>>24,M=se>>>16&255,L=65535&se,!(j+I<=E);){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}f>>>=j,E-=j,n.back+=j}if(f>>>=I,E-=I,n.back+=I,64&M){e.msg="invalid distance code",n.mode=Fi;break}n.offset=L,n.extra=15&M,n.mode=16203;case 16203:if(n.extra){for(Rt=n.extra;E<Rt;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}n.offset+=f&(1<<n.extra)-1,f>>>=n.extra,E-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Fi;break}n.mode=16204;case 16204:if(h===0)break e;if(T=S-h,n.offset>T){if(T=n.offset-T,T>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Fi;break}T>n.wnext?(T-=n.wnext,k=n.wsize-T):k=n.wnext-T,T>n.length&&(T=n.length),O=n.window}else O=r,k=l-n.offset,T=n.length;T>h&&(T=h),h-=T,n.length-=T;do r[l++]=O[k++];while(--T);n.length===0&&(n.mode=$b);break;case 16205:if(h===0)break e;r[l++]=n.length,h--,n.mode=$b;break;case JN:if(n.wrap){for(;E<32;){if(u===0)break e;u--,f|=i[a++]<<E,E+=8}if(S-=h,e.total_out+=S,n.total+=S,4&n.wrap&&S&&(e.adler=n.check=Pr(n)?Gr(n.check,r,S,l-S):gS(n.check,r,S,l-S)),S=h,4&n.wrap&&(Pr(n)?f:g5(f))!==n.check){e.msg="incorrect data check",n.mode=Fi;break}f=0,E=0}n.mode=16207;case 16207:if(n.wrap&&Pr(n)){for(;E<32;){if(u===0)break e;u--,f+=i[a++]<<E,E+=8}if(4&n.wrap&&f!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Fi;break}f=0,E=0}n.mode=16208;case 16208:Z=fK;break e;case Fi:Z=m5;break e;case 16210:return _5;default:return ho}return e.next_out=l,e.avail_out=h,e.next_in=a,e.avail_in=u,n.hold=f,n.bits=E,(n.wsize||S!==e.avail_out&&n.mode<Fi&&(n.mode<JN||t!==f5))&&b5(e,e.output,e.next_out,S-e.avail_out),y-=e.avail_in,S-=e.avail_out,e.total_in+=y,e.total_out+=S,n.total+=S,4&n.wrap&&S&&(e.adler=n.check=Pr(n)?Gr(n.check,r,S,e.next_out-S):gS(n.check,r,S,e.next_out-S)),e.data_type=n.bits+(n.last?64:0)+(n.mode===hd?128:0)+(n.mode===Qb||n.mode===XN?256:0),(y===0&&S===0||t===f5)&&Z===Kp&&(Z=_K),Z},pd={inflateReset:S5,inflateReset2:v5,inflateResetKeep:y5,inflateInit:e=>T5(e,15),inflateInit2:T5,inflate:yK,inflateEnd:e=>{if(qp(e))return ho;let t=e.state;return t.window&&(t.window=null),e.state=null,Kp},inflateGetHeader:(e,t)=>{if(qp(e))return ho;const n=e.state;return(2&n.wrap)==0?ho:(n.head=t,t.done=!1,Kp)},inflateSetDictionary:(e,t)=>{const n=t.length;let i,r,a;return qp(e)?ho:(i=e.state,i.wrap!==0&&i.mode!==Zb?ho:i.mode===Zb&&(r=1,r=gS(r,t,n,0),r!==i.check)?m5:(a=b5(e,t,n,n),a?(i.mode=16210,_5):(i.havedict=1,Kp)))},inflateInfo:"pako inflate (from Nodeca project)"},SK=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const C5=Object.prototype.toString,{Z_NO_FLUSH:vK,Z_FINISH:TK,Z_OK:AS,Z_STREAM_END:$N,Z_NEED_DICT:e1,Z_STREAM_ERROR:RK,Z_DATA_ERROR:w5,Z_MEM_ERROR:bK}=Bb;function eC(e){this.options=Wb.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h5,this.strm.avail_out=0;let n=pd.inflateInit2(this.strm,t.windowBits);if(n!==AS)throw new Error(Hp[n]);if(this.header=new SK,pd.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=CS.string2buf(t.dictionary):C5.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=pd.inflateSetDictionary(this.strm,t.dictionary),n!==AS)))throw new Error(Hp[n])}function CK(e,t){const n=new eC(t);if(n.push(e),n.err)throw n.msg||Hp[n.err];return n.result}eC.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let a,l,u;if(this.ended)return!1;for(l=t===~~t?t:t===!0?TK:vK,C5.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),a=pd.inflate(n,l),a===e1&&r&&(a=pd.inflateSetDictionary(n,r),a===AS?a=pd.inflate(n,l):a===w5&&(a=e1));n.avail_in>0&&a===$N&&n.state.wrap>0&&e[n.next_in]!==0;)pd.inflateReset(n),a=pd.inflate(n,l);switch(a){case RK:case w5:case e1:case bK:return this.onEnd(a),this.ended=!0,!1}if(u=n.avail_out,n.next_out&&(n.avail_out===0||a===$N))if(this.options.to==="string"){let h=CS.utf8border(n.output,n.next_out),f=n.next_out-h,E=CS.buf2string(n.output,h);n.next_out=f,n.avail_out=i-f,f&&n.output.set(n.output.subarray(h,h+f),0),this.onData(E)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==AS||u!==0){if(a===$N)return a=pd.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},eC.prototype.onData=function(e){this.chunks.push(e)},eC.prototype.onEnd=function(e){e===AS&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Wb.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var wK={inflate:CK};const{deflate:AK}=oK,{inflate:OK}=wK;var IK=AK,NK=OK,A5=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(A5||{});class DK{constructor(){P(this,"_sequence",0),P(this,"_startTime",Date.now()),P(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const u=new Uint8Array(4);u.set([1,0,0,0]);const h={id:0,length:4,data:u.buffer},f={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[h]};n.commonPacketHeader.extension=1,n.extension=f,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;U("SHOW_DATASTREAM2_LOG")&&b.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),r=new Uint8Array(i),a=new DataView(i);let l=0;if(a.setUint16(l,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),l+=2,a.setUint32(l,n.commonPacketHeader.sequence,!0),l+=4,a.setUint16(l,n.commonStreamHeader,!0),l+=2,n.extension){const u=this.serializeExtension(n.extension);r.set(new Uint8Array(u),l),l+=u.byteLength}if(r.set(new Uint8Array(n.payload),l),l+=n.payload.byteLength,l!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let i=0;const r=n.getUint16(i,!0);i+=2;const a={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let l,u;if(i+=4,U("SHOW_DATASTREAM2_LOG")&&b.debug("receive data header: ".concat(JSON.stringify(a))),n.getUint16(i,!0),i+=2,a.extension){u=this.deserializeExtension(t.slice(i)),i+=2+u.length,l=t.slice(i);let h=!1;if(u.datas.length>0){const f=u.datas.find(E=>E.id===0);f&&(h=(1&new DataView(f.data).getUint32(0,!0))==1)}l=h?this.decompress(l):l}else l=t.slice(8);return l}serializeExtension(t){const{profile:n,length:i,datas:r}=t,a=new ArrayBuffer(i+2),l=new Uint8Array(a),u=new DataView(a);let h=0;if(u.setUint8(h++,n),u.setUint8(h++,i),r.forEach(f=>{n?(u.setUint8(h++,f.id),u.setUint8(h++,f.length),l.set(new Uint8Array(f.data),h),h+=f.data.byteLength):(u.setUint8(h++,f.id|f.length<<4),l.set(new Uint8Array(f.data),h),h+=f.data.byteLength)}),h!==i+2)throw Error("serialize extension error, is ".concat(h,"!==").concat(i+2));return a}deserializeExtension(t){const n=new DataView(t);let i=0;const r=n.getUint8(i);i++;const a=n.getUint8(i);i++;const l=r===A5.TWO_BYTE,u=[],h=new DataView(t,2);let f=0;for(;f<a;){let E=0,y=0,S=new ArrayBuffer(0);l?(E=h.getUint8(f),f++,y=h.getUint8(f),f++):(E=15&h.getUint8(f),y=h.getUint8(f)>>4,f++),y>0&&(S=h.buffer.slice(f+2,f+2+y),f+=S.byteLength),u.push({id:E,length:y,data:S})}if(f!==a)throw Error("parse error");return{profile:r,length:a,datas:u}}decompress(t){return NK(new Uint8Array(t))}compress(t){return IK(new Uint8Array(t))}}const kK={name:"DataStream",create:(e,t)=>{const n=t?new jW(e):new FW(e);return n.useDataStream(new DK),n}};class PK extends Wn{constructor(t,n,i){super(),P(this,"ws",void 0),P(this,"requestId",1),P(this,"heartBeatTimer",void 0),P(this,"joinInfo",void 0),P(this,"clientId",void 0),P(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),P(this,"onClose",r=>{this.emit("close"),this.dispose()}),P(this,"onMessage",r=>{const a=JSON.parse(r.data);if(!a||a.command!=="serverResponse"||!a.requestId)return a&&a.command==="serverStatus"&&a.serverStatus&&a.serverStatus.command?(this.emit("status",a.serverStatus),void this.emit(a.serverStatus.command,a.serverStatus)):void 0;this.emit("req_".concat(a.requestId),a)}),this.joinInfo=t,this.clientId=n,this.ws=new $y("cross-channel-".concat(this.clientId),i),this.ws.on(_t.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(_t.CONNECTED,this.onOpen),this.ws.on(_t.ON_MESSAGE,this.onMessage),this.ws.on(_t.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new Ne((n,i)=>{const r=window.setTimeout(()=>{i(new te(x.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,a=>{window.clearTimeout(r),a.state&&a.state!==0?i(new te(x.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),i(new te(x.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new te(x.WS_DISCONNECT);const n=()=>new Ne((l,u)=>{this.ws.once(_t.CLOSED,()=>u(new te(x.WS_ABORT))),this.ws.once(_t.CONNECTED,l)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(t),r=new Ne((l,u)=>{const h=()=>{u(new te(x.WS_ABORT))};this.ws.once(_t.RECONNECTING,h),this.ws.once(_t.CLOSED,h),this.once("req_".concat(i),l),qi(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(_t.RECONNECTING,h),this.ws.off(_t.CLOSED,h),u(new te(x.TIMEOUT,"cross channel ws request timeout"))})}),a=await r;if(!a||a.code!==200)throw new te(x.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));return a}async connect(t){this.ws.removeAllListeners(_t.REQUEST_NEW_URLS),this.ws.on(_t.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class LK extends Wn{set state(t){t!==this._state&&(t!==ls.RELAY_STATE_FAILURE&&(this.errorCode=p_.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,i,r,a){super(),P(this,"joinInfo",void 0),P(this,"sid",void 0),P(this,"clientId",void 0),P(this,"cancelToken",Zr.CancelToken.source()),P(this,"workerToken",void 0),P(this,"requestId",0),P(this,"signal",void 0),P(this,"prevChannelMediaConfig",void 0),P(this,"httpRetryConfig",void 0),P(this,"_resolution",void 0),P(this,"_state",ls.RELAY_STATE_IDLE),P(this,"errorCode",p_.RELAY_OK),P(this,"onStatus",l=>{b.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(l))),l&&l.command&&(l.command==="onAudioPacketReceived"&&this.emit("event",od.PACKET_RECEIVED_AUDIO_FROM_SRC),l.command==="onVideoPacketReceived"&&this.emit("event",od.PACKET_RECEIVED_VIDEO_FROM_SRC),l.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=p_.SRC_TOKEN_EXPIRED,this.state=ls.RELAY_STATE_FAILURE),l.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=p_.DEST_TOKEN_EXPIRED,this.state=ls.RELAY_STATE_FAILURE))}),P(this,"onReconnect",async()=>{b.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",od.NETWORK_DISCONNECTED),this.state=ls.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(l=>{this.state!==ls.RELAY_STATE_IDLE&&(b.error("auto restart channel media relay failed",l.toString()),this.errorCode=p_.SERVER_CONNECTION_LOST,this.state=ls.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=Ip(),this.signal=new PK(this.joinInfo,this.clientId,i),this.httpRetryConfig=r,this._resolution=a}async startChannelMediaRelay(t){if(this.state!==ls.RELAY_STATE_IDLE)throw new te(x.INVALID_OPERATION);this.state=ls.RELAY_STATE_CONNECTING,await this.connect(),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new te(x.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new te(x.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new te(x.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==ls.RELAY_STATE_RUNNING)throw new te(x.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==ls.RELAY_STATE_RUNNING)throw new te(x.INVALID_OPERATION);const n=this.genMessage(Br.SetVideoProfile);await this.signal.request(n),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),b.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ls.RELAY_STATE_IDLE,this.dispose()}dispose(){b.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Zr.CancelToken.source(),this.state=ls.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await YY(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",od.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Br.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Br.SetSdkProfile,t);await this.signal.request(i),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(Br.SetSourceChannel,t);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",od.PACKET_JOINED_SRC_CHANNEL),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const a=this.genMessage(Br.SetSourceUserId,t);await this.signal.request(a),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const l=this.genMessage(Br.SetDestChannel,t);await this.signal.request(l),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",od.PACKET_JOINED_DEST_CHANNEL),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const u=this.genMessage(Br.StartPacketTransfer,t);await this.signal.request(u),this.emit("event",od.PACKET_SENT_TO_DEST_CHANNEL),this.state=ls.RELAY_STATE_RUNNING,b.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Br.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",od.PACKET_UPDATE_DEST_CHANNEL),b.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Br.StopPacketTransfer);await this.signal.request(t),b.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const i=[],r=[],a=[];this.requestId+=1;const l={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Sa,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};l.sdkVersion==="4.24.0"&&(l.sdkVersion="0.0.1");let u=null,h=null;switch(t){case Br.SetSdkProfile:return l.clientRequest={command:"SetSdkProfile",type:"multi_channel"},l;case Br.SetSourceChannel:if(h=n&&n.getSrcChannelMediaInfo(),!h)throw new te(x.UNEXPECTED_ERROR,"can not find source config");return l.clientRequest={command:"SetSourceChannel",uid:"0",channelName:h.channelName,token:h.token||this.joinInfo.appId},l;case Br.SetSourceUserId:if(h=n&&n.getSrcChannelMediaInfo(),!h)throw new te(x.UNEXPECTED_ERROR,"can not find source config");return l.clientRequest={command:"SetSourceUserId",uid:h.uid+""},l;case Br.SetDestChannel:if(u=n&&n.getDestChannelMediaInfo(),!u)throw new te(x.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(f=>{i.push(f.channelName),r.push(f.uid+""),a.push(f.token||this.joinInfo.appId)}),l.clientRequest={command:"SetDestChannel",channelName:i,uid:r,token:a},l;case Br.StartPacketTransfer:return l.clientRequest={command:"StartPacketTransfer"},l;case Br.Reconnect:return l.clientRequest={command:"Reconnect"},l;case Br.StopPacketTransfer:return l.clientRequest={command:"StopPacketTransfer"},l;case Br.UpdateDestChannel:if(u=n&&n.getDestChannelMediaInfo(),!u)throw new te(x.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(f=>{i.push(f.channelName),r.push(f.uid+""),a.push(f.token||this.joinInfo.appId)}),l.clientRequest={command:"UpdateDestChannel",channelName:i,uid:r,token:a},l;case Br.SetVideoProfile:l.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return l}}const MK={name:"ChannelMediaRelay",create:function(e){return new LK(e.joinInfo,e.clientId,e.websocketRetryConfig||_i,e.httpRetryConfig||_i,e.resolution)}};function O5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function OS(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?O5(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O5(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class xK extends Wn{constructor(t,n,i,r){super(),P(this,"spec",void 0),P(this,"token",void 0),P(this,"websocket",void 0),P(this,"pingpongTimer",void 0),P(this,"reconnectMode","retry"),P(this,"serviceMode",void 0),P(this,"reqId",0),P(this,"commandReqId",0),P(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),P(this,"handleWebSocketMessage",a=>{if(!a.data)return;const l=JSON.parse(a.data);l.requestId?this.emit("@".concat(l.requestId,"-").concat(l.sid),l):(He.workerEvent(this.spec.sid,{actionType:"status",serverCode:l.code,workerType:this.serviceMode===ad.TRANSCODE?1:2}),this.emit(xu.PUBLISH_STREAM_STATUS,l))}),this.spec=n,this.token=t,this.serviceMode=r,this.websocket=new $y("live-streaming",i),this.websocket.on(_t.CONNECTED,this.handleWebSocketOpen),this.websocket.on(_t.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(_t.REQUEST_NEW_URLS,(a,l)=>{nr(this,xu.REQUEST_NEW_ADDRESS).then(a).catch(l)}),this.websocket.on(_t.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,i,r){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const a=this.commandReqId,l=this.reqId;if(!l||!this.websocket)throw new te(x.UNEXPECTED_ERROR);const u=OS({command:t,sdkVersion:Sa==="4.24.0"?"0.0.1":Sa,seq:l,requestId:l,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new te(x.WS_DISCONNECT);const h=()=>new Ne((S,T)=>{this.websocket.once(_t.CLOSED,()=>T(new te(x.WS_ABORT))),this.websocket.once(_t.CONNECTED,S)});this.websocket.state!=="connected"&&await h(),u.clientRequest&&(u.clientRequest.workerToken=this.token);const f=new Ne((S,T)=>{const k=()=>{T(new te(x.WS_ABORT))};this.websocket.once(_t.RECONNECTING,k),this.websocket.once(_t.CLOSED,k),this.once("@".concat(l,"-").concat(this.spec.sid),O=>{S(O)})});r&&He.workerEvent(this.spec.sid,OS(OS({},r),{},{requestId:a,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const E=Date.now();this.websocket.sendMessage(u);let y=null;try{y=await f}catch(S){if(this.websocket.state==="closed")throw S;return await h(),await this.request(t,n,i)}return r&&He.workerEvent(this.spec.sid,OS(OS({},r),{},{requestId:a,actionType:"response",payload:JSON.stringify(y.serverResponse),serverCode:y.code,success:y.code===200,responseTime:Date.now()-E})),y.code!==200&&this.handleResponseError(y),y}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Sa==="4.24.0"?"0.0.1":Sa;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Ti.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void b.warning("live stream response already exists stream");case Ti.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ti.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ti.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new te(x.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Ti.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new te(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ti.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new te(x.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Ti.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new te(x.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(xu.WARNING,n,t.serverResponse.url)}case Ti.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new te(x.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(xu.WARNING,n,t.serverResponse.url)}case Ti.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new te(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ti.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new te(x.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Ti.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new te(x.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(xu.WARNING,n,t.serverResponse.url)}case Ti.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new te(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Ti.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new te(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ti.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ti.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new te(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ti.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new te(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new te(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ti.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ti.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ti.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ti.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new te(x.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(jR)},6e3)}}function I5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function ds(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?I5(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I5(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class UK extends Wn{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_i,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:_i;super(),P(this,"onLiveStreamWarning",void 0),P(this,"onLiveStreamError",void 0),P(this,"spec",void 0),P(this,"retryTimeout",1e4),P(this,"connection",void 0),P(this,"httpRetryConfig",void 0),P(this,"wsRetryConfig",void 0),P(this,"streamingTasks",new Map),P(this,"isStartingStreamingTask",!1),P(this,"taskMutex",new cr("live-streaming")),P(this,"cancelToken",Zr.CancelToken.source()),P(this,"transcodingConfig",void 0),P(this,"uapResponse",void 0),P(this,"lastTaskId",1),P(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=ds(ds({},RY),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(b.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(l=>ds(ds(ds({},TY),l),{},{zOrder:l.zOrder?l.zOrder+1:1}))),function(l){Xn(l.width)||un(l.width,"config.width",0,1e4),Xn(l.height)||un(l.height,"config.height",0,1e4),Xn(l.videoBitrate)||un(l.videoBitrate,"config.videoBitrate",1,1e6),Xn(l.videoFrameRate)||un(l.videoFrameRate,"config.videoFrameRate"),Xn(l.lowLatency)||Wo(l.lowLatency,"config.lowLatency"),Xn(l.audioSampleRate)||Ai(l.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Xn(l.audioBitrate)||un(l.audioBitrate,"config.audioBitrate",1,128),Xn(l.audioChannels)||Ai(l.audioChannels,"config.audioChannels",[1,2,3,4,5]),Xn(l.videoGop)||un(l.videoGop,"config.videoGop"),Xn(l.videoCodecProfile)||Ai(l.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Xn(l.userCount)||un(l.userCount,"config.userCount",0,17),Xn(l.backgroundColor)||un(l.backgroundColor,"config.backgroundColor",0,16777215),Xn(l.userConfigExtraInfo)||Ki(l.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),l.transcodingUsers&&!Xn(l.transcodingUsers)&&(sd(l.transcodingUsers,"config.transcodingUsers"),l.transcodingUsers.forEach((u,h)=>{lb(u.uid),Xn(u.x)||un(u.x,"transcodingUser[".concat(h,"].x"),0,1e4),Xn(u.y)||un(u.y,"transcodingUser[".concat(h,"].y"),0,1e4),Xn(u.width)||un(u.width,"transcodingUser[".concat(h,"].width"),0,1e4),Xn(u.height)||un(u.height,"transcodingUser[".concat(h,"].height"),0,1e4),Xn(u.zOrder)||un(u.zOrder-1,"transcodingUser[".concat(h,"].zOrder"),0,100),Xn(u.alpha)||un(u.alpha,"transcodingUser[".concat(h,"].alpha"),0,1,!1)})),Xn(l.watermark)||$I(l.watermark,"watermark"),Xn(l.backgroundImage)||$I(l.backgroundImage,"backgroundImage"),l.images&&!Xn(l.images)&&(sd(l.images,"config.images"),l.images.forEach((u,h)=>{$I(u,"images[".concat(h,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(l=>ds(ds(ds({},QI),l),{},{zOrder:255}))),n.backgroundImage&&(i.push(ds(ds(ds({},QI),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(ds(ds(ds({},QI),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(l=>ds({},l)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const r=(n.userConfigs||[]).map(l=>typeof l.uid=="number"?Ne.resolve(l.uid):t3(l.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Ne.all(r)).forEach((l,u)=>{n.userConfigs&&n.userConfigs[u]&&(n.userConfigs[u].uid=l)}),this.transcodingConfig=n,this.connection)try{var a;const l=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Ir(a=this.streamingTasks).call(a)).map(u=>u.taskId).join("#")});b.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(l.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(l){if(!l.data||!l.data.retry)throw l;l.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(u=>{b.warning("[".concat(this.spec.clientId,"] live streaming receive error"),l.toString(),"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,l).then(()=>{b.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(u.url," success"))}).catch(h=>{b.error("[".concat(this.spec.clientId,"] live streaming republish failed"),u.url,h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)})})}}async startLiveStreamingTask(t,n,i){if(!this.transcodingConfig&&n===ad.TRANSCODE)throw new te(x.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};b.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const a=await this.taskMutex.lock();if(!this.connection&&i)return void a();if(this.streamingTasks.get(t)&&!i)return a(),new te(x.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(u){throw a(),u}switch(n){case ad.TRANSCODE:r.transcodingConfig=ds({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const l=this.lastTaskId++;try{const u=new Ne((f,E)=>{qi(this.retryTimeout).then(()=>{if(i)return E(i);const y=this.statusError.get(t);return y?(this.statusError.delete(t),E(y)):void 0})}),h=await Ne.race([this.connection.request("request",{clientRequest:r},!0,{url:t,command:"PublishStream",workerType:n===ad.TRANSCODE?1:2,requestByUser:!i,tid:l.toString()}),u]);this.isStartingStreamingTask=!1,b.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(h.code)),this.streamingTasks.set(t,{clientRequest:r,mode:n,url:t,taskId:l}),a()}catch(u){if(a(),this.isStartingStreamingTask=!1,!u.data||!u.data.retry||i)throw u;return u.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,u)):await this.startLiveStreamingTask(t,n,u)}}stopLiveStreamingTask(t){return new Ne((n,i)=>{const r=this.streamingTasks.get(t);if(!r||!this.connection)return new te(x.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const a=r.mode;r.abortTask=()=>{b.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:t,command:"UnPublishStream",workerType:a===ad.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(l=>{b.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(l.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var t;const n=Array.from(Ir(t=this.streamingTasks).call(t));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Zr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new te(x.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await nr(this,eN.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new xK(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(xu.WARNING,(i,r)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(r,i)),this.connection.on(xu.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(xu.REQUEST_NEW_ADDRESS,(i,r)=>{if(!this.connection)return r(new te(x.UNEXPECTED_ERROR,"can not get new live streaming address list"));nr(this,eN.REQUEST_WORKER_MANAGER_LIST,t).then(a=>{this.uapResponse=a,i(a.addressList)}).catch(r)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),r=t.reason;switch(t.code){case Ti.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ti.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ti.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ti.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const l=new te(x.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return b.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,l);if(!this.isStartingStreamingTask)return;this.statusError.set(n,l)}case Ti.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const l=new te(x.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,l)}case Ti.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ti.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var a;if(!this.connection)return;this.connection.tryNextAddress();const l=Array.from(Ir(a=this.streamingTasks).call(a));for(const u of l)u.abortTask?u.abortTask():(b.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,new te(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{b.debug("[".concat(this.spec.clientId,"] republish live stream success"),u.url)}).catch(h=>{b.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const VK={name:"LiveStreaming",create:function(e){return new UK(e.joinInfo,e.websocketRetryConfig||_i,e.httpRetryConfig||_i)}};function jK(e){let t=k5();return function(n,i){let r=n.appId;r!==void 0&&(nn(i,10),cl(i,r));let a=n.cid;a!==void 0&&(nn(i,16),nn(i,a));let l=n.cname;l!==void 0&&(nn(i,26),cl(i,l));let u=n.deviceId;u!==void 0&&(nn(i,34),cl(i,u));let h=n.elapse;h!==void 0&&(nn(i,40),Qu(i,h));let f=n.fileSize;f!==void 0&&(nn(i,48),Qu(i,N_(f)));let E=n.height;E!==void 0&&(nn(i,56),Qu(i,N_(E)));let y=n.jpg;y!==void 0&&(nn(i,66),nn(i,y.length),function(pr,le){let Te=D_(pr,le.length);pr.bytes.set(le,Te)}(i,y));let S=n.networkType;S!==void 0&&(nn(i,72),Qu(i,N_(S)));let T=n.osType;T!==void 0&&(nn(i,80),Qu(i,N_(T)));let k=n.requestId;k!==void 0&&(nn(i,90),cl(i,k));let O=n.sdkVersion;O!==void 0&&(nn(i,98),cl(i,O));let I=n.sequence;I!==void 0&&(nn(i,104),Qu(i,N_(I)));let M=n.sid;M!==void 0&&(nn(i,114),cl(i,M));let L=n.timestamp;L!==void 0&&(nn(i,120),Qu(i,L));let j=n.uid;j!==void 0&&(nn(i,128),nn(i,j));let K=n.vid;K!==void 0&&(nn(i,136),nn(i,K));let z=n.width;z!==void 0&&(nn(i,144),Qu(i,N_(z)));let H=n.service;H!==void 0&&(nn(i,152),nn(i,H));let Z=n.callbackData;Z!==void 0&&(nn(i,162),cl(i,Z));let se=n.jpgEncryption;se!==void 0&&(nn(i,168),nn(i,se));let ue=n.requestType;ue!==void 0&&(nn(i,176),nn(i,ue));let Ee=n.scorePorn;Ee!==void 0&&(nn(i,185),s1(i,Ee));let Rt=n.scoreSexy;Rt!==void 0&&(nn(i,193),s1(i,Rt));let At=n.scoreNeutral;At!==void 0&&(nn(i,201),s1(i,At));let ot=n.scene;ot!==void 0&&(nn(i,208),nn(i,ot));let Kt=n.ossFilePrefix;Kt!==void 0&&(nn(i,218),cl(i,Kt));let Yt=n.serviceVendor;if(Yt!==void 0)for(let pr of Yt){nn(i,226);let le=k5();GK(pr,le),nn(i,le.limit),zK(i,le),YK(le)}}(e,t),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(t)}function FK(e){return function(n){let i={};e:for(;!P5(n);){let r=ll(n);switch(r>>>3){case 0:break e;case 1:i.code=ll(n);break;case 2:i.msg=L5(n,ll(n));break;case 3:{let a=HK(n);i.data=BK(n),n.limit=a;break}default:N5(n,7&r)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function BK(e){let t={};e:for(;!P5(e);){let n=ll(e);switch(n>>>3){case 0:break e;case 1:t.requestId=L5(e,ll(e));break;case 2:t.requestType=ll(e)>>>0;break;case 3:t.scorePorn=r1(e);break;case 4:t.scoreSexy=r1(e);break;case 5:t.scoreNeutral=r1(e);break;case 6:t.requestScene=ll(e)>>>0;break;case 7:t.scene=ll(e)>>>0;break;default:N5(e,7&n)}}return t}function GK(e,t){let n=e.service;n!==void 0&&(nn(t,8),nn(t,n));let i=e.vendor;i!==void 0&&(nn(t,16),nn(t,i));let r=e.token;r!==void 0&&(nn(t,26),cl(t,r));let a=e.callbackUrl;a!==void 0&&(nn(t,34),cl(t,a))}function HK(e){let t=ll(e),n=e.limit;return e.limit=e.offset+t,n}function N5(e,t){switch(t){case 0:for(;128&M5(e););break;case 2:n1(e,ll(e));break;case 5:n1(e,4);break;case 1:n1(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let WK=new Float32Array(1);new Uint8Array(WK.buffer);let t1=new Float64Array(1),us=new Uint8Array(t1.buffer);function N_(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let D5=[];function k5(){const e=D5.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function YK(e){D5.push(e)}function n1(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function P5(e){return e.offset>=e.limit}function D_(e,t){let n=e.bytes,i=e.offset,r=e.limit,a=i+t;if(a>n.length){let l=new Uint8Array(2*a);l.set(n),e.bytes=l}return e.offset=a,a>r&&(e.limit=a),i}function i1(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function L5(e,t){let n=i1(e,t),i=String.fromCharCode,r=e.bytes,a="",l="";for(let u=0;u<t;u++){let h,f,E,y,S=r[u+n];(128&S)==0?l+=i(S):(224&S)==192?u+1>=t?l+=a:(h=r[u+n+1],(192&h)!=128?l+=a:(y=(31&S)<<6|63&h,y<128?l+=a:(l+=i(y),u++))):(240&S)==224?u+2>=t?l+=a:(h=r[u+n+1],f=r[u+n+2],(49344&(h|f<<8))!=32896?l+=a:(y=(15&S)<<12|(63&h)<<6|63&f,y<2048||y>=55296&&y<=57343?l+=a:(l+=i(y),u+=2))):(248&S)==240?u+3>=t?l+=a:(h=r[u+n+1],f=r[u+n+2],E=r[u+n+3],(12632256&(h|f<<8|E<<16))!=8421504?l+=a:(y=(7&S)<<18|(63&h)<<12|(63&f)<<6|63&E,y<65536||y>1114111?l+=a:(y-=65536,l+=i(55296+(y>>10),56320+(1023&y)),u+=3))):l+=a}return l}function cl(e,t){let n=t.length,i=0;for(let l=0;l<n;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+t.charCodeAt(++l)-56613888),i+=u<128?1:u<2048?2:u<65536?3:4}nn(e,i);let r=D_(e,i),a=e.bytes;for(let l=0;l<n;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+t.charCodeAt(++l)-56613888),u<128?a[r++]=u:(u<2048?a[r++]=u>>6&31|192:(u<65536?a[r++]=u>>12&15|224:(a[r++]=u>>18&7|240,a[r++]=u>>12&63|128),a[r++]=u>>6&63|128),a[r++]=63&u|128)}}function zK(e,t){let n=D_(e,t.limit),i=e.bytes,r=t.bytes;for(let a=0,l=t.limit;a<l;a++)i[a+n]=r[a]}function M5(e){return e.bytes[i1(e,1)]}function x5(e,t){let n=D_(e,1);e.bytes[n]=t}function r1(e){let t=i1(e,8),n=e.bytes;return us[0]=n[t++],us[1]=n[t++],us[2]=n[t++],us[3]=n[t++],us[4]=n[t++],us[5]=n[t++],us[6]=n[t++],us[7]=n[t++],t1[0]}function s1(e,t){let n=D_(e,8),i=e.bytes;t1[0]=t,i[n++]=us[0],i[n++]=us[1],i[n++]=us[2],i[n++]=us[3],i[n++]=us[4],i[n++]=us[5],i[n++]=us[6],i[n++]=us[7]}function ll(e){let t,n=0,i=0;do t=M5(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function nn(e,t){for(t>>>=0;t>=128;)x5(e,127&t|128),t>>>=7;x5(e,t)}function Qu(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,r=t.high>>>24,a=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,l=D_(e,a),u=e.bytes;switch(a){case 10:u[l+9]=r>>>7&1;case 9:u[l+8]=a!==9?128|r:127&r;case 8:u[l+7]=a!==8?i>>>21|128:i>>>21&127;case 7:u[l+6]=a!==7?i>>>14|128:i>>>14&127;case 6:u[l+5]=a!==6?i>>>7|128:i>>>7&127;case 5:u[l+4]=a!==5?128|i:127&i;case 4:u[l+3]=a!==4?n>>>21|128:n>>>21&127;case 3:u[l+2]=a!==3?n>>>14|128:n>>>14&127;case 2:u[l+1]=a!==2?n>>>7|128:n>>>7&127;case 1:u[l]=a!==1?128|n:127&n}}function U5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}const KK=new Map([["moderation",1],["supervise",2]]);class qK extends Wn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(ji.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=gr(n=t.map(i=>KK.get(i)||0)).call(n,(i,r)=>i+r),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),P(this,"name","AgoraRTCVideoContentInspect"),P(this,"_connectionState",so.CONNECTING),P(this,"_innerConnectionState",void 0),P(this,"sequence",0),P(this,"inspectStartTime",void 0),P(this,"workerManagerConnection",void 0),P(this,"workerConnection",void 0),P(this,"workerMessageLengthLimit",void 0),P(this,"inspectIntervalMinimum",void 0),P(this,"qualityRatio",void 0),P(this,"_connectInfo",void 0),P(this,"_cancelTokenSource",Zr.CancelToken.source()),P(this,"_retryConfig",void 0),P(this,"wmSequence",0),P(this,"inspectInterval",void 0),P(this,"inspectTimer",null),P(this,"ossFilePrefix",void 0),P(this,"extraInfo",void 0),P(this,"_inspectType",void 0),P(this,"_inspectMode",void 0),P(this,"_quality",1),P(this,"qualityTimer",null),P(this,"_inspectId",void 0),P(this,"_needWorkUrlOnly",!1),P(this,"inspectImage",()=>{if(this.connectionState!==so.CONNECTED)throw new te(x.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===so.CONNECTED?this.requestToInspectImage():b.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=yn(5,"inspect-"),this.workerMessageLengthLimit=U("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=U("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=U("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new $y("worker-manager-"+this._inspectId,_i),this.on(ji.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,b.debug("[".concat(this._inspectId,"] Inspect operation :").concat(ao[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new $y("worker-"+this._inspectId,_i),this.handleWorkerEvents()}async init(t,n){this.emit(ji.STATE_CHANGE,ao.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new Ne((r,a)=>{this.on(ji.CONNECTION_STATE_CHANGE,(l,u)=>{u===so.CONNECTED&&r()}),this.requestAP(t,i,n).then(l=>{this.connectWorkerManager(l)}).catch(l=>{a(l)})})}async requestAP(t,n,i){const r=U("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),a=await function(u,h,f,E){let{appId:y,areaCode:S,cname:T,sid:k,token:O,uid:I}=h;S_++;const M="image_moderation_api",L={service_name:M,json_body:JSON.stringify({appId:y,areaCode:S,cname:T,command:"allocateEdge",requestId:S_,seq:S_,sid:k,token:O,ts:Date.now(),uid:I+""})};let j,K,z=u[0];return Yo(async()=>{j=Date.now();const H=await Jo(z,{data:L,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-j,H.code!==0){const Ee=new te(x.UNEXPECTED_RESPONSE,"image inspect ap error, code"+H.code,{retry:!0,responseTime:K});throw b.error(Ee.toString()),Ee}const Z=JSON.parse(H.json_body);if(Z.code!==200){const Ee=new te(x.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Z.code,", reason: ").concat(Z.reason),{code:Z.code,responseTime:K});throw b.error(Ee.toString()),Ee}if(!Z.servers||!Array.isArray(Z.servers)||Z.servers.length===0){const Ee=new te(x.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Z.code,responseTime:K});throw b.error(Ee.toString()),Ee}const se=U("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ue=U("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Z.servers.map(Ee=>{let{address:Rt,wss:At}=Ee;if(Rt&&At)return"wss://".concat(Rt.replace(/\./g,"-"),".").concat(se,":").concat(ue||At)}).filter(Ee=>!!Ee),workerToken:Z.workerToken,vid:Z.vid,responseTime:K}},(H,Z)=>(He.apworkerEvent(k,{success:!0,sc:200,serviceName:M,responseDetail:JSON.stringify(H.addressList),firstSuccess:Z===0,responseTime:K,serverIp:u[Z%u.length]}),!1),(H,Z)=>(He.apworkerEvent(k,{success:!1,sc:H.data&&H.data.code||200,serviceName:M,responseTime:K,serverIp:u[Z%u.length]}),!!(H.code!==x.OPERATION_ABORTED&&H.code!==x.UNEXPECTED_RESPONSE||H.data&&H.data.retry)&&(z=u[(Z+1)%u.length],!0)),E)}(r,t,n,i);this.emit(ji.STATE_CHANGE,ao.AP_CONNECTED);const{addressList:l}=a;return this.wmSequence++,l}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(ji.STATE_CHANGE,ao.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(_t.CONNECTED,async()=>{this.emit(ji.STATE_CHANGE,ao.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(_t.CLOSED,()=>{this._innerConnectionState<ao.GET_WORKER_MANAGER_RESPONSE&&b.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(_t.FAILED,()=>{this._innerConnectionState<ao.GET_WORKER_MANAGER_RESPONSE&&b.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(_t.RECONNECTING,()=>{this._innerConnectionState<ao.GET_WORKER_MANAGER_RESPONSE&&b.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(_t.ON_MESSAGE,async t=>{this.emit(ji.STATE_CHANGE,ao.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw b.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new te(x.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw b.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new te(x.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const r=U("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,a=n.replace(/:\d+\/?$/,":".concat(r));this.emit(ji.STATE_CHANGE,ao.CONNECT_WORKER,a),this._needWorkUrlOnly?this.emit(ji.REQUEST_NEW_WORKER_URL,a):await this.connectWorker(a)}}),this.workerManagerConnection.on(_t.WILL_RECONNECT,(t,n,i)=>{i(t)}),this.workerManagerConnection.on(_t.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(_t.CONNECTED,async()=>{this.emit(ji.STATE_CHANGE,ao.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=so.CONNECTED}),this.workerConnection.on(_t.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const i=FK(new Uint8Array(t.data));if(U("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&b.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(ji.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const r={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},a=gr(n=Object.keys(r)).call(n,(u,h)=>r[u]>r[h]?u:h,"porn"),l=Object.keys(r).find(u=>u===a);this.emit(ji.INSPECT_RESULT,l)}else this.emit(ji.INSPECT_RESULT,void 0,new te(x.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(ji.INSPECT_RESULT,void 0,new te(x.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else b.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(ji.INSPECT_RESULT,void 0,new te(x.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(_t.CLOSED,()=>{this.connectionState=so.CLOSED}),this.workerConnection.on(_t.FAILED,()=>{this.connectionState=so.CLOSED}),this.workerConnection.on(_t.RECONNECTING,()=>{this.connectionState=this.connectionState===so.CONNECTED?so.RECONNECTING:so.CONNECTING}),this.workerConnection.on(_t.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this.workerConnection.on(_t.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(ji.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const t=Js(this,ji.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(ji.INSPECT_RESULT,void 0,new te(x.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(ji.INSPECT_RESULT,void 0,new te(x.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:i,cname:r,cid:a,vid:l,sid:u,uid:h}=n;const f=Date.now(),E=await t.getCurrentFrameImage("image/jpeg",this.quality),y=await gx(E,i,r),S=this.sequence+"-"+a+"-"+h+"-"+f+"-"+yn(12,""),T={appId:i,cid:a,cname:r,deviceId:"",elapse:(k=Number(f-this.inspectStartTime),{low:k|=0,high:k>>31,unsigned:k>=0}),fileSize:y.byteLength,jpgEncryption:2,height:E.height,width:E.width,jpg:y,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.0",sequence:this.sequence,sid:u,timestamp:Y3(f),uid:h,vid:l,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var k;this.extraInfo===void 0&&delete T.callbackData,this.ossFilePrefix===void 0&&delete T.ossFilePrefix;const O=jK(T);if(O.byteLength<this.workerMessageLengthLimit){if(U("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const I=function(M){for(var L=1;L<arguments.length;L++){var j=arguments[L]!=null?arguments[L]:{};L%2?U5(Object(j),!0).forEach(function(K){P(M,K,j[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(j)):U5(Object(j)).forEach(function(K){Object.defineProperty(M,K,Object.getOwnPropertyDescriptor(j,K))})}return M}({},T);delete I.jpg,b.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(I))}return O}{const I=this.quality*this.qualityRatio;return this.quality=I,await this.generateRequestData(t,{appId:i,cname:r,cid:a,vid:l,sid:u,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Zr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=so.CLOSED,this.emit(ji.STATE_CHANGE,ao.CLOSED)}}const XK={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new te(x.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new te(x.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(r=>{var a;if(!Re(a=["supervise","moderation"]).call(a,r))throw new te(x.INVALID_PARAMS,"".concat(r," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new te(x.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new qK(t)}};var V5=v(Ci.Object.getOwnPropertySymbols),JK=Jt,ZK=Al.indexOf,QK=Nl,a1=We([].indexOf),j5=!!a1&&1/a1([1],1,-0)<0;JK({target:"Array",proto:!0,forced:j5||!QK("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return j5?a1(this,e,t)||0:ZK(this,e,t)}});var $K=gs("Array","indexOf"),eq=oe,tq=$K,o1=Array.prototype,nq=function(e){var t=e.indexOf;return e===o1||eq(o1,e)&&t===o1.indexOf?tq:t},F5=v(nq);function iq(e,t){if(e==null)return{};var n,i,r=function(l,u){if(l==null)return{};var h={};for(var f in l)if({}.hasOwnProperty.call(l,f)){if(F5(u).call(u,f)!==-1)continue;h[f]=l[f]}return h}(e,t);if(V5){var a=V5(e);for(i=0;i<a.length;i++)n=a[i],F5(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}let B5=class{get localCapabilities(){return jn(this._localCapabilities)}get rtpCapabilities(){return jn(this._rtpCapabilities)}get candidates(){return jn(this._candidates)}get iceParameters(){return jn(this._iceParameters)}get dtlsParameters(){return jn(this._dtlsParameters)}constructor(e){P(this,"sessionDesc",void 0),P(this,"_localCapabilities",void 0),P(this,"_rtpCapabilities",void 0),P(this,"_candidates",void 0),P(this,"_iceParameters",void 0),P(this,"_dtlsParameters",void 0),P(this,"setup",void 0),P(this,"currentMidIndex",void 0),P(this,"cname","o/i14u9pJrxRKAsu"),P(this,"firefoxSsrcMidMap",new Map),e=jn(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,localCapabilities:a,direction:l,setup:u,videoCodec:h,audioCodec:f}=e;let E;this.setup=u,E=l===Fr.RECEIVE_ONLY?os(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):os(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=r,this._candidates=i,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=a;const y=l===Fr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,S=l===Fr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,T=l===Fr.RECEIVE_ONLY?r.send.videoCodecs:iS(xe.VIDEO,y,S,h),k=l===Fr.RECEIVE_ONLY?r.send.audioCodecs:iS(xe.AUDIO,y,S,f);for(const O of E.mediaDescriptions)O.attributes.iceUfrag=t.iceUfrag,O.attributes.icePwd=t.icePwd,O.attributes.fingerprints=n.fingerprints,O.attributes.candidates=i,O.attributes.setup=this.setup,O.media.mediaType==="application"&&(O.attributes.sctpPort="5000"),O.media.mediaType==="video"&&(O.media.fmts=T.map(I=>I.payloadType.toString(10)),O.attributes.payloads=T,O.attributes.extmaps=y.videoExtensions),O.media.mediaType==="audio"&&(O.media.fmts=k.map(I=>I.payloadType.toString(10)),O.attributes.payloads=k,O.attributes.extmaps=y.audioExtensions,y_(O));this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return Lu(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,i,r){n=n.replace(/ /g,"-");const{ssrcs:a,ssrcGroups:l}=nS(t,this.cname,U("SYNC_GROUP")?n:void 0),u=this.findPreloadMediaDesc(a);if(u){if(qn()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,u.attributes.mid),r&&(r.twcc||r.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(u,r),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(e,a,i);let f;return h===-1?(f=this.createOrRecycleSendMedia(e,a,l,"sendonly",i,r),this.updateBundleMids()):(f=jn(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="sendonly",f.attributes.ssrcs=a,f.attributes.ssrcGroups=l,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(f,r)),qn()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,f.attributes.mid),{needExchangeSDP:!0,mid:f.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const i=[];return e.forEach(r=>{const a=r._mediaStreamTrack.kind,l=this.findAvailableRecvMediaIndex(a);let u,h=!1;l===-1?(h=!0,u=this.createOrRecycleRecvMedia(r,[],"recvonly",t,n),this.updateBundleMids()):(u=jn(this.sessionDesc.mediaDescriptions[l]),u.attributes.direction="recvonly"),i.push({mid:u.attributes.mid,needCreateTransceiver:h})}),i}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:i,port:r,type:a,relatedAddress:l,relatedPort:u,priority:h}=new RTCIceCandidate(e),f={foundation:t??"",componentId:"1",transport:n??"",priority:h?h+"":"",connectionAddress:i??"",port:r?r+"":"",type:a?a+"":"",relAddr:l??"",relPort:u?u+"":"",extension:{}};this.candidates.some(E=>E.priority===f.priority&&E.connectionAddress===f.connectionAddress&&E.port===f.port)||(this._candidates.push(f),this.sessionDesc.mediaDescriptions.forEach(E=>{E.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,i,r){const a=e._mediaStreamTrack.kind,l=this.rtpCapabilities.recv,u=iS(a,l,this.localCapabilities.send,a===xe.AUDIO?r:i),h=a===xe.VIDEO?l.videoExtensions:l.audioExtensions,f="".concat(++this.currentMidIndex);let E={media:{mediaType:a,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};E=this.mungRecvMediaDsec(E,e);const y=this.findFirstClosedMedia(a);if(y){const S=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[S]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Re(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Re(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const r=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(qn()){if(r){const a=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(a||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!a||a!==i.attributes.mid)}return!1}return r&&i.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=jn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,i,r,a){const l=this.rtpCapabilities.send,u=e===xe.VIDEO?l.videoCodecs:l.audioCodecs,h=e===xe.VIDEO?l.videoExtensions:l.audioExtensions;qn()&&(r="".concat(++this.currentMidIndex));let f={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:r}};f=this.mungSendMediaDesc(f,a);const E=this.findFirstClosedMedia(e);if(E){const y=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[y]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}mungRecvMediaDsec(e,t,n){const i=jn(e);return aN(i),g_(i,t),oN(i,t),MV(i),Eb(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=jn(e);return Eb(n,t,this.localCapabilities.recv),y_(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>qn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const rq=["sdp"];var Nn;function G5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function $u(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?G5(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G5(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let H5=(Nn=class U_ extends EV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,i){super(t,n),P(this,"direction",void 0),P(this,"name",void 0),P(this,"store",void 0),P(this,"spec",void 0),P(this,"peerConnection",void 0),P(this,"initialOffer",void 0),P(this,"transport",void 0),P(this,"statsFilter",void 0),P(this,"localCandidateCount",0),P(this,"_isInRestartIce",!1),P(this,"mutex",void 0),P(this,"onLocalCandidate",void 0),P(this,"remoteSDP",void 0),P(this,"pendingCandidates",[]),P(this,"localCapabilities",void 0),P(this,"isReady",!1),P(this,"restartCnt",0),P(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new cr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(U_.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Fr.SEND_ONLY,this.name=this.direction===Fr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=mI(this.peerConnection,U("STATS_UPDATE_INTERVAL"),void 0,qn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await UV();if(this.localCapabilities=gb(n),t){const{sdp:i}=t,r=iq(t,rq),a=function(){const E={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},y=tS(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(oo(y,E,"videoExtensions",S,T,k),oo(y,E,"videoCodecs",S,T,k),oo(y,E,"audioExtensions",S,T,k),oo(y,E,"audioCodecs",S,T,k),U("RAISE_H264_BASELINE_PRIORITY")){const O=k.videoCodecs.findIndex(I=>I.rtpMap&&I.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&I.fmtp&&I.fmtp.parameters["profile-level-id"]==="42001f");if(O!==-1){const I=k.videoCodecs.findIndex(M=>M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(I<O){b.debug("raising H264 baseline profile priority");const M=k.videoCodecs[O];k.videoCodecs.splice(O,1),k.videoCodecs.splice(I,0,M)}I!==-1&&U("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(M=>!(M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&M.fmtp&&M.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:S,recv:T,sendrecv:k}}({},{},i);this.remoteSDP=new B5({remoteIceParameters:r.iceParameters,remoteDtlsParameters:r.dtlsParameters,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const l=await this.peerConnection.createAnswer();if(!l.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const u=Fu(l.sdp);await this.peerConnection.setLocalDescription(l);const h=await VV({},{},l.sdp);this.localCapabilities=gb(h);const f=this.peerConnection.getTransceivers()[0];return f!=null&&f.receiver&&f.receiver.transport&&this.tryBindTransportEvents(f.receiver.transport),$u($u({},u),{},{sdp:l.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Fu(i.sdp);return this.initialOffer=i,$u($u({},r),{},{sdp:i.sdp})}}catch(n){throw new re(x.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:r}=t,a=await VV({},{},n);this.remoteSDP=new B5({remoteIceParameters:i,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const l=this.peerConnection.getTransceivers()[0];l!=null&&l.sender&&l.sender.transport&&this.tryBindTransportEvents(l.sender.transport)}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new re(x.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,i){var r=this;return ya(function*(){const a=yield Ft(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=[],u=r.remoteSDP.receive(t,n,i);t.forEach((I,M)=>{if(u[M].needCreateTransceiver){const L=r.peerConnection.addTransceiver(I._mediaStreamTrack,{direction:"sendonly"});l.push(L),I._updateRtpTransceiver(L)}else{const L=r.peerConnection.getTransceivers().find(j=>j.mid===u[M].mid);if(!L)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(u[M].mid));l.push(L),I._updateRtpTransceiver(L)}}),qn()&&U("SIMULCAST")===!0&&(yield Ft(r.applySimulcastForFirefox(l,t)));const h=u.map(I=>I.mid),f=yield Ft(r.peerConnection.createOffer()),E=r.mungSendOfferSDP(f.sdp,t,h),y=os(E),S=h.map(I=>{const M=y.mediaDescriptions.find(L=>L.attributes.mid===I);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return kV(M,U("USE_PUB_RTX"))}),T=l.map((I,M)=>{const L=h[M];return{localSSRC:S[M],id:L}});yield Ft(r.peerConnection.setLocalDescription({type:"offer",sdp:E}));try{yield T}catch(I){const M=r.remoteSDP.toString();throw yield Ft(r.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ft(r.peerConnection.setRemoteDescription({type:"answer",sdp:M})),yield Ft(r.stopSending(h,!0)),I}yield Ft(r.applySimulcastEncodings(l,t)),yield Ft(r.applySendEncodings(l,t));const k=r.remoteSDP.toString(),O=r.logSDPExchange(E,"offer","local","send");return O==null||O(k),yield Ft(r.setRemoteDescription({type:"answer",sdp:k})),l.map((I,M)=>{const L=h[M];return{localSSRC:S[M],id:L}})}catch(l){throw l instanceof re?l:new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{a()}})()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length (".concat(r.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));r.map(h=>{var f;h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});const a=await this.peerConnection.createOffer(),l=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();l==null||l(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(t,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:l}=this.remoteSDP.send(t,n,i,r);if(l){const h=this.remoteSDP.toString(),f=this.logSDPExchange(h,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:h});const E=await this.peerConnection.createAnswer(),y=this.mungReceiveAnswerSDP(E.sdp,a,t);f==null||f(y||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:y}),b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const u=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!u||u.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,mid:u.mid,transceiver:u}}catch(a){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async mockReceive(t,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:l}=this.remoteSDP.send(t,n,i,r);if(l){const u=this.remoteSDP.toString(),h=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(f.sdp,a,t);h==null||h(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(a){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Np.Auto&&(this.store.p2pTransport=Np.SdRtn,Bt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(U_.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Bt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(U_.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=Fu(n.sdp);return this.store.descriptionStart(),this.direction===Fr.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Fr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=Fu(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),l=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),l==null||l(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new re(x.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===t);i.length===1&&(this.isVP8Simulcast(n)?qn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:$u($u({},Zc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:$u($u({},Zc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;Re(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r={iceServers:[]};var a;return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Fy(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...U_.turnServerConfigToIceServers(t.turnServer.servers,n,i)),U("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...U_.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,i)),Re(a=[Np.Relay,Np.SdRtn]).call(a,n)&&(r.iceTransportPolicy="relay"),U("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(l=>{l.forceturn&&(r.iceTransportPolicy="relay")}))),U("ENABLE_ENCODED_TRANSFORM")&&Bt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),b.debug("P2PConnection p2pTransport is ".concat(n)),r}static turnServerConfigToIceServers(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=[],a=t.filter(u=>u.tcpport);b.debug("P2PConnection turnServers is ".concat(a,", current index is ").concat(i));const l=a.length>i?a[i]:a[0];switch(n){case Np.SdRtn:const u=t.filter(f=>{var E;return Re(E=f.username).call(E,"glb:")&&f.turnServerURL==f.turnServerURL}),h=u.length>i?u[i]:u[0];h&&(r.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(Vu(h.turnServerURL),":").concat(h.tcpport,"?transport=udp")}),r.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Vu(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;case Np.Relay:l&&(r.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=udp")}),r.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(Vu(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}));break;default:l&&(r.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=udp")}),r.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(Vu(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}),r.push({username:l.username,credential:l.password,credentialType:"password",urls:"stun:".concat(l.turnServerURL,":").concat(l.tcpport)}))}return r}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var i;t!=null&&t.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.state))},t.onerror=i=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in i?i.error:i)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const i=t==null?void 0:t.iceTransport.state;var r;i&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:r}=n.getSelectedCandidatePair()||{};if(i&&r){const a=i.address+":"+i.port,l=r.address+":"+r.port;b.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Vp(a)),", remote ").concat(JSON.stringify(Vp(l))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(E=>E.track===t._mediaStreamTrack)),!n)return b.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return b.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Bt().supportSetRtpSenderParameters)return b.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},a={};switch(t._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(t._encoderConfig){var l;const{bitrateMax:E,frameRate:y,scaleResolutionDownBy:S}=t._encoderConfig;E&&(a.maxBitrate=1e3*E),Re(l=t._hints).call(l,hn.LOW_STREAM)&&(y&&(a.maxFramerate=Ps(y)),S&&S>=1&&(a.scaleResolutionDownBy=S))}if(U("DSCP_TYPE")&&rd()){var u;const E=U("DSCP_TYPE");Re(u=["very-low","low","medium","high"]).call(u,E)&&(a.networkPriority=E)}const h=n.getParameters(),f=(i=h.encodings)===null||i===void 0?void 0:i[0];qn()&&!f&&(r.encodings=[a]),f&&Object.assign(f,a),Object.assign(h,r),b.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await n.setParameters(h)}async applySendEncodings(t,n){try{if(!Bt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const r=t[i],a=n[i];a instanceof In&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,r.sender)}}catch{b.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const r=os(t);return n.forEach((a,l)=>{const u=i[l],h=r.mediaDescriptions.find(f=>f.attributes.mid===u);h&&(g_(h,a),xV(h,a,this.store.codec))}),Lu(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let h=0;h<t.length;h++){var i,r,a,l,u;const f=t[h],E=n[h];if(E instanceof In&&!Re(i=E._hints).call(i,hn.LOW_STREAM)&&(r=E._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((a=E._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(l=E._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=E._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const y={},S={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};y.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const T=f.sender.getParameters();await f.sender.setParameters(Object.assign(T,y))}}}async applySimulcastEncodings(t,n){if(!qn()&&t.length===n.length)for(let i=0;i<t.length;i++){const r=n[i];if(r instanceof In&&this.isVP8Simulcast(r)){const a=t[i],l={},u={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,l))}}}isVP8Simulcast(t){var n,i,r,a,l;return!!(t instanceof In&&U("SIMULCAST")&&this.store.codec==="vp8"&&!Re(n=t._hints).call(n,hn.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=t._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(a=t._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((l=t._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(t,n,i,r){if(U("SDP_LOGGING"))return b.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",r)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(l=>{l.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();r==null||r(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async l=>{l.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();r==null||r(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var i;if(n=n??((i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp)){var r;const a=(r=os(n).mediaDescriptions.find(l=>l.attributes.mid===t))===null||r===void 0?void 0:r.attributes.ssrcs;return a==null?void 0:a[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),Re(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,i){const r=os(t),a=r.mediaDescriptions.find(l=>l.attributes.mid===n);return a&&i===xe.AUDIO&&a.media.mediaType==="audio"&&y_(a),Lu(r)}},Be(Nn.prototype,"establish",[po],Object.getOwnPropertyDescriptor(Nn.prototype,"establish"),Nn.prototype),Be(Nn.prototype,"connect",[po],Object.getOwnPropertyDescriptor(Nn.prototype,"connect"),Nn.prototype),Be(Nn.prototype,"receive",[po],Object.getOwnPropertyDescriptor(Nn.prototype,"receive"),Nn.prototype),Be(Nn.prototype,"mockReceive",[po],Object.getOwnPropertyDescriptor(Nn.prototype,"mockReceive"),Nn.prototype),Be(Nn.prototype,"stopReceiving",[po],Object.getOwnPropertyDescriptor(Nn.prototype,"stopReceiving"),Nn.prototype),Be(Nn.prototype,"restartICE",[po],Object.getOwnPropertyDescriptor(Nn.prototype,"restartICE"),Nn.prototype),Be(Nn.prototype,"close",[po],Object.getOwnPropertyDescriptor(Nn.prototype,"close"),Nn.prototype),Be(Nn.prototype,"updateEncoderConfig",[po],Object.getOwnPropertyDescriptor(Nn.prototype,"updateEncoderConfig"),Nn.prototype),Be(Nn.prototype,"updateSendParameters",[po],Object.getOwnPropertyDescriptor(Nn.prototype,"updateSendParameters"),Nn.prototype),Be(Nn.prototype,"replaceTrack",[po],Object.getOwnPropertyDescriptor(Nn.prototype,"replaceTrack"),Nn.prototype),Be(Nn.prototype,"muteLocal",[po],Object.getOwnPropertyDescriptor(Nn.prototype,"muteLocal"),Nn.prototype),Be(Nn.prototype,"unmuteLocal",[po],Object.getOwnPropertyDescriptor(Nn.prototype,"unmuteLocal"),Nn.prototype),Nn);function po(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,a=await r.lock("From P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},n}let $o=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var W5,Y5,z5,K5,q5,X5,J5,Z5,Q5,$5,ej,Fn;function tj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function tC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tj(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tj(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let sq=(W5=ec($o.SEND_ONLY),Y5=ec($o.SEND_ONLY),z5=ec(),K5=ec($o.RECEIVE_ONLY),q5=ec($o.RECEIVE_ONLY),X5=ec($o.RECEIVE_ONLY),J5=ec($o.RECEIVE_ONLY),Z5=ec($o.RECEIVE_ONLY),Q5=ec($o.RECEIVE_ONLY),$5=ec(),ej=ec($o.RECEIVE_ONLY),Fn=class extends Wn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Xe.StateChange,t,this._state)}constructor(e,t){super(),P(this,"isPlanB",!1),P(this,"store",void 0),P(this,"statsUploader",void 0),P(this,"sendConnection",void 0),P(this,"recvConnection",void 0),P(this,"localTrackMap",new Map),P(this,"remoteUserMap",new Map),P(this,"localDataChannels",[]),P(this,"pendingLocalTracks",[]),P(this,"pendingRemoteTracks",[]),P(this,"statsCollector",void 0),P(this,"dtlsFailedCount",0),P(this,"sendMutex",void 0),P(this,"recvMutex",void 0),P(this,"_state",$t.Disconnected),P(this,"_restartStates",["disconnected","failed"]),P(this,"reconnectInterval",void 0),P(this,"uploadUnplinkStarted",!1),P(this,"uploadDownlinkStarted",!1),P(this,"uplinkStateUploadInterval",void 0),P(this,"downlinkStatsUploadInterval",void 0),P(this,"handleMuteLocalTrack",async(n,i,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==$t.Connected)return void r(new re(x.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const h=this.filterTobeMutedTracks(n);if(h.length===0)return void i();const f=h.find(T=>T[0]==="videoLowTrack");f&&f[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(h.map(T=>{let[,{id:k}]=T;return k}));let E=!1;var l,u;n.trackMediaType==="video"?E=!((l=this.localTrackMap.get(me.LocalAudioTrack))===null||l===void 0||!l.track._muted):E=((u=this.localTrackMap.get(me.LocalVideoTrack))===null||u===void 0?void 0:u.id)===void 0;const y=this.createMuteMessage(h);await gn(this,Xe.RequestMuteLocal,y);const S=n.trackMediaType==="video"?Uu.MUTE_LOCAL_VIDEO:Uu.MUTE_LOCAL_AUDIO;await gn(this,Xe.RequestP2PMuteLocal,{action:S,message:y,isMuteAll:E}),i()}catch(h){r(h)}finally{a()}}),P(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==$t.Connected)return void r(new re(x.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const l=this.filterTobeUnmutedTracks(n);if(l.length===0)return void i();await this.sendConnection.unmuteLocal(l.map(f=>{let[,{id:E}]=f;return E}));const u=this.createUnmuteMessage(l),h=n.trackMediaType==="video"?Uu.UNMUTE_LOCAL_VIDEO:Uu.UNMUTE_LOCAL_AUDIO;await gn(this,Xe.RequestP2PMuteLocal,{action:h,message:u}),i()}catch(l){r(l)}finally{a()}}),P(this,"handleUpdateVideoEncoder",async(n,i,r,a)=>{let l;typeof a=="boolean"&&a||(l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const h=this.localTrackMap.get(me.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==n||this.state!==$t.Connected)return void i();const{id:f,track:E}=h;f&&(await this.sendConnection.updateSendParameters(f,E),await this.sendConnection.updateEncoderConfig(f,E),this.emit(Xe.UpdateVideoEncoder,E)),i()}catch(h){r(h)}finally{var u;(u=l)===null||u===void 0||u()}}),P(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const l=this.localTrackMap.get(me.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==n||this.state!==$t.Connected)return void i();const{id:u,track:h}=l;u&&await this.sendConnection.updateSendParameters(u,h),i()}catch(l){r(l)}finally{a()}}),P(this,"handleReplaceTrack",async(n,i,r,a)=>{let l;b.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof a=="boolean"&&a||(l=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var u;const f=Array.from(this.localTrackMap.entries()).find(E=>{let[,{track:y}]=E;return n===y});if(!this.sendConnection||!f||f[1].id===void 0||this.state!==$t.Connected)return void i();if(await((u=this.sendConnection)===null||u===void 0?void 0:u.replaceTrack(n,f[1].id)),f[0]===me.LocalVideoTrack&&Bt().supportDualStreamEncoding){const E=this.localTrackMap.get(me.LocalVideoLowTrack);if(E){const y=n._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=y,E.track._originMediaStreamTrack=y,await new Ne((S,T)=>{this.handleReplaceTrack(E.track,S,T,!0)})}}i()}catch(f){r(f)}finally{var h;(h=l)===null||h===void 0||h()}}),P(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),P(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),P(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),P(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new y3(e),this.bindStatsUploaderEvents(),this.sendMutex=new cr("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new cr("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},U("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new re(x.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new re(x.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(b.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new H5(e,this.store,Fr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(t);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=$t.New,this.sendConnection&&(b.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new H5(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new re(x.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=$t.Connected}async addRemoteCandidate(e,t){if(t===Fr.RECEIVE_ONLY){if(!this.sendConnection)throw new re(x.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new re(x.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var i=this;return ya(function*(){const r=yield Ft(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==$t.Connected){i.throwIfTrackTypeNotMatch(e);const f=e.filter(E=>i.pendingLocalTracks.indexOf(E)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(f))}i.store.pubId=i.store.pubId+1,hr.markPublishStart(i.store.clientId,i.store.pubId);const a=i.filterTobePublishedTracks(e,t,n);if(a.length===0)return void(yield Ft(i.tryToUnmuteAudio(e)));a.forEach(f=>{let{track:E,type:y}=f;const S=Date.now();i.store.publish(E.getTrackId(),y===me.LocalAudioTrack?"audio":"video",S)}),i.bindLocalTrackEvents(a);const l=yield Ft(i.sendConnection.send(a.map(f=>{let{track:E}=f;return E}),i.store.codec,i.store.audioCodec)),u=(yield Ft(l.next())).value,h=i.createGatewayPublishMessage(a,u);try{yield h}catch(f){throw l.throw(f),(f==null?void 0:f.code)===x.WS_ABORT&&a.forEach(E=>{let{track:y}=E;i.pendingLocalTracks.indexOf(y)===-1&&i.pendingLocalTracks.push(y)}),i.unbindLocalTrackEvents(a),f}yield Ft(l.next()),a.forEach(f=>{let{type:E}=f;i.statsCollector.addLocalStats(E)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(a,u),a.forEach(f=>{let{track:E,type:y}=f;const S=Date.now();i.store.publish(E.getTrackId(),y===me.LocalAudioTrack?"audio":"video",void 0,S)}),i.startUploadUplinkState()}finally{r()}})()}async unpublish(e){if(!this.sendConnection||this.state!==$t.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(r=>!Re(e).call(e,r)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(r=>r[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(r=>{let[,{id:a}]=r;return a})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[a,{track:l}]=r;return{type:a,track:l}})),t.forEach(r=>{let[a]=r;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===$t.Connected)return n&&n[1].track.close(),i;e.forEach(r=>{const a=this.pendingLocalTracks.indexOf(r);a!==-1&&this.pendingLocalTracks.splice(a,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:a,ssrcs:l}]=i;const u={stream_type:JY(a,r),ssrcs:l};a._muted||!a._enabled?t.push(u):n.push(u)}),t.length>0&&t.forEach(i=>{gn(this,Xe.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{gn(this,Xe.RequestUnmuteLocal,[i])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return ya(function*(){throw new re(x.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(b.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await nr(this,Xe.RequestRePublish,this.pendingLocalTracks),this.emit(Xe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new re(x.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,i){var r;if(!this.recvConnection)throw new re(x.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(e))!==null&&r!==void 0&&r.has(t))return;const{track:a,mid:l,transceiver:u}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),i);t===xe.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new d_(a,e.uid,e._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),u&&e._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new l_(a,e.uid,e._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),u&&e._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._videoTrack));const h=this.remoteUserMap.get(e);h?h.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const f=this.pendingRemoteTracks.findIndex(E=>{let{user:y,kind:S}=E;return y.uid===e.uid&&t===S});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Xe.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,i){if(!this.recvConnection)throw new re(x.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),i)}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(a=>{let{user:l,kind:u}=a;return t!==void 0?l.uid===e.uid&&t===u:l.uid===e.uid});if(i.forEach(a=>{const l=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(l,1)}),this.recvConnection||n||i.forEach(a=>{let{kind:l}=a;var u;if(l===xe.AUDIO)(u=e._audioTrack)===null||u===void 0||u._destroy(),e._audioTrack=void 0;else if(l===xe.VIDEO){var h;(h=e._videoTrack)===null||h===void 0||h._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const r=this.filterTobeUnSubscribedTracks(e,t);r.length!==0&&(await this.recvConnection.stopReceiving(r.map(a=>{let[,{id:l}]=a;return l})),this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),r.forEach(a=>{let[l,{kind:u}]=a;var h,f;if(u===xe.VIDEO&&l._videoSSRC&&((h=this.recvConnection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===xe.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0);else if(u===xe.AUDIO){var E;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((E=l._audioTrack)===null||E===void 0||E._destroy(),l._audioTrack=void 0)}}),r.forEach(a=>{let[,{kind:l}]=a;gn(this,Xe.RequestP2PMuteRemote,l)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[xe.VIDEO,xe.AUDIO].forEach(i=>{n.has(i)?gn(this,Xe.RequestP2PUnmuteRemote,i):gn(this,Xe.RequestP2PMuteRemote,i)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new re(x.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new re(x.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new re(x.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new re(x.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void b.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===xe.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||b.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(me.LocalAudioTrack);if((t==null?void 0:t.track)instanceof vi){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==me.LocalAudioTrack}).filter(i=>{let[r]=i;return!(e&&r===me.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===me.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(e,t,n,i,r){if(e){const l=this.localTrackMap.get(me.LocalAudioTrack),u=i?this.localTrackMap.get(me.LocalVideoLowTrack):this.localTrackMap.get(me.LocalVideoTrack);He.publish(this.store.sessionId,{eventElapse:hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.track.getTrackLabel(),videoName:u==null?void 0:u.track.getTrackLabel(),screenshare:(u==null?void 0:u.track._hints.indexOf(hn.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var a;n||(n=[]);const l=n.find(h=>h instanceof ni),u=i?(a=this.localTrackMap.get(me.LocalVideoTrack))===null||a===void 0?void 0:a.track:n.find(h=>h instanceof In);He.publish(this.store.sessionId,{eventElapse:hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.getTrackLabel(),videoName:u==null?void 0:u.getTrackLabel(),screenshare:(u==null?void 0:u._hints.indexOf(hn.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(e,t,n,i){const r=i===xe.VIDEO?n._videoSSRC:n._audioSSRC;r&&He.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===xe.VIDEO,audio:i===xe.AUDIO,peerid:n.uid,subscribeRequestid:i===xe.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:hr.measureFromSubscribeStart(this.store.clientId,r)})}reset(){b.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new cr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new cr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(me.LocalAudioTrack);if((e==null?void 0:e.track)instanceof vi){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=$t.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(me.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(me.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof In||t&&t.track instanceof ni?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(cs(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(me.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=gp(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(b.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=$t.Reconnecting,U("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case me.LocalVideoTrack:Re(t=i._hints).call(t,hn.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case me.LocalAudioTrack:i instanceof vi?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case me.LocalVideoLowTrack:}}),this.emit(Xe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(cs(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Xe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),b.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((e instanceof Wu?e.uid:e)===i.uid&&t===r)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,i;if(e===Fr.SEND_ONLY){if(!this.sendConnection)throw new re(x.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new re(x.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(t){const r=await i.restartICE(t);return i.isInRestartIce=!1,r}{const r=await i.restartICE();if(r){const a=await nr(this,Xe.RequestP2PRestartICE,{direction:Fr.RECEIVE_ONLY,iceParameter:r});await i.restartICE(a),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(me.LocalVideoTrack),n=this.localTrackMap.get(me.LocalAudioTrack),i=e.videoSend.find(T=>{var k;return T.ssrc===(t==null||(k=t.ssrcs)===null||k===void 0?void 0:k[0].ssrcId)}),r=e.audioSend.find(T=>{var k;return T.ssrc===(n==null||(k=n.ssrcs)===null||k===void 0?void 0:k[0].ssrcId)});if(!i||!r)return 1;const a=Js(this,Xe.NeedSignalRTT),l=i?i.rttMs:void 0,u=r?r.rttMs:void 0,h=l&&u?(l+u)/2:l||u,f=(h&&a?(h+a)/2:h||a)||0,E=100*e.sendPacketLossRate*.7/50+.3*f/1500,y=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,S=t==null?void 0:t.track;if(S&&S._encoderConfig&&S._hints.indexOf(hn.SCREEN_TRACK)===-1){const T=S._encoderConfig.bitrateMax,k=e.bitrate.actualEncoded;if(T&&k){const O=(1e3*T-k)/(1e3*T);return lV[O<.15?0:O<.3?1:O<.45?2:O<.6?3:4][y]}}return y}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,a=i._videoSSRC,l=e.audioRecv.find(k=>k.ssrc===r),u=e.videoRecv.find(k=>k.ssrc===a);if(!l&&!u)return void(t+=1);const h=Js(this,Xe.NeedSignalRTT),f=e.rtt,E=(f&&h?(f+h)/2:f||h)||0,y=l?l.jitterMs:void 0,S=e.recvPacketLossRate;let T=.7*S*100/50+.3*E/1500;y&&(T=.6*S*100/50+.2*E/1500+.2*y/400),t+=T<.1?1:T<.17?2:T<.36?3:T<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ne((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const i=[],r=Bt(),a=this.getAllTracks();e=Jm(e=e.filter(h=>a.indexOf(h)===-1));let l=!1,u=!1;for(const h of e){if(h instanceof In&&(this.localTrackMap.has(me.LocalVideoTrack)||l?new re(x.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:h,type:me.LocalVideoTrack}),l=!0),t)){const f=this.getLowVideoTrack(h,n);i.push({track:f,type:me.LocalVideoLowTrack})}if(h instanceof ni){const f=this.localTrackMap.get(me.LocalAudioTrack);if(f){if(!(f.track instanceof vi))throw new re(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new re(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0)}else if(u){const E=i.find(y=>{let{type:S}=y;return S===me.LocalAudioTrack});if(!(E.track instanceof vi))throw new re(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new re(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(h)}else{if(!r.webAudioMediaStreamDest||h instanceof vi||h._bypassWebAudio)i.push({track:h,type:me.LocalAudioTrack});else{const E=new vi;E.addAudioTrack(h),i.push({track:E,type:me.LocalAudioTrack})}u=!0}}}return i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Jm(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof ni){const r=this.localTrackMap.get(me.LocalAudioTrack);if(!r)continue;r.track instanceof vi?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(t.push([me.LocalAudioTrack,r]),r.track.close())):t.push([me.LocalAudioTrack,r])}if(i instanceof In){const r=this.localTrackMap.get(me.LocalVideoTrack);if(!r)continue;t.push([me.LocalVideoTrack,r]);const a=this.localTrackMap.get(me.LocalVideoLowTrack);a&&t.push([me.LocalVideoLowTrack,a])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case me.LocalVideoTrack:n.addListener(je.GET_STATS,this.handleGetLocalVideoStats),n.addListener(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(je.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case me.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case me.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof vi?e.trackList.forEach(n=>{n.addListener(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(je.GET_STATS,this.handleGetLocalAudioStats),n.addListener(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(je.GET_STATS,this.handleGetLocalAudioStats),e.addListener(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(je.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case me.LocalVideoTrack:n.off(je.GET_STATS,this.handleGetLocalVideoStats),n.off(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(je.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case me.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case me.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof vi?e.trackList.forEach(t=>{t.off(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(je.GET_STATS,this.handleGetLocalAudioStats),t.off(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(je.GET_STATS,this.handleGetLocalAudioStats),e.off(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(je.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof l_&&t.addListener(je.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof d_&&t.addListener(je.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(je.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(xe.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(xe.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var r;let a,{track:l,type:u}=n;switch(u){case me.LocalAudioTrack:a=tn.Audio;break;case me.LocalVideoTrack:a=Re(r=l._hints).call(r,hn.SCREEN_TRACK)?tn.Screen:tn.High;break;case me.LocalVideoLowTrack:a=tn.Low}return{kind:u===me.LocalAudioTrack?xe.AUDIO:xe.VIDEO,stream_type:a,mid:t[i].id,ssrcs:t[i].localSSRC,isMuted:l.muted||!l.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[r,{track:a,ssrcs:l,id:u}]=t;switch(r){case me.LocalVideoTrack:i=Re(n=a._hints).call(n,hn.SCREEN_TRACK)?tn.Screen:tn.High;break;case me.LocalAudioTrack:i=tn.Audio;break;case me.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:l,mid:u}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:r,type:a}=n;this.localTrackMap.set(a,{track:r,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Xe.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Re(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await qi(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),He.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Vn.TRACER}).onSuccess(),this.emit(Xe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(cs(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(Ta.FIRST_FRAME_DECODED),He.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_DECODE,Mn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(cs(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===t);i&&He.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_RECEIVED,Mn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoReceived=t=>{var n;const i=Array.from(cs(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===t);i&&He.firstRemoteFrame(this.store.sessionId,Oi.FIRST_VIDEO_RECEIVED,Mn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(Xe.ConnectionTypeChange,i),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ju(n))," -> ").concat(JSON.stringify(ju(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ju(n))," -> ").concat(JSON.stringify(ju(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Xe.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Fr.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,b.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Fr.SEND_ONLY?this.restartICE(e):nr(this,Xe.RequestP2PRestartICE,{direction:Fr.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(me.LocalAudioTrack);if(e instanceof ni&&(n==null?void 0:n.track)instanceof vi)return n.track.isActive||t.push([me.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return e===a});if(i&&(t.push(i),i[0]===me.LocalVideoTrack)){const r=this.localTrackMap.get(me.LocalVideoLowTrack);r&&t.push([me.LocalVideoLowTrack,r])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(me.LocalAudioTrack);if(e instanceof ni&&(n==null?void 0:n.track)instanceof vi)return n.track.isActive&&t.push([me.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return e===a});if(i)if(i[0]===me.LocalVideoTrack){t.push(i);const r=this.localTrackMap.get(me.LocalVideoLowTrack);r&&t.push([me.LocalVideoLowTrack,r])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[r,{track:a,ssrcs:l,id:u}]=t;switch(r){case me.LocalAudioTrack:i=tn.Audio;break;case me.LocalVideoTrack:i=Re(n=a._hints).call(n,hn.SCREEN_TRACK)?tn.Screen:tn.High;break;case me.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:l,mid:u}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[r,{track:a,ssrcs:l,id:u}]=t;switch(r){case me.LocalAudioTrack:i=tn.Audio;break;case me.LocalVideoTrack:i=Re(n=a._hints).call(n,hn.SCREEN_TRACK)?tn.Screen:tn.High;break;case me.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:l,mid:u}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const r=i.get(t);if(!r)return n;n.push([e,{kind:t,id:r}])}else Array.from(i.entries()).forEach(r=>{let[a,l]=r;n.push([e,{kind:a,id:l}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:r,id:a}]=n;switch(r){case xe.VIDEO:return void(i._videoSSRC&&t.push({stream_type:xe.VIDEO,ssrcId:i._videoSSRC}));case xe.AUDIO:return void(i._audioSSRC&&t.push({stream_type:xe.AUDIO,ssrcId:i._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(me.LocalVideoTrack),n=this.localTrackMap.get(me.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ne((i,r)=>{this.handleUpdateVideoEncoder(t.track,i,r,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ne((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof ni){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await gn(this,Xe.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Xe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Xe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await qi(lI(this.dtlsFailedCount,_i)),this.emit(Xe.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(me.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof In)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof In).length>1)throw new re(x.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof ni).length>1&&(e.some(t=>t instanceof ni&&t._bypassWebAudio)||!Bt().webAudioMediaStreamDest))throw new re(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof In&&this.pendingLocalTracks.some(n=>n instanceof In))throw new re(x.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof ni&&this.pendingLocalTracks.some(n=>n instanceof ni)&&(!Bt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof ni&&n._bypassWebAudio)))throw new re(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bt().supportDualStreamEncoding,i=tC(tC({},{width:160,height:120,framerate:15,bitrate:50}),t);let r;r=n?e._mediaStreamTrack.clone():CN(e,i);const a=yn(8,"track-low-"),l=new In(r,tC(tC({},n&&{scaleResolutionDownBy:sN(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return l.on(Dp.TRANSCEIVER_UPDATED,u=>{e._updateRtpTransceiver(u,i_.LOW_STREAM)}),l._hints.push(hn.LOW_STREAM),e.addListener(je.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,i){var r;const a=Array.from(cs(r=this.remoteUserMap).call(r)).find(l=>l._videoSSRC===e);if(a){i||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const l=this.store.keyMetrics,u=l.subscribe.find(h=>h.userId===a.uid&&h.type==="video");He.firstRemoteVideoDecode(this.store.sessionId,Oi.FIRST_VIDEO_DECODE,Mn.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:l.requestAPEnd||0,apStart:l.requestAPStart||0,joinGwEnd:l.joinGatewayEnd||0,joinGwStart:l.joinGatewayStart||0,pcEnd:l.peerConnectionEnd||0,pcStart:l.peerConnectionStart||0,subscriberEnd:(u==null?void 0:u.subscribeEnd)||0,subscriberStart:(u==null?void 0:u.subscribeStart)||0,videoAddNotify:(u==null?void 0:u.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const r=i.get(t);if(!r)return!1;const a=await this.recvConnection.getRemoteSSRC(r);return a!==void 0&&a!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new re(x.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new re(x.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new re(x.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new re(x.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new re(x.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new re(x.NOT_SUPPORTED)}async preConnect(e){throw new re(x.NOT_SUPPORTED)}getEstablishParams(){throw new re(x.NOT_SUPPORTED)}async reSubscribe(e){throw new re(x.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new re(x.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===me.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,i_.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Be(Fn.prototype,"p2pConnect",[W5],Object.getOwnPropertyDescriptor(Fn.prototype,"p2pConnect"),Fn.prototype),Be(Fn.prototype,"unpublish",[Y5],Object.getOwnPropertyDescriptor(Fn.prototype,"unpublish"),Fn.prototype),Be(Fn.prototype,"unpublishLowStream",[z5],Object.getOwnPropertyDescriptor(Fn.prototype,"unpublishLowStream"),Fn.prototype),Be(Fn.prototype,"subscribe",[K5],Object.getOwnPropertyDescriptor(Fn.prototype,"subscribe"),Fn.prototype),Be(Fn.prototype,"mockSubscribe",[q5],Object.getOwnPropertyDescriptor(Fn.prototype,"mockSubscribe"),Fn.prototype),Be(Fn.prototype,"unsubscribe",[X5],Object.getOwnPropertyDescriptor(Fn.prototype,"unsubscribe"),Fn.prototype),Be(Fn.prototype,"muteRemote",[J5],Object.getOwnPropertyDescriptor(Fn.prototype,"muteRemote"),Fn.prototype),Be(Fn.prototype,"unmuteRemote",[Z5],Object.getOwnPropertyDescriptor(Fn.prototype,"unmuteRemote"),Fn.prototype),Be(Fn.prototype,"hasRemoteMediaWithLock",[Q5],Object.getOwnPropertyDescriptor(Fn.prototype,"hasRemoteMediaWithLock"),Fn.prototype),Be(Fn.prototype,"disconnectForReconnect",[$5],Object.getOwnPropertyDescriptor(Fn.prototype,"disconnectForReconnect"),Fn.prototype),Be(Fn.prototype,"remoteMediaSsrcChanged",[ej],Object.getOwnPropertyDescriptor(Fn.prototype,"remoteMediaSsrcChanged"),Fn.prototype),Fn);function ec(e){return function(t,n,i){const r=t[n];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var a=arguments.length,l=new Array(a),u=0;u<a;u++)l[u]=arguments[u];switch(e){case $o.SEND_ONLY:{const h=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,l)}finally{h()}}case $o.RECEIVE_ONLY:{const h=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,l)}finally{h()}}default:{const h=await this.sendMutex.lock("From P2PChannel2.".concat(n)),f=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,l)}finally{h(),f()}}}},i}}class Xp extends Wn{constructor(t,n){super(),P(this,"signal",void 0),P(this,"token",void 0),P(this,"tokenTimeout",void 0),P(this,"tokenInterval",void 0),P(this,"_sequence",0),P(this,"userMap",new Map),P(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const i=()=>{this.signal.connectionState===wn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*U("P2P_TOKEN_INTERVAL"))};i()}async send(t,n,i,r,a){var l;if(this.userMap.size===0)return;const u=Array.from(Ir(l=this.userMap).call(l))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),r=r??yn(6,""),a=a??this._sequence++;const h={_id:r,_type:t,_seq:a,_message:n,token:"".concat(this.token,"_").concat(u)};U("SHOW_P2P_LOG")&&b.debug("send message",h,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(h)).forEach(E=>{this.signal.request(st.DATA_STREAM,{payload:Pu(this.encoder.encode(E))})});const f=new Ne((E,y)=>{const S=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),T),this.off("res-@".concat(r),O),this.off(m_.ABORT,k),b.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(r)),this.userMap.size===0?y(new re(x.INVALID_REMOTE_USER)):y(new re(x.TIMEOUT))},U("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),T=()=>{S&&window.clearTimeout(S),this.off(m_.ABORT,k),i&&E()},k=()=>{S&&window.clearTimeout(S),this.off("res-@".concat(r,"_ack"),T),this.off("res-@".concat(r),O),y(new re(x.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(r)))};this.once(m_.ABORT,k),this.once("res-@".concat(r,"_ack"),T);const O=(M,L)=>{I=!0,S&&window.clearTimeout(S),this.off("res-@".concat(r,"_ack"),T),this.off(m_.ABORT,k),M==="success"?E(L):y(new re(x.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(r)))};let I=!1;i||(this.once("res-@".concat(r),O),qi(U("SIGNAL_REQUEST_TIMEOUT")).then(()=>{I||b.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(r,", ").concat(h))}))});try{return await f}catch(E){if(E.code===x.TIMEOUT)return await this.send(t,n,i,r,a);throw E}}onMessage(t){var n;const{_uid:i}=t;let r,a=this.userMap.get(i);if(a)r=a.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==ci.CHECK)return;const{token:f}=t;r=new Map,a={uid:i,isStart:!0,token:f,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,a),this.signal.emit(Pt.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in t&&"total"in t){var l;const{id:f,total:E}=t,y=(l=r.get(f))!==null&&l!==void 0?l:[];if(y.push(t),r.has(f)||r.set(f,y),y.length!==E)return;{const S=gp(y).call(y,(T,k)=>T.index-k.index).map(T=>T.payload).join("");r.delete(f),(t=JSON.parse(S))._uid=i}}const{_type:u,token:h}=t;if(Re(n=[ci.ACK,ci.CHECK]).call(n,u))return u===ci.CHECK&&this.handleCheckToken(a,h),void this.receiveMessage(t);h==="".concat(a.token,"_").concat(this.token)?this.handleReceivedMessage(t):b.debug('Receive unexpected message", '.concat(h,", cur_token: ").concat(a.token,"_").concat(this.token),t)}check(){const t={_id:yn(6,""),token:this.token,_type:ci.CHECK};U("SHOW_P2P_LOG")&&b.debug("send message",t),this.signal.request(st.DATA_STREAM,{payload:Pu(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:ci.ACK,token:this.token};U("SHOW_P2P_LOG")&&b.debug("send message",n),this.signal.request(st.DATA_STREAM,{payload:Pu(this.encoder.encode(JSON.stringify(n)))})}response(t,n,i){this.send(ci.RESPONSE,JSON.stringify({success:!i,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(f=>{const{receivedMessagesMap:E,nextExpectedSequenceNumber:y}=f;for(;E.has(y);){const S=E.get(y);E.delete(y),this.receiveMessage(S),f.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:i,_seq:r}=t,a=this.userMap.get(i),{receivedMessagesMap:l,isStart:u,nextExpectedSequenceNumber:h}=a;if(r<h)return this.ack(t._id),void b.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(t._message));l.set(r,t),u&&r===h&&(this.receiveMessage(t),l.delete(h),a.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:i,_message:r,_uid:a}=t;if(U("SHOW_P2P_LOG")&&b.debug("receive message",t),n){let l;switch(t._type!==ci.ACK&&(r&&(l=JSON.parse(r)),this.ack(t._id)),t._type){case ci.CANDIDATE:case ci.CONTROL:this.signal.emit(i,l,a);break;case ci.PUBLISH:case ci.UNPUBLISH:case ci.RESTART_ICE:case ci.CALL:l.uid=a,nr(this.signal,i,l).then(u=>{this.response(t._id,u)}).catch(()=>{this.response(t._id,void 0,!0)});break;case ci.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case ci.RESPONSE:{const{success:u,message:h}=l;this.emit("res-@".concat(n),u?"success":"failed",h);break}}}}splitMessage(t){if(t.length<Xp.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:i}=JSON.parse(t),r=yn(6,"");let a=0,l=800;const u=Math.ceil(t.length/l);for(;t.length>0;){a++;const h={id:r,index:a,total:u,payload:t.slice(0,l),token:"".concat(this.token,"_").concat(i)};JSON.stringify(h).length>Xp.MAX_MESSAGE_SIZE?l-=50:(n.push(h),t=t.slice(l))}return n.map(h=>JSON.stringify(h))}handleCheckToken(t,n){return t.token!==n?(b.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{b.debug("token timeout, ".concat(n)),this.reset(t.uid)},U("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await nr(this.signal,ci.CALL,void 0),n=await this.send(ci.CALL,t);this.signal.emit(lt.P2P_CONNECTION,n,!0)}async reset(t,n){const i=this.userMap.get(t);i&&(this.emit(m_.ABORT),this.signal.emit(Pt.ON_USER_OFFLINE,{uid:i.uid,reason:bY.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(b.debug("change local token from ".concat(n," to ").concat(n)),this.token=yn(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(m_.ABORT)}}P(Xp,"MAX_SIZE",1),P(Xp,"MAX_MESSAGE_SIZE",1024);class aq extends Wn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===wn.CONNECTED?this.emit(lt.WS_CONNECTED):t===wn.RECONNECTING?this.emit(lt.WS_RECONNECTING,this._websocketReconnectReason):t===wn.CLOSED&&this.emit(lt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),P(this,"_disconnectedReason",void 0),P(this,"_websocketReconnectReason",void 0),P(this,"_connectionState",wn.CLOSED),P(this,"reconnectToken",void 0),P(this,"p2pToken",void 0),P(this,"websocket",void 0),P(this,"openConnectionTime",void 0),P(this,"clientId",void 0),P(this,"lastMsgTime",Date.now()),P(this,"uploadCache",[]),P(this,"uploadCacheInterval",void 0),P(this,"rttRolling",new DM(5)),P(this,"pingpongTimer",void 0),P(this,"pingpongTimeoutCount",0),P(this,"joinResponse",void 0),P(this,"multiIpOption",void 0),P(this,"initError",void 0),P(this,"spec",void 0),P(this,"store",void 0),P(this,"_external_signal",void 0),P(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(lt.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const a="res-@".concat(r._id);this.emit(a,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case Pt.ON_DATA_STREAM:return void this.handleDataStream(r._message);case Pt.MUTE_AUDIO:case Pt.MUTE_VIDEO:case Pt.ON_P2P_LOST:case Pt.ON_USER_ONLINE:return;case Pt.ON_USER_OFFLINE:const{uid:a}=r._message;return b.debug("[".concat(this.clientId,"] user-offline uid: ").concat(a)),void this._external_signal.reset(a)}if(this.emit(r._type,r._message),r._type===Pt.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Pt.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Qt.UID_BANNED);break;case 15:this.close(Qt.IP_BANNED);break;case 16:this.close(Qt.CHANNEL_BANNED)}if(r._type===Pt.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case et.ERR_LICENSE_MISSING:this.close(Qt.LICENSE_MISSING);break;case et.ERR_LICENSE_EXPIRED:this.close(Qt.LICENSE_EXPIRED);break;case et.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Qt.LICENSE_MINUTES_EXCEEDED);break;case et.ERR_LICENSE_PERIOD_INVALID:this.close(Qt.LICENSE_PERIOD_INVALID);break;case et.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Qt.LICENSE_MULTIPLE_SDK_SERVICE);break;case et.ERR_LICENSE_ILLEGAL:this.close(Qt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new iN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,U("JOIN_GATEWAY_USE_DUAL_DOMAIN"),U("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===wn.CONNECTED&&this.reconnect("retry",tr.OFFLINE)}),this.p2pToken=yn(6,""),this._external_signal=new Xp(this,this.p2pToken)}async request(t,n,i,r){const a=yn(6,""),l={_id:a,_type:t,_message:n},u=this.websocket.connectionID,h=()=>new Ne((k,O)=>{if(this.connectionState===wn.CONNECTED)return k();const I=()=>{this.off(lt.WS_CLOSED,M),k()},M=()=>{this.off(lt.WS_CONNECTED,I),O(new re(x.WS_ABORT))};this.once(lt.WS_CONNECTED,I),this.once(lt.WS_CLOSED,M)});if(this.connectionState!==wn.CONNECTING&&this.connectionState!==wn.RECONNECTING||t===st.JOIN||t===st.REJOIN||await h(),this.websocket.sendMessage(l,!0),r)return;const f=new Ne((k,O)=>{let I=!1;const M=(j,K)=>{I=!0,k({isSuccess:j==="success",message:K||{}}),this.off(lt.WS_CLOSED,L),this.off(lt.WS_RECONNECTING,L),this.emit(lt.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),M);const L=()=>{O(new re(x.WS_ABORT,"type: ".concat(t))),this.off(lt.WS_CLOSED,L),this.off(lt.WS_RECONNECTING,L),this.off("res-@".concat(a),M)};this.once(lt.WS_CLOSED,L),this.once(lt.WS_RECONNECTING,L),qi(U("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||I||(b.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(lt.REQUEST_TIMEOUT,t,n))})});let E=null;try{E=await f}catch(k){if(this.connectionState===wn.CLOSED||t===st.LEAVE)throw new re(x.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?k.throw():t===st.JOIN||t===st.REJOIN?null:(await h(),await this.request(t,n))}if(E.isSuccess)return E.message;const y=Number(E.message.error_code||E.message.code),S=Qy(y),T=new re(x.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(E.message.error_str),{code:y,data:E.message,desc:S.desc});return S.action==="success"?E.message:(b.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(y,", message: ").concat(S.desc,", action: ").concat(S.action)),y===et.ERR_TOO_MANY_BROADCASTERS?((t===st.JOIN||t===st.REJOIN)&&(this.initError=T,this.close()),T.throw()):S.action==="failed"?T.throw():S.action==="quit"?(this.initError=T,this.close(),T.throw()):(y===et.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,b.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",tr.MULTI_IP)):this.reconnect(S.action,tr.SERVER_ERROR),t===st.JOIN||t===st.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Ne(i=>{const r=a=>{(!n||n(a))&&(this.off(t,r),i(a))};this.on(t,r)})}uploadWRTCStats(t){if(!this.store.sessionId)return void b.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Jy.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const a=U("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==wn.CONNECTED)return;const l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},U("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(t,n,i){return await this._external_signal.send(t,n,i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ne((n,i)=>{this.once(lt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(lt.WS_CLOSED,()=>i(this.initError||new re(x.WS_ABORT))),this.connectionState=wn.CONNECTING,this.websocket.init(t).catch(i)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Qt.LEAVE,this.connectionState=wn.CLOSED,b.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=yn(6,""),this._external_signal.clear(),this._external_signal=new Xp(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(lt.ABORT_P2P_EXECUTION);const t=await nr(this,lt.REQUEST_JOIN_INFO),n=await this.request(st.JOIN,t);if(!n)return this.emit(lt.REPORT_JOIN_GATEWAY,x.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(lt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=wn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;const i=Op(t.payload),r=new TextDecoder().decode(i),a=JSON.parse(r);"total"in a&&"id"in a||Re(n=Object.values(ci)).call(n,a._type)?(a._uid=t.uid,this._external_signal.onMessage(a)):this.emit(Pt.ON_DATA_STREAM,t)}catch{this.emit(Pt.ON_DATA_STREAM,t)}}handleNotification(t){b.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Qy(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Qt.UID_BANNED),void this.close()):void this.reconnect(n.action,tr.SERVER_ERROR);b.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=U("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(b.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>U("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",tr.TIMEOUT):this.request(st.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),U("REPORT_STATS")&&this.send(st.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(_t.RECONNECT_CREATE_CONNECTION,t=>{this.emit(lt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(_t.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(_t.CLOSED,()=>{this.connectionState=wn.CLOSED}),this.websocket.on(_t.FAILED,()=>{this._disconnectedReason=Qt.NETWORK_ERROR,this.connectionState=wn.CLOSED}),this.websocket.on(_t.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===wn.CONNECTED?this.connectionState=wn.RECONNECTING:this.connectionState=wn.CONNECTING}),this.websocket.on(_t.WILL_RECONNECT,(t,n,i)=>{t!=="retry"?(b.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):b.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(t)}),this.websocket.on(_t.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(lt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof re&&t.code===x.UNEXPECTED_RESPONSE&&t.data.code===et.ERR_NO_AUTHORIZED)return b.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",tr.SERVER_ERROR);b.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",tr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(_t.REQUEST_NEW_URLS,(t,n)=>{nr(this,lt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const oq={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new sq(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new aq(n,t)}};function nj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function ij(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nj(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nj(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class cq{constructor(t){P(this,"sessionDesc",void 0),P(this,"localCapabilities",void 0),P(this,"rtpCapabilities",void 0),P(this,"candidates",void 0),P(this,"_originCandidates",void 0),P(this,"iceParameters",void 0),P(this,"dtlsParameters",void 0),P(this,"setup",void 0),P(this,"currentMidIndex",void 0),P(this,"cname",void 0),t=jn(t);const{iceParameters:n,dtlsParameters:i,candidates:r,rtpCapabilities:a,setup:l,localCapabilities:u,sdkCodec:h,cname:f}=t,E=os(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a,this.candidates=r,this._originCandidates=jn(r),this.iceParameters=n,this.dtlsParameters=i,this.setup=l,this.localCapabilities=u,this.cname=f;for(let y=0;y<E.mediaDescriptions.length;y++){const S=E.mediaDescriptions[y];if(S.attributes.iceUfrag=n.iceUfrag,S.attributes.icePwd=n.icePwd,S.attributes.fingerprints=i.fingerprints,S.attributes.candidates=r,S.attributes.setup=l,S.media.mediaType==="video"){S.media.fmts=a.videoCodecs.map(O=>O.payloadType.toString(10));const T=a.videoCodecs.filter(O=>{var I,M;return(I=O.rtpMap)===null||I===void 0?void 0:Re(M=I.encodingName.toLowerCase()).call(M,h)}),k=a.videoCodecs.filter(O=>!Re(T).call(T,O));S.attributes.payloads=[...T,...k],S.attributes.extmaps=a.videoExtensions}S.media.mediaType==="audio"&&(S.media.fmts=a.audioCodecs.map(T=>T.payloadType.toString(10)),S.attributes.payloads=a.audioCodecs,S.attributes.extmaps=a.audioExtensions),E.mediaDescriptions[y]=this.mungMediaDesc(S)}this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return Lu(this.sessionDesc)}send(t,n,i){const{ssrcs:r,ssrcGroups:a}=nS(n,this.cname),l=this.sessionDesc.mediaDescriptions.find(f=>t===xe.VIDEO?f.media.mediaType==="video":f.media.mediaType==="audio"),u=r[0].attributes.label,h=r[0].attributes.mslabel;return l.attributes.ssrcs=l.attributes.ssrcs.concat(r),l.attributes.ssrcGroups=l.attributes.ssrcGroups.concat(a),{id:u,mslabel:h}}batchSend(t){return t.map(n=>{let{kind:i,ssrcMsg:r}=n;return this.send(i,r,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],r=[],a=[];n.attributes.ssrcs.forEach(l=>{Re(t).call(t,l.attributes.label||"")?a.push(l):i.push(l)}),n.attributes.ssrcGroups.forEach(l=>{var u;Re(u=a.map(h=>h.ssrcId)).call(u,l.ssrcIds[0])||r.push(l)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=r})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,i){t.forEach((r,a)=>{const l=r._mediaStreamTrack,u=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===l.kind),h=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u],r);this.sessionDesc.mediaDescriptions[u]=h})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(r=>r.transport==="udp"),i=[];if(n.forEach(r=>{i.push(ij(ij({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),n.length!==0){switch(t){case ur.TCP_RELAY:this.candidates=i;break;case ur.UDP_TCP_RELAY:case ur.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(t){t=jn(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(t,n){const i=jn(t);return g_(i,n),oN(i,n),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===t);if(i!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=r}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,i){const r=this.sessionDesc.mediaDescriptions.find(l=>t===xe.VIDEO?l.attributes.mid==="video":l.attributes.mid==="audio");if(r){const l=r.attributes.ssrcs.find(u=>u.attributes.label===n);var a;l&&(l.attributes.label=i,(a=l.attributes.msid)===null||a===void 0||a.replace(n,i))}}mungMediaDesc(t){const n=jn(t);return aN(n),function(i){const r=i.attributes.extmaps.find(a=>_b(a.extensionName));r&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(r),1),i.attributes.payloads.forEach(a=>{const l=a.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");l!==-1&&a.rtcpFeedbacks.splice(l,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===t)return[i]}}var Sn;function rj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function nC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?rj(Object(n),!0).forEach(function(i){P(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rj(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let lq=(Sn=class jS extends gV{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Re(n=Object.keys(Yy)).call(n,t)}))]}constructor(t,n){super(t,n),P(this,"store",void 0),P(this,"peerConnection",void 0),P(this,"remoteSDP",void 0),P(this,"initialOffer",void 0),P(this,"statsFilter",void 0),P(this,"useRTX",!1),P(this,"localCapabilities",void 0),P(this,"localCandidateCount",0),P(this,"allCandidatesReceived",!1),P(this,"establishPromise",void 0),P(this,"mutex",void 0),this.store=n,this.mutex=new cr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(jS.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=mI(this.peerConnection,U("STATS_UPDATE_INTERVAL"),void 0,qn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Fu(t.sdp),i=tS(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:U("FILTER_VIDEO_FEC"),filterAudioFec:U("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,nC(nC({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new re(x.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new cq(nC(nC({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new re(x.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var i=this;return ya(function*(){const r=yield Ft(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=t.map(S=>i.peerConnection.addTrack(S._mediaStreamTrack)),l=yield Ft(i.peerConnection.createOffer()),u=os(l.sdp),h=t.map(S=>{const T=S._mediaStreamTrack,k=u.mediaDescriptions.find(O=>O.attributes.mid===T.kind);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return function(O,I,M){const L=O.attributes.ssrcs.filter(K=>K.attributes.label===I),j=O.attributes.ssrcGroups;if(L.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(j&&L.length>1){const K=j.find(z=>z.ssrcIds.indexOf(L[0].ssrcId)!==-1);return K?[{ssrcId:K.ssrcIds[0],rtx:M?K.ssrcIds[1]:void 0}]:[{ssrcId:L[0].ssrcId}]}return[{ssrcId:L[0].ssrcId}]}(k,T.id,i.useRTX)});let f;try{f=yield h}catch(S){throw a.forEach(T=>{er()&&T.replaceTrack(null),i.peerConnection.removeTrack(T)}),S}const E=i.mungSendOfferSDP(l.sdp,t);i.remoteSDP.receive(t,n,f);const y=i.remoteSDP.toString();return yield Ft(i.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ft(i.applySendEncodings(a,t)),yield Ft(i.peerConnection.setRemoteDescription({type:"answer",sdp:y})),t.map((S,T)=>{const k=S._mediaStreamTrack.id;return{localSSRC:h[T],id:k}})}catch(a){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{r()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(a=>{var l;return t.indexOf(((l=a.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(a=>{er()&&a.replaceTrack(null),this.peerConnection.removeTrack(a)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:a,mslabel:l}=this.remoteSDP.send(t,n,r),u=new Ne((E,y)=>{const S=setTimeout(()=>{y(new Error("Cannot receive track, id: ".concat(a)))},1e4),T=k=>{const O=xt();if((O.name==="Safari"&&Number(O.version)===11||vr())&&k.track.id!==a&&k.streams[0].id===l){var I;const M=k.streams[0].getTracks()[0];return(I=this.remoteSDP)===null||I===void 0||I.updateTrackLabel(t,a,k.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(S),void E(M)}if(k.track.id===a)return this.peerConnection.removeEventListener("track",T),clearTimeout(S),void E(k.track)};this.peerConnection.addEventListener("track",T)}),h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(f),{track:await u,id:a}}catch(a){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var r;return t.indexOf(((r=i.track)===null||r===void 0?void 0:r.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(er()&&i.track)i.track.enabled=!1;else{const r=i.getParameters();r.encodings.forEach(a=>a.active=!1),i.setParameters(r)}})}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(a=>{var l;return t.indexOf(((l=a.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async a=>{if(er()&&a.track)a.track.enabled=!0;else{const l=a.getParameters();l.encodings.forEach(u=>u.active=!0),await a.setParameters(l)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return ya(function*(){const i=yield Ft(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=Bt().supportPCSetConfiguration;if(t===ur.RELAY&&!r)return;if(r){const f=n.peerConnection.getConfiguration(),E=t===ur.RELAY?"relay":"all";f.iceTransportPolicy!==E&&(b.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(f.iceTransportPolicy,"] to [").concat(E,"]")),f.iceTransportPolicy=E,n.peerConnection.setConfiguration(f))}t!==ur.RELAY&&n.remoteSDP.updateCandidates(t);const a=yield Ft(n.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=Fu(a.sdp),{remoteIceParameters:u}=yield l.iceParameters;n.remoteSDP.restartICE(u);const h=n.remoteSDP.toString();yield Ft(n.peerConnection.setLocalDescription(a)),yield Ft(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(r){b.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new re(x.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getSenders().filter(r=>{var a;return((a=r.track)===null||a===void 0?void 0:a.id)===t});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getSenders().find(r=>{var a;return((a=r.track)===null||a===void 0?void 0:a.id)===n});i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new re(x.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new re(x.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},U("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Fy(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...jS.turnServerConfigToIceServers(t.turnServer.servers)),U("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...jS.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(f=>{var E;return((E=f.track)===null||E===void 0?void 0:E.id)===t._mediaStreamTrack.id})),!n)return b.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Bt().supportSetRtpSenderParameters)return b.warn("Browser not support set rtp-sender parameters");const r={},a={};if(t instanceof In)switch(t._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(U("DSCP_TYPE")&&rd()){var l;const f=U("DSCP_TYPE");Re(l=["very-low","low","medium","high"]).call(l,f)&&(a.networkPriority=f)}const u=n.getParameters(),h=(i=u.encodings)===null||i===void 0?void 0:i[0];h&&Object.assign(h,a),Object.assign(u,r),b.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await n.setParameters(u)}async applySendEncodings(t,n){try{if(!Bt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const r=t[i],a=n[i];r&&a&&await this.updateRtpSenderEncodings(a,r)}}catch{b.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const i=os(t);return n.forEach((r,a)=>{const l=r._mediaStreamTrack,u=i.mediaDescriptions.find(h=>h.attributes.mid===l.kind);u&&g_(u,r)}),Lu(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((a,l)=>{let{id:u,mslabel:h}=a;const{kind:f}=t[l];return new Ne((E,y)=>{const S=setTimeout(()=>{y(new Error("Cannot receive track, id: ".concat(u)))},1e4),T=k=>{const O=xt();if(O.name==="Safari"&&Number(O.version)===11&&k.track.id!==u&&k.streams[0].id===h){var I;const M=k.streams[0].getTracks()[0];return(I=this.remoteSDP)===null||I===void 0||I.updateTrackLabel(f,u,k.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(S),void E({track:M,id:u})}if(k.track.id===u)return this.peerConnection.removeEventListener("track",T),clearTimeout(S),void E({track:k.track,id:u})};this.peerConnection.addEventListener("track",T)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await Ne.all(n)}catch(n){throw new re(x.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Bt().supportPCSetConfiguration){const n=jS.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Be(Sn.prototype,"connect",[Oa],Object.getOwnPropertyDescriptor(Sn.prototype,"connect"),Sn.prototype),Be(Sn.prototype,"stopSending",[Oa],Object.getOwnPropertyDescriptor(Sn.prototype,"stopSending"),Sn.prototype),Be(Sn.prototype,"receive",[Oa],Object.getOwnPropertyDescriptor(Sn.prototype,"receive"),Sn.prototype),Be(Sn.prototype,"stopReceiving",[Oa],Object.getOwnPropertyDescriptor(Sn.prototype,"stopReceiving"),Sn.prototype),Be(Sn.prototype,"muteRemote",[Oa],Object.getOwnPropertyDescriptor(Sn.prototype,"muteRemote"),Sn.prototype),Be(Sn.prototype,"unmuteRemote",[Oa],Object.getOwnPropertyDescriptor(Sn.prototype,"unmuteRemote"),Sn.prototype),Be(Sn.prototype,"muteLocal",[Oa],Object.getOwnPropertyDescriptor(Sn.prototype,"muteLocal"),Sn.prototype),Be(Sn.prototype,"unmuteLocal",[Oa],Object.getOwnPropertyDescriptor(Sn.prototype,"unmuteLocal"),Sn.prototype),Be(Sn.prototype,"close",[Oa],Object.getOwnPropertyDescriptor(Sn.prototype,"close"),Sn.prototype),Be(Sn.prototype,"updateEncoderConfig",[Oa],Object.getOwnPropertyDescriptor(Sn.prototype,"updateEncoderConfig"),Sn.prototype),Be(Sn.prototype,"updateSendParameters",[Oa],Object.getOwnPropertyDescriptor(Sn.prototype,"updateSendParameters"),Sn.prototype),Be(Sn.prototype,"replaceTrack",[Oa],Object.getOwnPropertyDescriptor(Sn.prototype,"replaceTrack"),Sn.prototype),Be(Sn.prototype,"getRemoteSSRC",[Oa],Object.getOwnPropertyDescriptor(Sn.prototype,"getRemoteSSRC"),Sn.prototype),Sn);function Oa(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,a=await r.lock("Locking from P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},n}const dq={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new lq(n,t)}},uq={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Bt().supportWebRTCEncodedTransform)return void b.warning("browser not support audio encoded transform");if($R.has(e)||!e.track)return;const n={track:e.track};if(id()){if(!e.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(l){return void b.error("create audio-encoded-streams error",l&&l.message)}const a=new TransformStream({transform(l,u){n.controller||(n.controller=u),e.track&&e.track.id!==n.track.id&&(b.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const h=t.metadata&&t.metadata();h?function(f,E){const{chunk:y,controller:S}=E,T=Mu.METADATA;y.data=function(k,O,I){const M=I.byteLength,L=M+FI+tV,j=VI+jI+L,K=new ArrayBuffer(k.byteLength+j),z=new DataView(K);z.setUint8(0,eV),z.setUint16(1,L),z.setUint8(3,O),z.setUint16(4,M);for(let Z=0;Z<M;Z++)z.setUint8(6+Z,I[Z]);const H=new Uint8Array(z.buffer);return H.set(new Uint8Array(k),j),H.buffer}(y.data,T,f),S.enqueue(y)}(h,{chunk:l,controller:u}):u.enqueue(l)}});r.readable.pipeThrough(a).pipeTo(r.writable)}else if(er()){if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const r=QR(),a=new MessageChannel;await new Ne(u=>r.onmessage=h=>{h.data==="registered"&&u(void 0)});const l=new RTCRtpScriptTransform(r,{name:"audio-metadata-tx",port:a.port2},[a.port2]);e.transform=l,await new Ne(u=>r.onmessage=h=>{h.data==="started"&&u(void 0)}),a.port1.onmessage=u=>{var h;if(u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==n.track.id)b.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i);else if(u.data.getMetadata){const f=t.metadata&&t.metadata();f&&a.port1.postMessage({metadata:f})}},n.worker=r}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const r=$R.get(e);if(r){$R.delete(e);try{var a,l;(a=r.controller)===null||a===void 0||a.terminate(),(l=r.worker)===null||l===void 0||l.terminate()}catch(u){b.warning(u&&u.message)}}}$R.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Bt().supportWebRTCEncodedTransform)return void b.warning("browser not support audio encoded transform");if(sb.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(id()&&!vr()){if(!e.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");XO(Wt.CHROME,87,116)||(t.enableTopn=!1);let r=null;try{r=e.createEncodedStreams()}catch(l){return void b.error("create audio-encoded-streams error",l&&l.message)}const a=new TransformStream({transform(l,u){n.controller||(n.controller=u),e.track&&e.track.id!==n.track.id&&(b.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)),t.enableTopn?function(h,f,E){var y;const S=BI(new DataView(f.data));if(!S)return E.enqueue(f);const T=h.track.id;YW.set(T,h.track);const k=(y=S.tlv.find(K=>K.tag===Mu.AUDIO_LEVEL))===null||y===void 0?void 0:y.value;let O=0;typeof k=="number"&&(O=127-k);const I=Math.round(Math.pow(10,O/60)-1),{selected:M,speaker:L}=function(K,z){let H=u_.get(K);if(H||(H=function(Z){const se=new iV;return u_.set(Z,se),Ko||(Ko=new HW(U("TOPN_SILENCE_THRESHOLD")||500),Ko.on("ActiveSpeakerChanged",ue=>{ue!=null&&(nb=ue)})),Ko.addSpeakers([se]),se}(K)),u_.size<=rV)return{selected:!0,speaker:H};if(!Ko)throw new Error("no active speaker detector");return Ko.levelChanged(H.id,z),Mp=Ko.loudest.map(Z=>Z.id),nb&&!Re(Mp).call(Mp,nb)&&Mp.length>=rV&&Mp.pop(),{selected:Re(Mp).call(Mp,H.id)||H.id===nb,speaker:H}}(h,I),j=function(K,z,H){const Z=qo.get(K)||new WW(K,z);return Z.score=H,qo.set(K,Z),function(se){if(ib.set(se,!0),!rb)return void(rb=Date.now());const ue=Date.now();ue-rb>1e3&&(ib.get(se)?ib.set(se,!1):(sV(se),ib.delete(se)),rb=ue)}(K),Z}(T,h.track,L.energyScore);j.addSample(M),j.active&&(f.data=S.frame.buffer,E.enqueue(f))}(e,l,u):t.enableMetadata||t.enablePts?function(h,f,E,y){const S=new DataView(h.data),T=S.getUint8(0);let k;if((128&T)!=0&&T!==71){const M=function(L){if(L.byteLength<=0)return[];const j=[];let K=0;for(;K<L.byteLength;){const H=(128&L.getUint8(K))>>7,Z=127&L.getUint8(K);if(!(H&&K+4<=L.byteLength)){K++;break}{const se=L.getUint32(K,!1),ue=(16776192&se)>>10,Ee=1023&se;j.push({pt:Z,ts_offset:ue,length:Ee,data:new Uint8Array}),K+=4}}let z=L.byteLength-K;for(const H of j){if(H.length>z)return console.warn("Broken red payload"),[];H.length>0&&(H.data=new Uint8Array(L.buffer,L.byteOffset+K,H.length),K+=H.length,z-=H.length)}if(z>0){const H={pt:j.length>0?j[j.length-1].pt:0,ts_offset:0,length:z,data:new Uint8Array(L.buffer,L.byteOffset+K,z)};j.push(H)}return j}(S);if(M.length>0){const L=function(j){let K=0;for(let Z=0;Z<j.length;Z++)K+=Z<j.length-1?4:1,K+=j[Z].length;const z=new Uint8Array(K);let H=0;for(let Z=0;Z<j.length;Z++)if(Z<j.length-1){const se=(2147483648|(127&j[Z].pt)<<24|(262143&j[Z].ts_offset)<<10|1023&j[Z].length)>>>0;z[H++]=se>>24&255,z[H++]=se>>16&255,z[H++]=se>>8&255,z[H++]=255&se}else z[H++]=127&j[Z].pt;for(const Z of j)z.set(Z.data,H),H+=Z.length;return z}(M.map(j=>{const K=new Uint8Array(j.length);K.set(j.data);const z=BI(new DataView(K.buffer));return z!=null&&z.frame&&(j.data=z==null?void 0:z.frame),k=z,j}));h.data=L.buffer}}else k=BI(S),k&&(h.data=k.frame.buffer);if(f.enqueue(h),!k)return;const O=k.tlv.find(M=>M.tag===Mu.METADATA);O&&E&&O.value instanceof Uint8Array&&E(O.value);const I=k.tlv.find(M=>M.tag===Mu.AUDIO_64_BIT_PTS);I&&y&&I.value instanceof Uint8Array&&I.value.length==8&&y(new DataView(I.value.buffer).getBigUint64(0,!0))}(l,u,t.onMetadata,t.onPts):u.enqueue(l)}});r.readable.pipeThrough(a).pipeTo(r.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const r=QR(),a=new MessageChannel;await new Ne(u=>r.onmessage=h=>{h.data==="registered"&&u(void 0)});const l=new RTCRtpScriptTransform(r,{name:"audio-metadata-rx",port:a.port2},[a.port2]);e.transform=l,await new Ne(u=>r.onmessage=h=>{h.data==="started"&&u(void 0)}),a.port1.onmessage=u=>{var h;u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==n.track.id?(b.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)):u.data.metadata&&n.onMetadata?n.onMetadata(u.data.metadata):u.data.pts&&n.onPts&&n.onPts(u.data.pts)},n.worker=r}function i(){e.track.removeEventListener("ended",i),function(r){const a=sb.get(r);if(a){(function(h){const f=u_.get(h);f&&(u_.delete(h),Ko&&(Ko.removeSpeakers([f]),u_.size===0&&(Ko.destroy(),Ko=null)))})(r),sV(r.track.id),sb.delete(r);try{var l,u;(l=a.controller)===null||l===void 0||l.terminate(),(u=a.worker)===null||u===void 0||u.terminate()}catch(h){b.warning(h&&h.message)}}}(e)}sb.set(e,n),e.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(e,t){if(!Bt().supportWebRTCEncodedTransform)return void b.warning("browser not support video encoded transform");if(ab.has(e)||!e.track)return;const n={track:e.track};if(id()){if(!e.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(u){return void b.error("create video-encoded-streams error",u&&u.message)}const a=[];t.on("sei-to-send",u=>{a.push(u)});const l=new TransformStream({transform(u,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(b.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const f=cV(new Uint8Array(u.data)),E=a.shift();if(E){const y=function(S,T,k){switch(k){case YI:return function(O,I){const M=oV(I),L=M.length,j=Math.floor(L/255),K=L%255,z=new Uint8Array(6+j+1+L+O.byteLength);z[0]=0,z[1]=0,z[2]=0,z[3]=1,z[4]=6,z[5]=101;let H=0;for(;H<j;)z[6+H]=255,H++;return z[6+H]=K,H++,z.set(M,6+H),z.set(new Uint8Array(O),6+H+L),z.buffer}(S,T);case zI:return function(O,I){const M=oV(I),L=M.length,j=Math.floor(L/255),K=L%255,z=new Uint8Array(7+j+1+L+1+O.byteLength);z[0]=0,z[1]=0,z[2]=0,z[3]=1,z[4]=78,z[5]=1,z[6]=101;let H=0;for(;H<j;)z[7+H]=255,H++;return z[7+H]=K,H++,z.set(M,7+H),H+=L,z[7+H]=128,H++,z.set(new Uint8Array(O),7+H),z.buffer}(S,T);default:return null}}(u.data,E,f);y&&(u.data=y)}h.enqueue(u)}});r.readable.pipeThrough(l).pipeTo(r.writable)}else{if(!er())return;{if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const r=QR(),a=new MessageChannel;await new Ne(u=>r.onmessage=h=>{h.data==="registered"&&u(void 0)});const l=new RTCRtpScriptTransform(r,{name:"sei-tx",port:a.port2},[a.port2]);e.transform=l,await new Ne(u=>r.onmessage=h=>{h.data==="started"&&u(void 0)}),t.on("sei-to-send",u=>{a.port1.postMessage({sei:u})}),a.port1.onmessage=u=>{var h;u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==n.track.id&&(b.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=r}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const r=ab.get(e);if(r){ab.delete(e);try{var a,l;(a=r.controller)===null||a===void 0||a.terminate(),(l=r.worker)===null||l===void 0||l.terminate()}catch(u){b.warning(u&&u.message)}}}ab.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Bt().supportWebRTCEncodedTransform)return void b.warning("browser not support video encoded transform");if(!e.track)return;if(Xy.has(e)){const r=Xy.get(e);return void(r&&(r.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(id()){if(!e.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(l){return void b.error("create video-encoded-streams error",l&&l.message)}const a=new TransformStream({transform(l,u){n.controller||(n.controller=u),e.track&&e.track.id!==n.track.id&&(b.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const h=function(f,E){switch(E){case YI:return function(y){const S=new DataView(y.data);let T=0;for(;T+4<y.data.byteLength;){if(S.getUint8(T+0)===0&&S.getUint8(T+1)===0&&S.getUint8(T+2)===0&&S.getUint8(T+3)===1&&S.getUint8(T+4)===6){let k=T+6,O=0,I=0;for(;(I=S.getUint8(k++))===255;)O+=255;O+=I;const M=aV(y.data,k,O);return new Uint8Array(M)}T++}return null}(f);case zI:return function(y){const S=new DataView(y.data);let T=0;for(;T+5<y.data.byteLength;){if(S.getUint8(T+0)===0&&S.getUint8(T+1)===0&&S.getUint8(T+2)===0&&S.getUint8(T+3)===1&&S.getUint8(T+4)===78&&S.getUint8(T+5)===1&&S.getUint8(T+6)===101){let k=T+7,O=0,I=0;for(;(I=S.getUint8(k++))===255;)O+=255;O+=I;const M=aV(y.data,k,O);return new Uint8Array(M)}T++}return null}(f);default:return null}}(l,cV(new Uint8Array(l.data)));h&&n.onSei&&n.onSei(h),u.enqueue(l)}});r.readable.pipeThrough(a).pipeTo(r.writable)}else if(er()){if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const r=QR(),a=new MessageChannel;await new Ne(u=>r.onmessage=h=>{h.data==="registered"&&u(void 0)});const l=new RTCRtpScriptTransform(r,{name:"sei-rx",port:a.port2},[a.port2]);e.transform=l,await new Ne(u=>r.onmessage=h=>{h.data==="started"&&u(void 0)}),a.port1.onmessage=u=>{var h;u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==n.track.id?(b.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)):u.data.sei&&n.onSei&&n.onSei(u.data.sei)},n.worker=r}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}(function(r){const a=Xy.get(r);if(a){Xy.delete(r);try{var l,u;(l=a.controller)===null||l===void 0||l.terminate(),(u=a.worker)===null||u===void 0||u.terminate()}catch(h){b.warning(h&&h.message)}}})(e)}Xy.set(e,n),e.track.addEventListener("ended",i)}},hq={name:"InterceptFrame",create:()=>uq};_I(),on("PROCESS_ID","process-".concat(yn(8,""),"-").concat(yn(4,""),"-").concat(yn(4,""),"-").concat(yn(4,""),"-").concat(yn(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void b.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();b.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(Ln,i)){const{value:r,expires:a}=t[i];if(a&&a<=n)return;zo[i]=r,Ln[i]=r}})}catch(t){b.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(zo.AREAS)&&zo.AREAS.length>0&&uN(zo.AREAS,!0);const sj=(e,t,n)=>{b.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),on(e,t,n)};Hu(MK,!1),Hu(VK,!1),Hu(Ez,!1),Hu(XK,!1),Hu(kK,!1),Hu(oq,!1),Hu(dq,!1),Hu(hq,!1);const Ei=function(e){const t=new Wn,n=e,i={getListeners:t.getListeners.bind(t),on:(r,a)=>(function(l,u){l===tl.SECURITY_POLICY_VIOLATION&&j4(u,!0)}(r,a),t.on.bind(t)(r,a)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return V4(V4({},n),i)}({__TRACK_LIST__:n_,VERSION:Sa,BUILD:yI,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:sj,getParameter:U,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(i){let r;return Bt().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),r=(await i.createOffer()).sdp):r=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,r}(t);if(!n)return e;t.close(),t=null,e=function(i){const r={video:[],audio:[]};return i.match(/ VP8/i)&&r.video.push("VP8"),i.match(/ VP9/i)&&r.video.push("VP9"),i.match(/ AV1/i)&&r.video.push("AV1"),i.match(/ H264/i)&&r.video.push("H264"),i.match(/ H265/i)&&r.video.push("H265"),i.match(/ opus/i)&&r.audio.push("OPUS"),i.match(/ PCMU/i)&&r.audio.push("PCMU"),i.match(/ PCMA/i)&&r.audio.push("PCMA"),i.match(/ G722/i)&&r.audio.push("G722"),r}(n)}catch(t){throw new te(x.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=He.reportApiInvoke(null,{name:si.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Vn.TRACER});let t=!1;try{const a=window.RTCPeerConnection,l=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,u=window.WebSocket;t=!!(a&&l&&u),t&&tI()&&aM(75)&&new a().close()}catch(a){return b.error("check system requirement failed: ",a),!1}let n=!1;const i=xt();i.name===Wt.CHROME&&Number(i.version)>=58&&(Ho.engine.name!=="WebKit"||function(){const a=xt();if(MR()){if(a.os===Di.MAC_OS)return!0;if(a.os===Di.IOS){const l=Ho.os.version&&Ho.os.version.split(".");if(l&&Number(l[0])===14&&l[1]&&Number(l[1])>=3||l&&Number(l[0])>14)return!0}}return!1}())&&(n=!0),(i.name===Wt.FIREFOX&&Number(i.version)>=56||i.name===Wt.OPERA&&Number(i.version)>=45||i.name===Wt.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(vr()||eo())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||hM()||xt().name===Wt.QQ)&&(n=!0),b.debug("checkSystemRequirements, api:",t,"browser",n);const r=t&&n;return e.onSuccess(r),r},getDevices:function(e){return na.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return na.getRecordingDevices(e)},getCameras:function(e){return na.getCamerasDevices(e)},getElectronScreenSources:ax,getPlaybackDevices:function(e){return na.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=yn(5,"client-"),i=He.reportApiInvoke(null,{id:n,name:si.CREATE_CLIENT,options:[t],tag:Vn.TRACER});try{(function(r){Ai(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Ai(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&Ai(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&Ki(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&SM(r.turnServer),r.httpRetryConfig!==void 0&&yM(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&yM(r.websocketRetryConfig)})(t)}catch(r){throw i.onError(r),r}return(lM(16,0)||QO(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",b.debug("browser not support vp9, force use vp8")),on("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),i.onSuccess(),new gz(lo(lo({forceWaitGatewayResponse:!0},t),{},{role:Re(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=U("CAMERA_CAPTURE_CONFIG"),n=yn(8,"track-cam-"),i=He.reportApiInvoke(null,{id:n,tag:Vn.TRACER,name:si.CREATE_CAM_VIDEO_TRACK,options:[Cn({},e),t]});t&&(e.encoderConfig=t);const r=JR(e);let a=null;b.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{a=(await ta({video:r},n)).getVideoTracks()[0]||null}catch(u){throw i.onError(u),u}if(!a){const u=new re(x.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(u),u.throw(b)}if(e.optimizationMode&&UI(n,a,e,io(e.encoderConfig)),U("USE_STANDARD_BITRATE_DEFAULT")){const u=io(e.encoderConfig);e.encoderConfig=u,delete u.bitrateMax,delete u.bitrateMin}const l=new ZR(a,e,r,e.scalabiltyMode?zR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return i.onSuccess(l.getTrackId()),b.info("create camera video success, trackId:",n),l},createCustomVideoTrack:function(e){const t=yn(8,"track-cus-"),n=He.reportApiInvoke(null,{id:t,tag:Vn.TRACER,name:si.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});U("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const i=new In(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?zR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[hn.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),b.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(S){return _x(S)}(t):void 0;n&&(t="auto");const i=yn(8,"track-scr-v-"),r=He.reportApiInvoke(null,{id:i,tag:Vn.TRACER,name:si.CREATE_SCREEN_VIDEO_TRACK,options:[Cn({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const a=function(S){const T={};S.screenSourceType&&(T.mediaSource=S.screenSourceType),S.extensionId&&id()&&(T.extensionId=S.extensionId);const{displaySurface:k,selfBrowserSurface:O,surfaceSwitching:I,systemAudio:M,preferCurrentTab:L}=S;(Km(107)||JO(107)||$O(93))&&(k&&(Ai(k,"displaySurface",["browser","window","monitor"]),T.displaySurface=k),O?(Ai(O,"selfBrowserSurface",["exclude","include"]),T.selfBrowserSurface=O):T.selfBrowserSurface="include",I&&(Ai(I,"surfaceSwitching",["exclude","include"]),T.surfaceSwitching=I)),(Km(105)||JO(105)||$O(91))&&M&&(Ai(M,"systemAudio",["exclude","include"]),T.systemAudio=M),(Km(94)||JO(94)||$O(80))&&L&&(T.preferCurrentTab=!0),S.electronScreenSourceId&&(T.sourceId=S.electronScreenSourceId);const j=S.encoderConfig?CI(S.encoderConfig):null;return T.mandatory={chromeMediaSource:"desktop",maxWidth:j?j.width:void 0,maxHeight:j?j.height:void 0},j&&(j.frameRate&&(typeof j.frameRate=="number"?(T.mandatory.maxFrameRate=j.frameRate,T.mandatory.minFrameRate=j.frameRate):(T.mandatory.maxFrameRate=j.frameRate.max||j.frameRate.ideal||j.frameRate.exact||void 0,T.mandatory.minFrameRate=j.frameRate.min||j.frameRate.ideal||j.frameRate.exact||void 0),T.frameRate=j.frameRate),j.width&&(T.width=j.width),j.height&&(T.height=j.height)),T}(e);let l=null,u=null;const h=Bt();if(!h.supportShareAudio&&t==="enable"){const S=new re(x.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(S),S.throw(b)}b.info("start create screen video track with config",e,"withAudio",t,"trackId",i);const f=h.supportShareAudio&&t!=="disable";try{const S=await ta({screen:a,screenAudio:f?n||!0:void 0},i);l=S.getVideoTracks()[0]||null,u=S.getAudioTracks()[0]||null}catch(S){throw r.onError(S),S}if(!l){const S=new re(x.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(S),S.throw(b)}if(!u&&t==="enable"){l&&l.stop();const S=new re(x.SHARE_AUDIO_NOT_ALLOWED);return r.onError(S),S.throw(b)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(UI(i,l,e,e.encoderConfig&&CI(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const E=new In(l,e.encoderConfig?CI(e.encoderConfig):{},e.scalabiltyMode?zR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[hn.SCREEN_TRACK]);if(!u)return r.onSuccess(E.getTrackId()),b.info("create screen video track success","video:",E.getTrackId()),E;const y=new ni(u,void 0,yn(8,"track-scr-a-"),!1);return r.onSuccess([E.getTrackId(),y.getTrackId()]),b.info("create screen video track success","video:",E.getTrackId(),"audio:",y.getTrackId()),[E,y]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=U("CAMERA_CAPTURE_CONFIG"),i=yn(8,"track-mic-"),r=yn(8,"track-cam-"),a=He.reportApiInvoke(null,{id:"".concat(i,"-").concat(r),tag:Vn.TRACER,name:si.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const l=JR(t),u=Ex(e);let h=null,f=null;b.info("start create camera video track(".concat(r,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const S=await ta({audio:u,video:l},"".concat(i,"-").concat(r));h=S.getAudioTracks()[0],f=S.getVideoTracks()[0]}catch(S){throw a.onError(S),S}if(!h||!f){const S=new re(x.UNEXPECTED_ERROR,"can not find tracks in media stream");return a.onError(S),S.throw(b)}if(t.optimizationMode&&UI(r,f,t,io(t.encoderConfig)),U("USE_STANDARD_BITRATE_DEFAULT")){const S=io(t.encoderConfig);t.encoderConfig=S,delete S.bitrateMax,delete S.bitrateMin}const E=new qy(h,e,u,i),y=new ZR(f,t,l,t.scalabiltyMode?zR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r);return a.onSuccess([E.getTrackId(),y.getTrackId()]),b.info("create camera video track(".concat(r,") and microphone audio track(").concat(i,") success")),[E,y]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=yn(8,"track-mic-"),n=He.reportApiInvoke(null,{id:t,tag:Vn.TRACER,name:si.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=Ex(e);let r=null;b.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{r=(await ta({audio:i},t)).getAudioTracks()[0]||null}catch(l){throw n.onError(l),l}if(!r){const l=new re(x.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(l),l.throw(b)}const a=new qy(r,e,i,t);return n.onSuccess(a.getTrackId()),b.info("create microphone audio track success, trackId:",t),a},createCustomAudioTrack:function(e){const t=yn(8,"track-cus-"),n=He.reportApiInvoke(null,{id:t,tag:Vn.TRACER,name:si.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new ni(e.mediaStreamTrack,e.encoderConfig?KR(e.encoderConfig):{},t,!1);return b.info("create custom audio track success with config",e,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:i}=e;let{source:r}=e;const a={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":r,cacheOnlineFile:n,encoderConfig:i},l=yn(8,"track-buf-"),u=He.reportApiInvoke(null,{id:l,tag:Vn.TRACER,name:si.CREATE_BUFFER_AUDIO_TRACK,options:[a]});if(U("DISABLE_WEBAUDIO"))throw new re(x.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");b.info("start create buffer source audio track with config",JSON.stringify(a),"trackId",l);const h=r;if(!(r instanceof AudioBuffer))try{r=await async function(y,S){let T=null;if(typeof y=="string"){const O=iU.get(y);if(O)return b.debug("use cached audio resource: ",y),O;try{T=(await Yo(()=>Zr.get(y,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(I){throw new re(x.FETCH_AUDIO_FILE_FAILED,I.toString())}}else T=await new Ne((I,M)=>{const L=new FileReader;L.onload=j=>{j.target?I(j.target.result):M(new re(x.READ_LOCAL_AUDIO_FILE_ERROR))},L.onerror=()=>{M(new re(x.READ_LOCAL_AUDIO_FILE_ERROR))},L.readAsArrayBuffer(y)});const k=await function(O){const I=o_();return new Ne((M,L)=>{I.decodeAudioData(O,j=>{M(j)},j=>{L(new re(x.DECODE_AUDIO_FILE_FAILED,j.toString()))})})}(T);return typeof y=="string"&&S&&iU.set(y,k),k}(r,n)}catch(y){return u.onError(y),y.throw(b)}const f=new VW(r),E=new UW(h,f,i?KR(i):{},l);return b.info("create buffer source audio track success, trackId:",l),u.onSuccess(E.getTrackId()),E},setAppType:function(e){if(b.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw b.debug("Invalid appType"),new te(x.INVALID_PARAMS,"invalid app type",e);on("APP_TYPE",Math.floor(e))},setLogLevel:function(e){b.setLogLevel(e)},enableLogUpload:function(){U("USE_NEW_LOG")?on("UPLOAD_LOG",!0):b.enableLogUpload()},disableLogUpload:function(){U("USE_NEW_LOG")?on("UPLOAD_LOG",!1):b.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new a3},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=He.reportApiInvoke(null,{tag:Vn.TRACER,name:si.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof ni||e instanceof d_)){const h=new te(x.INVALID_TRACK,"the parameter is not a audio track");return n.onError(h),h.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof ni?e.getTrackLabel():"remote_track",r=e.getVolumeLevel();let a=r,l=r;const u=Date.now();return new Ne(h=>{const f=setInterval(()=>{const E=e.getVolumeLevel();a=E>a?E:a,l=E<l?E:l;const y=a-l>1e-4,S=Date.now()-u;if(y||S>t){clearInterval(f);const T=y,k={duration:S,deviceLabel:i,maxVolumeLevel:a,result:T};b.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(k))),n.onSuccess(k),h(T)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=He.reportApiInvoke(null,{tag:Vn.TRACER,name:si.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof In||e instanceof l_)){const y=new te(x.INVALID_TRACK,"the parameter is not a video track");return n.onError(y),y.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof In?e.getTrackLabel():"remote_track",r=e.getMediaStreamTrack(!0),a=document.createElement("video");a.style.width="1px",a.style.height="1px",a.setAttribute("muted",""),a.muted=!0,a.setAttribute("playsinline",""),a.controls=!1,(er()||MR())&&(a.style.opacity="0.01",a.style.position="fixed",a.style.left="0",a.style.top="0",document.body.appendChild(a)),a.srcObject=new MediaStream([r]),a.play();const l=document.createElement("canvas");l.width=160,l.height=120;let u=0,h=0;try{const y=Date.now();u=await function(S,T,k,O){let I,M=0,L=null;return new Ne((j,K)=>{function z(){M>O&&I&&(I(),j(M));const H=k.getContext("2d");if(!H){const ue=new te(x.UNEXPECTED_ERROR,"can not get canvas 2d context.");return b.error(ue.toString()),void K(ue)}H.drawImage(S,0,0,160,120);const Z=H.getImageData(0,0,k.width,k.height),se=Math.floor(Z.data.length/3);if(L){for(let ue=0;ue<se;ue+=3)if(Z.data[ue]!==L[ue])return M+=1,void(L=Z.data);L=Z.data}else L=Z.data}setTimeout(()=>{I&&(I(),j(M))},T),I=NI(()=>{z()},30)})}(a,t,l,4),h=Date.now()-y}catch(y){throw n.onError(y),y}iz===Wt.SAFARI&&(a.pause(),a.remove()),a.srcObject=null;const f=u>4,E={duration:h,changedPicNum:u,deviceLabel:i,result:f};return b.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(E))),n.onSuccess(E),f},setArea:uN,audioElementPlayCenter:Qr,resumeAudioContext:function(){Qr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Sz.processExternalMediaAEC(e)},registerExtensions:function(e){const t=U("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!Re(t).call(t,n.name)&&t.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=b.extLog,i.reporter.hookApiInvoke=He.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(r=>{i.parameters[r]=U(r)})}),sj("PLUGIN_INFO",t)},ChannelMediaRelayError:p_,ChannelMediaRelayEvent:od,ChannelMediaRelayState:ls,RemoteStreamFallbackType:NW,RemoteStreamType:IW,ConnectionDisconnectedReason:Qt,AudienceLatencyLevelType:aW,AREAS:zt,preload:async function(e,t,n,i){return N3(e,t,n,i)}});return Object.defineProperties(Ei,{onAudioAutoplayFailed:{get:()=>ia.onAudioAutoplayFailed,set:e=>{ia.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>ia.onAutoplayFailed,set:e=>{ia.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ei._onSecurityPolicyViolation,set(e){Ei._onSecurityPolicyViolation=e,j4(e)}},__CLIENT_LIST__:{get:()=>U("SHOW_GLOBAL_CLIENT_LIST")?xp:[]}}),na.on(kp.CAMERA_DEVICE_CHANGED,e=>{b.info("camera device changed",JSON.stringify(e)),Ei.onCameraChanged&&Ei.onCameraChanged(e),Ei.safeEmit(tl.CAMERA_CHANGED,e)}),na.on(kp.RECORDING_DEVICE_CHANGED,e=>{b.info("microphone device changed",JSON.stringify(e)),Ei.onMicrophoneChanged&&Ei.onMicrophoneChanged(e),Ei.safeEmit(tl.MICROPHONE_CHANGED,e)}),na.on(kp.PLAYOUT_DEVICE_CHANGED,e=>{b.debug("playout device changed",JSON.stringify(e)),Ei.onPlaybackDeviceChanged&&Ei.onPlaybackDeviceChanged(e),Ei.safeEmit(tl.PLAYBACK_DEVICE_CHANGED,e)}),Qr.onAutoplayFailed=()=>{b.info("detect audio element autoplay failed"),ia.onAudioAutoplayFailed&&ia.onAudioAutoplayFailed()},cn.on("autoplay-failed",()=>{b.info("detect webaudio autoplay failed"),ia.onAudioAutoplayFailed&&ia.onAudioAutoplayFailed(),Ei.safeEmit(tl.AUTOPLAY_FAILED)}),cn.on(Ji.STATE_CHANGE,(e,t)=>{b.info("audio context state changed: ".concat(t," => ").concat(e)),Ei.onAudioContextStateChanged&&Ei.onAudioContextStateChanged(e,t),Ei.safeEmit(tl.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),hi.on(Xm.NETWORK_STATE_CHANGE,(e,t)=>{b.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Ei),Ei})}(wC)),wC.exports}var Nre=Ire();const US=aF(Nre),sF="04d8a9031217470bb3b5c0d6b7a0db55",Zn=rh({autoConnect:!1,transports:["websocket","polling"]});function Dre(){const[o,d]=J.useState([]),[m,_]=J.useState(""),[v,w]=J.useState([]),[D,B]=J.useState(null),[W,F]=J.useState(!1),[X,Q]=J.useState([]),[oe,Ae]=J.useState("disconnected"),[ie]=J.useState(()=>US.createClient({mode:"rtc",codec:"vp8"})),[fe,ae]=J.useState({audio:null,video:null}),[ve,be]=J.useState([]),[_e,Qe]=J.useState(!1),[Ye,Et]=J.useState(!1),[Ge,Je]=J.useState(null),we=J.useRef(null),We=J.useRef(null),ct=J.useRef(null),Tt=J.useRef(null),rn=J.useRef(null),fn=Ad(),bn=localStorage.getItem("token"),De=localStorage.getItem("email"),Ue=localStorage.getItem("userId"),rt=at=>at?at.split("@")[0]:"User",sn=at=>new Date(at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});J.useEffect(()=>{bn&&(wt.defaults.headers.common.Authorization=`Bearer ${bn}`,wt.defaults.withCredentials=!0)},[bn]);const ne=at=>{const Ze=Date.now()+Math.random();Q(St=>[...St,{id:Ze,text:at}]),setTimeout(()=>{Q(St=>St.filter(Ht=>Ht.id!==Ze))},4e3)},Ke=()=>{var at;(at=Tt.current)==null||at.scrollIntoView({behavior:"smooth"})};J.useEffect(()=>{Ke()},[o]);const gt=async at=>{var Ze;try{const St=await wt.get(`/api/chat/history/${at}`);d(St.data.items||[])}catch(St){if(console.error("Failed to fetch chat history:",St),((Ze=St.response)==null?void 0:Ze.status)===401){ne("Session expired. Please login again."),da();return}d([])}},bt=async at=>{var Ze,St;try{const Ht=await wt.get(`/api/connection/getStatus/${at}`);return Ht.data.success!==void 0?Ht.data:{success:!0,available:!0,online:!0}}catch(Ht){if(console.error("Call availability check failed:",Ht),((Ze=Ht.response)==null?void 0:Ze.status)===500)return console.warn("Server error checking availability, proceeding with call"),{success:!0,available:!0,online:!0};throw((St=Ht.response)==null?void 0:St.status)===401?new Error("Please login again"):new Error("Failed to check user availability")}},it=(at,Ze)=>{const St=[at,Ze].sort();return`chat-${St[0]}-${St[1]}`},en=async at=>{var Ze;try{const St=await wt.post("/api/agora/token",{channelName:at,userId:Ue});return St.data.warning?(console.warn("No Agora certificate - using null token for testing"),null):St.data.token}catch(St){throw console.error("Failed to get Agora token:",St),((Ze=St.response)==null?void 0:Ze.status)===401?new Error("Authentication failed. Please login again."):St}},Nt=async(at=!0)=>{if(!(D!=null&&D.id)){ne("Select someone to call first.");return}try{console.log("Starting Agora call:",at?"video":"audio"),Et(!0),Je(at?"video":"audio");try{const Ci=await bt(D.id);if(!Ci.available)throw new Error(Ci.reason||"User is not available for calls")}catch(Ci){console.warn("Could not verify user status, proceeding with call:",Ci.message)}const Ze=it(Ue,D.id);rn.current=Ze;const St=await en(Ze);await ie.join(sF,Ze,St,parseInt(Ue));const Ht=await US.createMicrophoneAudioTrack();let $n=null;at&&($n=await US.createCameraVideoTrack()),ae({audio:Ht,video:$n});const Un=$n?[Ht,$n]:[Ht];await ie.publish(Un),$n&&we.current&&$n.play(we.current),Et(!1),Qe(!0),Zn.emit("agoraCallUser",{to:D.id,channelName:Ze,callType:at?"video":"audio",from:Ue,email:De}),ne(`Calling ${rt(D.email)}...`)}catch(Ze){console.error("Agora call failed:",Ze),ne(Ze.message||"Call failed"),Et(!1),qe()}},ke=async(at,Ze)=>{try{console.log("Answering Agora call"),Qe(!0),Je(Ze?"video":"audio"),rn.current=at;const St=await en(at);await ie.join(sF,at,St,parseInt(Ue));const Ht=await US.createMicrophoneAudioTrack();let $n=null;Ze&&($n=await US.createCameraVideoTrack()),ae({audio:Ht,video:$n});const Un=$n?[Ht,$n]:[Ht];await ie.publish(Un),$n&&we.current&&$n.play(we.current),ne("Call connected")}catch(St){console.error("Failed to answer call:",St),ne("Failed to answer call"),qe()}},qe=async()=>{console.log("Ending Agora call");try{fe.audio&&fe.audio.close(),fe.video&&fe.video.close(),await ie.leave(),ae({audio:null,video:null}),be([]),Qe(!1),Et(!1),Je(null),rn.current=null,we.current&&(we.current.srcObject=null),We.current&&(We.current.srcObject=null),D!=null&&D.id&&Zn.emit("agoraEndCall",{to:D.id})}catch(at){console.error("Error ending call:",at)}};J.useEffect(()=>{const at=async(Ht,$n)=>{console.log("User published:",Ht.uid,$n),await ie.subscribe(Ht,$n),$n==="video"&&We.current&&Ht.videoTrack.play(We.current),$n==="audio"&&Ht.audioTrack.play(),be(Un=>Un.find(_s=>_s.uid===Ht.uid)?Un.map(_s=>_s.uid===Ht.uid?Ht:_s):[...Un,Ht])},Ze=(Ht,$n)=>{console.log("User unpublished:",Ht.uid,$n),$n==="video"&&We.current&&(We.current.srcObject=null)},St=Ht=>{console.log("User left:",Ht.uid),be($n=>$n.filter(Un=>Un.uid!==Ht.uid)),We.current&&(We.current.srcObject=null),ne("User left the call")};return ie.on("user-published",at),ie.on("user-unpublished",Ze),ie.on("user-left",St),()=>{ie.off("user-published",at),ie.off("user-unpublished",Ze),ie.off("user-left",St)}},[ie]),J.useEffect(()=>{if(!bn||!Ue){fn("/");return}const at=()=>{console.log("Socket connected:",Zn.id),Ae("connected"),Zn.emit("join",{token:bn,email:De,userId:Ue})},Ze=()=>{console.log("Socket disconnected"),Ae("disconnected")},St=Xt=>{console.error("Socket error:",Xt),Xt.message==="Authentication failed"&&(ne("Authentication failed. Please login again."),da())},Ht=Xt=>{const pc={...Xt,timestamp:Xt.timestamp||new Date().toISOString()};d(fc=>[...fc,pc]),Xt.from!==Ue&&ne(`${rt(Xt.user)} sent a message`)},$n=Xt=>{w(Xt||[])},Un=Xt=>{D&&Xt===D.email&&(F(!0),clearTimeout(ct.current),ct.current=setTimeout(()=>F(!1),1500))},Ci=async({channelName:Xt,callType:pc,from:fc,email:Ms})=>{console.log("Incoming Agora call:",Xt,pc),window.confirm(`${rt(Ms)} is calling you (${pc}). Accept?`)?(await ke(Xt,pc==="video"),Zn.emit("agoraCallAccepted",{to:fc})):Zn.emit("agoraCallDeclined",{to:fc})},_s=()=>{console.log("Agora call accepted"),ne("Call connected")},hc=()=>{console.log("Agora call declined"),ne("Call declined"),qe()},df=()=>{console.log("Agora call ended by peer"),qe(),ne("Call ended")},sh=({message:Xt})=>{console.log("Agora call failed:",Xt),ne(Xt||"Call failed"),qe()};return Zn.on("connect",at),Zn.on("disconnect",Ze),Zn.on("error",St),Zn.on("message",Ht),Zn.on("onlineUsers",$n),Zn.on("typing",Un),Zn.on("agoraCallUser",Ci),Zn.on("agoraCallAccepted",_s),Zn.on("agoraCallDeclined",hc),Zn.on("agoraEndCall",df),Zn.on("agoraCallFailed",sh),Zn.connected||Zn.connect(),()=>{Zn.off("connect",at),Zn.off("disconnect",Ze),Zn.off("error",St),Zn.off("message",Ht),Zn.off("onlineUsers",$n),Zn.off("typing",Un),Zn.off("agoraCallUser",Ci),Zn.off("agoraCallAccepted",_s),Zn.off("agoraCallDeclined",hc),Zn.off("agoraEndCall",df),Zn.off("agoraCallFailed",sh),qe(),Zn.disconnect()}},[bn,De,fn,D,Ue,ie]),J.useEffect(()=>{D&&gt(D.id)},[D]);const qt=at=>{(_e||Ye)&&qe(),B(at),d([]),gt(at.id),F(!1)},an=at=>{if(at.preventDefault(),!D||!m.trim())return;const Ze={from:Ue,user:De,text:m.trim(),to:D.id,timestamp:new Date().toISOString()};Zn.emit("sendMessage",{userId:Ue,to:D.id,text:m.trim(),timestamp:new Date().toISOString()}),d(St=>[...St,Ze]),_("")},br=at=>{_(at.target.value),D!=null&&D.id&&Zn.emit("typing",D.id)},da=()=>{localStorage.removeItem("token"),localStorage.removeItem("email"),localStorage.removeItem("userId"),delete wt.defaults.headers.common.Authorization,qe(),fn("/")};return N.jsxs("div",{className:"chat-container",children:[N.jsxs("aside",{className:"sidebar",children:[N.jsxs("div",{className:"user-list-header",children:[N.jsxs("h3",{children:["Online Users (",v.length,")"]}),N.jsx("button",{className:"logout-btn",onClick:da,children:"Logout"})]}),N.jsxs("div",{className:"connection-status",style:{padding:"5px 10px",marginBottom:"10px",borderRadius:"5px",backgroundColor:oe==="connected"?"#4CAF50":"#f44336",color:"white",fontSize:"12px"},children:["Status: ",oe]}),N.jsx("ul",{className:"user-list",children:v.length===0?N.jsx("li",{style:{padding:"10px",color:"#aaa",fontSize:"14px"},children:"No online users found"}):v.map(at=>N.jsxs("li",{className:`user-item ${(D==null?void 0:D.id)===at.id?"selected-user":""}`,onClick:()=>qt(at),title:at.email,children:[N.jsx("span",{className:"online-dot"}),N.jsx("img",{src:`https://ui-avatars.com/api/?name=${encodeURIComponent(rt(at.email))}&background=45a29e&color=fff&rounded=true&size=34`,alt:at.email,className:"user-avatar"}),N.jsxs("div",{className:"user-info",children:[N.jsx("span",{className:"user-name",children:rt(at.email)}),N.jsx("small",{className:"last-seen",children:"Online"})]})]},at.id))})]}),N.jsxs("main",{className:"chat-main",children:[D&&N.jsxs("header",{className:"chat-header flex-shrink-0",children:[N.jsxs("div",{className:"chat-with",children:[N.jsxs("h1",{children:["Chat with ",rt(D.email)]}),N.jsx("span",{className:"status-pill",children:v.find(at=>at.id===D.id)?"Online":"Offline"})]}),N.jsxs("div",{className:"call-controls",children:[N.jsx("button",{className:"call-btn",onClick:()=>Nt(!0),disabled:Ye||_e,children:"Video Call"}),N.jsx("button",{className:"call-btn",onClick:()=>Nt(!1),disabled:Ye||_e,children:"Audio Call"}),(_e||Ye)&&N.jsx("button",{className:"end-call-btn",onClick:qe,children:"End Call"})]})]}),N.jsxs("div",{className:"chat-messages",id:"chat-scroll-area",children:[o.map((at,Ze)=>{const St=at.from===Ue;return N.jsx("div",{className:`message ${St?"my-message":"their-message"}`,children:N.jsxs("div",{className:"message-content",children:[!St&&N.jsxs("strong",{className:"sender",children:[rt(at.user),": "]}),N.jsx("span",{children:at.text}),N.jsx("span",{className:"message-time",children:sn(at.timestamp)})]})},Ze)}),N.jsx("div",{ref:Tt}),W&&D&&N.jsxs("div",{className:"typing-indicator",children:[rt(D.email)," is typing..."]})]}),D&&N.jsxs("form",{className:"message-form flex-shrink-0",onSubmit:an,children:[N.jsx("input",{type:"text",placeholder:"Type a message...",value:m,onChange:br,autoComplete:"off"}),N.jsx("button",{type:"submit",disabled:!m.trim(),"aria-label":"Send message",children:"Send"})]}),(_e||Ye)&&N.jsxs("div",{className:"video-container",children:[N.jsxs("div",{className:"video-tile",children:[N.jsx("video",{className:"my-video",playsInline:!0,muted:!0,ref:we,autoPlay:!0,style:{display:Ge==="audio"?"none":"block"}}),N.jsxs("div",{className:"video-label",children:["You ",Ge==="audio"&&"(Audio Only)"]})]}),ve.length>0&&N.jsxs("div",{className:"video-tile",children:[N.jsx("video",{className:"user-video",playsInline:!0,ref:We,autoPlay:!0,style:{display:Ge==="audio"?"none":"block"}}),N.jsxs("div",{className:"video-label",children:[D?rt(D.email):"Partner",Ge==="audio"&&" (Audio Only)"]})]}),Ye&&N.jsxs("div",{className:"call-status",children:["Calling ",D?rt(D.email):"","..."]})]})]}),N.jsx("div",{className:"notification-panel",children:X.map(at=>N.jsx("div",{className:"notification",children:at.text},at.id))})]})}function kre(){return N.jsxs(N.Fragment,{children:[N.jsx($_,{}),N.jsx("div",{className:"mt-16",children:N.jsx(Dre,{})})]})}function Pre(){let{userData:o}=J.useContext(dc);return N.jsxs(mX,{children:[N.jsx(hl,{path:"/",element:o?N.jsxs(N.Fragment,{children:[N.jsx($_,{}),N.jsx(tie,{})]}):N.jsx(P_,{to:"/login"})}),N.jsx(hl,{path:"/signup",element:o?N.jsx(P_,{to:"/"}):N.jsx(xie,{})}),N.jsx(hl,{path:"/login",element:o?N.jsx(P_,{to:"/"}):N.jsx(Uie,{})}),N.jsx(hl,{path:"/network",element:o?N.jsx(Bie,{}):N.jsx(P_,{to:"/login"})}),N.jsx(hl,{path:"/profile",element:o?N.jsx(Hie,{}):N.jsx(P_,{to:"/login"})}),N.jsx(hl,{path:"/notification",element:o?N.jsx(Wie,{}):N.jsx(P_,{to:"/login"})}),N.jsx(hl,{path:"/chat",element:N.jsx(kre,{})}),N.jsx(hl,{path:"/jobs",element:N.jsx(wre,{})}),N.jsx(hl,{path:"/jobs/new",element:N.jsx(Are,{})})]})}Cq.createRoot(document.getElementById("root")).render(N.jsx(VX,{children:N.jsx(dJ,{children:N.jsx(BZ,{children:N.jsx(Pre,{})})})}))});export default Lre();
